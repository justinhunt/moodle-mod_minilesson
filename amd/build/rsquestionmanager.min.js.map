{"version":3,"sources":["../src/rsquestionmanager.js"],"names":["define","$","log","templates","def","mfh","mdh","mih","mph","dplh","datatables","ModalFactory","ModalEvents","debug","cmid","controls","rowIds","init","props","dd","contextid","tableid","modaleditform","wwwroot","datatag","lessonitems","JSON","parse","val","remove","modalshow","register_events","process_html","collate_rowids","hide_useless_arrows","questionstable","getDataTable","questionscontainer","itemscontainer","noquestionscontainer","noitemscontainer","movearrows","movearrow","rows","every","rowindex","itemorder","cell","row","column","data","attr","rowcount","length","bottomrowindex","bottomtr","node","find","toprowindex","toptr","renumber_rows","fromorder","thetable","move_row","itemid","direction","therow","itemrow","currentrow","currentindex","index","currentorder","parseInt","targetorder","targetindex","from","to","draw","after_questionedit","item","decodeURIComponent","name","after_questionadd","id","up","down","render","then","html","add","page","hide","show","component","on","editurl","window","location","href","after_questiondelete","itemcount","count","after_questionmove","after_questionpreview","after_questionduplicate","$resp","ret","newitemid","newitemname","type","icon","typelabel","context","create","types","CANCEL","body","modal","setLarge","getRoot","addClass","shown","modalRoot","e","preventDefault","stopPropagation","stopImmediatePropagation","selector","getAttribute","allpanels","alllinks","target","hasClass","removeClass","trigger","setAttribute","addbtn","videocontroller","hidden","each","pause","currentTime","destroy","rootel","video","get","source","load","play"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log','core/templates','mod_minilesson/definitions','mod_minilesson/modalformhelper',\n        'mod_minilesson/modaldeletehelper','mod_minilesson/moveitemhelper','mod_minilesson/modalpreviewhelper',\n        'mod_minilesson/duplicateitemhelper','mod_minilesson/datatables', 'core/modal_factory', 'core/modal_events'],\n    function($,  log, templates, def, mfh, mdh, mih, mph,dplh, datatables, ModalFactory, ModalEvents) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('RSQuestion manager: initialising');\n\n    return {\n\n        cmid: null,\n        controls: null,\n        rowIds: [],\n\n\n        //pass in config\n        init: function(props){\n            var dd = this;\n            dd.contextid=props.contextid;\n            dd.tableid = props.tableid;\n            dd.modaleditform = props.modaleditform;\n            dd.cmid = props.cmid;\n            dd.wwwroot = props.wwwroot;\n\n            //fetch lesson items from hidden input\n            var datatag = $('#' + props.lessonitems);\n            dd.lessonitems = JSON.parse(datatag.val());\n            datatag.remove(); //we dont need it any more\n\n            dd.modalshow();\n            dd.register_events();\n            dd.process_html();\n            dd.collate_rowids();\n            dd.hide_useless_arrows();\n        },\n\n        process_html: function(){\n            this.controls = [];\n            this.controls.questionstable = datatables.getDataTable(this.tableid);\n            this.controls.questionscontainer = $('#' + def.itemscontainer);\n            this.controls.noquestionscontainer = $('#' + def.noitemscontainer);\n            this.controls.movearrows=$('#' + def.movearrow);\n        },\n\n        //we maintain an array of datatable rowids, indexed by itemorder\n        //we need this because moving, adding, deleting requires access to datatable rowid\n        collate_rowids: function(){\n            var dd = this;\n            dd.rowIds=[];\n\n            dd.controls.questionstable.rows().every( function ( rowindex, tableLoop, rowLoop ) {\n                var itemorder = dd.controls.questionstable.cell({row:rowindex, column:1}).data();\n                dd.rowIds[itemorder]=rowindex;\n            } );\n        },\n\n        //we wont to show move arrows, but hide arrows the final down and first up\n        hide_useless_arrows: function(){\n          //first lets show all the arrows\n          $('.mod_minilesson_item_move').attr('style','');\n\n          //if no rows just get out of here.\n          var rowcount=this.controls.questionstable.data().length;\n          if(!rowcount || rowcount<1){return;}\n\n          //hide bottom down arrow\n          var bottomrowindex=this.rowIds[rowcount];\n          var bottomtr = this.controls.questionstable.row(bottomrowindex).node();\n          $(bottomtr).find('.mod_minilesson_item_move[data-direction=\"down\"]').attr('style','visibility: hidden;');\n\n          //hide top up arrow\n          var toprowindex=this.rowIds[1];\n          var toptr = this.controls.questionstable.row(toprowindex).node();\n          $(toptr).find('.mod_minilesson_item_move[data-direction=\"up\"]').attr('style','visibility: hidden;');\n        },\n\n        // we need to renumber rows when we remove one, so we start from there and renumber the next ones\n        renumber_rows:function(fromorder) {\n\n            var thetable= this.controls.questionstable;\n            var rowcount = thetable.data().length;\n            for(var itemorder =fromorder; itemorder<rowcount;itemorder++){\n                var rowindex = this.rowIds[itemorder+1];\n                thetable.cell({row:rowindex, column:1}).data(itemorder);\n            }\n        },\n\n        move_row:function(itemid, direction) {\n            var thetable= this.controls.questionstable;\n            var therow = '#' + def.itemrow + '_' + itemid;\n            var currentrow = thetable.row(therow);\n            var currentindex = currentrow.index();\n            var currentorder = parseInt(thetable.cell({row:currentindex, column:1}).data());\n\n\n            var targetorder;\n            if(direction==\"up\"){\n                targetorder=currentorder-1;\n            } else if(direction==\"down\"){\n                targetorder=currentorder+1;\n            }\n\n            //should never arrive here pitching for out of range. But just in case\n            if(targetorder<1){return;}\n            var rowcount = thetable.data().length;\n            if(targetorder>rowcount){return;}\n\n            var targetindex = this.rowIds[targetorder];\n            var from = thetable.cell({row:currentindex, column:1}).data();\n            var to = thetable.cell({row:targetindex, column:1}).data();\n            thetable.cell({row:currentindex, column:1}).data(to);\n            thetable.cell({row:targetindex, column:1}).data(from);\n            thetable.draw(false);\n            this.collate_rowids();\n            \n        },\n        register_events: function() {\n          \n            var dd = this;\n        \n\n            var after_questionmove= function(itemid, direction) {\n                dd.move_row(itemid,direction);\n                dd.hide_useless_arrows();\n            };\n\n            var after_questionedit= function(item, itemid) {\n                var therow = '#' + def.itemrow + '_' + itemid;\n                dd.controls.questionstable.cell($(therow + ' .c1')).data(decodeURIComponent(item.name));\n            };\n            var after_questionadd= function(item, itemid) {\n                item.id = itemid;\n                item.name = decodeURIComponent(item.name);\n                item.index = dd.controls.questionstable.data().length+1;\n                item.up = {'key': 't/up','component': 'moodle','title': 'up'};\n                item.down = {'key': 't/down','component': 'moodle','title': 'down'};\n                templates.render('mod_minilesson/itemlistitem',item).then(\n                    function(html,js){\n                        //add row move to the last page so we can see the new row if its off page\n                        dd.controls.questionstable.row.add($(html)[0]).page('last').draw(false);\n                        dd.collate_rowids();\n                        dd.hide_useless_arrows();\n                    }\n                );\n                dd.controls.noquestionscontainer.hide();\n                dd.controls.questionscontainer.show();\n            };\n            var after_questionduplicate= function($resp) {\n\n                var ret = JSON.parse($resp);\n                var item={};\n                item.id = ret.newitemid;\n                item.name = decodeURIComponent(ret.newitemname);\n                item.type = ret.type;\n                item.icon = ret.icon;\n                item.typelabel = decodeURIComponent(ret.typelabel);\n                item.index = dd.controls.questionstable.data().length+1;\n                item.up = {'key': 't/up','component': 'moodle','title': 'up'};\n                item.down = {'key': 't/down','component': 'moodle','title': 'down'};\n                templates.render('mod_minilesson/itemlistitem',item).then(\n                    function(html,js){\n                        //add row move to the last page so we can see the new row if its off page\n                        dd.controls.questionstable.row.add($(html)[0]).page('last').draw(false);\n                        dd.collate_rowids();\n                        dd.hide_useless_arrows();\n                    }\n                );\n                dd.controls.noquestionscontainer.hide();\n                dd.controls.questionscontainer.show();\n            };\n            var after_questiondelete= function(itemid) {\n                log.debug('after question delete');\n                var therow=dd.controls.questionstable.row('#' + def.itemrow + '_' + itemid);\n                var itemorder=parseInt(therow.data()[0]);\n                dd.renumber_rows(itemorder);\n                therow.remove().draw(false);\n                dd.collate_rowids();\n                dd.hide_useless_arrows();\n                var itemcount = dd.controls.questionstable.rows().count();\n                if(!itemcount){\n                    dd.controls.noquestionscontainer.show();\n                    dd.controls.questionscontainer.hide();\n                }\n            };\n            var after_questionpreview= function(itemid) {\n                log.debug('after preview');\n                //we want to remove the question from DOM ... its still there and on subsequent shows, id will match on 2 elements and question will fail to unhide\n                $('#mod_minilesson_quiz_cont').remove();\n            };\n\n            //register ajax modal handler\n            var editcallback=function(item, itemid){console.log(item);};\n            var deletecallback=function(itemid){console.log(itemid);};\n            var addcallback=function(itemid){console.log(itemid);};\n            if(dd.modaleditform) {\n                mfh.init('.' + def.component + '_addlink', dd.contextid, after_questionadd);\n                //edit form helper\n                mfh.init('.' + def.itemrow + '_editlink', dd.contextid, after_questionedit);\n            }else{\n                $('.mod_minilesson_qpanel').on('click','.' + def.itemrow + '_editlink',function(){\n                    var editurl = dd.wwwroot + '/mod/minilesson/rsquestion/managersquestions.php?id=' + dd.cmid + '&itemid='+ $(this).data('id');\n                    log.debug('editurl ' + editurl);\n                    window.location.href=editurl;\n                    return false;\n                });\n            }\n            //delete helpser\n            mdh.init('.' + def.itemrow + '_deletelink', dd.contextid, 'deleteitem',after_questiondelete);\n            //move helper\n            mih.init('.' + def.movearrow , dd.contextid, after_questionmove);\n            //preview helper\n            mph.init('.' + def.itemrow + '_previewlink', dd.contextid, after_questionpreview);\n            //duplicate item helper\n            dplh.init('.' + def.itemrow + '_duplicatelink', dd.contextid, after_questionduplicate);\n        },\n\n            modalshow: function() {\n                var dd = this;\n                var context = {\n                    lessonitems: dd.lessonitems,\n                };\n                $('#additembtn').on('click', function() {\n                    ModalFactory.create({\n                        type: ModalFactory.types.CANCEL,\n                        body: templates.render('mod_minilesson/lessonitem', context),\n                    }).then(function (modal) {\n                        dd.modal = modal;\n                        dd.modal.setLarge();\n                        dd.modal.show();\n                        dd.modal.getRoot().find('.modal-header, .modal-footer').hide();\n                        dd.modal.getRoot().addClass('lessonitem-modal');\n\n                        dd.modal.getRoot().on(ModalEvents.shown, function() {\n                            modal.getRoot().find('.modal-dialog').addClass('modal-dialog-centered');\n                        });\n\n                        // on click of a lesson item link, show the relevant description panel, hide the others\n                        var modalRoot = dd.modal.getRoot();\n                        modalRoot.on('click', 'a.lessonitem-link', function (e) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            if (e.stopImmediatePropagation) { e.stopImmediatePropagation(); }\n\n                            const selector = this.getAttribute('data-toggletarget');\n                            const allpanels = modalRoot.find('.lessonitem-description');\n                            const alllinks = modalRoot.find('.lessonitem-link');\n                            if (!selector) {\n                                log.debug('No toggle target specified');\n                                return;\n                             }\n                            const target = modalRoot.find(selector);\n                            if (!target) {\n                                log.debug('No target found for selector ' + selector);\n                                return;\n                            }\n\n                            // Show the correct panel and hide the others.\n                            if (target.hasClass('show')) {\n                                log.debug('already visible do nothing ');\n                                // Already shown, do nothing.\n                                return;\n                            } else {\n                                log.debug('not visible, showing now');\n                                // Hide all others.\n                                allpanels.removeClass('show').trigger('lessonitem:hidden');\n                                // Not shown, show it.\n                                target.addClass('show').trigger('lessonitem:shown');\n                                \n                                // Set all other links to aria-expanded false\n                                alllinks.attr('aria-expanded', 'false');\n                                // Show this one.\n                                this.setAttribute('aria-expanded', 'true');\n                            }\n                        });\n\n                        // If they click the add button , lets turn it into a spinner\n                        modalRoot.on('click', 'a.addbtn', function (e) {\n\n                            const addbtn = $(this);\n                            if (addbtn.hasClass('ml_loading')) {\n                                // Already loading, do nothing.\n                                return;\n                            }\n                            addbtn.addClass('ml_loading');\n                            addbtn.html(\"<i class='icon fa fa-spinner fa-pulse fa-fw ' aria-hidden='true'></i> \");\n                        });\n\n                        dd.videocontroller(dd.modal.getRoot());\n\n                        dd.modal.getRoot().on(ModalEvents.hidden, function() {\n                            $(this).find('video').each(function() {\n                                this.pause();\n                                this.currentTime = 0;\n                                dd.modal.destroy();\n                            });\n                        });\n\n\n                        return dd.modal;\n                    });\n                });\n            },\n\n\n            videocontroller: function(rootel) {\n                $(rootel).on('shown.bs.collapse lessonitem:shown', '.lessonitem-description', function() {\n                    var video = $(this).find('video').get(0);\n                    if (video) {\n                        var source = $(video).find('source');\n                        if (source.length && source.attr('data-src') && !source.attr('src')) {\n                            source.attr('src', source.attr('data-src'));\n                            video.load();\n                        }\n                        video.play();\n                    }\n                });\n            \n\n                $(rootel).on('hide.bs.collapse lessonitem:hidden', '.lessonitem-description', function() {\n                    var video = $(this).find('video').get(0);\n                    if (video) {\n                        video.pause();\n                        video.currentTime = 0;\n                    }\n                });\n            }\n\n    };//end of returned object\n});//total end\n"],"file":"rsquestionmanager.min.js"}