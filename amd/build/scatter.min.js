define ("mod_minilesson/scatter",["jquery","core/notification","mod_minilesson/definitions","core/log","core/templates","mod_minilesson/animatecss","core/ajax","core/str","mod_minilesson/spacegame","core/url"],function(a,b,c,d,e,f,g,h,i,j){"use strict";d.debug("MiniLesson Scatter: initialising");return{pointer:1,jsondata:null,props:null,language:"en-US",startTime:null,scatteritems:[],controls:{},progressTimer:null,markedIndex:[],clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b,c){var e=this;d.debug(b);e.scatteritems=b.scatteritems;e.language=b.language;e.itemdata=b;e.index=a;e.quizhelper=c;var g={useanimatecss:c.useanimatecss};f.init(g);this.init_controls();this.register_events();this.start()},init_controls:function init_controls(){var b=this;b.controls={container:a("#"+b.itemdata.uniqueid+"_container")};b.controls.stage=b.controls.container.find(".ml_scatter_stage");b.controls.next_button=b.controls.container.find(".minilesson_nextbutton");b.controls.progress_container=b.controls.container.find(".progress-container");b.controls.result_container=b.controls.container.find(".ml_scatter_resultscontainer");b.controls.actionbutton=b.controls.container.find(".minilesson_actionbutton");b.controls.retrybutton=b.controls.container.find(".minilesson-try-again");b.controls.questionheader_contents=b.controls.container.find(".minilesson_questionheader_contents");b.controls.itemtext=b.controls.container.find(".mod_minilesson_itemtext ");var c=b.controls.stage.children(".ml_scatter_listitem");c.each(function(a,c){b.itemdata.shuffleditems[a].item=c})},shuffleItems:function shuffleItems(){var a=this,b=Array.from(a.itemdata.shuffleditems),c=b.length,d;while(0!=c){d=Math.floor(Math.random()*c);c--;var e=[b[d],b[c]];b[c]=e[0];b[d]=e[1]}a.itemdata.shuffleditems=b;a.itemdata.shuffleditems.forEach(function(b){b.item.classList.remove("selected","matched","shake");a.controls.stage.append(b.item)})},check_crosscard:function check_crosscard(b){var c=this,d=a(b.target),e=c.controls.stage.children(".ml_scatter_listitem");if(!e.is(d)){return}e.filter(function(a,b){return!b.classList.contains("matched")}).removeClass("shake");var f=d.index();if(0==c.markedIndex.length){c.markedIndex.push(f)}else if(c.markedIndex.includes(f)){var j=c.markedIndex.findIndex(function(a){return a===f});if(-1<j){c.markedIndex.slice(j,1)}}else{var g=c.markedIndex[0],h=c.itemdata.shuffleditems[g],i=c.itemdata.shuffleditems[f];c.markedIndex.push(f);if(h.key===i.key){c.itemdata.scatteritems[i.key].correct=!0;setTimeout(function(){e.eq(g).addClass("matched");e.eq(f).addClass("matched");if(!e.filter(":not(.matched)").length){c.end()}c.markedIndex=[]},200)}else{c.itemdata.scatteritems[i.key].correct=!1;e.eq(g).addClass("shake");e.eq(f).addClass("shake");setTimeout(function(){e.eq(g).removeClass("selected shake");e.eq(f).removeClass("selected shake");c.markedIndex=[]},300)}}c.markedIndex.forEach(function(a){e.eq(a).addClass("selected")});if(!e.filter(":not(.matched)").length){c.end()}},next_question:function next_question(){var a=this,b={};b.index=a.index;b.hasgrade=!0;b.totalitems=a.itemdata.scatteritems.length;b.correctitems=a.itemdata.scatteritems.filter(function(a){return a.correct}).length;b.grade=Math.round(100*(b.correctitems/b.totalitems));a.quizhelper.do_next(b)},register_events:function register_events(){var b=this;b.controls.stage.on("click",b.check_crosscard.bind(b));b.controls.stage.on("keydown",function(c){if(" "===c.key||"Spacebar"===c.key){var d=a(document.activeElement);if(d.hasClass("ml_scatter_listitem")){b.check_crosscard.call(b,{target:document.activeElement});c.preventDefault()}}});b.controls.container.on("showElement",function(){if(0<b.itemdata.timelimit){b.controls.progress_container.show();b.controls.progress_container.find("i").show();if(b.progressTimer){clearInterval(b.progressTimer);b.progressTimer=null}b.progressTimer=b.controls.progress_container.find("#progresstimer").progressTimer({height:"5px",timeLimit:b.itemdata.timelimit,onFinish:function onFinish(){b.end()}}).attr("timer")}b.startTime=Date.now()});b.controls.container.on("click","#minilesson-try-again",function(){b.startTime=null;b.markedIndex=[];b.shuffleItems();b.controls.container.trigger("showElement");b.controls.result_container.hide();b.controls.stage.show();b.controls.progress_container.find("#progresstimer,i").show();b.itemdata.scatteritems.forEach(function(a){a.correct=!1});b.controls.actionbutton.show()});b.controls.container.on("keydown","#minilesson-try-again",function(b){if(" "===b.key||"Spacebar"===b.key){a(this).trigger("click");b.preventDefault()}});b.controls.next_button.on("click",function(){b.next_question()});b.controls.next_button.on("keydown",function(b){if(" "===b.key||"Spacebar"===b.key){a(this).trigger("click");b.preventDefault()}})},start:function start(){},end:function end(){var a=this,b={prettytime:"00:00",results:[]},c=Date.now()-a.startTime;if(0<c){c=Number.parseFloat(c/1e3).toFixed(0)}if(0<c){b.prettytime=i.pretty_print_secs(c)}b.showitemreview=a.quizhelper.showitemreview;b.allowretry=a.itemdata.allowretry;b.total=a.itemdata.scatteritems.length;b.totalcorrect=a.itemdata.scatteritems.filter(function(a){return a.correct}).length;a.itemdata.scatteritems.forEach(function(a){b.results.push({question:a.term,answer:a.definition,correct:a.correct})});a.controls.result_container.show();a.controls.stage.hide();a.controls.progress_container.hide();a.controls.actionbutton.hide();if(a.progressTimer){clearInterval(a.progressTimer);a.progressTimer=null}b.yellow_starImgurl=j.imageUrl("yellow_star","mod_minilesson");b.timerImgurl=j.imageUrl("timer","mod_minilesson");a.controls.questionheader_contents.hide();a.controls.itemtext.hide();e.render("mod_minilesson/scatter_feedback",b).then(function(b,c){a.controls.result_container.html(b);e.runTemplateJS(c||"");try{var f=a.controls.result_container,g=f.find(".ml-scatter-btn"),h=f.find("#ml-scatter-fb-container");if(h.length&&g.length){function a(a){if(a){g.find(".ml-scatter-show-text").addClass("d-none");g.find(".ml-scatter-hide-text").removeClass("d-none")}else{g.find(".ml-scatter-show-text").removeClass("d-none");g.find(".ml-scatter-hide-text").addClass("d-none")}}a(h.hasClass("show"));h.on("shown.bs.collapse",function(){a(!0)});h.on("hidden.bs.collapse",function(){a(!1)});g.on("click",function(){a(h.hasClass("show"))})}}catch(a){d.debug("Error attaching collapse toggle handlers: "+a)}})}}});
//# sourceMappingURL=scatter.min.js.map
