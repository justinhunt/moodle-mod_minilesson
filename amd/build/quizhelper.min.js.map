{"version":3,"file":"quizhelper.min.js","sources":["../src/quizhelper.js"],"sourcesContent":["define(\n    ['jquery', 'core/log', 'mod_minilesson/definitions', 'core/templates', 'core/ajax',\n    'mod_minilesson/dictation', 'mod_minilesson/dictationchat', 'mod_minilesson/multichoice','mod_minilesson/multiaudio',\n        'mod_minilesson/speechcards', 'mod_minilesson/listenrepeat',\n        'mod_minilesson/page','mod_minilesson/smartframe','mod_minilesson/shortanswer',\n        'mod_minilesson/listeninggapfill','mod_minilesson/typinggapfill','mod_minilesson/speakinggapfill',\n        'mod_minilesson/spacegame','mod_minilesson/fluency','mod_minilesson/freespeaking',\n        'mod_minilesson/freewriting','mod_minilesson/passagereading','mod_minilesson/h5p',\n        'mod_minilesson/conversation','mod_minilesson/compquiz','mod_minilesson/passagegapfill',\n        'mod_minilesson/audiochat','mod_minilesson/wordshuffle','mod_minilesson/scatter',\n        'mod_minilesson/slides', 'mod_minilesson/fiction', 'mod_minilesson/progresstimer'],\n    function (\n        $,\n        log,\n        def,\n        templates,\n        Ajax,\n        dictation,\n        dictationchat,\n        multichoice,\n        multiaudio,\n        speechcards,\n        listenrepeat,\n        page,\n        smartframe,\n        shortanswer,\n        listeninggapfill,\n        typinggapfill,\n        speakinggapfill,\n        spacegame,\n        fluency,\n        freespeaking,\n        freewriting,\n        passagereading,\n        h5p,\n        conversation,\n        compquiz,\n        passagegapfill,\n        audiochat,\n        wordshuffle,\n        scatter,\n        slides,\n        fiction,\n        progresstimer\n    ) {\n        \"use strict\"; // jshint ;_;\n\n      /*\n      This file is to manage the quiz stage\n       */\n\n        log.debug('MiniLesson Quiz helper: initialising');\n\n        return {\n\n          //original spliton_regexp: new RegExp(/([,.!?:;\" ])/, 'g'),\n            // V2 spliton_regexp new RegExp(/([!\"# ¡¿$%&'()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~])/, 'g'),\n            //v3 we removed the apostrophe because it was not counting words correcting in listen and speak\n            spliton_regexp: new RegExp(/([!\"# ¡¿$%&()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~])/, 'g'),\n          //nopunc is diff to split on because it does not match on spaces\n            nopunc_regexp: new RegExp(/[!\"#¡¿$%&'()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~]/,'g'),\n            nonspaces_regexp: new RegExp(/[^ ]/,'g'),\n            autoplaydelay: 800,\n\n            controls: {},\n            submitbuttonclass: 'mod_minilesson_quizsubmitbutton',\n            stepresults: [],\n\n            init: function (quizcontainer, activitydata, cmid, attemptid,polly) {\n                this.quizdata = activitydata.quizdata;\n                this.region = activitydata.region;\n                this.ttslanguage = activitydata.ttslanguage;\n                this.controls.quizcontainer = quizcontainer;\n                this.attemptid = attemptid;\n                this.courseurl = activitydata.courseurl;\n                this.cmid = cmid;\n                this.reattempturl = decodeURIComponent(activitydata.reattempturl).replace(/&amp;/g, \"&\");\n                this.activityurl = decodeURIComponent(activitydata.activityurl).replace(/&amp;/g, \"&\");\n                this.backtocourse = activitydata.backtocourse;\n                this.stt_guided = activitydata.stt_guided;\n                this.wwwroot = activitydata.wwwroot;\n                this.useanimatecss  = activitydata.useanimatecss;\n                this.showitemreview  = activitydata.showitemreview;\n                this.stepresults = activitydata.stepresults;\n\n                this.prepare_html();\n                this.init_questions(this.quizdata,polly);\n                this.register_events();\n                this.start_quiz();\n            },\n\n            prepare_html: function () {\n\n              // this.controls.quizcontainer.append(submitbutton);\n                this.controls.quizfinished = $(\"#mod_minilesson_quiz_finished\");\n\n            },\n\n            init_questions: function (quizdata, polly) {\n                var dd = this;\n                $.each(quizdata, function (index, item) {\n                    switch (item.type) {\n                        case def.qtype_dictation:\n                            dictation.clone().init(index, item, dd, polly);\n                        break;\n                        case def.qtype_dictationchat:\n                            dictationchat.clone().init(index, item, dd, polly);\n                        break;\n                        case def.qtype_multichoice:\n                            multichoice.clone().init(index, item, dd);\n                        break;\n                        case def.qtype_multiaudio:\n                            multiaudio.clone().init(index, item, dd);\n                          break;\n                        case def.qtype_speechcards:\n                          //speechcards init needs to occur when it is visible. lame.\n                          // so we do that in do_next function, down below\n                            speechcards.clone().init(index, item, dd);\n                        break;\n                        case def.qtype_listenrepeat:\n                            listenrepeat.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_page:\n                            page.clone().init(index, item, dd);\n                          break;\n\n                        case def.qtype_smartframe:\n                            smartframe.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_shortanswer:\n                            shortanswer.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_listeninggapfill:\n                            listeninggapfill.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_typinggapfill:\n                            typinggapfill.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_speakinggapfill:\n                            speakinggapfill.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_spacegame:\n                            spacegame.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_fluency:\n                            fluency.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_freespeaking:\n                            freespeaking.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_freewriting:\n                            freewriting.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_passagereading:\n                            passagereading.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_h5p:\n                            h5p.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_conversation:\n                            conversation.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_compquiz:\n                            compquiz.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_passagegapfill:\n                            passagegapfill.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_audiochat:\n                            audiochat.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_wordshuffle:\n                            wordshuffle.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_scatter:\n                            scatter.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_slides:\n                            slides.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_fiction:\n                            fiction.clone().init(index, item, dd);\n                        break;\n                    }\n\n                });\n\n              //TTS in question headers\n                $(\"audio.mod_minilesson_itemttsaudio\").each(function () {\n                    var that = this;\n                    polly.fetch_polly_url($(this).data('text'), $(this).data('ttsoption'), $(this).data('voice')).then(function (audiourl) {\n                        $(that).attr(\"src\", audiourl);\n                    });\n                });\n\n            },\n\n            register_events: function () {\n                $('.' + this.submitbuttonclass).on('click', function () {\n                  //do something\n                });\n            },\n            render_quiz_progress:function (current,total) {\n                var array = [];\n                for (var i = 0; i < total; i++) {\n                    array.push(i);\n                }\n\n                if (total <= 1) {\n                    $(\".minilesson_quiz_progress\").hide();\n                    return;\n                }\n\n                if (total < 6) {\n                    var slice = array.slice(0, 5);\n                    var slicelength = slice.length > 1 ? (slice.length - 1) : slice.length;\n                    var itemWidth = 100 / slicelength;\n                    var innerclass,innerhtml,html = \"\";\n                    slice.forEach(function (i) {\n                        innerclass = i < current ? \"minilesson_quiz_progress_completed\" : \"minilesson_quiz_progress_incompleted\";\n                        innerhtml = (i !== (slice.length - 1)) ? \"<div class='\" + innerclass + \"' style='width: \" + itemWidth + \"%; '></div>\" : \"\";\n                        html += \"<div class='minilesson_quiz_progress_item \" +\n                        (i === current ? 'minilesson_quiz_progress_item_current' : '') + \" \" +\n                        (i < current ? 'minilesson_quiz_progress_item_completed' : '') + \"'>\" +\n                        (i < current ? '<i class=\"fa fa-check\"></i>' : i + 1) + \"</div>\" + innerhtml;\n                    });\n                } else {\n                    if (current > total - 6) {\n                        var slice = array.slice(total - 5, total - 1);\n                    } else {\n                        var slice = array.slice(current, current + 4);\n                    }\n                    var slicelength = slice.length > 1 ? (slice.length - 1) : slice.length;\n                    var itemWidth = 100 / slicelength;\n                    var html = \"\",innerhtml,innerclass;\n                    var lastvalue = slice[slice.length - 1];\n                    slice.forEach(function (i) {\n                        html += \"<div class='minilesson_quiz_progress_item \" + (i === current ? 'minilesson_quiz_progress_item_current' : '') + \" \" + (i < current ? 'minilesson_quiz_progress_item_completed' : '') + \"'>\" + (i < current ? '<i class=\"fa fa-check\"></i>' : i + 1) + \"</div>\";\n                        innerclass = (i === lastvalue && i < total - 2) ? \"minilesson_quiz_progress_dashedline\" : i < current ? \"minilesson_quiz_progress_completed\" : \"minilesson_quiz_progress_incompleted\";\n                        innerhtml = \"<div class='\" + innerclass + \"' style='width: \" + itemWidth + \"%; '></div>\";\n                        html += innerhtml;\n                    });\n                    //end marker\n                    html += \"<div class='minilesson_quiz_progress_finalitem'>\" + (total) + \"</div>\";\n                }\n\n                html += \"\";\n                $(\".minilesson_quiz_progress\").html(html);\n\n            },\n\n            do_next: function (stepdata) {\n                var dd = this;\n              //get current question\n                var currentquizdataindex =   stepdata.index;\n                var currentitem = this.quizdata[currentquizdataindex];\n              //in preview mode do no do_next\n                if (currentitem.preview === true) {\n                    return;}\n\n              //post grade\n               // log.debug(\"reporting step grade\");\n                dd.report_step_grade(stepdata);\n               // log.debug(\"reported step grade\");\n\n              //show next question or End Screen\n                if (dd.quizdata.length > currentquizdataindex + 1) {\n                  // we want to hide current question - before show new one\n                    var theoldquestion = $(\"#\" + currentitem.uniqueid + \"_container\");\n                    theoldquestion.hide();\n\n                    var nextindex = currentquizdataindex + 1;\n                    var nextitem = this.quizdata[nextindex];\n                    //show the question\n                    $(\"#\" + nextitem.uniqueid + \"_container\").show().trigger(\"showElement\");\n                  //any per question type init that needs to occur can go here\n                    switch (nextitem.type) {\n                        case def.qtype_speechcards:\n                            //speechcards.init(nextindex, nextitem, dd);\n                            break;\n                        case def.qtype_dictation:\n                        case def.qtype_dictationchat:\n                        case def.qtype_multichoice:\n                        case def.qtype_multiaudio:\n                        case def.qtype_listenrepeat:\n                        case def.qtype_smartframe:\n                        case def.qtype_shortanswer:\n                        case def.qtype_spacegame:\n                        case def.qtype_fluency:\n                        case def.qtype_freespeaking:\n                        case def.qtype_freewriting:\n                        case def.qtype_passagereading:\n                        case def.qtype_h5p:\n                        case def.qtype_conversation:\n                        case def.qtype_compquiz:\n                        case def.qtype_audiochat:\n                        case def.qtype_slides:\n                        case def.qtype_fiction:\n                        default:\n                    }//end of nextitem switch\n\n                  //autoplay audio if we need to\n                    var ttsquestionplayer = $(\"#\" + nextitem.uniqueid + \"_container audio.mod_minilesson_itemttsaudio\");\n                    if (ttsquestionplayer.data('autoplay') == \"1\") {\n                        var that = this;\n                        setTimeout(function () {\n                            ttsquestionplayer[0].play();}, that.autoplaydelay);\n                    }\n                } else {\n                  //just reload and re-fetch all the data to display\n                    $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n                    window.location.href = dd.activityurl;\n                    /*\n                    setTimeout(function () {\n                    log.debug(\"forwarding to finished page\");\n                    window.location.href=dd.activityurl;\n                    }, 500);\n                    */\n\n                    return;\n\n                  //no longer do this\n                    /*\n                  var results = dd.stepresults.filter(function(e){return e.hasgrade;});\n                  var correctitems = 0;\n                  var totalitems = 0;\n                  results.forEach(function(result,i){\n                    result.index=i+1;\n                    result.title=dd.quizdata[i].title;\n                    correctitems += result.correctitems;\n                    totalitems += result.totalitems;\n                  });\n                  var totalpercent = Math.round((correctitems/totalitems)*100);\n                  console.log(results,correctitems,totalitems,totalpercent);\n                  var finishedparams ={results:results,total:totalpercent, courseurl: this.courseurl};\n                  if(this.reattempturl!=''){finishedparams.reattempturl = this.reattempturl;}\n                  if(this.backtocourse!=''){finishedparams.backtocourse = true;}\n                  templates.render('mod_minilesson/quizfinished',finishedparams).then(\n                    function(html,js){\n                    dd.controls.quizfinished.html(html);\n                    dd.controls.quizfinished.show();\n                    templates.runTemplateJS(js);\n                    }\n                  );\n                  */\n                }//end of if has more questions\n\n                this.render_quiz_progress(stepdata.index + 1,this.quizdata.length);\n\n              //we want to destroy the old question in the DOM also because iframe/media content might be playing\n                theoldquestion.remove();\n\n            },\n\n            report_step_grade: function (stepdata) {\n                var dd = this;\n\n              //store results locally\n                this.stepresults.push(stepdata);\n\n              //push results to server\n                var isasync = false;\n                var ret = Ajax.call([{\n                    methodname: 'mod_minilesson_report_step_grade',\n                    args: {\n                        cmid: dd.cmid,\n                        step: JSON.stringify(stepdata),\n                    },\n                }],isasync)[0];\n                log.debug(\"report_step_grade success: \" + ret);\n\n            },\n\n\n\n            start_quiz: function () {\n                const i = this.stepresults.length;\n                $(\"#\" + this.quizdata[i].uniqueid + \"_container\").show().trigger(\"showElement\");\n              //autoplay audio if we need to\n                var ttsquestionplayer = $(\"#\" + this.quizdata[i].uniqueid + \"_container audio.mod_minilesson_itemttsaudio\");\n                if (ttsquestionplayer.data('autoplay') == \"1\") {\n                    var that = this;\n                    setTimeout(function () {\n                        ttsquestionplayer[i].play();}, that.autoplaydelay);\n                }\n                this.render_quiz_progress(i,this.quizdata.length);\n            },\n\n          //this function is overridden by the calling class\n            onSubmit: function () {\n                alert('quiz submitted. Override this');\n            },\n\n            mobile_user: function () {\n\n                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n                    return true;\n                } else {\n                    return false;\n                }\n            },\n\n            chrome_user: function () {\n                if (/Chrome/i.test(navigator.userAgent)) {\n                    return true;\n                } else {\n                    return false;\n                }\n            },\n\n          //this will always be true these days\n            use_ttrecorder: function () {\n                return true;\n            },\n            is_stt_guided: function () {\n                return this.stt_guided;\n            },\n\n          //count words\n            count_words: function (transcript) {\n                return transcript.trim().split(/\\s+/).filter(function (word) {\n                    return word.length > 0;\n                }).length;\n            },\n\n          //text comparison functions follow===============\n\n            similarity: function (s1, s2) {\n              //we remove spaces because JP transcript and passage might be different. And who cares about spaces anyway?\n                s1 = s1.replace(/\\s+/g, '');\n                s2 = s2.replace(/\\s+/g, '');\n\n                var longer = s1;\n                var shorter = s2;\n                if (s1.length < s2.length) {\n                    longer = s2;\n                    shorter = s1;\n                }\n                var longerLength = longer.length;\n                if (longerLength === 0) {\n                    return 100;\n                }\n                return 100 * ((longerLength - this.editDistance(longer, shorter)) / parseFloat(longerLength));\n            },\n            editDistance: function (s1, s2) {\n                s1 = s1.toLowerCase();\n                s2 = s2.toLowerCase();\n\n                var costs = [];\n                for (var i = 0; i <= s1.length; i++) {\n                    var lastValue = i;\n                    for (var j = 0; j <= s2.length; j++) {\n                        if (i === 0) {\n                            costs[j] = j;\n                        } else {\n                            if (j > 0) {\n                                var newValue = costs[j - 1];\n                                if (s1.charAt(i - 1) !== s2.charAt(j - 1)) {\n                                    newValue = Math.min(\n                                        Math.min(newValue, lastValue),\n                                        costs[j]\n                                    ) + 1;\n                                }\n                                costs[j - 1] = lastValue;\n                                lastValue = newValue;\n                            }\n                        }\n                    }\n                    if (i > 0) {\n                        costs[s2.length] = lastValue;\n                    }\n                }\n                return costs[s2.length];\n            },\n\n            cleanText: function (text) {\n                var lowertext = text.toLowerCase();\n                var punctuationless = lowertext.replace(this.nopunc_regexp,\"\");\n                var ret = punctuationless.replace(/\\s+/g, \" \").trim();\n                return ret;\n            },\n\n          //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n            checkByPhonetic: function (passage, transcript, passagephonetic, language) {\n                return Ajax.call([{\n                    methodname: 'mod_minilesson_check_by_phonetic',\n                    args: {\n                        'spoken': transcript,\n                        'correct': passage,\n                        'language': language,\n                        'phonetic': passagephonetic,\n                        'region': this.region,\n                        'cmid': this.cmid\n                    },\n                    async: false\n                }])[0];\n\n            },\n\n            comparePassageToTranscript: function (passage,transcript,passagephonetic,language,alternatives=\"\") {\n                return Ajax.call([{\n                    methodname: 'mod_minilesson_compare_passage_to_transcript',\n                    args: {\n                        passage: passage,\n                        transcript: transcript,\n                        alternatives: alternatives,\n                        phonetic: passagephonetic,\n                        language: language,\n                        region: this.region,\n                        cmid: this.cmid\n                    },\n                    async: false\n                }])[0];\n            },\n\n          //this will return the promise, the result of which is an object containing marks, corrections and feedback\n            evaluateTranscript: function (transcript, itemid) {\n                return Ajax.call([{\n                    methodname: 'mod_minilesson_evaluate_transcript',\n                    args: {\n                        'transcript': transcript,\n                        'itemid': itemid,\n                        'cmid': this.cmid\n                    },\n                    async: false\n                }])[0];\n            },\n\n        }; //end of return value\n    }\n);\n"],"names":["define","$","log","def","templates","Ajax","dictation","dictationchat","multichoice","multiaudio","speechcards","listenrepeat","page","smartframe","shortanswer","listeninggapfill","typinggapfill","speakinggapfill","spacegame","fluency","freespeaking","freewriting","passagereading","h5p","conversation","compquiz","passagegapfill","audiochat","wordshuffle","scatter","slides","fiction","progresstimer","debug","spliton_regexp","RegExp","nopunc_regexp","nonspaces_regexp","autoplaydelay","controls","submitbuttonclass","stepresults","init","quizcontainer","activitydata","cmid","attemptid","polly","quizdata","region","ttslanguage","courseurl","reattempturl","decodeURIComponent","replace","activityurl","backtocourse","stt_guided","wwwroot","useanimatecss","showitemreview","prepare_html","init_questions","this","register_events","start_quiz","quizfinished","dd","each","index","item","type","qtype_dictation","clone","qtype_dictationchat","qtype_multichoice","qtype_multiaudio","qtype_speechcards","qtype_listenrepeat","qtype_page","qtype_smartframe","qtype_shortanswer","qtype_listeninggapfill","qtype_typinggapfill","qtype_speakinggapfill","qtype_spacegame","qtype_fluency","qtype_freespeaking","qtype_freewriting","qtype_passagereading","qtype_h5p","qtype_conversation","qtype_compquiz","qtype_passagegapfill","qtype_audiochat","qtype_wordshuffle","qtype_scatter","qtype_slides","qtype_fiction","that","fetch_polly_url","data","then","audiourl","attr","on","render_quiz_progress","current","total","array","i","push","hide","itemWidth","slice","length","html","forEach","innerclass","innerhtml","lastvalue","do_next","stepdata","currentquizdataindex","currentitem","preview","report_step_grade","prop","window","location","href","theoldquestion","uniqueid","nextindex","nextitem","show","trigger","ttsquestionplayer","setTimeout","play","remove","ret","call","methodname","args","step","JSON","stringify","onSubmit","alert","mobile_user","test","navigator","userAgent","chrome_user","use_ttrecorder","is_stt_guided","count_words","transcript","trim","split","filter","word","similarity","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","toLowerCase","costs","lastValue","j","newValue","charAt","Math","min","cleanText","text","checkByPhonetic","passage","passagephonetic","language","async","comparePassageToTranscript","alternatives","phonetic","evaluateTranscript","itemid"],"mappings":"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"}