{"version":3,"sources":["../src/quizhelper.js"],"names":["define","$","log","def","templates","Ajax","dictation","dictationchat","multichoice","multiaudio","speechcards","listenrepeat","page","smartframe","shortanswer","listeninggapfill","typinggapfill","speakinggapfill","spacegame","fluency","freespeaking","freewriting","passagereading","h5p","conversation","compquiz","passagegapfill","audiochat","wordshuffle","scatter","slides","debug","spliton_regexp","RegExp","nopunc_regexp","nonspaces_regexp","autoplaydelay","controls","submitbuttonclass","stepresults","init","quizcontainer","activitydata","cmid","attemptid","polly","quizdata","region","ttslanguage","courseurl","reattempturl","decodeURIComponent","replace","activityurl","backtocourse","stt_guided","wwwroot","useanimatecss","showitemreview","prepare_html","init_questions","register_events","start_quiz","quizfinished","dd","each","index","item","type","qtype_dictation","clone","qtype_dictationchat","qtype_multichoice","qtype_multiaudio","qtype_speechcards","qtype_listenrepeat","qtype_page","qtype_smartframe","qtype_shortanswer","qtype_listeninggapfill","qtype_typinggapfill","qtype_speakinggapfill","qtype_spacegame","qtype_fluency","qtype_freespeaking","qtype_freewriting","qtype_passagereading","qtype_h5p","qtype_conversation","qtype_compquiz","qtype_passagegapfill","qtype_audiochat","qtype_wordshuffle","qtype_scatter","qtype_slides","that","fetch_polly_url","data","then","audiourl","attr","on","render_quiz_progress","current","total","array","i","push","hide","slice","slicelength","length","itemWidth","innerclass","innerhtml","html","forEach","lastvalue","do_next","stepdata","currentquizdataindex","currentitem","preview","report_step_grade","theoldquestion","uniqueid","nextitem","show","trigger","ttsquestionplayer","setTimeout","play","prop","window","location","href","remove","ret","call","methodname","args","step","JSON","stringify","onSubmit","alert","mobile_user","test","navigator","userAgent","chrome_user","use_ttrecorder","is_stt_guided","count_words","transcript","trim","split","filter","word","similarity","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","toLowerCase","costs","lastValue","j","newValue","charAt","Math","min","cleanText","text","lowertext","punctuationless","checkByPhonetic","passage","passagephonetic","language","async","comparePassageToTranscript","alternatives","phonetic","evaluateTranscript","itemid"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions', 'core/templates', 'core/ajax',\n    'mod_minilesson/dictation', 'mod_minilesson/dictationchat', 'mod_minilesson/multichoice','mod_minilesson/multiaudio',\n        'mod_minilesson/speechcards', 'mod_minilesson/listenrepeat',\n        'mod_minilesson/page','mod_minilesson/smartframe','mod_minilesson/shortanswer',\n        'mod_minilesson/listeninggapfill','mod_minilesson/typinggapfill','mod_minilesson/speakinggapfill',\n        'mod_minilesson/spacegame','mod_minilesson/fluency','mod_minilesson/freespeaking',\n        'mod_minilesson/freewriting','mod_minilesson/passagereading','mod_minilesson/h5p',\n        'mod_minilesson/conversation','mod_minilesson/compquiz','mod_minilesson/passagegapfill',\n        'mod_minilesson/audiochat','mod_minilesson/wordshuffle','mod_minilesson/scatter',\n        'mod_minilesson/slides', 'mod_minilesson/progresstimer'],\n  function($, log, def, templates, Ajax, dictation, dictationchat, multichoice, multiaudio,\n           speechcards, listenrepeat, page, smartframe, shortanswer,\n           listeninggapfill,typinggapfill, speakinggapfill,\n           spacegame,fluency, freespeaking,freewriting,\n           passagereading,h5p,conversation,compquiz,passagegapfill,\n           audiochat,wordshuffle,scatter, slides, progresstimer) {\n    \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the quiz stage\n     */\n\n    log.debug('MiniLesson Quiz helper: initialising');\n\n    return {\n\n      //original spliton_regexp: new RegExp(/([,.!?:;\" ])/, 'g'),\n        // V2 spliton_regexp new RegExp(/([!\"# ¡¿$%&'()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~])/, 'g'),\n        //v3 we removed the apostrophe because it was not counting words correcting in listen and speak\n      spliton_regexp: new RegExp(/([!\"# ¡¿$%&()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~])/, 'g'),\n      //nopunc is diff to split on because it does not match on spaces\n      nopunc_regexp: new RegExp(/[!\"#¡¿$%&'()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~]/,'g'),\n      nonspaces_regexp: new RegExp(/[^ ]/,'g'),\n      autoplaydelay: 800,\n\n      controls: {},\n      submitbuttonclass: 'mod_minilesson_quizsubmitbutton',\n      stepresults: [],\n\n      init: function(quizcontainer, activitydata, cmid, attemptid,polly) {\n        this.quizdata = activitydata.quizdata;\n        this.region = activitydata.region;\n        this.ttslanguage = activitydata.ttslanguage;\n        this.controls.quizcontainer = quizcontainer;\n        this.attemptid = attemptid;\n        this.courseurl = activitydata.courseurl;\n        this.cmid = cmid;\n        this.reattempturl = decodeURIComponent(activitydata.reattempturl).replace(/&amp;/g, \"&\");\n        this.activityurl = decodeURIComponent(activitydata.activityurl).replace(/&amp;/g, \"&\");\n        this.backtocourse = activitydata.backtocourse;\n        this.stt_guided = activitydata.stt_guided;\n        this.wwwroot = activitydata.wwwroot;\n        this.useanimatecss  = activitydata.useanimatecss;\n        this.showitemreview  = activitydata.showitemreview;\n\n        this.prepare_html();\n        this.init_questions(this.quizdata,polly);\n        this.register_events();\n        this.start_quiz();\n      },\n\n      prepare_html: function() {\n\n        // this.controls.quizcontainer.append(submitbutton);\n        this.controls.quizfinished=$(\"#mod_minilesson_quiz_finished\");\n\n      },\n\n      init_questions: function(quizdata, polly) {\n        var dd = this;\n        $.each(quizdata, function(index, item) {\n          switch (item.type) {\n            case def.qtype_dictation:\n              dictation.clone().init(index, item, dd, polly);\n              break;\n            case def.qtype_dictationchat:\n              dictationchat.clone().init(index, item, dd, polly);\n              break;\n            case def.qtype_multichoice:\n              multichoice.clone().init(index, item, dd);\n              break;\n            case def.qtype_multiaudio:\n                multiaudio.clone().init(index, item, dd);\n                break;\n            case def.qtype_speechcards:\n              //speechcards init needs to occur when it is visible. lame.\n              // so we do that in do_next function, down below\n              speechcards.clone().init(index, item, dd);\n              break;\n            case def.qtype_listenrepeat:\n              listenrepeat.clone().init(index, item, dd);\n              break;\n\n             case def.qtype_page:\n                  page.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_smartframe:\n                  smartframe.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_shortanswer:\n                  shortanswer.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_listeninggapfill:\n                  listeninggapfill.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_typinggapfill:\n                  typinggapfill.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_speakinggapfill:\n                  speakinggapfill.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_spacegame:\n                spacegame.clone().init(index, item, dd);\n                break;\n\n              case def.qtype_fluency:\n                  fluency.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_freespeaking:\n                freespeaking.clone().init(index, item, dd);\n                break;\n\n              case def.qtype_freewriting:\n                freewriting.clone().init(index, item, dd);\n                break;\n\n              case def.qtype_passagereading:\n                passagereading.clone().init(index, item, dd);\n                break;\n\n              case def.qtype_h5p:\n                h5p.clone().init(index, item, dd);\n                break;\n\n              case def.qtype_conversation:\n                conversation.clone().init(index, item, dd);\n                break;\n\n              case def.qtype_compquiz:\n                compquiz.clone().init(index, item, dd);\n                break;\n\n              case def.qtype_passagegapfill:\n                  passagegapfill.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_audiochat:\n                  audiochat.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_wordshuffle:\n                  wordshuffle.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_scatter:\n                  scatter.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_slides:\n                  slides.clone().init(index, item, dd);\n                  break;\n          }\n\n        });\n\n        //TTS in question headers\n          $(\"audio.mod_minilesson_itemttsaudio\").each(function(){\n              var that=this;\n              polly.fetch_polly_url($(this).data('text'), $(this).data('ttsoption'), $(this).data('voice')).then(function(audiourl) {\n                  $(that).attr(\"src\", audiourl);\n              });\n          });\n\n      },\n\n      register_events: function() {\n        $('.' + this.submitbuttonclass).on('click', function() {\n          //do something\n        });\n      },\n      render_quiz_progress:function(current,total){\n        var array = [];\n        for(var i=0;i<total;i++){\n          array.push(i);\n        }\n\n        if (total <= 1) {\n          $(\".minilesson_quiz_progress\").hide();\n          return;\n        }\n\n        if(total<6) {\n            var slice = array.slice(0, 5);\n            var slicelength = slice.length > 1 ? (slice.length - 1) : slice.length;\n            var itemWidth = 100 / slicelength;\n            var innerclass,innerhtml,html = \"\";\n            slice.forEach(function (i) {\n                innerclass = i < current ? \"minilesson_quiz_progress_completed\" : \"minilesson_quiz_progress_incompleted\";\n                innerhtml = (i !== (slice.length-1)) ? \"<div class='\" + innerclass + \"' style='width: \"+ itemWidth +\"%; '></div>\" : \"\";\n                html += \"<div class='minilesson_quiz_progress_item \" +\n                (i === current ? 'minilesson_quiz_progress_item_current' : '') + \" \" +\n                (i < current ? 'minilesson_quiz_progress_item_completed' : '') + \"'>\" +\n                (i < current ? '<i class=\"fa fa-check\"></i>' : i + 1) + \"</div>\" + innerhtml;\n            });\n        }else {\n             if(current > total-6){\n                 var slice = array.slice(total-5, total-1);\n             }else{\n                 var slice = array.slice(current, current + 4);\n             }\n            var slicelength = slice.length > 1 ? (slice.length - 1) : slice.length;\n            var itemWidth = 100 / slicelength;\n            var html = \"\",innerhtml,innerclass;\n            var lastvalue = slice[slice.length - 1];\n            slice.forEach(function (i) {\n              html += \"<div class='minilesson_quiz_progress_item \" + (i === current ? 'minilesson_quiz_progress_item_current' : '') + \" \" + (i < current ? 'minilesson_quiz_progress_item_completed' : '') + \"'>\" + (i < current ? '<i class=\"fa fa-check\"></i>' : i + 1) + \"</div>\";\n              innerclass = (i === lastvalue && i < total - 2) ? \"minilesson_quiz_progress_dashedline\" : i < current ? \"minilesson_quiz_progress_completed\" : \"minilesson_quiz_progress_incompleted\";\n              innerhtml = \"<div class='\" + innerclass + \"' style='width: \"+ itemWidth +\"%; '></div>\";\n              html += innerhtml;\n            });\n              //end marker\n            html += \"<div class='minilesson_quiz_progress_finalitem'>\" + (total) + \"</div>\";\n          }\n\n        html+=\"\";\n        $(\".minilesson_quiz_progress\").html(html);\n\n      },\n\n      do_next: function(stepdata){\n        var dd = this;\n        //get current question\n        var currentquizdataindex =   stepdata.index;\n        var currentitem = this.quizdata[currentquizdataindex];\n        //in preview mode do no do_next\n        if(currentitem.preview===true){return;}\n\n        //post grade\n         // log.debug(\"reporting step grade\");\n        dd.report_step_grade(stepdata);\n         // log.debug(\"reported step grade\");\n\n        //show next question or End Screen\n        if (dd.quizdata.length > currentquizdataindex+1) {\n          // we want to hide current question - before show new one\n          var theoldquestion = $(\"#\" + currentitem.uniqueid + \"_container\");\n          theoldquestion.hide();\n\n          var nextindex = currentquizdataindex+ 1;\n          var nextitem = this.quizdata[nextindex];\n            //show the question\n            $(\"#\" + nextitem.uniqueid + \"_container\").show().trigger(\"showElement\");\n          //any per question type init that needs to occur can go here\n          switch (nextitem.type) {\n              case def.qtype_speechcards:\n                  //speechcards.init(nextindex, nextitem, dd);\n                  break;\n              case def.qtype_dictation:\n              case def.qtype_dictationchat:\n              case def.qtype_multichoice:\n              case def.qtype_multiaudio:\n              case def.qtype_listenrepeat:\n              case def.qtype_smartframe:\n              case def.qtype_shortanswer:\n              case def.qtype_spacegame:\n              case def.qtype_fluency:\n              case def.qtype_freespeaking:\n              case def.qtype_freewriting:\n              case def.qtype_passagereading:\n              case def.qtype_h5p:\n              case def.qtype_conversation:\n              case def.qtype_compquiz:\n              case def.qtype_audiochat:\n              default:\n          }//end of nextitem switch\n\n            //autoplay audio if we need to\n            var ttsquestionplayer = $(\"#\" + nextitem.uniqueid + \"_container audio.mod_minilesson_itemttsaudio\");\n            if(ttsquestionplayer.data('autoplay')==\"1\"){\n                var that=this;\n                setTimeout(function() {ttsquestionplayer[0].play();}, that.autoplaydelay);\n            }\n\n        } else {\n          //just reload and re-fetch all the data to display\n            $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n            window.location.href=dd.activityurl;\n            /*\n            setTimeout(function () {\n                log.debug(\"forwarding to finished page\");\n                window.location.href=dd.activityurl;\n            }, 500);\n            */\n\n          return;\n\n          //no longer do this\n            /*\n          var results = dd.stepresults.filter(function(e){return e.hasgrade;});\n          var correctitems = 0;\n          var totalitems = 0;\n          results.forEach(function(result,i){\n            result.index=i+1;\n            result.title=dd.quizdata[i].title;\n            correctitems += result.correctitems;\n            totalitems += result.totalitems;\n          });\n          var totalpercent = Math.round((correctitems/totalitems)*100);\n          console.log(results,correctitems,totalitems,totalpercent);\n          var finishedparams ={results:results,total:totalpercent, courseurl: this.courseurl};\n          if(this.reattempturl!=''){finishedparams.reattempturl = this.reattempturl;}\n          if(this.backtocourse!=''){finishedparams.backtocourse = true;}\n          templates.render('mod_minilesson/quizfinished',finishedparams).then(\n              function(html,js){\n                  dd.controls.quizfinished.html(html);\n                  dd.controls.quizfinished.show();\n                  templates.runTemplateJS(js);\n              }\n          );\n          */\n\n        }//end of if has more questions\n\n        this.render_quiz_progress(stepdata.index+1,this.quizdata.length);\n\n          //we want to destroy the old question in the DOM also because iframe/media content might be playing\n          theoldquestion.remove();\n\n      },\n\n      report_step_grade: function(stepdata) {\n        var dd = this;\n\n        //store results locally\n        this.stepresults.push(stepdata);\n\n        //push results to server\n        var isasync = false;\n        var ret = Ajax.call([{\n          methodname: 'mod_minilesson_report_step_grade',\n          args: {\n            cmid: dd.cmid,\n            step: JSON.stringify(stepdata),\n          },\n        }],isasync)[0];\n        log.debug(\"report_step_grade success: \" + ret);\n\n      },\n\n\n\n      start_quiz: function() {\n        $(\"#\" + this.quizdata[0].uniqueid + \"_container\").show().trigger(\"showElement\");\n          //autoplay audio if we need to\n          var ttsquestionplayer = $(\"#\" + this.quizdata[0].uniqueid + \"_container audio.mod_minilesson_itemttsaudio\");\n          if(ttsquestionplayer.data('autoplay')==\"1\"){\n              var that=this;\n              setTimeout(function() {ttsquestionplayer[0].play();}, that.autoplaydelay);\n          }\n        this.render_quiz_progress(0,this.quizdata.length);\n      },\n\n      //this function is overridden by the calling class\n      onSubmit: function() {\n        alert('quiz submitted. Override this');\n      },\n\n        mobile_user: function() {\n\n            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n                return true;\n            } else {\n                return false;\n            }\n        },\n\n        chrome_user: function(){\n            if(/Chrome/i.test(navigator.userAgent)) {\n                return true;\n            }else{\n                return false;\n            }\n        },\n\n        //this will always be true these days\n        use_ttrecorder: function(){\n            return true;\n        },\n        is_stt_guided: function(){\n          return this.stt_guided;\n        },\n\n        //count words\n        count_words: function(transcript) {\n          return transcript.trim().split(/\\s+/).filter(function(word) {\n              return word.length > 0;\n          }).length;\n        },\n\n        //text comparison functions follow===============\n\n        similarity: function(s1, s2) {\n            //we remove spaces because JP transcript and passage might be different. And who cares about spaces anyway?\n            s1 = s1.replace(/\\s+/g, '');\n            s2 = s2.replace(/\\s+/g, '');\n\n            var longer = s1;\n            var shorter = s2;\n            if (s1.length < s2.length) {\n                longer = s2;\n                shorter = s1;\n            }\n            var longerLength = longer.length;\n            if (longerLength === 0) {\n                return 100;\n            }\n            return 100 * ((longerLength - this.editDistance(longer, shorter)) / parseFloat(longerLength));\n        },\n        editDistance: function(s1, s2) {\n            s1 = s1.toLowerCase();\n            s2 = s2.toLowerCase();\n\n            var costs = [];\n            for (var i = 0; i <= s1.length; i++) {\n                var lastValue = i;\n                for (var j = 0; j <= s2.length; j++) {\n                    if (i === 0) {\n                        costs[j] = j;\n                    }else {\n                        if (j > 0) {\n                            var newValue = costs[j - 1];\n                            if (s1.charAt(i - 1) !== s2.charAt(j - 1)) {\n                                newValue = Math.min(Math.min(newValue, lastValue),\n                                    costs[j]) + 1;\n                            }\n                            costs[j - 1] = lastValue;\n                            lastValue = newValue;\n                        }\n                    }\n                }\n                if (i > 0) {\n                    costs[s2.length] = lastValue;\n                }\n            }\n            return costs[s2.length];\n        },\n\n        cleanText: function(text) {\n            var lowertext = text.toLowerCase();\n            var punctuationless = lowertext.replace(this.nopunc_regexp,\"\");\n            var ret = punctuationless.replace(/\\s+/g, \" \").trim();\n            return ret;\n        },\n\n        //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n        checkByPhonetic: function(passage, transcript, passagephonetic, language) {\n            return Ajax.call([{\n                methodname: 'mod_minilesson_check_by_phonetic',\n                args: {\n                    'spoken': transcript,\n                    'correct': passage,\n                    'language': language,\n                    'phonetic': passagephonetic,\n                    'region': this.region,\n                    'cmid': this.cmid\n                },\n                async: false\n            }])[0];\n\n        },\n\n       comparePassageToTranscript: function (passage,transcript,passagephonetic,language,alternatives=\"\"){\n          return Ajax.call([{\n               methodname: 'mod_minilesson_compare_passage_to_transcript',\n               args: {\n                   passage: passage,\n                   transcript: transcript,\n                   alternatives: alternatives,\n                   phonetic: passagephonetic,\n                   language: language,\n                   region: this.region,\n                   cmid: this.cmid\n               },\n              async: false\n           }])[0];\n       },\n\n      //this will return the promise, the result of which is an object containing marks, corrections and feedback\n      evaluateTranscript: function(transcript, itemid) {\n        return Ajax.call([{\n            methodname: 'mod_minilesson_evaluate_transcript',\n            args: {\n                'transcript': transcript,\n                'itemid': itemid,\n                'cmid': this.cmid\n            },\n            async: false\n        }])[0];\n      },\n\n    }; //end of return value\n  });\n"],"file":"quizhelper.min.js"}