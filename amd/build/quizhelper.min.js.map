{"version":3,"sources":["../src/quizhelper.js"],"names":["define","$","log","def","templates","Ajax","dictation","dictationchat","multichoice","multiaudio","speechcards","listenrepeat","page","smartframe","shortanswer","listeninggapfill","typinggapfill","speakinggapfill","spacegame","fluency","freespeaking","freewriting","passagereading","h5p","conversation","compquiz","passagegapfill","audiochat","wordshuffle","scatter","slides","fiction","debug","spliton_regexp","RegExp","nopunc_regexp","nonspaces_regexp","autoplaydelay","controls","submitbuttonclass","stepresults","init","quizcontainer","activitydata","cmid","attemptid","polly","quizdata","region","ttslanguage","courseurl","reattempturl","decodeURIComponent","replace","activityurl","backtocourse","stt_guided","wwwroot","useanimatecss","showitemreview","prepare_html","init_questions","register_events","start_quiz","quizfinished","dd","each","index","item","type","qtype_dictation","clone","qtype_dictationchat","qtype_multichoice","qtype_multiaudio","qtype_speechcards","qtype_listenrepeat","qtype_page","qtype_smartframe","qtype_shortanswer","qtype_listeninggapfill","qtype_typinggapfill","qtype_speakinggapfill","qtype_spacegame","qtype_fluency","qtype_freespeaking","qtype_freewriting","qtype_passagereading","qtype_h5p","qtype_conversation","qtype_compquiz","qtype_passagegapfill","qtype_audiochat","qtype_wordshuffle","qtype_scatter","qtype_slides","qtype_fiction","that","fetch_polly_url","data","then","audiourl","attr","on","render_quiz_progress","current","total","array","i","push","hide","slice","slicelength","length","itemWidth","innerclass","innerhtml","html","forEach","lastvalue","do_next","stepdata","currentquizdataindex","currentitem","preview","report_step_grade","theoldquestion","uniqueid","nextitem","showStep","prop","window","location","href","remove","ret","call","methodname","args","step","JSON","stringify","$container","show","find","ttsquestionplayer","setTimeout","play","$splashscreen","trigger","onSubmit","alert","mobile_user","test","navigator","userAgent","chrome_user","use_ttrecorder","is_stt_guided","count_words","transcript","trim","split","filter","word","similarity","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","toLowerCase","costs","lastValue","j","newValue","charAt","Math","min","cleanText","text","lowertext","punctuationless","checkByPhonetic","passage","passagephonetic","language","async","comparePassageToTranscript","alternatives","phonetic","evaluateTranscript","itemid"],"mappings":"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","sourcesContent":["define(\n    ['jquery', 'core/log', 'mod_minilesson/definitions', 'core/templates', 'core/ajax',\n    'mod_minilesson/dictation', 'mod_minilesson/dictationchat', 'mod_minilesson/multichoice','mod_minilesson/multiaudio',\n        'mod_minilesson/speechcards', 'mod_minilesson/listenrepeat',\n        'mod_minilesson/page','mod_minilesson/smartframe','mod_minilesson/shortanswer',\n        'mod_minilesson/listeninggapfill','mod_minilesson/typinggapfill','mod_minilesson/speakinggapfill',\n        'mod_minilesson/spacegame','mod_minilesson/fluency','mod_minilesson/freespeaking',\n        'mod_minilesson/freewriting','mod_minilesson/passagereading','mod_minilesson/h5p',\n        'mod_minilesson/conversation','mod_minilesson/compquiz','mod_minilesson/passagegapfill',\n        'mod_minilesson/audiochat','mod_minilesson/wordshuffle','mod_minilesson/scatter',\n        'mod_minilesson/slides', 'mod_minilesson/fiction', 'mod_minilesson/progresstimer'],\n    function (\n        $,\n        log,\n        def,\n        templates,\n        Ajax,\n        dictation,\n        dictationchat,\n        multichoice,\n        multiaudio,\n        speechcards,\n        listenrepeat,\n        page,\n        smartframe,\n        shortanswer,\n        listeninggapfill,\n        typinggapfill,\n        speakinggapfill,\n        spacegame,\n        fluency,\n        freespeaking,\n        freewriting,\n        passagereading,\n        h5p,\n        conversation,\n        compquiz,\n        passagegapfill,\n        audiochat,\n        wordshuffle,\n        scatter,\n        slides,\n        fiction,\n        progresstimer\n    ) {\n        \"use strict\"; // jshint ;_;\n\n      /*\n      This file is to manage the quiz stage\n       */\n\n        log.debug('MiniLesson Quiz helper: initialising');\n\n        return {\n\n          //original spliton_regexp: new RegExp(/([,.!?:;\" ])/, 'g'),\n            // V2 spliton_regexp new RegExp(/([!\"# ¡¿$%&'()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~])/, 'g'),\n            //v3 we removed the apostrophe because it was not counting words correcting in listen and speak\n            spliton_regexp: new RegExp(/([!\"# ¡¿$%&()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~])/, 'g'),\n          //nopunc is diff to split on because it does not match on spaces\n            nopunc_regexp: new RegExp(/[!\"#¡¿$%&'()。「」、*+,-.\\/:;<=>?@[\\]^_`{|}~]/,'g'),\n            nonspaces_regexp: new RegExp(/[^ ]/,'g'),\n            autoplaydelay: 800,\n\n            controls: {},\n            submitbuttonclass: 'mod_minilesson_quizsubmitbutton',\n            stepresults: [],\n\n            init: function (quizcontainer, activitydata, cmid, attemptid,polly) {\n                this.quizdata = activitydata.quizdata;\n                this.region = activitydata.region;\n                this.ttslanguage = activitydata.ttslanguage;\n                this.controls.quizcontainer = quizcontainer;\n                this.attemptid = attemptid;\n                this.courseurl = activitydata.courseurl;\n                this.cmid = cmid;\n                this.reattempturl = decodeURIComponent(activitydata.reattempturl).replace(/&amp;/g, \"&\");\n                this.activityurl = decodeURIComponent(activitydata.activityurl).replace(/&amp;/g, \"&\");\n                this.backtocourse = activitydata.backtocourse;\n                this.stt_guided = activitydata.stt_guided;\n                this.wwwroot = activitydata.wwwroot;\n                this.useanimatecss  = activitydata.useanimatecss;\n                this.showitemreview  = activitydata.showitemreview;\n\n                this.prepare_html();\n                this.init_questions(this.quizdata,polly);\n                this.register_events();\n                this.start_quiz();\n            },\n\n            prepare_html: function () {\n\n              // this.controls.quizcontainer.append(submitbutton);\n                this.controls.quizfinished = $(\"#mod_minilesson_quiz_finished\");\n\n            },\n\n            init_questions: function (quizdata, polly) {\n                var dd = this;\n                $.each(quizdata, function (index, item) {\n                    switch (item.type) {\n                        case def.qtype_dictation:\n                            dictation.clone().init(index, item, dd, polly);\n                        break;\n                        case def.qtype_dictationchat:\n                            dictationchat.clone().init(index, item, dd, polly);\n                        break;\n                        case def.qtype_multichoice:\n                            multichoice.clone().init(index, item, dd);\n                        break;\n                        case def.qtype_multiaudio:\n                            multiaudio.clone().init(index, item, dd);\n                          break;\n                        case def.qtype_speechcards:\n                          //speechcards init needs to occur when it is visible. lame.\n                          // so we do that in do_next function, down below\n                            speechcards.clone().init(index, item, dd);\n                        break;\n                        case def.qtype_listenrepeat:\n                            listenrepeat.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_page:\n                            page.clone().init(index, item, dd);\n                          break;\n\n                        case def.qtype_smartframe:\n                            smartframe.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_shortanswer:\n                            shortanswer.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_listeninggapfill:\n                            listeninggapfill.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_typinggapfill:\n                            typinggapfill.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_speakinggapfill:\n                            speakinggapfill.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_spacegame:\n                            spacegame.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_fluency:\n                            fluency.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_freespeaking:\n                            freespeaking.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_freewriting:\n                            freewriting.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_passagereading:\n                            passagereading.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_h5p:\n                            h5p.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_conversation:\n                            conversation.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_compquiz:\n                            compquiz.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_passagegapfill:\n                            passagegapfill.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_audiochat:\n                            audiochat.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_wordshuffle:\n                            wordshuffle.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_scatter:\n                            scatter.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_slides:\n                            slides.clone().init(index, item, dd);\n                        break;\n\n                        case def.qtype_fiction:\n                            fiction.clone().init(index, item, dd);\n                        break;\n                    }\n\n                });\n\n              //TTS in question headers\n                $(\"audio.mod_minilesson_itemttsaudio\").each(function () {\n                    var that = this;\n                    polly.fetch_polly_url($(this).data('text'), $(this).data('ttsoption'), $(this).data('voice')).then(function (audiourl) {\n                        $(that).attr(\"src\", audiourl);\n                    });\n                });\n\n            },\n\n            register_events: function () {\n                $('.' + this.submitbuttonclass).on('click', function () {\n                  //do something\n                });\n            },\n            render_quiz_progress:function (current,total) {\n                var array = [];\n                for (var i = 0; i < total; i++) {\n                    array.push(i);\n                }\n\n                if (total <= 1) {\n                    $(\".minilesson_quiz_progress\").hide();\n                    return;\n                }\n\n                if (total < 6) {\n                    var slice = array.slice(0, 5);\n                    var slicelength = slice.length > 1 ? (slice.length - 1) : slice.length;\n                    var itemWidth = 100 / slicelength;\n                    var innerclass,innerhtml,html = \"\";\n                    slice.forEach(function (i) {\n                        innerclass = i < current ? \"minilesson_quiz_progress_completed\" : \"minilesson_quiz_progress_incompleted\";\n                        innerhtml = (i !== (slice.length - 1)) ? \"<div class='\" + innerclass + \"' style='width: \" + itemWidth + \"%; '></div>\" : \"\";\n                        if (i === current) {\n                            html += \"<div class='minilesson_quiz_progress_current'>\";\n                        }\n                        html += \"<div class='minilesson_quiz_progress_item \" +\n                        (i === current ? 'minilesson_quiz_progress_item_current' : '') + \" \" +\n                        (i < current ? 'minilesson_quiz_progress_item_completed' : '') + \"'>\" +\n                        (i < current ? '<i class=\"fa fa-check\"></i>' : i + 1) + \"</div>\";\n                        if (i === current) {\n                            html += \"</div>\";\n                        }\n                        html += innerhtml;\n                    });\n                } else {\n                    if (current > total - 6) {\n                        var slice = array.slice(total - 5, total - 1);\n                    } else {\n                        var slice = array.slice(current, current + 4);\n                    }\n                    var slicelength = slice.length > 1 ? (slice.length - 1) : slice.length;\n                    var itemWidth = 100 / slicelength;\n                    var html = \"\",innerhtml,innerclass;\n                    var lastvalue = slice[slice.length - 1];\n                    slice.forEach(function (i) {\n                        if (i === current) {\n                            html += \"<div class='minilesson_quiz_progress_current'>\";\n                        }\n                        html += \"<div class='minilesson_quiz_progress_item \" + (i === current ? 'minilesson_quiz_progress_item_current' : '') + \" \" + (i < current ? 'minilesson_quiz_progress_item_completed' : '') + \"'>\" + (i < current ? '<i class=\"fa fa-check\"></i>' : i + 1) + \"</div>\";\n                        innerclass = (i === lastvalue && i < total - 2) ? \"minilesson_quiz_progress_dashedline\" : i < current ? \"minilesson_quiz_progress_completed\" : \"minilesson_quiz_progress_incompleted\";\n                        innerhtml = \"<div class='\" + innerclass + \"' style='width: \" + itemWidth + \"%; '></div>\";\n                        if (i === current) {\n                            html += \"</div>\";\n                        }\n                        html += innerhtml;\n                    });\n                    //end marker\n                    html += \"<div class='minilesson_quiz_progress_finalitem'>\" + (total) + \"</div>\";\n                }\n\n                html += \"\";\n                $(\".minilesson_quiz_progress\").html(html);\n\n            },\n\n            do_next: function (stepdata) {\n                var dd = this;\n              //get current question\n                var currentquizdataindex =   stepdata.index;\n                var currentitem = this.quizdata[currentquizdataindex];\n              //in preview mode do no do_next\n                if (currentitem.preview === true) {\n                    return;}\n\n              //post grade\n               // log.debug(\"reporting step grade\");\n                dd.report_step_grade(stepdata);\n               // log.debug(\"reported step grade\");\n\n              //show next question or End Screen\n                if (dd.quizdata.length > currentquizdataindex + 1) {\n                  // we want to hide current question - before show new one\n                    var theoldquestion = $(\"#\" + currentitem.uniqueid + \"_container\");\n                    theoldquestion.hide();\n\n                    var nextindex = currentquizdataindex + 1;\n                    var nextitem = dd.quizdata[nextindex];\n                    //show the question\n\n                    dd.showStep($(\"#\" + nextitem.uniqueid + \"_container\"));\n                  //any per question type init that needs to occur can go here\n                    switch (nextitem.type) {\n                        case def.qtype_speechcards:\n                            //speechcards.init(nextindex, nextitem, dd);\n                            break;\n                        case def.qtype_dictation:\n                        case def.qtype_dictationchat:\n                        case def.qtype_multichoice:\n                        case def.qtype_multiaudio:\n                        case def.qtype_listenrepeat:\n                        case def.qtype_smartframe:\n                        case def.qtype_shortanswer:\n                        case def.qtype_spacegame:\n                        case def.qtype_fluency:\n                        case def.qtype_freespeaking:\n                        case def.qtype_freewriting:\n                        case def.qtype_passagereading:\n                        case def.qtype_h5p:\n                        case def.qtype_conversation:\n                        case def.qtype_compquiz:\n                        case def.qtype_audiochat:\n                        case def.qtype_slides:\n                        case def.qtype_fiction:\n                        default:\n                    }//end of nextitem switch\n                } else {\n                  //just reload and re-fetch all the data to display\n                    $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n                    window.location.href = dd.activityurl;\n                    /*\n                    setTimeout(function () {\n                    log.debug(\"forwarding to finished page\");\n                    window.location.href=dd.activityurl;\n                    }, 500);\n                    */\n\n                    return;\n\n                  //no longer do this\n                    /*\n                  var results = dd.stepresults.filter(function(e){return e.hasgrade;});\n                  var correctitems = 0;\n                  var totalitems = 0;\n                  results.forEach(function(result,i){\n                    result.index=i+1;\n                    result.title=dd.quizdata[i].title;\n                    correctitems += result.correctitems;\n                    totalitems += result.totalitems;\n                  });\n                  var totalpercent = Math.round((correctitems/totalitems)*100);\n                  console.log(results,correctitems,totalitems,totalpercent);\n                  var finishedparams ={results:results,total:totalpercent, courseurl: this.courseurl};\n                  if(this.reattempturl!=''){finishedparams.reattempturl = this.reattempturl;}\n                  if(this.backtocourse!=''){finishedparams.backtocourse = true;}\n                  templates.render('mod_minilesson/quizfinished',finishedparams).then(\n                    function(html,js){\n                    dd.controls.quizfinished.html(html);\n                    dd.controls.quizfinished.show();\n                    templates.runTemplateJS(js);\n                    }\n                  );\n                  */\n                }//end of if has more questions\n\n                this.render_quiz_progress(stepdata.index + 1,this.quizdata.length);\n\n              //we want to destroy the old question in the DOM also because iframe/media content might be playing\n                theoldquestion.remove();\n\n            },\n\n            report_step_grade: function (stepdata) {\n                var dd = this;\n\n              //store results locally\n                this.stepresults.push(stepdata);\n\n              //push results to server\n                var isasync = false;\n                var ret = Ajax.call([{\n                    methodname: 'mod_minilesson_report_step_grade',\n                    args: {\n                        cmid: dd.cmid,\n                        step: JSON.stringify(stepdata),\n                    },\n                }],isasync)[0];\n                log.debug(\"report_step_grade success: \" + ret);\n\n            },\n\n            showStep: function($container) {\n                $container.show();\n                $container.on('showElement', () => {\n                    $container.find('[data-region=\"activity-wrapper\"]').show();\n                    $container.find('[data-region=\"splashscreen\"]').hide();\n                    //autoplay audio if we need to\n                    var ttsquestionplayer = $(\"#\" + this.quizdata[0].uniqueid + \"_container audio.mod_minilesson_itemttsaudio\");\n                    if (ttsquestionplayer.data('autoplay') == \"1\") {\n                        var that = this;\n                        setTimeout(function () {\n                            ttsquestionplayer[0].play();\n                        }, that.autoplaydelay);\n                    }\n                });\n                this.render_quiz_progress(0,this.quizdata.length);\n                const $splashscreen = $container.find('[data-region=\"splashscreen\"]');\n                if ($splashscreen.length > 0) {\n                    $splashscreen.show();\n                    $splashscreen.on('click', '[data-action=\"startmodule\"]', () => $container.trigger(\"showElement\"));\n                    return;\n                }\n                $container.trigger(\"showElement\");\n            },\n\n            start_quiz: function () {\n                const $container = $(\"#\" + this.quizdata[0].uniqueid + \"_container\");\n                this.showStep($container);\n            },\n\n          //this function is overridden by the calling class\n            onSubmit: function () {\n                alert('quiz submitted. Override this');\n            },\n\n            mobile_user: function () {\n\n                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n                    return true;\n                } else {\n                    return false;\n                }\n            },\n\n            chrome_user: function () {\n                if (/Chrome/i.test(navigator.userAgent)) {\n                    return true;\n                } else {\n                    return false;\n                }\n            },\n\n          //this will always be true these days\n            use_ttrecorder: function () {\n                return true;\n            },\n            is_stt_guided: function () {\n                return this.stt_guided;\n            },\n\n          //count words\n            count_words: function (transcript) {\n                return transcript.trim().split(/\\s+/).filter(function (word) {\n                    return word.length > 0;\n                }).length;\n            },\n\n          //text comparison functions follow===============\n\n            similarity: function (s1, s2) {\n              //we remove spaces because JP transcript and passage might be different. And who cares about spaces anyway?\n                s1 = s1.replace(/\\s+/g, '');\n                s2 = s2.replace(/\\s+/g, '');\n\n                var longer = s1;\n                var shorter = s2;\n                if (s1.length < s2.length) {\n                    longer = s2;\n                    shorter = s1;\n                }\n                var longerLength = longer.length;\n                if (longerLength === 0) {\n                    return 100;\n                }\n                return 100 * ((longerLength - this.editDistance(longer, shorter)) / parseFloat(longerLength));\n            },\n            editDistance: function (s1, s2) {\n                s1 = s1.toLowerCase();\n                s2 = s2.toLowerCase();\n\n                var costs = [];\n                for (var i = 0; i <= s1.length; i++) {\n                    var lastValue = i;\n                    for (var j = 0; j <= s2.length; j++) {\n                        if (i === 0) {\n                            costs[j] = j;\n                        } else {\n                            if (j > 0) {\n                                var newValue = costs[j - 1];\n                                if (s1.charAt(i - 1) !== s2.charAt(j - 1)) {\n                                    newValue = Math.min(\n                                        Math.min(newValue, lastValue),\n                                        costs[j]\n                                    ) + 1;\n                                }\n                                costs[j - 1] = lastValue;\n                                lastValue = newValue;\n                            }\n                        }\n                    }\n                    if (i > 0) {\n                        costs[s2.length] = lastValue;\n                    }\n                }\n                return costs[s2.length];\n            },\n\n            cleanText: function (text) {\n                var lowertext = text.toLowerCase();\n                var punctuationless = lowertext.replace(this.nopunc_regexp,\"\");\n                var ret = punctuationless.replace(/\\s+/g, \" \").trim();\n                return ret;\n            },\n\n          //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n            checkByPhonetic: function (passage, transcript, passagephonetic, language) {\n                return Ajax.call([{\n                    methodname: 'mod_minilesson_check_by_phonetic',\n                    args: {\n                        'spoken': transcript,\n                        'correct': passage,\n                        'language': language,\n                        'phonetic': passagephonetic,\n                        'region': this.region,\n                        'cmid': this.cmid\n                    },\n                    async: false\n                }])[0];\n\n            },\n\n            comparePassageToTranscript: function (passage,transcript,passagephonetic,language,alternatives=\"\") {\n                return Ajax.call([{\n                    methodname: 'mod_minilesson_compare_passage_to_transcript',\n                    args: {\n                        passage: passage,\n                        transcript: transcript,\n                        alternatives: alternatives,\n                        phonetic: passagephonetic,\n                        language: language,\n                        region: this.region,\n                        cmid: this.cmid\n                    },\n                    async: false\n                }])[0];\n            },\n\n          //this will return the promise, the result of which is an object containing marks, corrections and feedback\n            evaluateTranscript: function (transcript, itemid) {\n                return Ajax.call([{\n                    methodname: 'mod_minilesson_evaluate_transcript',\n                    args: {\n                        'transcript': transcript,\n                        'itemid': itemid,\n                        'cmid': this.cmid\n                    },\n                    async: false\n                }])[0];\n            },\n\n        }; //end of return value\n    }\n);\n"],"file":"quizhelper.min.js"}