define ("mod_minilesson/quizhelper",["jquery","core/log","mod_minilesson/definitions","core/templates","core/ajax","mod_minilesson/dictation","mod_minilesson/dictationchat","mod_minilesson/multichoice","mod_minilesson/speechcards","mod_minilesson/listenrepeat","mod_minilesson/page","mod_minilesson/teachertools","mod_minilesson/shortanswer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";b.debug("Poodll Time Quiz helper: initialising");return{controls:{},submitbuttonclass:"mod_minilesson_quizsubmitbutton",stepresults:[],init:function init(a,b,c,d,e){this.quizdata=b.quizdata;this.region=b.region;this.ttslanguage=b.ttslanguage;this.controls.quizcontainer=a;this.attemptid=d;this.courseurl=b.courseurl;this.cmid=c;this.reattempturl=b.reattempturl;this.prepare_html();this.init_questions(this.quizdata,e);this.register_events();this.start_quiz()},prepare_html:function prepare_html(){this.controls.quizfinished=a("#mod_minilesson_quiz_finished")},init_questions:function init_questions(b,d){var e=this;a.each(b,function(a,b){switch(b.type){case c.qtype_dictation:f.clone().init(a,b,e,d);break;case c.qtype_dictationchat:g.clone().init(a,b,e,d);break;case c.qtype_multichoice:h.clone().init(a,b,e);break;case c.qtype_speechcards:i.clone().init(a,b,e);break;case c.qtype_listenrepeat:j.clone().init(a,b,e);break;case c.qtype_page:k.clone().init(a,b,e);break;case c.qtype_teachertools:l.clone().init(a,b,e);break;case c.qtype_shortanswer:m.clone().init(a,b,e);break;}});a("audio.mod_minilesson_itemttsaudio").each(function(){var b=this;d.fetch_polly_url(a(this).data("text"),"text",a(this).data("voice")).then(function(c){a(b).attr("src",c)})})},register_events:function register_events(){a("."+this.submitbuttonclass).on("click",function(){})},render_quiz_progress:function render_quiz_progress(b,c){for(var d=[],e=0;e<c;e++){d.push(e)}if(6>c){var f=d.slice(0,5),g="width: "+(100-100/f.length)+"%; margin-left: auto; margin-right: auto",h="<div class='minilesson_quiz_progress_line' style='"+g+"'></div>";f.forEach(function(a){h+="<div class='minilesson_quiz_progress_item "+(a==b?"minilesson_quiz_progress_item_current":"")+" "+(a<b?"minilesson_quiz_progress_item_completed":"")+"'>"+(a+1)+"</div>"})}else{if(b>c-6){var f=d.slice(c-5,c-1)}else{var f=d.slice(b,b+4)}if(0==b){var g="width: 80%; margin-left: auto; margin-right: auto"}else{var g="width: "+(100-100/(2*f.length))+"%; margin-left: 0"}var h="<div class='minilesson_quiz_progress_line' style='"+g+"'></div>";f.forEach(function(a){h+="<div class='minilesson_quiz_progress_item "+(a==b?"minilesson_quiz_progress_item_current":"")+" "+(a<b?"minilesson_quiz_progress_item_completed":"")+"'>"+(a+1)+"</div>"});h+="<div class='minilesson_quiz_progress_finalitem'>"+c+"</div>"}h+="";a(".minilesson_quiz_progress").html(h)},do_next:function do_next(b){var e=this,f=b.index,g=this.quizdata[f];if(!0===g.preview){return}e.report_step_grade(b);a("#"+g.uniqueid+"_container").hide();if(e.quizdata.length>f+1){var h=this.quizdata[f+1];a("#"+h.uniqueid+"_container").show();switch(h.type){case c.qtype_speechcards:break;case c.qtype_dictation:case c.qtype_dictationchat:case c.qtype_multichoice:case c.qtype_listenrepeat:case c.qtype_teachertools:case c.qtype_shortanswer:default:}}else{var i=e.stepresults.filter(function(a){return a.hasgrade}),j=0,k=0;i.forEach(function(a,b){a.index=b+1;a.title=e.quizdata[b].title;j+=a.correctitems;k+=a.totalitems});var l=Math.round(100*(j/k));console.log(i,j,k,l);var m={results:i,total:l,courseurl:this.courseurl};if(""!=this.reattempturl){m.reattempturl=this.reattempturl}d.render("mod_minilesson/quizfinished",m).then(function(a,b){e.controls.quizfinished.html(a);e.controls.quizfinished.show();d.runTemplateJS(b)})}this.render_quiz_progress(b.index+1,this.quizdata.length)},report_step_grade:function report_step_grade(a){var b=this;this.stepresults.push(a);e.call([{methodname:"mod_minilesson_report_step_grade",args:{cmid:b.cmid,step:JSON.stringify(a)}}])},start_quiz:function start_quiz(){a("#"+this.quizdata[0].uniqueid+"_container").show();this.render_quiz_progress(0,this.quizdata.length)},onSubmit:function onSubmit(){alert("quiz submitted. Override this")},mobile_user:function mobile_user(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return!0}else{return!1}},chrome_user:function chrome_user(){if(/Chrome/i.test(navigator.userAgent)){return!0}else{return!1}},use_ttrecorder:function use_ttrecorder(){var a=!1,b=this.chrome_user();switch(this.region){case"tokyo":case"useast1":case"dublin":case"sydney":a=!0;break;default:a=b;}return a}}});
//# sourceMappingURL=quizhelper.min.js.map
