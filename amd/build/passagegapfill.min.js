define(["jquery","core/log","core/ajax","mod_minilesson/definitions","mod_minilesson/pollyhelper","mod_minilesson/animatecss","mod_minilesson/progresstimer","core/templates"],(function($,log,ajax,def,polly,anim,progresstimer,templates){return log.debug("MiniLesson passage gap fill: initialising"),{clone:function(){return $.extend(!0,{},this)},controls:{},gapitems:[],init:function(index,itemdata,quizhelper){this.itemdata=itemdata,this.quizhelper=quizhelper,this.index=index;var animopts={};animopts.useanimatecss=quizhelper.useanimatecss,anim.init(animopts),this.register_controls(),this.register_events(),this.getGapItems()},register_controls:function(){this.controls.audioplayer=$("#"+this.itemdata.uniqueid+"_container .pgapfill_audio_player"),this.controls.resultsbox=$("#"+this.itemdata.uniqueid+"_container .pgapfill_resultscontainer"),this.controls.checkbtn=$("#"+this.itemdata.uniqueid+"_container .ml_checkbutton"),this.controls.hintbtn=$("#"+this.itemdata.uniqueid+"_container .ml_hintbutton"),this.controls.nextbtn=$("#"+this.itemdata.uniqueid+"_container .minilesson_nextbutton")},prepare_audio:function(){var self=this;polly.fetch_polly_url(self.itemdata.passagedata.plaintext,self.itemdata.voiceoption,self.itemdata.usevoice).then((function(audiourl){self.controls.audioplayer.attr("src",audiourl)}))},next_question:function(){var stepdata={};stepdata.index=this.index,stepdata.hasgrade=!0,stepdata.totalitems=this.items.length,stepdata.correctitems=this.items.filter((function(e){return e.correct})).length,stepdata.grade=Math.round(stepdata.correctitems/stepdata.totalitems*100),this.quizhelper.do_next(stepdata)},show_item_review:function(){var review_data={};review_data.items=this.items,review_data.totalitems=this.items.length,review_data.correctitems=this.items.filter((function(e){return e.correct})).length,templates.render("mod_minilesson/passagegapfillresults",review_data).then((function(html,js){resultsbox.html(html),resultsbox.show(),templates.runTemplateJS(js)}))},register_events:function(){var self=this;self.controls.nextbtn.on("click",(function(e){self.next_question()})),self.controls.hintbtn.on("click",(function(){self.give_hint()})),self.controls.checkbtn.on("click",(function(){self.check_answer()}))},check_answer:function(){},give_hint:function(){},getGapItems:function(){log.debug("getting gap items");var passagedata=this.itemdata.passagedata;this.gapitems=passagedata.words.map((function(target){return{wordindex:target.wordindex,text:target.text,placeholder:target.placeholder,isgap:target.isgap}})).filter((function(e){return""!==e.target}))},appReady:function(){this.start()},end:function(){var self=this;$(".minilesson_nextbutton").prop("disabled",!0),setTimeout((function(){$(".minilesson_nextbutton").prop("disabled",!1),self.quizhelper.showitemreview?self.show_item_review():self.next_question()}),2e3)},start:function(){this.controls.question.show()},stopTimer:function(timer){timer&&clearInterval(timer)}}}));

//# sourceMappingURL=passagegapfill.min.js.map