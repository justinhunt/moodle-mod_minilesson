{"version":3,"file":"freespeaking.min.js","sources":["../src/freespeaking.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions','mod_minilesson/cloudpoodllloader',\n    'mod_minilesson/ttrecorder',],\n    function($, log, def, cloudpoodll, ttrecorder) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the free speaking item type\n   */\n\n  log.debug('MiniLesson FreeSpeaking: initialising');\n\n  return {\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      this.itemdata = itemdata;\n      this.quizhelper = quizhelper;\n      this.init_components(quizhelper,itemdata);\n      this.register_events(index, itemdata, quizhelper);\n\n    },\n\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      self.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n      \n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n      \n      nextbutton.on('click', function(e) {\n        self.next_question(0);\n      });\n\n    },\n\n    init_components: function(quizhelper,itemdata){\n      var self=this;\n      self.allwords = $(\"#\" + self.itemdata.uniqueid + \"_container.mod_minilesson_mu_passage_word\");\n      self.thebutton = \"thettrbutton\"; // To Do impl. this\n      self.resultbox = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_freespeaking_resultbox\");\n\n      var theCallback = function(message) {\n\n        switch (message.type) {\n          case 'recording':\n            break;\n\n          case 'speech':\n            log.debug(\"speech at speechcards\");\n            var speechtext = message.capturedspeech;\n            //var spoken_clean  = quizhelper.cleanText(speechtext);\n            //log.debug('speechtext:',speechtext);\n            //log.debug('spoken:',spoken_clean);\n            self.do_evaluation(\n              speechtext\n            );    \n        } //end of switch message type\n      };\n\n      if(quizhelper.use_ttrecorder()) {\n          //init tt recorder\n          var opts = {};\n          opts.uniqueid = itemdata.uniqueid;\n          opts.callback = theCallback;\n          opts.stt_guided=false;\n          self.ttrec = ttrecorder.clone();\n          self.ttrec.init(opts);\n\n      }else{\n          //init cloudpoodll push recorder\n          cloudpoodll.init('minilesson-recorder-passagereading-' + itemdata.id, theCallback);\n      }\n    }, //end of init components\n\n    do_evaluation: function(speechtext) {\n      log.debug('do_evaluation:',speechtext);\n      this.resultbox.html(speechtext);\n\n    },\n  };\n});"],"names":["define","$","log","def","cloudpoodll","ttrecorder","debug","clone","extend","this","init","index","itemdata","quizhelper","init_components","register_events","next_question","percent","stepdata","hasgrade","totalitems","correctitems","grade","do_next","self","uniqueid","on","e","allwords","thebutton","resultbox","theCallback","message","type","speechtext","capturedspeech","do_evaluation","use_ttrecorder","opts","callback","stt_guided","ttrec","id","html"],"mappings":"AAAAA,qCAAO,CAAC,SAAU,WAAY,6BAA6B,mCACvD,8BACA,SAASC,EAAGC,IAAKC,IAAKC,YAAaC,mBAOrCH,IAAII,MAAM,yCAEH,CAGHC,MAAO,kBACIN,EAAEO,QAAO,EAAM,GAAIC,OAGhCC,KAAM,SAASC,MAAOC,SAAUC,iBACzBD,SAAWA,cACXC,WAAaA,gBACbC,gBAAgBD,WAAWD,eAC3BG,gBAAgBJ,MAAOC,SAAUC,aAIxCG,cAAe,SAASC,aAElBC,SAAW,GACfA,SAASP,MAFEF,KAEWE,MACtBO,SAASC,UAAW,EACpBD,SAASE,WAAa,EACtBF,SAASG,aAAeJ,QAAQ,EAAE,EAAE,EACpCC,SAASI,MAAQL,QANNR,KAONI,WAAWU,QAAQL,WAG1BH,gBAAiB,SAASJ,MAAOC,SAAUC,gBAErCW,KAAOf,KACXe,KAAKb,MAAQA,MACba,KAAKX,WAAaA,WACDZ,EAAE,IAAMW,SAASa,SAAW,qCAElCC,GAAG,SAAS,SAASC,GAC9BH,KAAKR,cAAc,OAKvBF,gBAAiB,SAASD,WAAWD,cAC/BY,KAAKf,KACTe,KAAKI,SAAW3B,EAAE,IAAMuB,KAAKZ,SAASa,SAAW,6CACjDD,KAAKK,UAAY,eACjBL,KAAKM,UAAY7B,EAAE,IAAMuB,KAAKZ,SAASa,SAAW,6CAE9CM,YAAc,SAASC,gBAEjBA,QAAQC,UACT,sBAGA,SACH/B,IAAII,MAAM,6BACN4B,WAAaF,QAAQG,eAIzBX,KAAKY,cACHF,iBAKLrB,WAAWwB,iBAAkB,KAExBC,KAAO,GACXA,KAAKb,SAAWb,SAASa,SACzBa,KAAKC,SAAWR,YAChBO,KAAKE,YAAW,EAChBhB,KAAKiB,MAAQpC,WAAWE,QACxBiB,KAAKiB,MAAM/B,KAAK4B,WAIhBlC,YAAYM,KAAK,sCAAwCE,SAAS8B,GAAIX,cAI5EK,cAAe,SAASF,YACtBhC,IAAII,MAAM,iBAAiB4B,iBACtBJ,UAAUa,KAAKT"}