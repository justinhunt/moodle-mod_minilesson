{"version":3,"file":"multichoice.min.js","sources":["../src/multichoice.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions', 'mod_minilesson/pollyhelper','mod_minilesson/animatecss'],\n    function($, log, def, polly, anim) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('MiniLesson Multichoice: initialising');\n\n  return {\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n\n      this.itemdata = itemdata;\n      this.register_events(index, itemdata, quizhelper);\n\n        //anim\n        var animopts = {};\n        animopts.useanimatecss=quizhelper.useanimatecss;\n        anim.init(animopts);\n\n    },\n\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      self.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n      \n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      var chosenelement=null;\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n      var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n      var confirmchoicebutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_confirmchoice\");\n      var resultspanel = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_resultspanel\");\n      var resultspanelswish = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_resultspanel_swish\");\n      var resultspanelstars = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_swishstars\");\n      var resultspanelscore = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_swishscore\");\n\n      nextbutton.on('click', function(e) {\n        self.next_question(0);\n      });\n\n      //if we need to submit this question we dont allow skip\n      if(itemdata.confirmchoice===1 || itemdata.confirmchoice==='1') {\n            nextbutton.hide();\n      }\n\n\n      var finalChoice = function() {\n          //if disabled =>just return (already answered)\n          if($(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").hasClass('minilesson_mc_disabled')){\n              return;\n          }\n\n          //get selected item index\n          var checked = $(chosenelement).data('index');\n\n          //disable the answers, cos its answered\n          $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").addClass('minilesson_mc_disabled');\n\n          //highlight selected answers\n          $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minilesson_mc_selected');\n\n          //calculate score\n          var achieved = checked == itemdata.correctanswer ? 1 : 0;\n          var percent = achieved * 100;\n\n          if(quizhelper.showitemreview) {\n\n              //reveal answers\n              $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_unanswered\").hide();\n              $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_wrong\").show();\n\n              $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_wrong\").hide();\n              $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_right\").show();\n\n              //if answers were dots for audio content, show them\n              if(itemdata.hasOwnProperty('audiocontent') && itemdata.audiocontent===true) {\n                  for (var i = 0; i < itemdata.sentences.length; i++) {\n                      var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\n                      $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minilesson_sentence').text(itemdata.sentences[i].sentence);\n                  }\n              }\n\n              //hide the confirm choice button\n              confirmchoicebutton.hide();\n\n              //show the result panel\n              resultspanelswish.data('possible', '1');\n              resultspanelswish.data('achieved', achieved);\n              resultspanelscore.text(achieved + '/' + 1);\n              if (achieved > 0) {\n                  resultspanelstars.html('⭐'); // Display a star\n              }else{\n                  resultspanelstars.html('❌'); // Display a cross\n              }\n              resultspanel.show();\n              anim.do_animate(resultspanelswish,'zoomIn animate__faster','in');\n\n              //reset the handler for a call to move to next question, this time with the score\n              //first unset the old button handler\n              nextbutton.off('click');\n              //then set the correct handler\n              nextbutton.on('click', function(e) {\n                  self.next_question(percent);\n              });\n\n              //show the next button\n              nextbutton.show();\n\n          }else{\n              $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n              setTimeout(function() {\n                  $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n                  self.next_question(percent);\n              }, 2000);\n          }\n      };//end of final choice\n\n\n\n      //on tapping of a response, we either action the choice or show a confirmation button\n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").on('click', function(e){\n          chosenelement = this;\n          if(itemdata.confirmchoice===0 || itemdata.confirmchoice==='0'){\n              finalChoice();\n          }else{\n\n              //highlight selected answer\n              //get selected item index\n              var checked = $(this).data('index');\n              $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").removeClass('minilesson_mc_selected');\n              $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minilesson_mc_selected');\n\n              self.showConfirmButton(itemdata);\n          }\n      });\n\n        //on tapping of confirmation button, execute final choice\n        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_confirmchoice\").on('click', function(e){\n                finalChoice();\n        });\n\n      //play audio if we are doing this as an audio player thingy\n        //this will use the multichoice audio content template\n        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_audioplayer\").on('click', function(e) {\n            //if disabled =>just return (already answered)\n            if($(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_audioplayer\").hasClass('minilesson_mc_disabled')){\n                return;\n            }\n\n            //audio play requests\n            if (!self.playing) {\n                var el = this;\n                self.playing = true;\n                theplayer.attr('src', $(this).attr('data-src'));\n                theplayer[0].play();\n                theplayer[0].onended = function() {\n                    $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                    self.playing = false;\n                };\n                $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n            }else{\n                theplayer[0].pause();\n                theplayer[0].currentTime=0;\n                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                self.playing = false;\n            }\n        });\n\n\n        $(\"#\" + itemdata.uniqueid + \"_container\").on('showElement', () => {\n            if (itemdata.timelimit > 0) {\n                $(\"#\" + itemdata.uniqueid + \"_container .progress-container\").show();\n                $(\"#\" + itemdata.uniqueid + \"_container .progress-container i\").show();\n                $(\"#\" + itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                    height: '5px',\n                    timeLimit: itemdata.timelimit,\n                    onFinish: function() {\n                        nextbutton.trigger('click');\n                    }\n                });\n            }\n        });\n\n    },\n\n      showConfirmButton: function(itemdata) {\n          var confirmbutton =$(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_confirmchoice\");\n          anim.do_animate(confirmbutton,'zoomIn animate__faster','in');\n      },\n  };\n});"],"names":["define","$","log","def","polly","anim","debug","clone","extend","this","init","index","itemdata","quizhelper","register_events","animopts","useanimatecss","next_question","percent","stepdata","hasgrade","totalitems","correctitems","grade","do_next","self","chosenelement","theplayer","uniqueid","nextbutton","confirmchoicebutton","resultspanel","resultspanelswish","resultspanelstars","resultspanelscore","on","e","confirmchoice","hide","finalChoice","hasClass","checked","data","addClass","achieved","correctanswer","showitemreview","show","hasOwnProperty","audiocontent","i","sentences","length","text","sentence","html","do_animate","off","prop","setTimeout","removeClass","showConfirmButton","playing","pause","currentTime","el","attr","play","onended","find","timelimit","progressTimer","height","timeLimit","onFinish","trigger","confirmbutton"],"mappings":"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"}