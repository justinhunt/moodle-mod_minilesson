{"version":3,"file":"multichoice.min.js","sources":["../src/multichoice.js"],"sourcesContent":["define(\n    ['jquery', 'core/log', 'mod_minilesson/definitions', 'mod_minilesson/pollyhelper','mod_minilesson/animatecss'],\n    function ($, log, def, polly, anim) {\n        \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the quiz stage\n    */\n\n        log.debug('MiniLesson Multichoice: initialising');\n\n        return {\n\n          //for making multiple instances\n            clone: function () {\n                return $.extend(true, {}, this);\n            },\n\n            init: function (index, itemdata, quizhelper) {\n\n                this.itemdata = itemdata;\n                this.register_events(index, itemdata, quizhelper);\n\n        //anim\n                var animopts = {};\n                animopts.useanimatecss = quizhelper.useanimatecss;\n                anim.init(animopts);\n\n            },\n\n            next_question: function (percent) {\n                var self = this;\n                var stepdata = {};\n                stepdata.index = self.index;\n                stepdata.hasgrade = true;\n                stepdata.totalitems = 1;\n                stepdata.correctitems = percent > 0 ? 1 : 0;\n                stepdata.grade = percent;\n                self.quizhelper.do_next(stepdata);\n            },\n\n            register_events: function (index, itemdata, quizhelper) {\n\n                var self = this;\n                self.index = index;\n                self.quizhelper = quizhelper;\n                var chosenelement = null;\n                var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n                var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n                var confirmchoicebutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_confirmchoice\");\n                var resultspanel = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_resultspanel\");\n                var resultspanelswish = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_resultspanel_swish\");\n                var resultspanelstars = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_swishstars\");\n                var resultspanelscore = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_swishscore\");\n\n                if (itemdata.shuffleanswers) {\n                    var $choicewrapper = $(\"#\" + itemdata.uniqueid + \"_container .mcchoiceswrapper\");\n                    $choicewrapper.each(function () {\n                        var $parent = $(this);\n                        var $children = $parent.children();\n\n                        // Sort the children randomly\n                        $children.sort(function () {\n                            return 0.5 - Math.random();\n                        });\n\n                        // Empty the parent and append the shuffled children\n                        $parent.empty().append($children);\n                    });\n                }\n\n                nextbutton.on('click', function (e) {\n                    self.next_question(0);\n                });\n\n    //if we need to submit this question we dont allow skip\n                if (itemdata.confirmchoice === 1 || itemdata.confirmchoice === '1') {\n                      nextbutton.hide();\n                }\n\n\n                var finalChoice = function () {\n                    //if disabled =>just return (already answered)\n                    if ($(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").hasClass('minilesson_mc_disabled')) {\n                        return;\n                    }\n\n                    //get selected item index\n                    var checked = $(chosenelement).data('index');\n\n                    //disable the answers, cos its answered\n                    $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").addClass('minilesson_mc_disabled');\n\n                    //highlight selected answers\n                    $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minilesson_mc_selected');\n\n                    //calculate score\n                    var achieved = checked == itemdata.correctanswer ? 1 : 0;\n                    var percent = achieved * 100;\n\n                    if (quizhelper.showitemreview) {\n                        //reveal answers\n                        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_unanswered\").hide();\n                        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_wrong\").show();\n\n                        $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_wrong\").hide();\n                        $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_right\").show();\n\n                        //if answers were dots for audio content, show them\n                        if (itemdata.hasOwnProperty('audiocontent') && itemdata.audiocontent === true) {\n                            for (var i = 0; i < itemdata.sentences.length; i++) {\n                                var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\n                                $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minilesson_sentence').text(itemdata.sentences[i].sentence);\n                            }\n                        }\n\n                        //hide the confirm choice button\n                        confirmchoicebutton.hide();\n\n                        //show the result panel\n                        resultspanelswish.data('possible', '1');\n                        resultspanelswish.data('achieved', achieved);\n                        resultspanelscore.text(achieved + '/' + 1);\n                        if (achieved > 0) {\n                            resultspanelstars.html('⭐'); // Display a star\n                        } else {\n                            resultspanelstars.html('❌'); // Display a cross\n                        }\n                        resultspanel.show();\n                        anim.do_animate(resultspanelswish,'zoomIn animate__faster','in');\n\n                        //reset the handler for a call to move to next question, this time with the score\n                        //first unset the old button handler\n                        nextbutton.off('click');\n                        //then set the correct handler\n                        nextbutton.on('click', function (e) {\n                            self.next_question(percent);\n                        });\n\n                        //show the next button\n                        nextbutton.show();\n                    } else {\n                        $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n                        setTimeout(function () {\n                            $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n                            self.next_question(percent);\n                        }, 2000);\n                    }\n                };//end of final choice\n\n\n\n      //on tapping of a response, we either action the choice or show a confirmation button\n                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").on('click', function (e) {\n                    chosenelement = this;\n                    if (itemdata.confirmchoice === 0 || itemdata.confirmchoice === '0') {\n                        finalChoice();\n                    } else {\n                        //highlight selected answer\n                        //get selected item index\n                        var checked = $(this).data('index');\n                        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_response\").removeClass('minilesson_mc_selected');\n                        $(\"#\" + itemdata.uniqueid + \"_option\" + checked).addClass('minilesson_mc_selected');\n\n                        self.showConfirmButton(itemdata);\n                    }\n                });\n\n      //on tapping of confirmation button, execute final choice\n                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_confirmchoice\").on('click', function (e) {\n                        finalChoice();\n                });\n\n    //play audio if we are doing this as an audio player thingy\n      //this will use the multichoice audio content template\n                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_audioplayer\").on('click', function (e) {\n                    //if disabled =>just return (already answered)\n                    if ($(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_audioplayer\").hasClass('minilesson_mc_disabled')) {\n                        return;\n                    }\n\n                    //audio play requests\n                    if (!self.playing) {\n                        var el = this;\n                        self.playing = true;\n                        theplayer.attr('src', $(this).attr('data-src'));\n                        theplayer[0].play();\n                        theplayer[0].onended = function () {\n                            $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                            self.playing = false;\n                        };\n                        $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n                    } else {\n                        theplayer[0].pause();\n                        theplayer[0].currentTime = 0;\n                        $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                        self.playing = false;\n                    }\n                });\n\n\n                $(\"#\" + itemdata.uniqueid + \"_container\").on('showElement', () => {\n                    if (itemdata.timelimit > 0) {\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container\").show();\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container i\").show();\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                            height: '5px',\n                            timeLimit: itemdata.timelimit,\n                            onFinish: function () {\n                                nextbutton.trigger('click');\n                            }\n                        });\n                    }\n                });\n\n            },\n\n            showConfirmButton: function (itemdata) {\n                var confirmbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_confirmchoice\");\n                anim.do_animate(confirmbutton,'zoomIn animate__faster','in');\n            }\n        };\n    }\n);"],"names":["define","$","log","def","polly","anim","debug","clone","extend","this","init","index","itemdata","quizhelper","register_events","animopts","useanimatecss","next_question","percent","stepdata","hasgrade","totalitems","correctitems","grade","do_next","self","chosenelement","theplayer","uniqueid","nextbutton","confirmchoicebutton","resultspanel","resultspanelswish","resultspanelstars","resultspanelscore","shuffleanswers","each","$parent","$children","children","sort","Math","random","empty","append","on","e","confirmchoice","hide","finalChoice","hasClass","checked","data","addClass","achieved","correctanswer","showitemreview","show","hasOwnProperty","audiocontent","i","sentences","length","text","sentence","html","do_animate","off","prop","setTimeout","removeClass","showConfirmButton","playing","pause","currentTime","el","attr","play","onended","find","timelimit","progressTimer","height","timeLimit","onFinish","trigger","confirmbutton"],"mappings":"AAAAA,oCACI,CAAC,SAAU,WAAY,6BAA8B,6BAA6B,8BAClF,SAAUC,EAAGC,IAAKC,IAAKC,MAAOC,aAO1BH,IAAII,MAAM,wCAEH,CAGHC,MAAO,kBACIN,EAAEO,QAAO,EAAM,GAAIC,OAG9BC,KAAM,SAAUC,MAAOC,SAAUC,iBAExBD,SAAWA,cACXE,gBAAgBH,MAAOC,SAAUC,gBAGlCE,SAAW,GACfA,SAASC,cAAgBH,WAAWG,cACpCX,KAAKK,KAAKK,WAIdE,cAAe,SAAUC,aAEjBC,SAAW,GACfA,SAASR,MAFEF,KAEWE,MACtBQ,SAASC,UAAW,EACpBD,SAASE,WAAa,EACtBF,SAASG,aAAeJ,QAAU,EAAI,EAAI,EAC1CC,SAASI,MAAQL,QANNT,KAONI,WAAWW,QAAQL,WAG5BL,gBAAiB,SAAUH,MAAOC,SAAUC,gBAEpCY,KAAOhB,KACXgB,KAAKd,MAAQA,MACbc,KAAKZ,WAAaA,eACda,cAAgB,KAChBC,UAAY1B,EAAE,IAAMW,SAASgB,SAAW,WACxCC,WAAa5B,EAAE,IAAMW,SAASgB,SAAW,qCACzCE,oBAAsB7B,EAAE,IAAMW,SAASgB,SAAW,2CAClDG,aAAe9B,EAAE,IAAMW,SAASgB,SAAW,uCAC3CI,kBAAoB/B,EAAE,IAAMW,SAASgB,SAAW,6CAChDK,kBAAoBhC,EAAE,IAAMW,SAASgB,SAAW,qCAChDM,kBAAoBjC,EAAE,IAAMW,SAASgB,SAAW,qCAEhDhB,SAASuB,gBACYlC,EAAE,IAAMW,SAASgB,SAAW,gCAClCQ,MAAK,eACZC,QAAUpC,EAAEQ,MACZ6B,UAAYD,QAAQE,WAGxBD,UAAUE,MAAK,iBACJ,GAAMC,KAAKC,YAItBL,QAAQM,QAAQC,OAAON,cAI/BT,WAAWgB,GAAG,SAAS,SAAUC,GAC7BrB,KAAKR,cAAc,MAIQ,IAA3BL,SAASmC,eAAkD,MAA3BnC,SAASmC,eACvClB,WAAWmB,WAIbC,YAAc,eAEVhD,EAAE,IAAMW,SAASgB,SAAW,sCAAsCsB,SAAS,+BAK3EC,QAAUlD,EAAEyB,eAAe0B,KAAK,SAGpCnD,EAAE,IAAMW,SAASgB,SAAW,sCAAsCyB,SAAS,0BAG3EpD,EAAE,IAAMW,SAASgB,SAAW,UAAYuB,SAASE,SAAS,8BAGtDC,SAAWH,SAAWvC,SAAS2C,cAAgB,EAAI,EACnDrC,QAAqB,IAAXoC,YAEVzC,WAAW2C,eAAgB,IAE3BvD,EAAE,IAAMW,SAASgB,SAAW,wCAAwCoB,OACpE/C,EAAE,IAAMW,SAASgB,SAAW,mCAAmC6B,OAE/DxD,EAAE,IAAMW,SAASgB,SAAW,UAAYhB,SAAS2C,cAAgB,yBAAyBP,OAC1F/C,EAAE,IAAMW,SAASgB,SAAW,UAAYhB,SAAS2C,cAAgB,yBAAyBE,OAGtF7C,SAAS8C,eAAe,kBAA6C,IAA1B9C,SAAS+C,iBAC/C,IAAIC,EAAI,EAAGA,EAAIhD,SAASiD,UAAUC,OAAQF,IAAK,CAClC3D,EAAE,IAAMW,SAASgB,SAAW,WAAagC,EAAI,IAC3D3D,EAAE,IAAMW,SAASgB,SAAW,WAAagC,EAAI,GAAK,yBAAyBG,KAAKnD,SAASiD,UAAUD,GAAGI,UAK9GlC,oBAAoBkB,OAGpBhB,kBAAkBoB,KAAK,WAAY,KACnCpB,kBAAkBoB,KAAK,WAAYE,UACnCpB,kBAAkB6B,KAAKT,SAAAA,MACnBA,SAAW,EACXrB,kBAAkBgC,KAAK,KAEvBhC,kBAAkBgC,KAAK,KAE3BlC,aAAa0B,OACbpD,KAAK6D,WAAWlC,kBAAkB,yBAAyB,MAI3DH,WAAWsC,IAAI,SAEftC,WAAWgB,GAAG,SAAS,SAAUC,GAC7BrB,KAAKR,cAAcC,YAIvBW,WAAW4B,YAEXxD,EAAE,0BAA0BmE,KAAK,YAAY,GAC7CC,YAAW,WACPpE,EAAE,0BAA0BmE,KAAK,YAAY,GAC7C3C,KAAKR,cAAcC,WACpB,OAOXjB,EAAE,IAAMW,SAASgB,SAAW,sCAAsCiB,GAAG,SAAS,SAAUC,MACpFpB,cAAgBjB,KACe,IAA3BG,SAASmC,eAAkD,MAA3BnC,SAASmC,cACzCE,kBACG,KAGCE,QAAUlD,EAAEQ,MAAM2C,KAAK,SAC3BnD,EAAE,IAAMW,SAASgB,SAAW,sCAAsC0C,YAAY,0BAC9ErE,EAAE,IAAMW,SAASgB,SAAW,UAAYuB,SAASE,SAAS,0BAE1D5B,KAAK8C,kBAAkB3D,cAK/BX,EAAE,IAAMW,SAASgB,SAAW,2CAA2CiB,GAAG,SAAS,SAAUC,GACrFG,iBAKRhD,EAAE,IAAMW,SAASgB,SAAW,yCAAyCiB,GAAG,SAAS,SAAUC,OAEnF7C,EAAE,IAAMW,SAASgB,SAAW,yCAAyCsB,SAAS,6BAK7EzB,KAAK+C,QAWN7C,UAAU,GAAG8C,QACb9C,UAAU,GAAG+C,YAAc,EAC3BzE,EAAE,IAAMW,SAASgB,SAAW,uCAAuC0C,YAAY,sBAAsBjB,SAAS,WAC9G5B,KAAK+C,SAAU,MAdA,KACXG,GAAKlE,KACTgB,KAAK+C,SAAU,EACf7C,UAAUiD,KAAK,MAAO3E,EAAEQ,MAAMmE,KAAK,aACnCjD,UAAU,GAAGkD,OACblD,UAAU,GAAGmD,QAAU,WACnB7E,EAAE0E,IAAII,KAAK,4BAA4BT,YAAY,sBAAsBjB,SAAS,WAClF5B,KAAK+C,SAAU,GAEnBvE,EAAE0E,IAAII,KAAK,4BAA4BT,YAAY,WAAWjB,SAAS,0BAU/EpD,EAAE,IAAMW,SAASgB,SAAW,cAAciB,GAAG,eAAe,KACpDjC,SAASoE,UAAY,IACrB/E,EAAE,IAAMW,SAASgB,SAAW,kCAAkC6B,OAC9DxD,EAAE,IAAMW,SAASgB,SAAW,oCAAoC6B,OAChExD,EAAE,IAAMW,SAASgB,SAAW,iDAAiDqD,cAAc,CACvFC,OAAQ,MACRC,UAAWvE,SAASoE,UACpBI,SAAU,WACNvD,WAAWwD,QAAQ,iBAQvCd,kBAAmB,SAAU3D,cACrB0E,cAAgBrF,EAAE,IAAMW,SAASgB,SAAW,2CAChDvB,KAAK6D,WAAWoB,cAAc,yBAAyB"}