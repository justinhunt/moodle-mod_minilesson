{"version":3,"sources":["../src/multiaudio.js"],"names":["define","$","log","def","polly","ttrecorder","anim","debug","ttrec","passmark","playing","clone","extend","init","index","itemdata","quizhelper","animopts","useanimatecss","prepare_audio","register_events","init_components","next_question","percent","self","stepdata","hasgrade","totalitems","correctitems","grade","do_next","theplayer","uniqueid","on","hasClass","el","attr","play","onended","find","removeClass","addClass","pause","currentTime","timelimit","show","progressTimer","height","timeLimit","onFinish","trigger","each","sentences","sentence","fetch_polly_url","voiceoption","usevoice","then","audiourl","process_accepted_response","checked","showitemreview","parseInt","show_text","i","length","text","correctanswer","hide","app","correcttext","correctphonetic","phonetic","cleanincorrecttexts","cleanText","cleancorrecttext","opts","callback","theCallback","message","type","speechtext","capturedspeech","cleanspeechtext","spoken","similarity","wordsDoMatch","setTimeout","prop","x","similar","checkByPhonetic","language","Deferred","reject","therecorder","do_animate","stt_guided","is_stt_guided","allsentences","currentPrompt","phraseheard","currentphrase"],"mappings":"AAAAA,OAAM,6BAAC,CAAC,QAAD,CACH,UADG,CAEH,4BAFG,CAGH,4BAHG,CAIH,2BAJG,CAKH,2BALG,CAAD,CAMC,SAASC,CAAT,CAAYC,CAAZ,CAAiBC,CAAjB,CAAsBC,CAAtB,CAA6BC,CAA7B,CAAwCC,CAAxC,CAA8C,CACnD,aAMAJ,CAAG,CAACK,KAAJ,CAAU,qCAAV,EAEA,MAAO,CAGHC,KAAK,CAAE,IAHJ,CAKHC,QAAQ,CAAE,EALP,CAMHC,OAAO,GANJ,CASHC,KAAK,CAAE,gBAAY,CACf,MAAOV,CAAAA,CAAC,CAACW,MAAF,IAAe,EAAf,CAAmB,IAAnB,CACX,CAXG,CAaLC,IAAI,CAAE,cAASC,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,CAG1C,GAAIC,CAAAA,CAAQ,CAAG,CACJC,aADI,CACUF,CAAU,CAACE,aADrB,CAAf,CAEAZ,CAAI,CAACO,IAAL,CAAUI,CAAV,EAEA,KAAKE,aAAL,CAAmBJ,CAAnB,EACA,KAAKK,eAAL,CAAqBN,CAArB,CAA4BC,CAA5B,CAAsCC,CAAtC,EACA,KAAKK,eAAL,CAAqBP,CAArB,CAA4BC,CAA5B,CAAsCC,CAAtC,CACD,CAvBI,CAwBLM,aAAa,CAAE,uBAASC,CAAT,CAAkB,IAC3BC,CAAAA,CAAI,CAAG,IADoB,CAE3BC,CAAQ,CAAG,EAFgB,CAG/BA,CAAQ,CAACX,KAAT,CAAiBU,CAAI,CAACV,KAAtB,CACAW,CAAQ,CAACC,QAAT,IACAD,CAAQ,CAACE,UAAT,CAAsB,CAAtB,CACAF,CAAQ,CAACG,YAAT,CAAgC,CAAR,CAAAL,CAAO,CAAG,CAAH,CAAK,CAApC,CACAE,CAAQ,CAACI,KAAT,CAAiBN,CAAjB,CACAC,CAAI,CAACR,UAAL,CAAgBc,OAAhB,CAAwBL,CAAxB,CACD,CAjCI,CAkCLL,eAAe,CAAE,yBAASN,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,IAEjDQ,CAAAA,CAAI,CAAG,IAF0C,CAGjDO,CAAS,CAAG9B,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,SAA3B,CAHoC,CAIrDR,CAAI,CAACV,KAAL,CAAaA,CAAb,CACAU,CAAI,CAACR,UAAL,CAAkBA,CAAlB,CAEAf,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,mCAA3B,CAAD,CAAiEC,EAAjE,CAAoE,OAApE,CAA6E,UAAY,CACvFT,CAAI,CAACF,aAAL,CAAmB,CAAnB,CACD,CAFD,EAIArB,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,uBAA3B,CAAD,CAAqDC,EAArD,CAAwD,OAAxD,CAAiE,UAAY,CAEzE,GAAGhC,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,uBAA3B,CAAD,CAAqDE,QAArD,CAA8D,wBAA9D,CAAH,CAA2F,CACzF,MACD,CAGD,GAAI,CAACV,CAAI,CAACd,OAAV,CAAmB,CACf,GAAIyB,CAAAA,CAAE,CAAG,IAAT,CACAX,CAAI,CAACd,OAAL,IACAqB,CAAS,CAACK,IAAV,CAAe,KAAf,CAAsBnC,CAAC,CAAC,IAAD,CAAD,CAAQmC,IAAR,CAAa,UAAb,CAAtB,EACAL,CAAS,CAAC,CAAD,CAAT,CAAaM,IAAb,GACAN,CAAS,CAAC,CAAD,CAAT,CAAaO,OAAb,CAAuB,UAAW,CAC9BrC,CAAC,CAACkC,CAAD,CAAD,CAAMI,IAAN,CAAW,0BAAX,EAAuCC,WAAvC,CAAmD,oBAAnD,EAAyEC,QAAzE,CAAkF,SAAlF,EACAjB,CAAI,CAACd,OAAL,GACH,CAHD,CAIAT,CAAC,CAACkC,CAAD,CAAD,CAAMI,IAAN,CAAW,0BAAX,EAAuCC,WAAvC,CAAmD,SAAnD,EAA8DC,QAA9D,CAAuE,oBAAvE,CACH,CAVD,IAUK,CACDV,CAAS,CAAC,CAAD,CAAT,CAAaW,KAAb,GACAX,CAAS,CAAC,CAAD,CAAT,CAAaY,WAAb,CAAyB,CAAzB,CACA1C,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,qCAA3B,CAAD,CAAmEQ,WAAnE,CAA+E,oBAA/E,EAAqGC,QAArG,CAA8G,SAA9G,EACAjB,CAAI,CAACd,OAAL,GACH,CAKJ,CA3BD,EA6BAT,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,YAA3B,CAAD,CAA0CC,EAA1C,CAA6C,aAA7C,CAA4D,UAAM,CAChE,GAAyB,CAArB,CAAAlB,CAAQ,CAAC6B,SAAb,CAA4B,CACxB3C,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,gCAA3B,CAAD,CAA8Da,IAA9D,GACA5C,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,kCAA3B,CAAD,CAAgEa,IAAhE,GACA5C,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,+CAA3B,CAAD,CAA6Ec,aAA7E,CAA2F,CACvFC,MAAM,CAAE,KAD+E,CAEvFC,SAAS,CAAEjC,CAAQ,CAAC6B,SAFmE,CAGvFK,QAAQ,CAAE,mBAAW,CACjBhD,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,mCAA3B,CAAD,CAAiEkB,OAAjE,CAAyE,OAAzE,CACH,CALsF,CAA3F,CAOH,CACF,CAZD,CAcD,CAxFI,CA0FL/B,aAAa,CAAE,uBAASJ,CAAT,CAAmB,CAE5Bd,CAAC,CAACkD,IAAF,CAAOpC,CAAQ,CAACqC,SAAhB,CAA2B,SAAStC,CAAT,CAAgBuC,CAAhB,CAA0B,CACjDjD,CAAK,CAACkD,eAAN,CAAsBD,CAAQ,CAACA,QAA/B,CAAyCtC,CAAQ,CAACwC,WAAlD,CAA+DxC,CAAQ,CAACyC,QAAxE,EAAkFC,IAAlF,CAAuF,SAASC,CAAT,CAAmB,CACtGzD,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,SAA1B,EAAuClB,CAAK,CAAC,CAA7C,CAAD,CAAD,CAAmDsB,IAAnD,CAAwD,UAAxD,CAAoEsB,CAApE,CACH,CAFD,CAGH,CAJD,CAKL,CAjGI,CAmGLC,yBAAyB,CAAE,mCAAS5C,CAAT,CAAmB6C,CAAnB,CAA2B,CAClD,GAAIpC,CAAAA,CAAI,CAAG,IAAX,CAEAvB,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,uBAA3B,CAAD,CAAqDS,QAArD,CAA8D,wBAA9D,EAEA,GAAGjB,CAAI,CAACR,UAAL,CAAgB6C,cAAnB,CAAmC,CAE/B,GAAoC,CAAhC,EAAAC,QAAQ,CAAC/C,CAAQ,CAACgD,SAAV,CAAZ,CAAuC,CACnC,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGjD,CAAQ,CAACqC,SAAT,CAAmBa,MAAvC,CAA+CD,CAAC,EAAhD,CAAoD,CAClC/D,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,SAA1B,EAAuCgC,CAAC,CAAG,CAA3C,CAAD,CADiC,CAEhD/D,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,SAA1B,EAAuCgC,CAAC,CAAG,CAA3C,EAAgD,uBAAjD,CAAD,CAA2EE,IAA3E,CAAgFnD,CAAQ,CAACqC,SAAT,CAAmBY,CAAnB,EAAsBX,QAAtG,CACH,CACJ,CAGDpD,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,iCAA3B,CAAD,CAA+Da,IAA/D,GACA5C,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,SAA1B,CAAsCjB,CAAQ,CAACoD,aAA/C,CAA+D,uBAAhE,CAAD,CAA0FC,IAA1F,GACAnE,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,SAA1B,CAAsCjB,CAAQ,CAACoD,aAA/C,CAA+D,uBAAhE,CAAD,CAA0FtB,IAA1F,EACH,CAED5C,CAAC,CAAC,IAAMc,CAAQ,CAACiB,QAAf,CAA0B,SAA1B,CAAsC4B,CAAtC,CAAgD,0BAAjD,CAAD,CAA8EnB,QAA9E,CAAuF,wBAAvF,EAGA,GAAIlB,CAAAA,CAAO,CAAGqC,CAAO,EAAI7C,CAAQ,CAACoD,aAApB,CAAoC,GAApC,CAA0C,CAAxD,CAEA,MAAO5C,CAAAA,CAEV,CA9HI,CAgILF,eAAe,CAAE,yBAASP,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,IAC/CqD,CAAAA,CAAG,CAAE,IAD0C,CAE/CC,CAAW,CAAGvD,CAAQ,CAACqC,SAAT,CAAmBrC,CAAQ,CAACoD,aAAT,CAAuB,CAA1C,EAA6Cd,QAFZ,CAG/CkB,CAAe,CAAGxD,CAAQ,CAACqC,SAAT,CAAmBrC,CAAQ,CAACoD,aAAT,CAAuB,CAA1C,EAA6CK,QAHhB,CAI/CC,CAAmB,CAAC,EAJ2B,CAMnDvE,CAAG,CAACK,KAAJ,CAAU,2BAAV,EACAL,CAAG,CAACK,KAAJ,CAAUQ,CAAQ,CAACqC,SAAnB,EAEA,IAAI,GAAIY,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAACjD,CAAQ,CAACqC,SAAT,CAAmBa,MAAjC,CAAwCD,CAAC,EAAzC,CAA4C,CACxC,GAAGA,CAAC,CAAC,CAAF,EAAKjD,CAAQ,CAACoD,aAAjB,CAAgC,CAG5BM,CAAmB,CAACT,CAAD,CAAnB,CAAuB,EAC1B,CAJD,IAIK,CACDS,CAAmB,CAACT,CAAD,CAAnB,CAAuBhD,CAAU,CAAC0D,SAAX,CAAqB3D,CAAQ,CAACqC,SAAT,CAAmBY,CAAnB,EAAsBX,QAA3C,CAC1B,CACJ,CAjBkD,GAmB/CsB,CAAAA,CAAgB,CAAG3D,CAAU,CAAC0D,SAAX,CAAqBJ,CAArB,CAnB4B,CA2G/CM,CAAI,CAAG,EA3GwC,CA4GnDA,CAAI,CAAC5C,QAAL,CAAgBjB,CAAQ,CAACiB,QAAzB,CACA9B,CAAG,CAACK,KAAJ,CAAU,eAAiBQ,CAAQ,CAACiB,QAApC,EACA4C,CAAI,CAACC,QAAL,CAzFkB,QAAdC,CAAAA,WAAc,CAASC,CAAT,CAAkB,CAEhC,OAAQA,CAAO,CAACC,IAAhB,EACI,IAAK,WAAL,CAEI,MAEJ,IAAK,QAAL,CACI9E,CAAG,CAACK,KAAJ,CAAU,sBAAV,EADJ,GAEQ0E,CAAAA,CAAU,CAAGF,CAAO,CAACG,cAF7B,CAGQC,CAAe,CAAGnE,CAAU,CAAC0D,SAAX,CAAqBO,CAArB,CAH1B,CAIQG,CAAM,CAAGD,CAJjB,CAKIjF,CAAG,CAACK,KAAJ,CAAU,aAAV,CAAwB0E,CAAxB,EACA/E,CAAG,CAACK,KAAJ,CAAU,SAAV,CAAoB6E,CAApB,EACAlF,CAAG,CAACK,KAAJ,CAAU,UAAV,CAAqBoE,CAArB,EAEA,GAAIU,CAAAA,CAAU,CAAGrE,CAAU,CAACqE,UAAX,CAAsBD,CAAtB,CAA8BT,CAA9B,CAAjB,CACAzE,CAAG,CAACK,KAAJ,CAAU,kBAAoB6E,CAApB,CAA6B,GAA7B,CAAmCT,CAAnC,CAAsD,GAAtD,CAA4DU,CAAtE,EAGA,GAAIA,CAAU,EAAIhB,CAAG,CAAC5D,QAAlB,EACA4D,CAAG,CAACiB,YAAJ,CAAiBtE,CAAjB,CAA6BmE,CAA7B,CAA8CR,CAA9C,CADJ,CACqE,CACjEzE,CAAG,CAACK,KAAJ,CAAU,wBAA+B6E,CAA/B,CAAwC,GAAxC,CAA8CT,CAAxD,EACA,GAAIpD,CAAAA,CAAO,CAAG8C,CAAG,CAACV,yBAAJ,CAA8B5C,CAA9B,CAAwCA,CAAQ,CAACoD,aAAjD,CAAd,CAGAoB,UAAU,CAAC,UAAW,CAClBtF,CAAC,CAAC,wBAAD,CAAD,CAA4BuF,IAA5B,CAAiC,UAAjC,KACAnB,CAAG,CAAC/C,aAAJ,CAAkBC,CAAlB,CACH,CAHS,CAGP,GAHO,CAAV,CAKA,MACH,CAZD,IAYK,CACD,IAAI,GAAIkE,CAAAA,CAAC,CAAC,CAAV,CAAYA,CAAC,CAAChB,CAAmB,CAACR,MAAlC,CAAyCwB,CAAC,EAA1C,CAA6C,CAEzC,GAA4B,EAAzB,GAAAhB,CAAmB,CAACgB,CAAD,CAAtB,CAA+B,CAAC,QAAU,CAC1C,GAAIC,CAAAA,CAAO,CAAG1E,CAAU,CAACqE,UAAX,CAAsBD,CAAtB,CAA8BX,CAAmB,CAACgB,CAAD,CAAjD,CAAd,CACAvF,CAAG,CAACK,KAAJ,CAAU,kBAAoB6E,CAApB,CAA6B,GAA7B,CAAmCX,CAAmB,CAACgB,CAAD,CAAtD,CAA4D,GAA5D,CAAkEC,CAA5E,EACA,GAAIA,CAAO,EAAIrB,CAAG,CAAC5D,QAAf,EACA4D,CAAG,CAACiB,YAAJ,CAAiBtE,CAAjB,CAA6BmE,CAA7B,CAA8CV,CAAmB,CAACgB,CAAD,CAAjE,CADJ,CAC2E,CAGvE,GAAIlE,CAAAA,CAAO,CAAG8C,CAAG,CAACV,yBAAJ,CAA8B5C,CAA9B,CAAwC0E,CAAC,CAAC,CAA1C,CAAd,CACAxF,CAAC,CAAC,wBAAD,CAAD,CAA4BuF,IAA5B,CAAiC,UAAjC,KAGAD,UAAU,CAAC,UAAW,CAClBtF,CAAC,CAAC,wBAAD,CAAD,CAA4BuF,IAA5B,CAAiC,UAAjC,KACAnB,CAAG,CAAC/C,aAAJ,CAAkBC,CAAlB,CACH,CAHS,CAGP,GAHO,CAAV,CAIA,MACH,CACJ,CACJ,CAGDP,CAAU,CAAC2E,eAAX,CAA2BhB,CAA3B,CAA4CS,CAA5C,CAAoDb,CAApD,CAAqExD,CAAQ,CAAC6E,QAA9E,EAAwFnC,IAAxF,CAA6F,SAAS4B,CAAT,CAAqB,CAC9G,GAAI,KAAAA,CAAJ,CAA0B,CACtB,MAAOpF,CAAAA,CAAC,CAAC4F,QAAF,GAAaC,MAAb,EACV,CAFD,IAEO,CACH5F,CAAG,CAACK,KAAJ,CAAU,mBAAqB6E,CAArB,CAA8B,GAA9B,CAAoCT,CAApC,CAAuD,GAAvD,CAA6DU,CAAvE,EACA,GAAIA,CAAU,EAAIhB,CAAG,CAAC5D,QAAtB,CAAgC,CAC5B,GAAIc,CAAAA,CAAO,CAAG8C,CAAG,CAACV,yBAAJ,CAA8B5C,CAA9B,CAAwCA,CAAQ,CAACoD,aAAjD,CAAd,CAGAlE,CAAC,CAAC,wBAAD,CAAD,CAA4BuF,IAA5B,CAAiC,UAAjC,KACAD,UAAU,CAAC,UAAW,CAClBtF,CAAC,CAAC,wBAAD,CAAD,CAA4BuF,IAA5B,CAAiC,UAAjC,KACAnB,CAAG,CAAC/C,aAAJ,CAAkBC,CAAlB,CACH,CAHS,CAGP,GAHO,CAIb,CACJ,CAID,GAAIwE,CAAAA,CAAW,CAAG9F,CAAC,CAAC,oBAAsBc,CAAQ,CAACiB,QAAhC,CAAnB,CACA1B,CAAI,CAAC0F,UAAL,CAAgBD,CAAhB,CAA4B,wBAA5B,EAAsDtC,IAAtD,CACI,UAAW,CAAE,CADjB,CAIH,CAxBD,EAtDR,CAiFH,CAMD,CACAmB,CAAI,CAACqB,UAAL,CAAgBjF,CAAU,CAACkF,aAAX,EAAhB,CACA7B,CAAG,CAAC7D,KAAJ,CAAYH,CAAU,CAACM,KAAX,EAAZ,CACA0D,CAAG,CAAC7D,KAAJ,CAAUK,IAAV,CAAe+D,CAAf,EAIA,OADIuB,CAAAA,CAAY,CAAC,EACjB,CAAQnC,CAAC,CAAC,CAAV,CAAYA,CAAC,CAAEjD,CAAQ,CAACqC,SAAT,CAAmBa,MAAlC,CAA0CD,CAAC,EAA3C,CAA8C,CAC1CmC,CAAY,EAAInF,CAAU,CAAC0D,SAAX,CAAqB3D,CAAQ,CAACqC,SAAT,CAAmBY,CAAnB,EAAsBX,QAA3C,EAAuD,GAC1E,CACDgB,CAAG,CAAC7D,KAAJ,CAAU4F,aAAV,CAAwBD,CAE3B,CA1PI,CA4PLb,YAAY,CAAE,sBAAStE,CAAT,CAAqBqF,CAArB,CAAkCC,CAAlC,CAAiD,CAE3DD,CAAW,CAAGrF,CAAU,CAAC0D,SAAX,CAAqB2B,CAArB,CAAd,CACAC,CAAa,CAAGtF,CAAU,CAAC0D,SAAX,CAAqB4B,CAArB,CAAhB,CACA,GAAID,CAAW,EAAIC,CAAnB,CAAkC,CAC9B,QACH,CACD,QACH,CApQI,CAsQR,CArRK,CAAN","sourcesContent":["define(['jquery',\n    'core/log',\n    'mod_minilesson/definitions',\n    'mod_minilesson/pollyhelper',\n    'mod_minilesson/ttrecorder',\n    'mod_minilesson/animatecss'\n    ], function($, log, def, polly, ttrecorder,anim) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('MiniLesson Multiaudio: initialising');\n\n  return {\n\n      //a handle on the tt recorder\n      ttrec: null,\n\n      passmark: 90,//lower this if it often doesnt match (was 85)\n      playing: false,\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n\n      //anim\n      var animopts = {};\n        animopts.useanimatecss=quizhelper.useanimatecss;\n      anim.init(animopts);\n\n      this.prepare_audio(itemdata);\n      this.register_events(index, itemdata, quizhelper);\n      this.init_components(index, itemdata, quizhelper);\n    },\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      self.quizhelper.do_next(stepdata);\n    },\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n      self.index = index;\n      self.quizhelper = quizhelper;\n\n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n        self.next_question(0);\n      });\n\n      $(\"#\" + itemdata.uniqueid + \"_container .mcplayrow\").on('click', function(e) {\n        //if disabled =>just return (already answered)\n          if($(\"#\" + itemdata.uniqueid + \"_container .mcplayrow\").hasClass('minilesson_mc_disabled')){\n            return;\n          }\n\n          //audio play requests\n          if (!self.playing) {\n              var el = this;\n              self.playing = true;\n              theplayer.attr('src', $(this).attr('data-src'));\n              theplayer[0].play();\n              theplayer[0].onended = function() {\n                  $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n                  self.playing = false;\n              };\n              $(el).find(\".minilesson_mc_playstate\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n          }else{\n              theplayer[0].pause();\n              theplayer[0].currentTime=0;\n              $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_playstate\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n              self.playing = false;\n          }\n\n          //get selected item index\n          //var checked = $(this).data('index');\n\n      });\n\n      $(\"#\" + itemdata.uniqueid + \"_container\").on('showElement', () => {\n        if (itemdata.timelimit > 0) {\n            $(\"#\" + itemdata.uniqueid + \"_container .progress-container\").show();\n            $(\"#\" + itemdata.uniqueid + \"_container .progress-container i\").show();\n            $(\"#\" + itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                height: '5px',\n                timeLimit: itemdata.timelimit,\n                onFinish: function() {\n                    $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").trigger('click');\n                }\n            });\n        }\n      });\n\n    },//end of register events\n\n    prepare_audio: function(itemdata) {\n         // debugger;\n          $.each(itemdata.sentences, function(index, sentence) {\n              polly.fetch_polly_url(sentence.sentence, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\n                  $(\"#\" + itemdata.uniqueid + \"_option\" + (index+1)).attr(\"data-src\", audiourl);\n              });\n          });\n    },\n\n    process_accepted_response: function(itemdata, checked){\n        var self = this;\n        //disable the answers, cos its answered\n        $(\"#\" + itemdata.uniqueid + \"_container .mcplayrow\").addClass('minilesson_mc_disabled');\n\n        if(self.quizhelper.showitemreview) {\n            //turn dots into text (if they were dots)\n            if (parseInt(itemdata.show_text) == 0) {\n                for (var i = 0; i < itemdata.sentences.length; i++) {\n                    var theline = $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1));\n                    $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minilesson_sentence').text(itemdata.sentences[i].sentence);\n                }\n            }\n\n            //reveal answers\n            $(\"#\" + itemdata.uniqueid + \"_container .minilesson_mc_wrong\").show();\n            $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_wrong\").hide();\n            $(\"#\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \" .minilesson_mc_right\").show();\n        }\n        //highlight selected answers\n        $(\"#\" + itemdata.uniqueid + \"_option\" + checked + ' .minilesson_mc_response').addClass('minilesson_mc_selected');\n\n\n        var percent = checked == itemdata.correctanswer ? 100 : 0;\n\n        return percent;\n\n    },\n\n    init_components: function(index, itemdata, quizhelper) {\n        var app= this;\n        var correcttext = itemdata.sentences[itemdata.correctanswer-1].sentence;\n        var correctphonetic = itemdata.sentences[itemdata.correctanswer-1].phonetic;\n        var cleanincorrecttexts=[];\n\n        log.debug('initcomponents_multiaudio');\n        log.debug(itemdata.sentences);\n\n        for(var i=0;i<itemdata.sentences.length;i++){\n            if(i+1==itemdata.correctanswer) {\n                //to make life simple for ourselves we add an empty string entry in incorrecttexts at the correct answer index\n                //NB index of item in DOM is 1 based , so we need to mess with +1's\n                cleanincorrecttexts[i]='';\n            }else{\n                cleanincorrecttexts[i]=quizhelper.cleanText(itemdata.sentences[i].sentence);\n            }\n        }\n\n        var cleancorrecttext = quizhelper.cleanText(correcttext);\n\n        var theCallback = function(message) {\n\n            switch (message.type) {\n                case 'recording':\n\n                    break;\n\n                case 'speech':\n                    log.debug(\"speech at multiaudio\");\n                    var speechtext = message.capturedspeech;\n                    var cleanspeechtext = quizhelper.cleanText(speechtext);\n                    var spoken = cleanspeechtext;\n                    log.debug('speechtext:',speechtext);\n                    log.debug('spoken:',spoken);\n                    log.debug('correct:',cleancorrecttext);\n                    //Similarity check by character matching\n                    var similarity = quizhelper.similarity(spoken, cleancorrecttext);\n                    log.debug('JS similarity: ' + spoken + ':' + cleancorrecttext + ':' + similarity);\n\n                    //Similarity check by direct-match/acceptable-mistranscription\n                    if (similarity >= app.passmark ||\n                        app.wordsDoMatch(quizhelper, cleanspeechtext, cleancorrecttext)) {\n                        log.debug('local correct match:' + ':' + spoken + ':' + cleancorrecttext);\n                        var percent = app.process_accepted_response(itemdata, itemdata.correctanswer);\n\n                        //proceed to next question\n                        setTimeout(function() {\n                            $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n                            app.next_question(percent);\n                        }, 2000);\n\n                        return;\n                    }else{\n                        for(var x=0;x<cleanincorrecttexts.length;x++){\n                            //if this is the correct answer index, just move on\n                            if(cleanincorrecttexts[x]===''){continue;}\n                            var similar = quizhelper.similarity(spoken, cleanincorrecttexts[x]);\n                            log.debug('JS similarity: ' + spoken + ':' + cleanincorrecttexts[x] + ':' + similar);\n                            if (similar >= app.passmark ||\n                                app.wordsDoMatch(quizhelper, cleanspeechtext, cleanincorrecttexts[x])) {\n\n                              //proceed to next question\n                                var percent = app.process_accepted_response(itemdata, x+1);\n                                $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n                                //proceed to next question\n                                setTimeout(function() {\n                                    $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n                                    app.next_question(percent);\n                                }, 2000);\n                                return;\n                            }//end of if similarity\n                        }//end of for x\n                    }\n\n                    //Similarity check by phonetics(ajax)\n                    quizhelper.checkByPhonetic(cleancorrecttext,spoken, correctphonetic, itemdata.language).then(function(similarity) {\n                        if (similarity === false) {\n                            return $.Deferred().reject();\n                        } else {\n                            log.debug('PHP similarity: ' + spoken + ':' + cleancorrecttext + ':' + similarity);\n                            if (similarity >= app.passmark) {\n                                var percent = app.process_accepted_response(itemdata, itemdata.correctanswer);\n\n                                //proceed to next question\n                                $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n                                setTimeout(function() {\n                                    $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n                                    app.next_question(percent);\n                                }, 2000);\n                            }\n                        } //end of if check_by_phonetic result\n\n                        //whatever was spoken was off, so give a visual indication of that\n                        //shake the screen\n                        var therecorder = $(\"#ttrec_container_\" + itemdata.uniqueid);\n                        anim.do_animate(therecorder,'shakeX animate__faster').then(\n                            function() {}\n                        );\n\n                    }); //end of check by phonetic\n\n            } //end of switch message type\n        };\n\n        //init tt recorder\n        var opts = {};\n        opts.uniqueid = itemdata.uniqueid;\n        log.debug('ma uniqueid:' + itemdata.uniqueid);\n        opts.callback = theCallback;\n        opts.stt_guided=quizhelper.is_stt_guided();\n        app.ttrec = ttrecorder.clone();\n        app.ttrec.init(opts);\n\n        //prompt for TT recorder\n        var allsentences=\"\";\n        for(var i=0;i< itemdata.sentences.length; i++){\n            allsentences += quizhelper.cleanText(itemdata.sentences[i].sentence) + ' ';\n        }\n        app.ttrec.currentPrompt=allsentences;\n\n    }, //end of init components\n\n    wordsDoMatch: function(quizhelper, phraseheard, currentphrase) {\n        //lets lower case everything\n        phraseheard = quizhelper.cleanText(phraseheard);\n        currentphrase = quizhelper.cleanText(currentphrase);\n        if (phraseheard == currentphrase) {\n            return true;\n        }\n        return false;\n    },\n  };\n});"],"file":"multiaudio.min.js"}