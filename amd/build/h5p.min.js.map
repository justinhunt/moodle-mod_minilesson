{"version":3,"file":"h5p.min.js","sources":["../src/h5p.js"],"sourcesContent":["define(\n    ['jquery', 'core/log', 'mod_minilesson/definitions'],\n    function ($, log, def, anim) {\n        \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the H5P item type\n    */\n\n        log.debug('MiniLesson H5P: initialising');\n\n        return {\n\n          //for making multiple instances\n            clone: function () {\n                return $.extend(true, {correctitems: 0, totalitems: 0}, this);\n            },\n\n            init: function (index, itemdata, quizhelper) {\n                this.itemdata = itemdata;\n                this.register_events(index, itemdata, quizhelper);\n                log.debug('MiniLesson H5P URL: ' + itemdata.h5purl);\n                log.debug('MiniLesson H5P Total Marks: ' + itemdata.totalmarks);\n\n            },\n\n            next_question: function () {\n                var self = this;\n                var stepdata = {};\n                stepdata.index = self.index;\n                stepdata.hasgrade = true;\n                stepdata.totalitems = self.totalitems;\n                stepdata.correctitems = self.correctitems;\n                stepdata.grade = self.totalitems > 0 ? 100 * self.correctitems / self.totalitems : 0;\n                self.quizhelper.do_next(stepdata);\n            },\n\n            register_events: function (index, itemdata, quizhelper) {\n\n                var self = this;\n                self.index = index;\n                self.quizhelper = quizhelper;\n                var h5pplayer = $(\"#\" + itemdata.uniqueid + \"_h5pplayer\");\n                var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n\n                nextbutton.on('click', function (e) {\n                            self.next_question();\n                });\n\n                var iframe = h5pplayer.find('iframe')[0];\n                if (iframe) {\n                            addEventListener('message', event => {\n                                if (window === event.target && event.data.context === 'h5p' && !iframe.getAttribute('data-gradelistener')) {\n                                    iframe.contentWindow.H5P.externalDispatcher.on('xAPI', function (event) {\n                                        if (event.getMaxScore() > 0) {\n                                            console.log('gradehit');\n                                            self.correctitems = event.getScore();\n                                            self.totalitems = event.getMaxScore();\n                                        }\n                                    });\n                                    iframe.setAttribute('data-gradelistener', 1);\n                                }\n                            });\n                }\n\n            },\n\n        };\n    }\n);"],"names":["define","$","log","def","anim","debug","clone","extend","correctitems","totalitems","this","init","index","itemdata","quizhelper","register_events","h5purl","totalmarks","next_question","stepdata","hasgrade","grade","do_next","self","h5pplayer","uniqueid","on","e","iframe","find","addEventListener","event","window","target","data","context","getAttribute","contentWindow","H5P","externalDispatcher","getMaxScore","console","getScore","setAttribute"],"mappings":"AAAAA,4BACI,CAAC,SAAU,WAAY,+BACvB,SAAUC,EAAGC,IAAKC,IAAKC,aAOnBF,IAAIG,MAAM,gCAEH,CAGHC,MAAO,kBACIL,EAAEM,QAAO,EAAM,CAACC,aAAc,EAAGC,WAAY,GAAIC,OAG5DC,KAAM,SAAUC,MAAOC,SAAUC,iBACxBD,SAAWA,cACXE,gBAAgBH,MAAOC,SAAUC,YACtCZ,IAAIG,MAAM,uBAAyBQ,SAASG,QAC5Cd,IAAIG,MAAM,+BAAiCQ,SAASI,aAIxDC,cAAe,eAEPC,SAAW,GACfA,SAASP,MAFEF,KAEWE,MACtBO,SAASC,UAAW,EACpBD,SAASV,WAJEC,KAIgBD,WAC3BU,SAASX,aALEE,KAKkBF,aAC7BW,SAASE,MANEX,KAMWD,WAAa,EAAI,IAN5BC,KAMuCF,aANvCE,KAM2DD,WAAa,EANxEC,KAONI,WAAWQ,QAAQH,WAG5BJ,gBAAiB,SAAUH,MAAOC,SAAUC,gBAEpCS,KAAOb,KACXa,KAAKX,MAAQA,MACbW,KAAKT,WAAaA,eACdU,UAAYvB,EAAE,IAAMY,SAASY,SAAW,cAC3BxB,EAAE,IAAMY,SAASY,SAAW,qCAElCC,GAAG,SAAS,SAAUC,GACrBJ,KAAKL,uBAGbU,OAASJ,UAAUK,KAAK,UAAU,GAClCD,QACQE,iBAAiB,WAAWC,QACpBC,SAAWD,MAAME,QAAiC,QAAvBF,MAAMG,KAAKC,SAAsBP,OAAOQ,aAAa,wBAChFR,OAAOS,cAAcC,IAAIC,mBAAmBb,GAAG,QAAQ,SAAUK,OACzDA,MAAMS,cAAgB,IACtBC,QAAQvC,IAAI,YACZqB,KAAKf,aAAeuB,MAAMW,WAC1BnB,KAAKd,WAAasB,MAAMS,kBAGhCZ,OAAOe,aAAa,qBAAsB"}