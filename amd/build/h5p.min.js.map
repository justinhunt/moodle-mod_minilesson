{"version":3,"sources":["../src/h5p.js"],"names":["define","$","log","debug","clone","extend","correctitems","totalitems","init","index","itemdata","quizhelper","register_events","h5purl","totalmarks","next_question","self","stepdata","hasgrade","grade","do_next","h5pplayer","uniqueid","nextbutton","on","iframe","find","addEventListener","event","window","target","data","context","getAttribute","contentWindow","H5P","externalDispatcher","getMaxScore","console","getScore","setAttribute"],"mappings":"AAAAA,OAAM,sBAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,4BAAvB,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAA4B,CAC9B,aAMAA,CAAG,CAACC,KAAJ,CAAU,8BAAV,EAEA,MAAO,CAGHC,KAAK,CAAE,gBAAY,CACf,MAAOH,CAAAA,CAAC,CAACI,MAAF,IAAe,CAACC,YAAY,CAAE,CAAf,CAAkBC,UAAU,CAAE,CAA9B,CAAf,CAAiD,IAAjD,CACX,CALG,CAOLC,IAAI,CAAE,cAASC,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,CAC1C,KAAKD,QAAL,CAAgBA,CAAhB,CACA,KAAKE,eAAL,CAAqBH,CAArB,CAA4BC,CAA5B,CAAsCC,CAAtC,EACAT,CAAG,CAACC,KAAJ,CAAU,uBAAyBO,CAAQ,CAACG,MAA5C,EACAX,CAAG,CAACC,KAAJ,CAAU,+BAAiCO,CAAQ,CAACI,UAApD,CAED,CAbI,CAeLC,aAAa,CAAE,wBAAW,IACpBC,CAAAA,CAAI,CAAG,IADa,CAEpBC,CAAQ,CAAG,EAFS,CAGxBA,CAAQ,CAACR,KAAT,CAAiBO,CAAI,CAACP,KAAtB,CACAQ,CAAQ,CAACC,QAAT,IACAD,CAAQ,CAACV,UAAT,CAAsBS,CAAI,CAACT,UAA3B,CACAU,CAAQ,CAACX,YAAT,CAAwBU,CAAI,CAACV,YAA7B,CACAW,CAAQ,CAACE,KAAT,CAAmC,CAAlB,CAAAH,CAAI,CAACT,UAAL,CAAsB,IAAMS,CAAI,CAACV,YAAX,CAA0BU,CAAI,CAACT,UAArD,CAAiE,CAAlF,CACAS,CAAI,CAACL,UAAL,CAAgBS,OAAhB,CAAwBH,CAAxB,CACD,CAxBI,CA0BLL,eAAe,CAAE,yBAASH,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,CAErD,GAAIK,CAAAA,CAAI,CAAG,IAAX,CACAA,CAAI,CAACP,KAAL,CAAaA,CAAb,CACAO,CAAI,CAACL,UAAL,CAAkBA,CAAlB,CAJqD,GAKjDU,CAAAA,CAAS,CAAGpB,CAAC,CAAC,IAAMS,CAAQ,CAACY,QAAf,CAA0B,YAA3B,CALoC,CAMjDC,CAAU,CAAGtB,CAAC,CAAC,IAAMS,CAAQ,CAACY,QAAf,CAA0B,mCAA3B,CANmC,CAQrDC,CAAU,CAACC,EAAX,CAAc,OAAd,CAAuB,UAAY,CACjCR,CAAI,CAACD,aAAL,EACD,CAFD,EAIA,GAAIU,CAAAA,CAAM,CAAGJ,CAAS,CAACK,IAAV,CAAe,QAAf,EAAyB,CAAzB,CAAb,CACA,GAAID,CAAJ,CAAY,CACVE,gBAAgB,CAAC,SAAD,CAAY,SAAAC,CAAK,CAAI,CACnC,GAAIC,MAAM,GAAKD,CAAK,CAACE,MAAjB,EAAkD,KAAvB,GAAAF,CAAK,CAACG,IAAN,CAAWC,OAAtC,EAA2D,CAACP,CAAM,CAACQ,YAAP,CAAoB,oBAApB,CAAhE,CAA2G,CACzGR,CAAM,CAACS,aAAP,CAAqBC,GAArB,CAAyBC,kBAAzB,CAA4CZ,EAA5C,CAA+C,MAA/C,CAAuD,SAASI,CAAT,CAAe,CACpE,GAA0B,CAAtB,CAAAA,CAAK,CAACS,WAAN,EAAJ,CAA6B,CAC3BC,OAAO,CAACpC,GAAR,CAAY,UAAZ,EACAc,CAAI,CAACV,YAAL,CAAoBsB,CAAK,CAACW,QAAN,EAApB,CACAvB,CAAI,CAACT,UAAL,CAAkBqB,CAAK,CAACS,WAAN,EACnB,CACF,CAND,EAOAZ,CAAM,CAACe,YAAP,CAAoB,oBAApB,CAA0C,CAA1C,CACD,CACF,CAXe,CAYjB,CAEF,CAtDI,CAyDR,CAnEK,CAAN","sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions'],\n    function($, log, def, anim) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the H5P item type\n   */\n\n  log.debug('MiniLesson H5P: initialising');\n\n  return {\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {correctitems: 0, totalitems: 0}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      this.itemdata = itemdata;\n      this.register_events(index, itemdata, quizhelper);\n      log.debug('MiniLesson H5P URL: ' + itemdata.h5purl);\n      log.debug('MiniLesson H5P Total Marks: ' + itemdata.totalmarks);\n\n    },\n\n    next_question: function() {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = self.totalitems;\n      stepdata.correctitems = self.correctitems;\n      stepdata.grade = self.totalitems > 0 ? 100 * self.correctitems / self.totalitems: 0;\n      self.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      var h5pplayer = $(\"#\" + itemdata.uniqueid + \"_h5pplayer\");\n      var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n\n      nextbutton.on('click', function(e) {\n        self.next_question();\n      });\n\n      var iframe = h5pplayer.find('iframe')[0];\n      if (iframe) {\n        addEventListener('message', event => {\n          if (window === event.target && event.data.context === 'h5p' && !iframe.getAttribute('data-gradelistener')) {\n            iframe.contentWindow.H5P.externalDispatcher.on('xAPI', function(event){\n              if (event.getMaxScore() > 0) {\n                console.log('gradehit');\n                self.correctitems = event.getScore();\n                self.totalitems = event.getMaxScore();\n              }\n            });\n            iframe.setAttribute('data-gradelistener', 1);\n          }\n        });\n      }\n\n    },\n\n  };\n});"],"file":"h5p.min.js"}