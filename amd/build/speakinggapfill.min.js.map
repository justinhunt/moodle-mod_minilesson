{"version":3,"sources":["../src/speakinggapfill.js"],"names":["define","$","log","ajax","def","polly","ttrecorder","anim","progresstimer","templates","str","notification","debug","ttrec","controls","clone","extend","init","index","itemdata","quizhelper","self","strings","opts","uniqueid","callback","theCallback","message","type","words","items","game","pointer","maskedwords","Object","keys","forEach","key","push","getComparison","join","capturedspeech","phonetic","comparison","gotComparison","mediaurl","stt_guided","is_stt_guided","wwwroot","animopts","useanimatecss","init_controls","init_strings","register_events","setvoice","getItems","container","listen_cont","nextbutton","start_btn","skip_btn","ctrl_btn","speakbtncontainer","controlsbox","resultscontainer","mainmenu","title","progress_container","progress_bar","question","listen_btn","description","image","maintitle","itemquestion","get_strings","done","s","i","nextlessonitem","confirm_desc","yes","no","next_question","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","stop_audio","do_next","show_item_review","review_data","item","itemwordlist","parsedstring","data","character","wordmatch","regex","RegExp","answerclass","result","target","replace","listencont","qbox","recorderbox","gamebox","resultsbox","render","then","html","js","show","hide","runTemplateJS","find","on","some","answered","confirm","start","audioplayerbtn","readsentence","theaudio","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","text","prompt","each","realidx","sgapfill_targetWord","sgapfill_targetWords","val","stopTimer","timer","setTimeout","nextPrompt","end","usevoice","voiceoption","text_items","sentences","map","sentence","segmentedsentence","displayprompt","definition","typed","audiourl","imageurl","Audio","src","appReady","hidestartpage","countdownStarted","feedback","allCorrect","matched","characterinput","updateProgressDots","obj","word","thereply","do_animate","targetWord","timelimit_progressbar","allowretry","hasClass","passage","transcript","comparePassageToTranscript","language","alternates","ajaxresult","payloadobject","JSON","parse","showitemreview","spoken","color","icon","progress","idx","newprompt","nextReply","code","brackets","started","ended","hasdefinition","imagebottommargin","append","newreply","startTimer","mobile_user","trigger","use_ttrecorder","currentPrompt","timelimit","doStartTimer","progresbar","progressTimer","height","timeLimit","onFinish","attr","timers","clearInterval"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'mod_minilesson/definitions',\n    'mod_minilesson/pollyhelper',\n    'mod_minilesson/ttrecorder',\n    'mod_minilesson/animatecss',\n    'mod_minilesson/progresstimer',\n    'core/templates',\n    'core/str',\n    'core/notification'\n], function ($, log, ajax, def, polly, ttrecorder, anim, progresstimer, templates, str, notification) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('MiniLesson speaking gap fill: initialising');\n\n    return {\n\n        //a handle on the tt recorder\n        ttrec: null,\n        controls: {},\n\n        // For making multiple instances\n        clone: function () {\n            return $.extend(true, {}, this);\n        },\n\n        init: function (index, itemdata, quizhelper) {\n            var self = this;\n            self.strings = {};\n            var theCallback = function (message) {\n\n                switch (message.type) {\n                    case 'recording':\n                        break;\n\n                    case 'speech':\n                        log.debug(\"Speech at speaking gap fill -\");\n                        var words = self.items[self.game.pointer].words;\n                        var maskedwords = [];\n\n                        Object.keys(words).forEach(function (key) {\n                            maskedwords.push(words[key]);\n                        });\n\n                        self.getComparison(\n                            maskedwords.join(\" \"),\n                            message.capturedspeech,\n                            self.items[self.game.pointer].phonetic,\n                            function (comparison) {\n                                self.gotComparison(comparison, message);\n                            }\n                        );\n                        break;\n\n                    case 'mediasaved':\n                        self.mediaurl = message.mediaurl;\n                        log.debug('Media saved at speaking gap fill: ' + self.mediaurl);\n                        break;\n                }\n\n            };\n\n            // Init the TT Recorder\n            var opts = {};\n            opts.uniqueid = itemdata.uniqueid;\n            opts.callback = theCallback;\n            opts.stt_guided = quizhelper.is_stt_guided();\n            opts.wwwroot = quizhelper.is_stt_guided();\n            self.ttrec = ttrecorder.clone();\n            self.ttrec.init(opts);\n\n            self.itemdata = itemdata;\n            log.debug(\"itemdata\");\n            log.debug(itemdata);\n            self.quizhelper = quizhelper;\n            self.index = index;\n\n            // Anim\n            var animopts = {};\n            animopts.useanimatecss = quizhelper.useanimatecss;\n            anim.init(animopts);\n            self.init_controls();\n            self.init_strings();\n            self.register_events();\n            self.setvoice();\n            self.getItems();\n        },\n\n        init_controls: function () {\n            var self = this;\n            self.controls = {\n                container: $(\"#\" + self.itemdata.uniqueid + \"_container\"),\n                listen_cont: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_cont\"),\n                nextbutton: $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\"),\n                start_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_start_btn\"),\n                skip_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_skip_btn\"),\n                ctrl_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\"),\n                speakbtncontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_speakbtncontainer\"),\n                game: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_game\"),\n                controlsbox: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_controls\"),\n                resultscontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_resultscontainer\"),\n                mainmenu: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_mainmenu\"),\n                title: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_title\"),\n                progress_container: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container\"),\n                progress_bar: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container .progress-bar\"),\n                question: $(\"#\" + self.itemdata.uniqueid + \"_container .question\"),\n                listen_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_btn\"),\n                description: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_description\"),\n                image: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_image_container\"),\n                maintitle: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_maintitle\"),\n                itemquestion: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_itemtext\"),\n            };\n        },\n\n        init_strings: function () {\n            var self = this;\n            str.get_strings([\n                { \"key\": \"nextlessonitem\", \"component\": 'mod_minilesson' },\n                { \"key\": \"confirm_desc\", \"component\": 'mod_minilesson' },\n                { \"key\": \"yes\", \"component\": 'moodle' },\n                { \"key\": \"no\", \"component\": 'moodle' },\n            ]).done(function (s) {\n                var i = 0;\n                self.strings.nextlessonitem = s[i++];\n                self.strings.confirm_desc = s[i++];\n                self.strings.yes = s[i++];\n                self.strings.no = s[i++];\n            });\n        },\n\n        next_question: function (percent) {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = true;\n            stepdata.totalitems = self.items.length;\n            stepdata.correctitems = self.items.filter(function (e) {\n                return e.correct;\n            }).length;\n            stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n\n            //stop audio\n            self.stop_audio();\n\n            self.quizhelper.do_next(stepdata);\n        },\n\n        show_item_review: function () {\n            var self = this;\n            var review_data = {};\n\n            self.items.forEach(function (item) {\n                var itemwordlist = [];\n                item.parsedstring.forEach(function (data) {\n                    if (data.type === 'input' || data.type === 'mtext') {\n                        itemwordlist.push(data.character);\n                    }\n                });\n                var wordmatch = itemwordlist.join(\"\");\n                var regex = new RegExp(wordmatch, \"gi\");\n                var answerclass = item.correct ? 'correctitem' : 'wrongitem';\n                var result = item.target.replace(regex, `<span class=\"${answerclass}\">${wordmatch}</span>`);\n                item.target = result;\n            });\n\n            review_data.items = self.items;\n            review_data.totalitems = self.items.length;\n            review_data.correctitems = self.items.filter(function (e) {\n                return e.correct; }).length;\n\n            //Get controls\n            var listencont = self.controls.listen_cont;\n            var qbox = self.controls.question;\n            var recorderbox = self.controls.speakbtncontainer;\n            var gamebox = self.controls.game;\n            var controlsbox = self.controls.controlsbox;\n            var resultsbox = self.controls.resultscontainer;\n\n            //display results\n            templates.render('mod_minilesson/listitemresults', review_data).then(\n                function (html, js) {\n                    resultsbox.html(html);\n                    //show and hide\n                    resultsbox.show();\n                    gamebox.hide();\n                    controlsbox.hide();\n                    listencont.hide();\n                    qbox.hide();\n                    recorderbox.hide();\n                    // Run js for audio player events\n                    templates.runTemplateJS(js);\n                }\n            );// End of templates\n        },\n\n        register_events: function () {\n\n            var self = this;\n            // On next button click\n            self.controls.container.find('.minilesson_nextbutton').on('click', function (e) {\n                if (self.items.some(item => !item.answered)) {\n                    notification.confirm(\n                        self.strings.nextlessonitem,\n                        self.strings.confirm_desc,\n                        self.strings.yes,\n                        self.strings.no,\n                        function () {\n                            self.next_question();\n                        }\n                    );\n                } else {\n                    self.next_question();\n                }\n            });\n            // On start button click\n            self.controls.start_btn.on(\"click\", function () {\n                self.start();\n            });\n\n            //AUDIO PLAYER Button events\n            var audioplayerbtn = self.controls.listen_btn;\n            // On listen button click\n            if (self.itemdata.readsentence) {\n                audioplayerbtn.on(\"click\", function () {\n                    var theaudio = self.items[self.game.pointer].audio;\n\n                    //if we are already playing stop playing\n                    if (!theaudio.paused) {\n                        theaudio.pause();\n                        theaudio.currentTime = 0;\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                        return;\n                    }\n\n                    //change icon to indicate playing state\n                    theaudio.addEventListener('ended', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                    });\n\n                    theaudio.addEventListener('play', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-volume-up');\n                        $(audioplayerbtn).children('.fa').addClass('fa-stop');\n                    });\n                    theaudio.load();\n                    theaudio.play();\n                });\n            }\n\n            // On skip button click\n            self.controls.skip_btn.on(\"click\", function () {\n                // Disable the buttons\n                self.controls.ctrl_btn.prop(\"disabled\", true);\n                // Reveal the prompt\n                self.controls.container.find('.sgapfill_speech.sgapfill_teacher_left').text(self.items[self.game.pointer].prompt + \"\");\n                // Reveal the answer\n                self.controls.container.find('.sgapfill_targetWord').each(function () {\n                    var realidx = $(this).data(\"realidx\");\n                    var sgapfill_targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(sgapfill_targetWord);\n                });\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                //mark as answered and incorrect\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = false;\n\n                if (self.game.pointer < self.items.length - 1) {\n                    self.controls.skip_btn.prop(\"disabled\", true);\n                    self.controls.skip_btn.children('.fa').removeClass('fa-arrow-right');\n                    self.controls.skip_btn.children('.fa').addClass('fa-spinner fa-spin');\n                    // Move on after short time to next prompt\n                    setTimeout(function () {\n                        self.controls.skip_btn.children('.fa').removeClass('fa-spinner fa-spin');\n                        self.controls.skip_btn.children('.fa').addClass('fa-arrow-right');\n                        self.controls.skip_btn.prop(\"disabled\", false);\n                        self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                    // End question\n                } else {\n                    self.end();\n                }\n\n            });\n\n        },\n\n        game: {\n            pointer: 0\n        },\n\n        usevoice: '',\n\n        setvoice: function () {\n            var self = this;\n            self.usevoice = self.itemdata.usevoice;\n            self.voiceoption = self.itemdata.voiceoption;\n        },\n\n        getItems: function () {\n            var self = this;\n            var text_items = self.itemdata.sentences;\n\n            self.items = text_items.map(function (target) {\n                return {\n                    target: target.sentence,\n                    segmentedsentence: target.segmentedsentence,\n                    prompt: target.prompt,\n                    parsedstring: target.parsedstring,\n                    displayprompt: target.displayprompt,\n                    definition: target.definition,\n                    phonetic: target.phonetic,\n                    words: target.words,\n                    typed: \"\",\n                    timer: [],\n                    answered: false,\n                    correct: false,\n                    audio: null,\n                    audiourl: target.audiourl ? target.audiourl : \"\",\n                    imageurl: target.imageurl,\n                };\n            }).filter(function (e) {\n                return e.target !== \"\";\n            });\n\n            if (self.itemdata.readsentence) {\n                $.each(self.items, function (index, item) {\n                    item.audio = new Audio();\n                    item.audio.src = item.audiourl;\n                });\n                self.appReady();\n            } else {\n                self.appReady();\n            }\n        },\n\n        appReady: function () {\n            var self = this;\n            self.controls.container.find('.sgapfill_not_loaded').hide();\n            self.controls.container.find('.sgapfill_loaded').show();\n            if (self.itemdata.hidestartpage) {\n                self.start();\n            } else {\n                self.controls.start_btn.prop(\"disabled\", false);\n            }\n        },\n\n        gotComparison: function (comparison, typed) {\n            log.debug(\"sgapfill comparison\");\n            var self = this;\n            var countdownStarted = false;\n            var feedback = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + \" .dictate_feedback[data-idx='\" + self.game.pointer + \"']\");\n\n            self.controls.container.find('.sgapfill_targetWord').removeClass(\"sgapfill_correct sgapfill_incorrect\");\n            self.controls.container.find('.sgapfill_feedback').removeClass(\"fa fa-check fa-times\");\n\n            var allCorrect = comparison.filter(function (e) {\n                return !e.matched;\n            }).length == 0;\n            log.debug('allcorrect=' + allCorrect);\n\n            if (allCorrect && comparison && comparison.length > 0) {\n                // Fill in all the correct words\n                self.items[self.game.pointer].parsedstring.forEach(function (data, index) {\n                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' .sgapfill_missing_input[data-index=\"' + index + '\"]');\n                    if (characterinput && data.type === 'input') {\n                        characterinput.text(data.character);\n                    }\n                });\n\n                feedback.removeClass(\"fa fa-times\");\n                feedback.addClass(\"fa fa-check\");\n                //make the input boxes green and move forward\n                log.debug('applying correct class to input boxes');\n                self.controls.container.find('.sgapfill_reply_' + self.game.pointer + \" .sgapfill_missing_input\").addClass(\"ml_gapfill_char_correct\");\n\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = true;\n                self.items[self.game.pointer].typed = typed;\n\n                self.controls.ctrl_btn.prop(\"disabled\", true);\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                if ((self.game.pointer < self.items.length - 1) && !countdownStarted) {\n                    countdownStarted = true;\n                    log.debug('moving to next prompt B');\n                    setTimeout(function () {\n                        self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                } else {\n                    self.updateProgressDots();\n                    self.end();\n                }\n            } else {\n                feedback.removeClass(\"fa fa-check\");\n                feedback.addClass(\"fa fa-times\");\n                // Mark up the words as correct or not\n                comparison.forEach(function (obj) {\n                    var words = self.items[self.game.pointer].words;\n\n                    Object.keys(words).forEach(function (key) {\n                        if (words[key] == obj.word) {\n                            if (!obj.matched) {\n                                self.items[self.game.pointer].parsedstring.forEach(function (data, index) {\n                                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val('');\n                                    }\n                                });\n                            } else {\n                                self.items[self.game.pointer].parsedstring.forEach(function (data, index) {\n                                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val(data.character);\n                                        characterinput.addClass(\"ml_gapfill_char_correct\");\n                                    }\n                                });\n                            }\n                        }\n                    });\n                });\n                var thereply = self.controls.container.find('.sgapfill_reply_' + self.game.pointer);\n                anim.do_animate(thereply, 'shakeX animate__faster').then(\n                    function () {\n                        self.controls.ctrl_btn.prop(\"disabled\", false);\n                    }\n                );\n\n                // Show all the correct words\n                self.controls.container.find('.sgapfill_targetWord.sgapfill_correct').each(function () {\n                    var realidx = $(this).data(\"realidx\");\n                    var targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(targetWord);\n                });\n\n                //if they cant retry OR the time limit is up, move on\n                var timelimit_progressbar = self.controls.progress_bar;\n                if (!self.itemdata.allowretry || timelimit_progressbar.hasClass('progress-bar-complete')) {\n                    self.items[self.game.pointer].answered = true;\n                    self.items[self.game.pointer].correct = false;\n                    self.items[self.game.pointer].typed = typed;\n\n                    self.controls.ctrl_btn.prop(\"disabled\", true);\n\n                    self.stopTimer(self.items[self.game.pointer].timer);\n\n                    if (!countdownStarted) {\n                        if (self.game.pointer < self.items.length - 1) {\n                            countdownStarted = true;\n                            setTimeout(function () {\n                                self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                                self.game.pointer++;\n                                self.nextPrompt();\n                            }, 2000);\n                        } else {\n                            self.updateProgressDots();\n                            self.end();\n                        }\n                    }//end of if countdown not started\n                } //end of if can't retry or time limit up\n            }//end of if -all -correct or not\n        },\n\n        getComparison: function (passage, transcript, phonetic, callback) {\n            var self = this;\n\n            self.controls.ctrl_btn.prop(\"disabled\", true);\n            self.quizhelper.comparePassageToTranscript(passage, transcript, phonetic, self.itemdata.language, self.itemdata.alternates).then(function (ajaxresult) {\n                var payloadobject = JSON.parse(ajaxresult);\n                if (payloadobject) {\n                    callback(payloadobject);\n                } else {\n                    callback(false);\n                }\n            });\n        },\n\n        end: function () {\n            var self = this;\n            $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n            //progress dots are updated on next_item. The last item has no next item, so we update from here\n            self.updateProgressDots();\n\n            setTimeout(function () {\n                $(\".minilesson_nextbutton\").prop(\"disabled\",false);\n                if (self.quizhelper.showitemreview) {\n                    self.controls.progress_container.removeClass('d-flex');\n                    self.controls.progress_container.hide();\n                    self.controls.title.hide();\n                    self.show_item_review();\n                } else {\n                    self.next_question();\n                }\n            }, 2000);\n\n        },\n\n        start: function () {\n            var self = this;\n\n            self.controls.ctrl_btn.prop(\"disabled\", true);\n            self.controls.speakbtncontainer.show();\n\n            self.items.forEach(function (item) {\n                item.spoken = \"\";\n                item.answered = false;\n                item.correct = false;\n            });\n\n            self.game.pointer = 0;\n\n            self.controls.question.show();\n            if (self.itemdata.readsentence) {\n                self.controls.listen_cont.show();\n            }\n            self.controls.start_btn.hide();\n            self.controls.mainmenu.hide();\n            self.controls.controlsbox.show();\n            self.controls.maintitle.show();\n            self.controls.itemquestion.show();\n            self.controls.description.hide();\n            self.controls.image.hide();\n\n            self.nextPrompt();\n        },\n\n        updateProgressDots: function () {\n            var self = this;\n            var color,icon;\n            var progress = self.items.map(function (item, idx) {\n                color = \"#E6E9FD\";\n                icon = 'fa fa-square';\n                if (self.items[idx].answered && self.items[idx].correct) {\n                    color = \"#74DC72\";\n                    icon = 'fa fa-check-square';\n                } else if (self.items[idx].answered && !self.items[idx].correct) {\n                    color = \"#FB6363\";\n                    icon = 'fa fa-window-close';\n                }\n                return \"<i style='color:\" + color + \"' class='\" + icon + \" pl-1'></i>\";\n            }).join(\" \");\n            self.controls.title.html(progress);\n        },\n\n        nextPrompt: function () {\n            var self = this;\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n            self.updateProgressDots();\n            var newprompt = self.controls.container.find('.sgapfill_prompt_' + self.game.pointer);\n            anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n                function () {\n                }\n            );\n            self.nextReply();\n        },\n\n\n        nextReply: function () {\n            var self = this;\n\n            var code = \"<div class='sgapfill_reply sgapfill_reply_\" + self.game.pointer + \" text-center' style='display:none;'>\";\n            var brackets = { started: false, ended: false, index: null };\n\n            code += \"<div class='form-container'>\";\n            self.items[self.game.pointer].parsedstring.forEach(function (data, index) {\n                if (brackets.started && !brackets.ended && brackets.index !== data.index) {\n                    brackets.started = brackets.ended = false;\n                    code += '</span>';\n                }\n                if ((data.type === 'input' || data.type === 'mtext') && !brackets.started) {\n                    code += '<span class=\"form-input-phrase-online\" data-mindex=\"' + data.index + '\">';\n                    brackets.started = true;\n                }\n                brackets.index = data.index;\n                if (data.type === 'input') {\n                    code += \"<span class='sgapfill_missing_input' data-index='\" + index + \"'></span>\";\n                } else if (data.type === 'mtext') {\n                    code += \"<span class='sgapfill_missing_inputmtext'>\" + data.character + \"</span>\";\n                } else {\n                    code += data.character;\n                }\n            });\n            if (brackets.started && !brackets.ended) {\n                code += '</span>';\n            }\n            //correct or not\n            code += \" <i data-idx='\" + self.game.pointer + \"' class='dictate_feedback'></i></div>\";\n\n            //hints\n            // We need to set a higher margin for the image if there is no hint, to stop it being overlapped by the recorder\n            var hasdefinition = self.items[self.game.pointer].definition && self.items[self.game.pointer].definition !== \"\";\n            var imagebottommargin = hasdefinition ? \"margin-bottom: 5px\" : \"margin-bottom: 50px\";\n            if (self.items[self.game.pointer].imageurl) {\n                code += \"<div class='minilesson_sentence_image' style='\" + imagebottommargin + \"'><div class='minilesson_padded_image'><img src='\"\n                    + self.items[self.game.pointer].imageurl + \"' alt='Image for gap fill' /></div></div>\";\n            }\n            //hint - definition\n            if (hasdefinition) {\n                code += \"<div class='definition-container'><div class='definition'>\"\n                    + \"<div class='hinticon-container'><i class='fa fa-lightbulb-o hinticon'></i></div>\"\n                    + \"<h4 class='hint-title'>Hint</h4>\"\n                    + self.items[self.game.pointer].definition + \"</div>\";\n            }\n\n\n            self.controls.question.append(code);\n\n\n            var newreply = self.controls.container.find('.sgapfill_reply_' + self.game.pointer);\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function () {\n                }\n            );\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n\n            // Start the timer (if we have one)\n            self.startTimer();\n\n            // We autoplay the audio on item entry, if its not a mobile user.\n            // If we do not have a start page and its the first item, we play on the item show event\n            if (!self.quizhelper.mobile_user()) {\n                if (self.itemdata.hidestartpage && self.game.pointer === 0) {\n                    self.controls.container.on(\"showElement\", () => {\n                        setTimeout(function () {\n                            self.controls.listen_btn.trigger('click');\n                        }, 1000);\n                    });\n                } else {\n                    setTimeout(function () {\n                        self.controls.listen_btn.trigger('click');\n                    }, 1000);\n                }\n            }\n\n            //target is the speech we expect\n            var target = self.items[self.game.pointer].target;\n            //in some cases ttrecorder wants to know the target\n            if (self.quizhelper.use_ttrecorder()) {\n                self.ttrec.currentPrompt = target;\n            }\n        },\n\n        // Stop audio .. usually when leaving the item or sentence\n        stop_audio: function () {\n            var self = this;\n            //pause audio if its playing\n            var theaudio = self.items[self.game.pointer].audio;\n            if (theaudio && !theaudio.paused) {\n                theaudio.pause();\n            }\n        },\n\n        startTimer: function () {\n            var self = this;\n            // If we have a time limit, set up the timer, otherwise return\n            if (self.itemdata.timelimit > 0) {\n                // This is a function to start the timer (we call it conditionally below)\n                var doStartTimer = function () {\n                    // This shows progress bar\n                    self.controls.progress_container.show();\n                    self.controls.progress_container.addClass('d-flex align-items-center');\n                    self.controls.progress_container.find('i').show();\n                    var progresbar = self.controls.progress_container.find('#progresstimer').progressTimer({\n                        height: '5px',\n                        timeLimit: self.itemdata.timelimit,\n                        onFinish: function () {\n                            self.controls.skip_btn.trigger('click');\n                        }\n                    });\n                    progresbar.each(function () {\n                        self.items[self.game.pointer].timer.push($(this).attr('timer'));\n                    });\n                }\n\n                // This adds the timer and starts it. But if we dont have a start page and its the first item\n                // we need to defer the timer start until the item is shown\n                if (self.itemdata.hidestartpage && self.game.pointer === 0) {\n                    self.controls.container.on(\"showElement\", () => {\n                        doStartTimer();\n                    });\n                } else {\n                    doStartTimer();\n                }\n            }\n        },\n\n        stopTimer: function (timers) {\n            if (timers.length) {\n                timers.forEach(function (timer) {\n                    clearInterval(timer);\n                });\n            }\n        },\n    };\n});"],"file":"speakinggapfill.min.js"}