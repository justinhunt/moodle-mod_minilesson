{"version":3,"sources":["../src/speakinggapfill.js"],"names":["define","$","log","ajax","def","polly","ttrecorder","anim","progresstimer","templates","str","notification","debug","ttrec","controls","clone","extend","init","index","itemdata","quizhelper","self","strings","opts","uniqueid","callback","theCallback","message","type","words","items","game","pointer","maskedwords","Object","keys","forEach","key","push","getComparison","join","capturedspeech","phonetic","comparison","gotComparison","stt_guided","is_stt_guided","wwwroot","animopts","useanimatecss","init_controls","init_strings","register_events","setvoice","getItems","container","listen_cont","nextbutton","start_btn","skip_btn","ctrl_btn","speakbtncontainer","controlsbox","resultscontainer","mainmenu","title","progress_container","progress_bar","question","listen_btn","description","image","maintitle","get_strings","done","s","i","nextlessonitem","confirm_desc","yes","no","next_question","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","stop_audio","do_next","show_item_review","review_data","item","itemwordlist","parsedstring","data","character","wordmatch","regex","RegExp","answerclass","result","target","replace","listencont","qbox","recorderbox","gamebox","resultsbox","render","then","html","js","show","hide","runTemplateJS","find","on","some","answered","confirm","start","audioplayerbtn","readsentence","theaudio","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","text","prompt","each","realidx","sgapfill_targetWord","sgapfill_targetWords","val","stopTimer","timer","setTimeout","nextPrompt","end","usevoice","voiceoption","text_items","sentences","map","sentence","segmentedsentence","displayprompt","definition","typed","audiourl","imageurl","Audio","src","appReady","hidestartpage","countdownStarted","feedback","allCorrect","matched","characterinput","updateProgressDots","obj","word","thereply","do_animate","targetWord","timelimit_progressbar","allowretry","hasClass","passage","transcript","comparePassageToTranscript","language","alternates","ajaxresult","payloadobject","JSON","parse","showitemreview","spoken","color","icon","progress","idx","newprompt","nextReply","code","brackets","started","ended","hasdefinition","imagebottommargin","append","newreply","startTimer","mobile_user","trigger","use_ttrecorder","currentPrompt","timelimit","doStartTimer","progresbar","progressTimer","height","timeLimit","onFinish","attr","timers","clearInterval"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'mod_minilesson/definitions',\n    'mod_minilesson/pollyhelper',\n    'mod_minilesson/ttrecorder',\n    'mod_minilesson/animatecss',\n    'mod_minilesson/progresstimer',\n    'core/templates',\n    'core/str',\n    'core/notification'\n], function($, log, ajax, def, polly, ttrecorder, anim, progresstimer, templates,str,notification) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('MiniLesson speaking gap fill: initialising');\n\n    return {\n\n        //a handle on the tt recorder\n        ttrec: null,\n        controls: {},\n\n        // For making multiple instances\n        clone: function() {\n            return $.extend(true, {}, this);\n        },\n\n        init: function(index, itemdata, quizhelper) {\n            var self = this;\n            self.strings = {};\n            var theCallback = function(message) {\n\n                switch (message.type) {\n                    case 'recording':\n                        break;\n\n                    case 'speech':\n                        log.debug(\"Speech at speaking gap fill -\");\n                        var words = self.items[self.game.pointer].words;\n                        var maskedwords = [];\n\n                        Object.keys(words).forEach(function(key) {\n                            maskedwords.push(words[key]);\n                        });\n\n                        self.getComparison(\n                            maskedwords.join(\" \"),\n                            message.capturedspeech,\n                            self.items[self.game.pointer].phonetic,\n                            function(comparison) {\n                                self.gotComparison(comparison, message);\n                            }\n                        );\n                        break;\n\n                }\n\n            };\n\n            // Init the TT Recorder\n            var opts = {};\n            opts.uniqueid = itemdata.uniqueid;\n            opts.callback = theCallback;\n            opts.stt_guided = quizhelper.is_stt_guided();\n            opts.wwwroot = quizhelper.is_stt_guided();\n            self.ttrec = ttrecorder.clone();\n            self.ttrec.init(opts);\n\n            self.itemdata = itemdata;\n            log.debug(\"itemdata\");\n            log.debug(itemdata);\n            self.quizhelper = quizhelper;\n            self.index = index;\n\n            // Anim\n            var animopts = {};\n            animopts.useanimatecss = quizhelper.useanimatecss;\n            anim.init(animopts);\n            self.init_controls();\n            self.init_strings();\n            self.register_events();\n            self.setvoice();\n            self.getItems();\n        },\n\n        init_controls: function() {\n            var self = this;\n            self.controls = {\n                container: $(\"#\" + self.itemdata.uniqueid + \"_container\"),\n                listen_cont: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_cont\"),\n                nextbutton: $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\"),\n                start_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_start_btn\"),\n                skip_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_skip_btn\"),\n                ctrl_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\"),\n                speakbtncontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_speakbtncontainer\"),\n                game: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_game\"),\n                controlsbox: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_controls\"),\n                resultscontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_resultscontainer\"),\n                mainmenu: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_mainmenu\"),\n                title: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_title\"),\n                progress_container: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container\"),\n                progress_bar: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container .progress-bar\"),\n                question: $(\"#\" + self.itemdata.uniqueid + \"_container .question\"),\n                listen_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_btn\"),\n                description: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_description\"),\n                image: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_image_container\"),\n                maintitle: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_maintitle\"),\n            };\n        },\n\n        init_strings: function() {\n            var self = this;\n            str.get_strings([\n                { \"key\": \"nextlessonitem\", \"component\": 'mod_minilesson'},\n                { \"key\": \"confirm_desc\", \"component\": 'mod_minilesson'},\n                { \"key\": \"yes\", \"component\": 'moodle'},\n                { \"key\": \"no\", \"component\": 'moodle'},\n            ]).done(function (s) {\n                var i = 0;\n                self.strings.nextlessonitem = s[i++];\n                self.strings.confirm_desc = s[i++];\n                self.strings.yes = s[i++];\n                self.strings.no = s[i++];\n            });\n        },\n\n        next_question: function(percent) {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = true;\n            stepdata.totalitems = self.items.length;\n            stepdata.correctitems = self.items.filter(function(e) {\n                return e.correct;\n            }).length;\n            stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n\n            //stop audio\n            self.stop_audio();\n\n            self.quizhelper.do_next(stepdata);\n        },\n\n        show_item_review:function(){\n            var self=this;\n            var review_data = {};\n\n            self.items.forEach(function(item){\n                var itemwordlist = [];\n                item.parsedstring.forEach(function(data) {\n                    if (data.type === 'input' || data.type === 'mtext') {\n                        itemwordlist.push(data.character);\n                    }\n                });\n                var wordmatch = itemwordlist.join(\"\");\n                var regex = new RegExp(wordmatch, \"gi\");\n                var answerclass = item.correct ? 'correctitem' : 'wrongitem';\n                var result = item.target.replace(regex, ` <span class=\"${answerclass}\">${wordmatch}</span>`);\n                item.target = result;\n            });\n\n            review_data.items = self.items;\n            review_data.totalitems=self.items.length;\n            review_data.correctitems=self.items.filter(function(e) {return e.correct;}).length;\n\n            //Get controls\n            var listencont = self.controls.listen_cont;\n            var qbox = self.controls.question;\n            var recorderbox = self.controls.speakbtncontainer;\n            var gamebox = self.controls.game;\n            var controlsbox = self.controls.controlsbox;\n            var resultsbox = self.controls.resultscontainer;\n\n            //display results\n            templates.render('mod_minilesson/listitemresults',review_data).then(\n              function(html,js){\n                  resultsbox.html(html);\n                  //show and hide\n                  resultsbox.show();\n                  gamebox.hide();\n                  controlsbox.hide();\n                  listencont.hide();\n                  qbox.hide();\n                  recorderbox.hide();\n                  // Run js for audio player events\n                  templates.runTemplateJS(js);\n              }\n            );// End of templates\n        },\n\n        register_events: function() {\n\n            var self = this;\n            // On next button click\n            self.controls.container.find('.minilesson_nextbutton').on('click', function(e) {\n                if (self.items.some(item => !item.answered)) {\n                    notification.confirm(self.strings.nextlessonitem,\n                        self.strings.confirm_desc,\n                        self.strings.yes,\n                        self.strings.no,\n                        function() {\n                            self.next_question();\n                        }\n                    );\n                } else {\n                    self.next_question();\n                }\n            });\n            // On start button click\n            self.controls.start_btn.on(\"click\", function() {\n                self.start();\n            });\n\n            //AUDIO PLAYER Button events\n            var audioplayerbtn=self.controls.listen_btn;\n            // On listen button click\n            if(self.itemdata.readsentence) {\n                audioplayerbtn.on(\"click\", function () {\n                    var theaudio = self.items[self.game.pointer].audio;\n\n                    //if we are already playing stop playing\n                    if(!theaudio.paused){\n                        theaudio.pause();\n                        theaudio.currentTime=0;\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                        return;\n                    }\n\n                    //change icon to indicate playing state\n                    theaudio.addEventListener('ended', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                    });\n\n                    theaudio.addEventListener('play', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-volume-up');\n                        $(audioplayerbtn).children('.fa').addClass('fa-stop');\n                    });\n                    theaudio.load();\n                    theaudio.play();\n                });\n            }\n\n            // On skip button click\n            self.controls.skip_btn.on(\"click\", function() {\n                // Disable the buttons\n                self.controls.ctrl_btn.prop(\"disabled\", true);\n                // Reveal the prompt\n                self.controls.container.find('.sgapfill_speech.sgapfill_teacher_left').text(self.items[self.game.pointer].prompt + \"\");\n                // Reveal the answer\n                self.controls.container.find('.sgapfill_targetWord').each(function() {\n                    var realidx = $(this).data(\"realidx\");\n                    var sgapfill_targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(sgapfill_targetWord);\n                });\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                //mark as answered and incorrect\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = false;\n\n                if (self.game.pointer < self.items.length - 1) {\n                    self.controls.skip_btn.prop(\"disabled\", true);\n                    self.controls.skip_btn.children('.fa').removeClass('fa-arrow-right');\n                    self.controls.skip_btn.children('.fa').addClass('fa-spinner fa-spin');\n                    // Move on after short time to next prompt\n                    setTimeout(function() {\n                        self.controls.skip_btn.children('.fa').removeClass('fa-spinner fa-spin');\n                        self.controls.skip_btn.children('.fa').addClass('fa-arrow-right');\n                        self.controls.skip_btn.prop(\"disabled\", false);\n                        self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                    // End question\n                } else {\n                    self.end();\n                }\n\n            });\n\n        },\n\n        game: {\n            pointer: 0\n        },\n\n        usevoice: '',\n\n        setvoice: function() {\n            var self = this;\n            self.usevoice = self.itemdata.usevoice;\n            self.voiceoption = self.itemdata.voiceoption;\n        },\n\n        getItems: function() {\n            var self = this;\n            var text_items = self.itemdata.sentences;\n\n            self.items = text_items.map(function(target) {\n                return {\n                    target: target.sentence,\n                    segmentedsentence: target.segmentedsentence,\n                    prompt: target.prompt,\n                    parsedstring: target.parsedstring,\n                    displayprompt: target.displayprompt,\n                    definition: target.definition,\n                    phonetic: target.phonetic,\n                    words: target.words,\n                    typed: \"\",\n                    timer: [],\n                    answered: false,\n                    correct: false,\n                    audio: null,\n                    audiourl: target.audiourl ? target.audiourl : \"\",\n                    imageurl: target.imageurl,\n                };\n            }).filter(function(e) {\n                return e.target !== \"\";\n            });\n\n            if(self.itemdata.readsentence) {\n                $.each(self.items, function (index, item) {\n                    item.audio = new Audio();\n                    item.audio.src = item.audiourl;\n                });\n                self.appReady();\n            }else{\n                self.appReady();\n            }\n        },\n\n        appReady: function() {\n            var self = this;\n            self.controls.container.find('.sgapfill_not_loaded').hide();\n            self.controls.container.find('.sgapfill_loaded').show();\n            if(self.itemdata.hidestartpage){\n                self.start();\n            }else{\n               self.controls.start_btn.prop(\"disabled\", false);\n            }\n        },\n\n        gotComparison: function(comparison, typed) {\n            log.debug(\"sgapfill comparison\");\n            var self = this;\n            var countdownStarted = false;\n            var feedback = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + \" .dictate_feedback[data-idx='\" + self.game.pointer + \"']\");\n\n            self.controls.container.find('.sgapfill_targetWord').removeClass(\"sgapfill_correct sgapfill_incorrect\");\n            self.controls.container.find('.sgapfill_feedback').removeClass(\"fa fa-check fa-times\");\n\n            var allCorrect = comparison.filter(function(e) {\n                return !e.matched;\n            }).length == 0;\n            log.debug('allcorrect=' + allCorrect);\n\n            if (allCorrect && comparison && comparison.length > 0) {\n\n                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' .sgapfill_missing_input[data-index=\"' + index + '\"]');\n                    if (characterinput) {\n                        characterinput.text(data.character);\n                    }\n                });\n\n                feedback.removeClass(\"fa fa-times\");\n                feedback.addClass(\"fa fa-check\");\n                //make the input boxes green and move forward\n                log.debug('applying correct class to input boxes');\n                self.controls.container.find('.sgapfill_reply_' + self.game.pointer + \" .sgapfill_missing_input\").addClass(\"ml_gapfill_char_correct\");\n\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = true;\n                self.items[self.game.pointer].typed = typed;\n\n                self.controls.ctrl_btn.prop(\"disabled\", true);\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                if ((self.game.pointer < self.items.length - 1) && !countdownStarted) {\n                    countdownStarted = true;\n                    log.debug('moving to next prompt B');\n                    setTimeout(function() {\n                        self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                } else {\n                    self.updateProgressDots();\n                    self.end();\n                }\n            } else {\n                feedback.removeClass(\"fa fa-check\");\n                feedback.addClass(\"fa fa-times\");\n                // Mark up the words as correct or not\n                comparison.forEach(function(obj) {\n                    var words = self.items[self.game.pointer].words;\n\n                    Object.keys(words).forEach(function(key) {\n                        if (words[key] == obj.word) {\n                            if (!obj.matched) {\n                                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val('');\n                                    }\n                                });\n                            } else {\n                                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val(data.character);\n                                    }\n                                });\n                            }\n                        }\n                    });\n                });\n                var thereply = self.controls.container.find('.sgapfill_reply_' + self.game.pointer);\n                anim.do_animate(thereply, 'shakeX animate__faster').then(\n                    function() {\n                        self.controls.ctrl_btn.prop(\"disabled\", false);\n                    }\n                );\n\n                // Show all the correct words\n                self.controls.container.find('.sgapfill_targetWord.sgapfill_correct').each(function() {\n                    var realidx = $(this).data(\"realidx\");\n                    var targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(targetWord);\n                });\n\n                //if they cant retry OR the time limit is up, move on\n                var timelimit_progressbar = self.controls.progress_bar;\n                if(!self.itemdata.allowretry || timelimit_progressbar.hasClass('progress-bar-complete')){\n                    self.items[self.game.pointer].answered = true;\n                    self.items[self.game.pointer].correct = false;\n                    self.items[self.game.pointer].typed = typed;\n\n                    self.controls.ctrl_btn.prop(\"disabled\", true);\n\n                    self.stopTimer(self.items[self.game.pointer].timer);\n\n                    if(!countdownStarted) {\n                        if (self.game.pointer < self.items.length - 1) {\n                            countdownStarted = true;\n                            setTimeout(function () {\n                                self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                                self.game.pointer++;\n                                self.nextPrompt();\n                            }, 2000);\n                        } else {\n                            self.updateProgressDots();\n                            self.end();\n                        }\n                    }//end of if countdown not started\n                } //end of if can't retry or time limit up\n            }//end of if -all -correct or not\n        },\n\n        getComparison: function(passage, transcript, phonetic, callback) {\n            var self = this;\n\n            self.controls.ctrl_btn.prop(\"disabled\", true);\n            self.quizhelper.comparePassageToTranscript(passage, transcript, phonetic, self.itemdata.language, self.itemdata.alternates).then(function(ajaxresult) {\n                var payloadobject = JSON.parse(ajaxresult);\n                if (payloadobject) {\n                    callback(payloadobject);\n                } else {\n                    callback(false);\n                }\n            });\n        },\n\n        end: function() {\n            var self = this;\n            $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n            //progress dots are updated on next_item. The last item has no next item, so we update from here\n            self.updateProgressDots();\n\n            setTimeout(function() {\n                $(\".minilesson_nextbutton\").prop(\"disabled\",false);\n                if(self.quizhelper.showitemreview){\n                    self.controls.progress_container.removeClass('d-flex');\n                    self.controls.progress_container.hide();\n                    self.controls.title.hide();\n                    self.show_item_review();\n                }else{\n                    self.next_question();\n                }\n            }, 2000);\n\n        },\n\n        start: function() {\n            var self = this;\n\n            self.controls.ctrl_btn.prop(\"disabled\", true);\n            self.controls.speakbtncontainer.show();\n\n            self.items.forEach(function(item) {\n                item.spoken = \"\";\n                item.answered = false;\n                item.correct = false;\n            });\n\n            self.game.pointer = 0;\n\n            self.controls.question.show();\n            if(self.itemdata.readsentence) {\n                self.controls.listen_cont.show();\n            }\n            self.controls.start_btn.hide();\n            self.controls.mainmenu.hide();\n            self.controls.controlsbox.show();\n            self.controls.maintitle.show();\n            self.controls.description.hide();\n            self.controls.image.hide();\n\n            self.nextPrompt();\n        },\n\n        updateProgressDots: function(){\n            var self = this;\n            var color,icon;\n            var progress = self.items.map(function(item, idx) {\n                color = \"#E6E9FD\";\n                icon = 'fa fa-square';\n                if (self.items[idx].answered && self.items[idx].correct) {\n                    color = \"#74DC72\";\n                    icon = 'fa fa-check-square';\n                } else if (self.items[idx].answered && !self.items[idx].correct) {\n                    color = \"#FB6363\";\n                    icon = 'fa fa-window-close';\n                }\n                return \"<i style='color:\" + color + \"' class='\" + icon + \" pl-1'></i>\";\n            }).join(\" \");\n            self.controls.title.html(progress);\n        },\n\n        nextPrompt: function() {\n            var self = this;\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n            self.updateProgressDots();\n            var newprompt = self.controls.container.find('.sgapfill_prompt_' + self.game.pointer);\n            anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n            self.nextReply();\n        },\n\n\n        nextReply: function() {\n            var self = this;\n\n            var code = \"<div class='sgapfill_reply sgapfill_reply_\" + self.game.pointer + \" text-center' style='display:none;'>\";\n            var brackets = {started: false, ended: false, index: null};\n\n            code += \"<div class='form-container'>\";\n            self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                if (brackets.started && !brackets.ended && brackets.index !== data.index) {\n                    brackets.started = brackets.ended = false;\n                    code += '</span>';\n                }\n                if ((data.type === 'input' || data.type === 'mtext') && !brackets.started) {\n                    code += '<span class=\"form-input-phrase-online\" data-mindex=\"'+data.index+'\">';\n                    brackets.started = true;\n                }\n                brackets.index = data.index;\n                if (data.type === 'input') {\n                    code += \"<span class='sgapfill_missing_input' data-index='\" + index + \"'></span>\";\n                } else if (data.type === 'mtext') {\n                    code += \"<span class='sgapfill_missing_inputmtext'>\"+ data.character +\"</span>\";\n                } else {\n                    code += data.character;\n                }\n            });\n            if (brackets.started && !brackets.ended) {\n                code += '</span>';\n            }\n            //correct or not\n            code += \" <i data-idx='\" + self.game.pointer + \"' class='dictate_feedback'></i></div>\";\n\n            //hints\n            // We need to set a higher margin for the image if there is no hint, to stop it being overlapped by the recorder\n            var hasdefinition = self.items[self.game.pointer].definition && self.items[self.game.pointer].definition !== \"\";\n            var imagebottommargin  = hasdefinition ? \"margin-bottom: 5px\" : \"margin-bottom: 50px\";\n            if( self.items[self.game.pointer].imageurl) {\n                code += \"<div class='minilesson_sentence_image' style='\"+imagebottommargin+\"'><div class='minilesson_padded_image'><img src='\"\n                    + self.items[self.game.pointer].imageurl + \"' alt='Image for gap fill' /></div></div>\";\n            }\n            //hint - definition\n            if(hasdefinition ) {\n                code += \"<div class='definition-container'><div class='definition'>\"\n                    + \"<div class='hinticon-container'><i class='fa fa-lightbulb-o hinticon'></i></div>\"\n                    + \"<h4 class='hint-title'>Hint</h4>\"\n                    + self.items[self.game.pointer].definition + \"</div>\";\n            }\n\n\n            self.controls.question.append(code);\n\n\n            var newreply = self.controls.container.find('.sgapfill_reply_' + self.game.pointer);\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n\n            // Start the timer (if we have one)\n            self.startTimer();\n\n            // We autoplay the audio on item entry, if its not a mobile user.\n            // If we do not have a start page and its the first item, we play on the item show event\n            if (!self.quizhelper.mobile_user()){\n                if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                    self.controls.container.on(\"showElement\", () => {\n                        setTimeout(function() {\n                            self.controls.listen_btn.trigger('click');\n                        }, 1000);\n                    });\n                }else{\n                    setTimeout(function() {\n                        self.controls.listen_btn.trigger('click');\n                    }, 1000);\n                }\n            }\n\n            //target is the speech we expect\n            var target = self.items[self.game.pointer].target;\n            //in some cases ttrecorder wants to know the target\n            if(self.quizhelper.use_ttrecorder()) {\n                self.ttrec.currentPrompt=target;\n            }\n        },\n\n        // Stop audio .. usually when leaving the item or sentence\n        stop_audio: function(){\n            var self =this;\n            //pause audio if its playing\n            var theaudio = self.items[self.game.pointer].audio;\n            if(theaudio && !theaudio.paused) {\n                theaudio.pause();\n            }\n        },\n\n        startTimer: function(){\n            var self = this;\n            // If we have a time limit, set up the timer, otherwise return\n            if (self.itemdata.timelimit > 0) {\n               // This is a function to start the timer (we call it conditionally below)\n                var doStartTimer = function() {\n                     // This shows progress bar\n                    self.controls.progress_container.show();\n                    self.controls.progress_container.addClass('d-flex align-items-center');\n                    self.controls.progress_container.find('i').show();\n                    var progresbar = self.controls.progress_container.find('#progresstimer').progressTimer({\n                        height: '5px',\n                        timeLimit: self.itemdata.timelimit,\n                        onFinish: function() {\n                            self.controls.skip_btn.trigger('click');\n                        }\n                    });\n                    progresbar.each(function() {\n                        self.items[self.game.pointer].timer.push($(this).attr('timer'));\n                    });\n                }\n\n                // This adds the timer and starts it. But if we dont have a start page and its the first item\n                // we need to defer the timer start until the item is shown\n                if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                    self.controls.container.on(\"showElement\", () => {\n                        doStartTimer();\n                    });\n                }else{\n                    doStartTimer();\n                }\n            }\n        },\n\n        stopTimer: function(timers) {\n            if (timers.length) {\n                timers.forEach(function(timer) {\n                    clearInterval(timer);\n                });\n            }\n        },\n    };\n});"],"file":"speakinggapfill.min.js"}