{"version":3,"sources":["../src/speakinggapfill.js"],"names":["define","$","log","ajax","def","polly","ttrecorder","anim","progresstimer","templates","debug","ttrec","controls","clone","extend","init","index","itemdata","quizhelper","self","opts","uniqueid","callback","theCallback","message","type","words","items","game","pointer","maskedwords","Object","keys","forEach","key","push","getComparison","join","capturedspeech","phonetic","comparison","gotComparison","stt_guided","is_stt_guided","wwwroot","animopts","useanimatecss","init_controls","register_events","setvoice","getItems","container","listen_cont","nextbutton","start_btn","skip_btn","ctrl_btn","speakbtncontainer","controlsbox","resultscontainer","mainmenu","title","progress_container","progress_bar","question","listen_btn","next_question","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","stop_audio","do_next","show_item_review","review_data","listencont","qbox","recorderbox","gamebox","resultsbox","render","then","html","js","show","hide","runTemplateJS","find","on","start","audioplayerbtn","readsentence","theaudio","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","text","prompt","each","realidx","data","sgapfill_targetWord","sgapfill_targetWords","val","stopTimer","timer","answered","setTimeout","nextPrompt","end","usevoice","voiceoption","text_items","sentences","map","target","sentence","parsedstring","displayprompt","definition","typed","audiourl","imageurl","item","Audio","src","appReady","hidestartpage","countdownStarted","feedback","allCorrect","matched","characterinput","character","updateProgressDots","obj","word","thereply","do_animate","targetWord","timelimit_progressbar","allowretry","hasClass","$self","passage","transcript","comparePassageToTranscript","language","alternates","ajaxresult","payloadobject","JSON","parse","showitemreview","spoken","color","progress","idx","newprompt","nextReply","code","brackets","started","ended","append","newreply","startTimer","mobile_user","trigger","use_ttrecorder","currentPrompt","timelimit","doStartTimer","progresbar","progressTimer","height","timeLimit","onFinish","attr","timers","clearInterval"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'mod_minilesson/definitions',\n    'mod_minilesson/pollyhelper',\n    'mod_minilesson/ttrecorder',\n    'mod_minilesson/animatecss',\n    'mod_minilesson/progresstimer',\n    'core/templates'\n], function($, log, ajax, def, polly, ttrecorder, anim, progresstimer, templates) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('MiniLesson speaking gap fill: initialising');\n\n    return {\n\n        //a handle on the tt recorder\n        ttrec: null,\n        controls: {},\n\n        // For making multiple instances\n        clone: function() {\n            return $.extend(true, {}, this);\n        },\n\n        init: function(index, itemdata, quizhelper) {\n            var self = this;\n            var theCallback = function(message) {\n\n                switch (message.type) {\n                    case 'recording':\n                        break;\n\n                    case 'speech':\n                        log.debug(\"Speech at speaking gap fill -\");\n                        var words = self.items[self.game.pointer].words;\n                        var maskedwords = [];\n\n                        Object.keys(words).forEach(function(key) {\n                            maskedwords.push(words[key]);\n                        });\n\n                        self.getComparison(\n                            maskedwords.join(\" \"),\n                            message.capturedspeech,\n                            self.items[self.game.pointer].phonetic,\n                            function(comparison) {\n                                self.gotComparison(comparison, message);\n                            }\n                        );\n                        break;\n\n                }\n\n            };\n\n            // Init the TT Recorder\n            var opts = {};\n            opts.uniqueid = itemdata.uniqueid;\n            opts.callback = theCallback;\n            opts.stt_guided = quizhelper.is_stt_guided();\n            opts.wwwroot = quizhelper.is_stt_guided();\n            self.ttrec = ttrecorder.clone();\n            self.ttrec.init(opts);\n\n            self.itemdata = itemdata;\n            log.debug(\"itemdata\");\n            log.debug(itemdata);\n            self.quizhelper = quizhelper;\n            self.index = index;\n\n            // Anim\n            var animopts = {};\n            animopts.useanimatecss = quizhelper.useanimatecss;\n            anim.init(animopts);\n            self.init_controls();\n            self.register_events();\n            self.setvoice();\n            self.getItems();\n        },\n\n        init_controls: function() {\n            var self = this;\n            self.controls = {\n                container: $(\"#\" + self.itemdata.uniqueid + \"_container\"),\n                listen_cont: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_cont\"),\n                nextbutton: $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\"),\n                start_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_start_btn\"),\n                skip_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_skip_btn\"),\n                ctrl_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\"),\n                speakbtncontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_speakbtncontainer\"),\n                game: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_game\"),\n                controlsbox: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_controls\"),\n                resultscontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_resultscontainer\"),\n                mainmenu: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_mainmenu\"),\n                title: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_title\"),\n                progress_container: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container\"),\n                progress_bar: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container .progress-bar\"),\n                question: $(\"#\" + self.itemdata.uniqueid + \"_container .question\"),\n                listen_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_btn\"),\n            };\n        },\n\n        next_question: function(percent) {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = true;\n            stepdata.totalitems = self.items.length;\n            stepdata.correctitems = self.items.filter(function(e) {\n                return e.correct;\n            }).length;\n            stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n\n            //stop audio\n            self.stop_audio();\n\n            self.quizhelper.do_next(stepdata);\n        },\n\n        show_item_review:function(){\n            var self=this;\n            var review_data = {};\n            review_data.items = self.items;\n            review_data.totalitems=self.items.length;\n            review_data.correctitems=self.items.filter(function(e) {return e.correct;}).length;\n\n            //Get controls\n            var listencont = self.controls.listen_cont;\n            var qbox = self.controls.question;\n            var recorderbox = self.controls.speakbtncontainer;\n            var gamebox = self.controls.game;\n            var controlsbox = self.controls.controlsbox;\n            var resultsbox = self.controls.resultscontainer;\n\n            //display results\n            templates.render('mod_minilesson/listitemresults',review_data).then(\n              function(html,js){\n                  resultsbox.html(html);\n                  //show and hide\n                  resultsbox.show();\n                  gamebox.hide();\n                  controlsbox.hide();\n                  listencont.hide();\n                  qbox.hide();\n                  recorderbox.hide();\n                  // Run js for audio player events\n                  templates.runTemplateJS(js);\n              }\n            );// End of templates\n        },\n\n        register_events: function() {\n\n            var self = this;\n            // On next button click\n            self.controls.container.find('.minilesson_nextbutton').on('click', function(e) {\n                self.next_question();\n            });\n            // On start button click\n            self.controls.start_btn.on(\"click\", function() {\n                self.start();\n            });\n\n            //AUDIO PLAYER Button events\n            var audioplayerbtn=self.controls.listen_btn;\n            // On listen button click\n            if(self.itemdata.readsentence) {\n                audioplayerbtn.on(\"click\", function () {\n                    var theaudio = self.items[self.game.pointer].audio;\n\n                    //if we are already playing stop playing\n                    if(!theaudio.paused){\n                        theaudio.pause();\n                        theaudio.currentTime=0;\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                        return;\n                    }\n\n                    //change icon to indicate playing state\n                    theaudio.addEventListener('ended', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                    });\n\n                    theaudio.addEventListener('play', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-volume-up');\n                        $(audioplayerbtn).children('.fa').addClass('fa-stop');\n                    });\n                    theaudio.load();\n                    theaudio.play();\n                });\n            }\n\n            // On skip button click\n            self.controls.skip_btn.on(\"click\", function() {\n                // Disable the buttons\n                self.controls.ctrl_btn.prop(\"disabled\", true);\n                // Reveal the prompt\n                self.controls.container.find('.sgapfill_speech.sgapfill_teacher_left').text(self.items[self.game.pointer].prompt + \"\");\n                // Reveal the answer\n                self.controls.container.find('.sgapfill_targetWord').each(function() {\n                    var realidx = $(this).data(\"realidx\");\n                    var sgapfill_targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(sgapfill_targetWord);\n                });\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                //mark as answered and incorrect\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = false;\n\n                if (self.game.pointer < self.items.length - 1) {\n                    // Move on after short time to next prompt\n                    setTimeout(function() {\n                        self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                    // End question\n                } else {\n                    self.end();\n                }\n\n            });\n\n        },\n\n        game: {\n            pointer: 0\n        },\n\n        usevoice: '',\n\n        setvoice: function() {\n            var self = this;\n            self.usevoice = self.itemdata.usevoice;\n            self.voiceoption = self.itemdata.voiceoption;\n        },\n\n        getItems: function() {\n            var self = this;\n            var text_items = self.itemdata.sentences;\n\n            self.items = text_items.map(function(target) {\n                return {\n                    target: target.sentence,\n                    prompt: target.prompt,\n                    parsedstring: target.parsedstring,\n                    displayprompt: target.displayprompt,\n                    definition: target.definition,\n                    phonetic: target.phonetic,\n                    words: target.words,\n                    typed: \"\",\n                    timer: [],\n                    answered: false,\n                    correct: false,\n                    audio: null,\n                    audiourl: target.audiourl ? target.audiourl : \"\",\n                    imageurl: target.imageurl,\n                };\n            }).filter(function(e) {\n                return e.target !== \"\";\n            });\n\n            if(self.itemdata.readsentence) {\n                $.each(self.items, function (index, item) {\n                    item.audio = new Audio();\n                    item.audio.src = item.audiourl;\n                });\n                self.appReady();\n            }else{\n                self.appReady();\n            }\n        },\n\n        appReady: function() {\n            var self = this;\n            self.controls.container.find('.sgapfill_not_loaded').hide();\n            self.controls.container.find('.sgapfill_loaded').show();\n            if(self.itemdata.hidestartpage){\n                self.start();\n            }else{\n               self.controls.start_btn.prop(\"disabled\", false);\n            }\n        },\n\n        gotComparison: function(comparison, typed) {\n            log.debug(\"sgapfill comparison\");\n            var self = this;\n            var countdownStarted = false;\n            var feedback = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + \" .dictate_feedback[data-idx='\" + self.game.pointer + \"']\");\n\n            self.controls.container.find('.sgapfill_targetWord').removeClass(\"sgapfill_correct sgapfill_incorrect\");\n            self.controls.container.find('.sgapfill_feedback').removeClass(\"fa fa-check fa-times\");\n\n            var allCorrect = comparison.filter(function(e) {\n                return !e.matched;\n            }).length == 0;\n            log.debug('allcorrect=' + allCorrect);\n\n            if (allCorrect && comparison && comparison.length > 0) {\n\n                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                    if (data.type === 'input') {\n                        characterinput.val(data.character);\n                    }\n                });\n\n                feedback.removeClass(\"fa fa-times\");\n                feedback.addClass(\"fa fa-check\");\n                //make the input boxes green and move forward\n                log.debug('applying correct class to input boxes');\n                self.controls.container.find('.sgapfill_reply_' + self.game.pointer + \" input\").addClass(\"ml_gapfill_char_correct\");\n\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = true;\n                self.items[self.game.pointer].typed = typed;\n\n                self.controls.ctrl_btn.prop(\"disabled\", true);\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                if ((self.game.pointer < self.items.length - 1) && !countdownStarted) {\n                    countdownStarted = true;\n                    log.debug('moving to next prompt B');\n                    setTimeout(function() {\n                        self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                } else {\n                    self.updateProgressDots();\n                    self.end();\n                }\n            } else {\n                feedback.removeClass(\"fa fa-check\");\n                feedback.addClass(\"fa fa-times\");\n                // Mark up the words as correct or not\n                comparison.forEach(function(obj) {\n                    var words = self.items[self.game.pointer].words;\n\n                    Object.keys(words).forEach(function(key) {\n                        if (words[key] == obj.word) {\n                            if (!obj.matched) {\n                                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val('');\n                                    }\n                                });\n                            } else {\n                                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val(data.character);\n                                    }\n                                });\n                            }\n                        }\n                    });\n                });\n                var thereply = self.controls.container.find('.sgapfill_reply_' + self.game.pointer);\n                anim.do_animate(thereply, 'shakeX animate__faster').then(\n                    function() {\n                        self.controls.ctrl_btn.prop(\"disabled\", false);\n                    }\n                );\n\n                // Show all the correct words\n                self.controls.container.find('.sgapfill_targetWord.sgapfill_correct').each(function() {\n                    var realidx = $(this).data(\"realidx\");\n                    var targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(targetWord);\n                });\n\n                //if they cant retry OR the time limit is up, move on\n                var timelimit_progressbar = self.controls.progress_bar;\n                if(!self.itemdata.allowretry || timelimit_progressbar.hasClass('progress-bar-complete')){\n                    self.items[self.game.pointer].answered = true;\n                    self.items[self.game.pointer].correct = false;\n                    self.items[self.game.pointer].typed = typed;\n\n                    $self.controls.ctrl_btn.prop(\"disabled\", true);\n\n                    self.stopTimer(self.items[self.game.pointer].timer);\n\n                    if(!countdownStarted) {\n                        if (self.game.pointer < self.items.length - 1) {\n                            countdownStarted = true;\n                            setTimeout(function () {\n                                self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                                self.game.pointer++;\n                                self.nextPrompt();\n                            }, 2000);\n                        } else {\n                            self.updateProgressDots();\n                            self.end();\n                        }\n                    }//end of if countdown not started\n                } //end of if can't retry or time limit up\n            }//end of if -all -correct or not\n        },\n\n        getComparison: function(passage, transcript, phonetic, callback) {\n            var self = this;\n\n            self.controls.ctrl_btn.prop(\"disabled\", true);\n            self.quizhelper.comparePassageToTranscript(passage, transcript, phonetic, self.itemdata.language, self.itemdata.alternates).then(function(ajaxresult) {\n                var payloadobject = JSON.parse(ajaxresult);\n                if (payloadobject) {\n                    callback(payloadobject);\n                } else {\n                    callback(false);\n                }\n            });\n        },\n\n        end: function() {\n            var self = this;\n            $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n            //progress dots are updated on next_item. The last item has no next item, so we update from here\n            self.updateProgressDots();\n\n            setTimeout(function() {\n                $(\".minilesson_nextbutton\").prop(\"disabled\",false);\n                if(self.quizhelper.showitemreview){\n                    self.show_item_review();\n                }else{\n                    self.next_question();\n                }\n            }, 2000);\n\n        },\n\n        start: function() {\n            var self = this;\n\n            self.controls.ctrl_btn.prop(\"disabled\", true);\n            self.controls.speakbtncontainer.show();\n\n            self.items.forEach(function(item) {\n                item.spoken = \"\";\n                item.answered = false;\n                item.correct = false;\n            });\n\n            self.game.pointer = 0;\n\n            self.controls.question.show();\n            if(self.itemdata.readsentence) {\n                self.controls.listen_cont.show();\n            }\n            self.controls.start_btn.hide();\n            self.controls.mainmenu.hide();\n            self.controls.controlsbox.show();\n\n            self.nextPrompt();\n        },\n\n        updateProgressDots: function(){\n            var self = this;\n            var color;\n            var progress = self.items.map(function(item, idx) {\n                color = \"gray\";\n                if (self.items[idx].answered && self.items[idx].correct) {\n                    color = \"green\";\n                } else if (self.items[idx].answered && !self.items[idx].correct) {\n                    color = \"red\";\n                }\n                return \"<i style='color:\" + color + \"' class='fa fa-circle'></i>\";\n            }).join(\" \");\n            self.controls.title.html(progress);\n        },\n\n        nextPrompt: function() {\n            var self = this;\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n            self.updateProgressDots();\n            var newprompt = self.controls.container.find('.sgapfill_prompt_' + self.game.pointer);\n            anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n            self.nextReply();\n        },\n\n\n        nextReply: function() {\n            var self = this;\n\n            var code = \"<div class='sgapfill_reply sgapfill_reply_\" + self.game.pointer + \" text-center' style='display:none;'>\";\n            var brackets = {started: false, ended: false, index: null};\n\n            code += \"<div class='form-container'>\";\n            self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                if (brackets.started && !brackets.ended && brackets.index !== data.index) {\n                    brackets.started = brackets.ended = false;\n                    code += '</span>';\n                }\n                if ((data.type === 'input' || data.type === 'mtext') && !brackets.started) {\n                    code += '<span class=\"form-input-phrase-online\" data-mindex=\"'+data.index+'\">';\n                    brackets.started = true;\n                }\n                brackets.index = data.index;\n                if (data.type === 'input') {\n                    code += \"<input class='single-character' autocomplete='off' type='text' name='filltext\" + index + \"' maxlength='1' data-index='\" + index + \"' readonly>\";\n                } else if (data.type === 'mtext') {\n                    code += \"<input class='single-character-mtext' type='text' name='readonly\" + index + \"' maxlength='1' value='\" + data.character + \"' readonly>\";\n                } else {\n                    code += data.character;\n                }\n            });\n            if (brackets.started && !brackets.ended) {\n                code += '</span>';\n            }\n            //correct or not\n            code += \" <i data-idx='\" + self.game.pointer + \"' class='dictate_feedback'></i></div>\";\n\n            //hint - image\n            if( self.items[self.game.pointer].imageurl) {\n                code += \"<div class='minilesson_sentence_image'><div class='minilesson_padded_image'><img src='\"\n                    + self.items[self.game.pointer].imageurl + \"' alt='Image for gap fill' /></div></div>\";\n            }\n            //hint - definition\n            if( self.items[self.game.pointer].definition) {\n                code += \"<div class='definition-container'><div class='definition'>\"\n                    + self.items[self.game.pointer].definition + \"</div>\";\n            }\n\n\n            self.controls.question.append(code);\n\n\n            var newreply = self.controls.container.find('.sgapfill_reply_' + self.game.pointer);\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n\n            // Start the timer (if we have one)\n            self.startTimer();\n\n            // We autoplay the audio on item entry, if its not a mobile user.\n            // If we do not have a start page and its the first item, we play on the item show event\n            if (!self.quizhelper.mobile_user()){\n                if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                    self.controls.container.on(\"showElement\", () => {\n                        setTimeout(function() {\n                            self.controls.listen_btn.trigger('click');\n                        }, 1000);\n                    });\n                }else{\n                    setTimeout(function() {\n                        self.controls.listen_btn.trigger('click');\n                    }, 1000);\n                }\n            }\n\n            //target is the speech we expect\n            var target = self.items[self.game.pointer].target;\n            //in some cases ttrecorder wants to know the target\n            if(self.quizhelper.use_ttrecorder()) {\n                self.ttrec.currentPrompt=target;\n            }\n        },\n\n        // Stop audio .. usually when leaving the item or sentence\n        stop_audio: function(){\n            var self =this;\n            //pause audio if its playing\n            var theaudio = self.items[self.game.pointer].audio;\n            if(theaudio && !theaudio.paused) {\n                theaudio.pause();\n            }\n        },\n\n        startTimer: function(){\n            var self = this;\n            // If we have a time limit, set up the timer, otherwise return\n            if (self.itemdata.timelimit > 0) {\n               // This is a function to start the timer (we call it conditionally below)\n                var doStartTimer = function() {\n                     // This shows progress bar\n                    self.controls.progress_container.show();\n                    self.controls.progress_container.find('i').show();\n                    var progresbar = self.controls.progress_container.find('#progresstimer').progressTimer({\n                        height: '5px',\n                        timeLimit: self.itemdata.timelimit,\n                        onFinish: function() {\n                            self.controls.skip_btn.trigger('click');\n                        }\n                    });\n                    progresbar.each(function() {\n                        self.items[self.game.pointer].timer.push($(this).attr('timer'));\n                    });\n                }\n\n                // This adds the timer and starts it. But if we dont have a start page and its the first item\n                // we need to defer the timer start until the item is shown\n                if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                    self.controls.container.on(\"showElement\", () => {\n                        doStartTimer();\n                    });\n                }else{\n                    doStartTimer();\n                }\n            }\n        },\n\n        stopTimer: function(timers) {\n            if (timers.length) {\n                timers.forEach(function(timer) {\n                    clearInterval(timer);\n                });\n            }\n        },\n    };\n});"],"file":"speakinggapfill.min.js"}