{"version":3,"sources":["../src/speakinggapfill.js"],"names":["define","$","log","ajax","def","polly","ttrecorder","anim","progresstimer","templates","str","notification","debug","ttrec","controls","clone","extend","init","index","itemdata","quizhelper","self","strings","opts","uniqueid","callback","theCallback","message","type","words","items","game","pointer","maskedwords","Object","keys","forEach","key","push","getComparison","join","capturedspeech","phonetic","comparison","gotComparison","stt_guided","is_stt_guided","wwwroot","animopts","useanimatecss","init_controls","init_strings","register_events","setvoice","getItems","container","listen_cont","nextbutton","start_btn","skip_btn","ctrl_btn","speakbtncontainer","controlsbox","resultscontainer","mainmenu","title","progress_container","progress_bar","question","listen_btn","get_strings","done","s","i","nextlessonitem","confirm_desc","yes","no","next_question","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","stop_audio","do_next","show_item_review","review_data","listencont","qbox","recorderbox","gamebox","resultsbox","render","then","html","js","show","hide","runTemplateJS","find","on","some","item","answered","confirm","start","audioplayerbtn","readsentence","theaudio","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","text","prompt","each","realidx","data","sgapfill_targetWord","sgapfill_targetWords","val","stopTimer","timer","setTimeout","nextPrompt","end","usevoice","voiceoption","text_items","sentences","map","target","sentence","segmentedsentence","parsedstring","displayprompt","definition","typed","audiourl","imageurl","Audio","src","appReady","hidestartpage","countdownStarted","feedback","allCorrect","matched","characterinput","character","updateProgressDots","obj","word","thereply","do_animate","targetWord","timelimit_progressbar","allowretry","hasClass","passage","transcript","comparePassageToTranscript","language","alternates","ajaxresult","payloadobject","JSON","parse","showitemreview","spoken","color","progress","idx","newprompt","nextReply","code","brackets","started","ended","hasdefinition","imagebottommargin","append","newreply","startTimer","mobile_user","trigger","use_ttrecorder","currentPrompt","timelimit","doStartTimer","progresbar","progressTimer","height","timeLimit","onFinish","attr","timers","clearInterval"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'mod_minilesson/definitions',\n    'mod_minilesson/pollyhelper',\n    'mod_minilesson/ttrecorder',\n    'mod_minilesson/animatecss',\n    'mod_minilesson/progresstimer',\n    'core/templates',\n    'core/str',\n    'core/notification'\n], function($, log, ajax, def, polly, ttrecorder, anim, progresstimer, templates,str,notification) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('MiniLesson speaking gap fill: initialising');\n\n    return {\n\n        //a handle on the tt recorder\n        ttrec: null,\n        controls: {},\n\n        // For making multiple instances\n        clone: function() {\n            return $.extend(true, {}, this);\n        },\n\n        init: function(index, itemdata, quizhelper) {\n            var self = this;\n            self.strings = {};\n            var theCallback = function(message) {\n\n                switch (message.type) {\n                    case 'recording':\n                        break;\n\n                    case 'speech':\n                        log.debug(\"Speech at speaking gap fill -\");\n                        var words = self.items[self.game.pointer].words;\n                        var maskedwords = [];\n\n                        Object.keys(words).forEach(function(key) {\n                            maskedwords.push(words[key]);\n                        });\n\n                        self.getComparison(\n                            maskedwords.join(\" \"),\n                            message.capturedspeech,\n                            self.items[self.game.pointer].phonetic,\n                            function(comparison) {\n                                self.gotComparison(comparison, message);\n                            }\n                        );\n                        break;\n\n                }\n\n            };\n\n            // Init the TT Recorder\n            var opts = {};\n            opts.uniqueid = itemdata.uniqueid;\n            opts.callback = theCallback;\n            opts.stt_guided = quizhelper.is_stt_guided();\n            opts.wwwroot = quizhelper.is_stt_guided();\n            self.ttrec = ttrecorder.clone();\n            self.ttrec.init(opts);\n\n            self.itemdata = itemdata;\n            log.debug(\"itemdata\");\n            log.debug(itemdata);\n            self.quizhelper = quizhelper;\n            self.index = index;\n\n            // Anim\n            var animopts = {};\n            animopts.useanimatecss = quizhelper.useanimatecss;\n            anim.init(animopts);\n            self.init_controls();\n            self.init_strings();\n            self.register_events();\n            self.setvoice();\n            self.getItems();\n        },\n\n        init_controls: function() {\n            var self = this;\n            self.controls = {\n                container: $(\"#\" + self.itemdata.uniqueid + \"_container\"),\n                listen_cont: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_cont\"),\n                nextbutton: $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\"),\n                start_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_start_btn\"),\n                skip_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_skip_btn\"),\n                ctrl_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_ctrl-btn\"),\n                speakbtncontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_speakbtncontainer\"),\n                game: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_game\"),\n                controlsbox: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_controls\"),\n                resultscontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_resultscontainer\"),\n                mainmenu: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_mainmenu\"),\n                title: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_title\"),\n                progress_container: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container\"),\n                progress_bar: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container .progress-bar\"),\n                question: $(\"#\" + self.itemdata.uniqueid + \"_container .question\"),\n                listen_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .sgapfill_listen_btn\"),\n            };\n        },\n\n        init_strings: function() {\n            var self = this;\n            str.get_strings([\n                { \"key\": \"nextlessonitem\", \"component\": 'mod_minilesson'},\n                { \"key\": \"confirm_desc\", \"component\": 'mod_minilesson'},\n                { \"key\": \"yes\", \"component\": 'moodle'},\n                { \"key\": \"no\", \"component\": 'moodle'},\n            ]).done(function (s) {\n                var i = 0;\n                self.strings.nextlessonitem = s[i++];\n                self.strings.confirm_desc = s[i++];\n                self.strings.yes = s[i++];\n                self.strings.no = s[i++];\n            });\n        },\n\n        next_question: function(percent) {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = true;\n            stepdata.totalitems = self.items.length;\n            stepdata.correctitems = self.items.filter(function(e) {\n                return e.correct;\n            }).length;\n            stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n\n            //stop audio\n            self.stop_audio();\n\n            self.quizhelper.do_next(stepdata);\n        },\n\n        show_item_review:function(){\n            var self=this;\n            var review_data = {};\n            review_data.items = self.items;\n            review_data.totalitems=self.items.length;\n            review_data.correctitems=self.items.filter(function(e) {return e.correct;}).length;\n\n            //Get controls\n            var listencont = self.controls.listen_cont;\n            var qbox = self.controls.question;\n            var recorderbox = self.controls.speakbtncontainer;\n            var gamebox = self.controls.game;\n            var controlsbox = self.controls.controlsbox;\n            var resultsbox = self.controls.resultscontainer;\n\n            //display results\n            templates.render('mod_minilesson/listitemresults',review_data).then(\n              function(html,js){\n                  resultsbox.html(html);\n                  //show and hide\n                  resultsbox.show();\n                  gamebox.hide();\n                  controlsbox.hide();\n                  listencont.hide();\n                  qbox.hide();\n                  recorderbox.hide();\n                  // Run js for audio player events\n                  templates.runTemplateJS(js);\n              }\n            );// End of templates\n        },\n\n        register_events: function() {\n\n            var self = this;\n            // On next button click\n            self.controls.container.find('.minilesson_nextbutton').on('click', function(e) {\n                if (self.items.some(item => !item.answered)) {\n                    notification.confirm(self.strings.nextlessonitem,\n                        self.strings.confirm_desc,\n                        self.strings.yes,\n                        self.strings.no,\n                        function() {\n                            self.next_question();\n                        }\n                    );\n                } else {\n                    self.next_question();\n                }\n            });\n            // On start button click\n            self.controls.start_btn.on(\"click\", function() {\n                self.start();\n            });\n\n            //AUDIO PLAYER Button events\n            var audioplayerbtn=self.controls.listen_btn;\n            // On listen button click\n            if(self.itemdata.readsentence) {\n                audioplayerbtn.on(\"click\", function () {\n                    var theaudio = self.items[self.game.pointer].audio;\n\n                    //if we are already playing stop playing\n                    if(!theaudio.paused){\n                        theaudio.pause();\n                        theaudio.currentTime=0;\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                        return;\n                    }\n\n                    //change icon to indicate playing state\n                    theaudio.addEventListener('ended', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n                        $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n                    });\n\n                    theaudio.addEventListener('play', function () {\n                        $(audioplayerbtn).children('.fa').removeClass('fa-volume-up');\n                        $(audioplayerbtn).children('.fa').addClass('fa-stop');\n                    });\n                    theaudio.load();\n                    theaudio.play();\n                });\n            }\n\n            // On skip button click\n            self.controls.skip_btn.on(\"click\", function() {\n                // Disable the buttons\n                self.controls.ctrl_btn.prop(\"disabled\", true);\n                // Reveal the prompt\n                self.controls.container.find('.sgapfill_speech.sgapfill_teacher_left').text(self.items[self.game.pointer].prompt + \"\");\n                // Reveal the answer\n                self.controls.container.find('.sgapfill_targetWord').each(function() {\n                    var realidx = $(this).data(\"realidx\");\n                    var sgapfill_targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(sgapfill_targetWord);\n                });\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                //mark as answered and incorrect\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = false;\n\n                if (self.game.pointer < self.items.length - 1) {\n                    self.controls.skip_btn.prop(\"disabled\", true);\n                    self.controls.skip_btn.children('.fa').removeClass('fa-arrow-right');\n                    self.controls.skip_btn.children('.fa').addClass('fa-spinner fa-spin');\n                    // Move on after short time to next prompt\n                    setTimeout(function() {\n                        self.controls.skip_btn.children('.fa').removeClass('fa-spinner fa-spin');\n                        self.controls.skip_btn.children('.fa').addClass('fa-arrow-right');\n                        self.controls.skip_btn.prop(\"disabled\", false);\n                        self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                    // End question\n                } else {\n                    self.end();\n                }\n\n            });\n\n        },\n\n        game: {\n            pointer: 0\n        },\n\n        usevoice: '',\n\n        setvoice: function() {\n            var self = this;\n            self.usevoice = self.itemdata.usevoice;\n            self.voiceoption = self.itemdata.voiceoption;\n        },\n\n        getItems: function() {\n            var self = this;\n            var text_items = self.itemdata.sentences;\n\n            self.items = text_items.map(function(target) {\n                return {\n                    target: target.sentence,\n                    segmentedsentence: target.segmentedsentence,\n                    prompt: target.prompt,\n                    parsedstring: target.parsedstring,\n                    displayprompt: target.displayprompt,\n                    definition: target.definition,\n                    phonetic: target.phonetic,\n                    words: target.words,\n                    typed: \"\",\n                    timer: [],\n                    answered: false,\n                    correct: false,\n                    audio: null,\n                    audiourl: target.audiourl ? target.audiourl : \"\",\n                    imageurl: target.imageurl,\n                };\n            }).filter(function(e) {\n                return e.target !== \"\";\n            });\n\n            if(self.itemdata.readsentence) {\n                $.each(self.items, function (index, item) {\n                    item.audio = new Audio();\n                    item.audio.src = item.audiourl;\n                });\n                self.appReady();\n            }else{\n                self.appReady();\n            }\n        },\n\n        appReady: function() {\n            var self = this;\n            self.controls.container.find('.sgapfill_not_loaded').hide();\n            self.controls.container.find('.sgapfill_loaded').show();\n            if(self.itemdata.hidestartpage){\n                self.start();\n            }else{\n               self.controls.start_btn.prop(\"disabled\", false);\n            }\n        },\n\n        gotComparison: function(comparison, typed) {\n            log.debug(\"sgapfill comparison\");\n            var self = this;\n            var countdownStarted = false;\n            var feedback = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + \" .dictate_feedback[data-idx='\" + self.game.pointer + \"']\");\n\n            self.controls.container.find('.sgapfill_targetWord').removeClass(\"sgapfill_correct sgapfill_incorrect\");\n            self.controls.container.find('.sgapfill_feedback').removeClass(\"fa fa-check fa-times\");\n\n            var allCorrect = comparison.filter(function(e) {\n                return !e.matched;\n            }).length == 0;\n            log.debug('allcorrect=' + allCorrect);\n\n            if (allCorrect && comparison && comparison.length > 0) {\n\n                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                    if (data.type === 'input') {\n                        characterinput.val(data.character);\n                    }\n                });\n\n                feedback.removeClass(\"fa fa-times\");\n                feedback.addClass(\"fa fa-check\");\n                //make the input boxes green and move forward\n                log.debug('applying correct class to input boxes');\n                self.controls.container.find('.sgapfill_reply_' + self.game.pointer + \" input\").addClass(\"ml_gapfill_char_correct\");\n\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = true;\n                self.items[self.game.pointer].typed = typed;\n\n                self.controls.ctrl_btn.prop(\"disabled\", true);\n\n                self.stopTimer(self.items[self.game.pointer].timer);\n\n                if ((self.game.pointer < self.items.length - 1) && !countdownStarted) {\n                    countdownStarted = true;\n                    log.debug('moving to next prompt B');\n                    setTimeout(function() {\n                        self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                        self.game.pointer++;\n                        self.nextPrompt();\n                    }, 2000);\n                } else {\n                    self.updateProgressDots();\n                    self.end();\n                }\n            } else {\n                feedback.removeClass(\"fa fa-check\");\n                feedback.addClass(\"fa fa-times\");\n                // Mark up the words as correct or not\n                comparison.forEach(function(obj) {\n                    var words = self.items[self.game.pointer].words;\n\n                    Object.keys(words).forEach(function(key) {\n                        if (words[key] == obj.word) {\n                            if (!obj.matched) {\n                                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val('');\n                                    }\n                                });\n                            } else {\n                                self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                                    var characterinput = self.controls.container.find('.sgapfill_reply_' + self.game.pointer + ' input.single-character[data-index=\"' + index + '\"]');\n                                    if (data.index == key && data.type === 'input') {\n                                        characterinput.val(data.character);\n                                    }\n                                });\n                            }\n                        }\n                    });\n                });\n                var thereply = self.controls.container.find('.sgapfill_reply_' + self.game.pointer);\n                anim.do_animate(thereply, 'shakeX animate__faster').then(\n                    function() {\n                        self.controls.ctrl_btn.prop(\"disabled\", false);\n                    }\n                );\n\n                // Show all the correct words\n                self.controls.container.find('.sgapfill_targetWord.sgapfill_correct').each(function() {\n                    var realidx = $(this).data(\"realidx\");\n                    var targetWord = self.items[self.game.pointer].sgapfill_targetWords[realidx];\n                    $(this).val(targetWord);\n                });\n\n                //if they cant retry OR the time limit is up, move on\n                var timelimit_progressbar = self.controls.progress_bar;\n                if(!self.itemdata.allowretry || timelimit_progressbar.hasClass('progress-bar-complete')){\n                    self.items[self.game.pointer].answered = true;\n                    self.items[self.game.pointer].correct = false;\n                    self.items[self.game.pointer].typed = typed;\n\n                    self.controls.ctrl_btn.prop(\"disabled\", true);\n\n                    self.stopTimer(self.items[self.game.pointer].timer);\n\n                    if(!countdownStarted) {\n                        if (self.game.pointer < self.items.length - 1) {\n                            countdownStarted = true;\n                            setTimeout(function () {\n                                self.controls.container.find('.sgapfill_reply_' + self.game.pointer).hide();\n                                self.game.pointer++;\n                                self.nextPrompt();\n                            }, 2000);\n                        } else {\n                            self.updateProgressDots();\n                            self.end();\n                        }\n                    }//end of if countdown not started\n                } //end of if can't retry or time limit up\n            }//end of if -all -correct or not\n        },\n\n        getComparison: function(passage, transcript, phonetic, callback) {\n            var self = this;\n\n            self.controls.ctrl_btn.prop(\"disabled\", true);\n            self.quizhelper.comparePassageToTranscript(passage, transcript, phonetic, self.itemdata.language, self.itemdata.alternates).then(function(ajaxresult) {\n                var payloadobject = JSON.parse(ajaxresult);\n                if (payloadobject) {\n                    callback(payloadobject);\n                } else {\n                    callback(false);\n                }\n            });\n        },\n\n        end: function() {\n            var self = this;\n            $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n            //progress dots are updated on next_item. The last item has no next item, so we update from here\n            self.updateProgressDots();\n\n            setTimeout(function() {\n                $(\".minilesson_nextbutton\").prop(\"disabled\",false);\n                if(self.quizhelper.showitemreview){\n                    self.show_item_review();\n                }else{\n                    self.next_question();\n                }\n            }, 2000);\n\n        },\n\n        start: function() {\n            var self = this;\n\n            self.controls.ctrl_btn.prop(\"disabled\", true);\n            self.controls.speakbtncontainer.show();\n\n            self.items.forEach(function(item) {\n                item.spoken = \"\";\n                item.answered = false;\n                item.correct = false;\n            });\n\n            self.game.pointer = 0;\n\n            self.controls.question.show();\n            if(self.itemdata.readsentence) {\n                self.controls.listen_cont.show();\n            }\n            self.controls.start_btn.hide();\n            self.controls.mainmenu.hide();\n            self.controls.controlsbox.show();\n\n            self.nextPrompt();\n        },\n\n        updateProgressDots: function(){\n            var self = this;\n            var color;\n            var progress = self.items.map(function(item, idx) {\n                color = \"gray\";\n                if (self.items[idx].answered && self.items[idx].correct) {\n                    color = \"green\";\n                } else if (self.items[idx].answered && !self.items[idx].correct) {\n                    color = \"red\";\n                }\n                return \"<i style='color:\" + color + \"' class='fa fa-circle'></i>\";\n            }).join(\" \");\n            self.controls.title.html(progress);\n        },\n\n        nextPrompt: function() {\n            var self = this;\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n            self.updateProgressDots();\n            var newprompt = self.controls.container.find('.sgapfill_prompt_' + self.game.pointer);\n            anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n            self.nextReply();\n        },\n\n\n        nextReply: function() {\n            var self = this;\n\n            var code = \"<div class='sgapfill_reply sgapfill_reply_\" + self.game.pointer + \" text-center' style='display:none;'>\";\n            var brackets = {started: false, ended: false, index: null};\n\n            code += \"<div class='form-container'>\";\n            self.items[self.game.pointer].parsedstring.forEach(function(data, index) {\n                if (brackets.started && !brackets.ended && brackets.index !== data.index) {\n                    brackets.started = brackets.ended = false;\n                    code += '</span>';\n                }\n                if ((data.type === 'input' || data.type === 'mtext') && !brackets.started) {\n                    code += '<span class=\"form-input-phrase-online\" data-mindex=\"'+data.index+'\">';\n                    brackets.started = true;\n                }\n                brackets.index = data.index;\n                if (data.type === 'input') {\n                    code += \"<input class='single-character' autocomplete='off' type='text' name='filltext\" + index + \"' maxlength='1' data-index='\" + index + \"' readonly>\";\n                } else if (data.type === 'mtext') {\n                    code += \"<input class='single-character-mtext' type='text' name='readonly\" + index + \"' maxlength='1' value='\" + data.character + \"' readonly>\";\n                } else {\n                    code += data.character;\n                }\n            });\n            if (brackets.started && !brackets.ended) {\n                code += '</span>';\n            }\n            //correct or not\n            code += \" <i data-idx='\" + self.game.pointer + \"' class='dictate_feedback'></i></div>\";\n\n            //hints\n            // We need to set a higher margin for the image if there is no hint, to stop it being overlapped by the recorder\n            var hasdefinition = self.items[self.game.pointer].definition && self.items[self.game.pointer].definition !== \"\";\n            var imagebottommargin  = hasdefinition ? \"margin-bottom: 5px\" : \"margin-bottom: 50px\";\n            if( self.items[self.game.pointer].imageurl) {\n                code += \"<div class='minilesson_sentence_image' style='\"+imagebottommargin+\"'><div class='minilesson_padded_image'><img src='\"\n                    + self.items[self.game.pointer].imageurl + \"' alt='Image for gap fill' /></div></div>\";\n            }\n            //hint - definition\n            if(hasdefinition ) {\n                code += \"<div class='definition-container'><div class='definition'>\"\n                    + self.items[self.game.pointer].definition + \"</div>\";\n            }\n\n\n            self.controls.question.append(code);\n\n\n            var newreply = self.controls.container.find('.sgapfill_reply_' + self.game.pointer);\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function() {\n                }\n            );\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n\n            // Start the timer (if we have one)\n            self.startTimer();\n\n            // We autoplay the audio on item entry, if its not a mobile user.\n            // If we do not have a start page and its the first item, we play on the item show event\n            if (!self.quizhelper.mobile_user()){\n                if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                    self.controls.container.on(\"showElement\", () => {\n                        setTimeout(function() {\n                            self.controls.listen_btn.trigger('click');\n                        }, 1000);\n                    });\n                }else{\n                    setTimeout(function() {\n                        self.controls.listen_btn.trigger('click');\n                    }, 1000);\n                }\n            }\n\n            //target is the speech we expect\n            var target = self.items[self.game.pointer].target;\n            //in some cases ttrecorder wants to know the target\n            if(self.quizhelper.use_ttrecorder()) {\n                self.ttrec.currentPrompt=target;\n            }\n        },\n\n        // Stop audio .. usually when leaving the item or sentence\n        stop_audio: function(){\n            var self =this;\n            //pause audio if its playing\n            var theaudio = self.items[self.game.pointer].audio;\n            if(theaudio && !theaudio.paused) {\n                theaudio.pause();\n            }\n        },\n\n        startTimer: function(){\n            var self = this;\n            // If we have a time limit, set up the timer, otherwise return\n            if (self.itemdata.timelimit > 0) {\n               // This is a function to start the timer (we call it conditionally below)\n                var doStartTimer = function() {\n                     // This shows progress bar\n                    self.controls.progress_container.show();\n                    self.controls.progress_container.find('i').show();\n                    var progresbar = self.controls.progress_container.find('#progresstimer').progressTimer({\n                        height: '5px',\n                        timeLimit: self.itemdata.timelimit,\n                        onFinish: function() {\n                            self.controls.skip_btn.trigger('click');\n                        }\n                    });\n                    progresbar.each(function() {\n                        self.items[self.game.pointer].timer.push($(this).attr('timer'));\n                    });\n                }\n\n                // This adds the timer and starts it. But if we dont have a start page and its the first item\n                // we need to defer the timer start until the item is shown\n                if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                    self.controls.container.on(\"showElement\", () => {\n                        doStartTimer();\n                    });\n                }else{\n                    doStartTimer();\n                }\n            }\n        },\n\n        stopTimer: function(timers) {\n            if (timers.length) {\n                timers.forEach(function(timer) {\n                    clearInterval(timer);\n                });\n            }\n        },\n    };\n});"],"file":"speakinggapfill.min.js"}