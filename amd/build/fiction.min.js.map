{"version":3,"file":"fiction.min.js","sources":["../src/fiction.js"],"sourcesContent":["define([\n    'jquery', 'core/log', 'mod_minilesson/definitions',\n    'core/str', 'core/modal_factory', 'core/fragment'\n],\n    function ($, log, def, Str, ModalFactory, Fragment) {\n        \"use strict\"; // jshint ;_;\n\n        /*\n       This file is to manage the fiction item type\n        */\n\n        log.debug('MiniLesson Fiction: initialising');\n\n        return {\n\n            instance: null,\n\n            itemdata: {},\n\n            //for making multiple instances\n            clone: function () {\n                return $.extend(true, {}, this);\n            },\n\n            init: function (index, itemdata, quizhelper) {\n                this.itemdata = itemdata;\n                this.register_events(index, itemdata, quizhelper);\n            },\n\n            prepare_html: function (itemdata) {\n                //do something\n            },\n\n            register_events: function (index, itemdata, quizhelper) {\n                var self = this;\n                //When click next button , report and leave it up to parent to eal with it.\n                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function (e) {\n                    var stepdata = {};\n                    stepdata.index = index;\n                    stepdata.hasgrade = false;\n                    stepdata.totalitems = 0;\n                    stepdata.correctitems = 0;\n                    stepdata.grade = 0;\n                    quizhelper.do_next(stepdata);\n                });\n                $(\"#\" + itemdata.uniqueid + \"_container\").on(\"showElement\", async (e) => {\n                    if (!self.instance) {\n                        // Maybe init yarn-bound here\n                        self.instance.initialize();\n                    }\n\n                    if (itemdata.timelimit > 0) {\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container\").show();\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container i\").show();\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                            height: '5px',\n                            timeLimit: itemdata.timelimit,\n                            onFinish: function () {\n                                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").trigger('click');\n                            }\n                        });\n                    }\n                });\n            },\n\n            register_previewbutton: function (buttonid, region = 'default') {\n                var previewbtn = document.getElementById(buttonid);\n                if (!previewbtn) {\n                    return;\n                }\n                previewbtn.addEventListener('click', function (e) {\n                    e.preventDefault();\n                    var form = previewbtn.form;\n                    if (!form) {\n                        return;\n                    }\n                    ModalFactory.create({\n                        type: ModalFactory.types.CANCEL,\n                        large: true,\n                        removeOnClose: true,\n                        templateContext: {\n                            classes: 'minilesson-fiction-preview-modal'\n                        },\n                        title: Str.get_string('fiction:previewmodaltitle', 'mod_minilesson'),\n                        body: Fragment.loadFragment('mod_minilesson', 'preview_fiction', M.cfg.contextid, {\n                            formdata: new URLSearchParams([...new FormData(form).entries()]).toString()\n                        })\n                    }).then(function (modal) {\n                        modal.getFooter().addClass('d-none');\n                        modal.show();\n                    });\n                    return;\n                });\n                \n            }\n        }; //end of return value\n    });"],"names":["define","$","log","def","Str","ModalFactory","Fragment","debug","instance","itemdata","clone","extend","this","init","index","quizhelper","register_events","prepare_html","self","uniqueid","on","e","stepdata","hasgrade","totalitems","correctitems","grade","do_next","async","initialize","timelimit","show","progressTimer","height","timeLimit","onFinish","trigger","register_previewbutton","buttonid","previewbtn","document","getElementById","addEventListener","preventDefault","form","create","type","types","CANCEL","large","removeOnClose","templateContext","classes","title","get_string","body","loadFragment","M","cfg","contextid","formdata","URLSearchParams","FormData","entries","toString","then","modal","getFooter","addClass"],"mappings":"AAAAA,gCAAO,CACH,SAAU,WAAY,6BACtB,WAAY,qBAAsB,kBAElC,SAAUC,EAAGC,IAAKC,IAAKC,IAAKC,aAAcC,iBAOtCJ,IAAIK,MAAM,oCAEH,CAEHC,SAAU,KAEVC,SAAU,GAGVC,MAAO,kBACIT,EAAEU,QAAO,EAAM,GAAIC,OAG9BC,KAAM,SAAUC,MAAOL,SAAUM,iBACxBN,SAAWA,cACXO,gBAAgBF,MAAOL,SAAUM,aAG1CE,aAAc,SAAUR,YAIxBO,gBAAiB,SAAUF,MAAOL,SAAUM,gBACpCG,KAAON,KAEXX,EAAE,IAAMQ,SAASU,SAAW,qCAAqCC,GAAG,SAAS,SAAUC,OAC/EC,SAAW,GACfA,SAASR,MAAQA,MACjBQ,SAASC,UAAW,EACpBD,SAASE,WAAa,EACtBF,SAASG,aAAe,EACxBH,SAASI,MAAQ,EACjBX,WAAWY,QAAQL,aAEvBrB,EAAE,IAAMQ,SAASU,SAAW,cAAcC,GAAG,eAAeQ,MAAAA,IACnDV,KAAKV,UAENU,KAAKV,SAASqB,aAGdpB,SAASqB,UAAY,IACrB7B,EAAE,IAAMQ,SAASU,SAAW,kCAAkCY,OAC9D9B,EAAE,IAAMQ,SAASU,SAAW,oCAAoCY,OAChE9B,EAAE,IAAMQ,SAASU,SAAW,iDAAiDa,cAAc,CACvFC,OAAQ,MACRC,UAAWzB,SAASqB,UACpBK,SAAU,WACNlC,EAAE,IAAMQ,SAASU,SAAW,qCAAqCiB,QAAQ,iBAO7FC,uBAAwB,SAAUC,cAC1BC,WAAaC,SAASC,eAAeH,UACpCC,YAGLA,WAAWG,iBAAiB,SAAS,SAAUrB,GAC3CA,EAAEsB,qBACEC,KAAOL,WAAWK,KACjBA,MAGLvC,aAAawC,OAAO,CAChBC,KAAMzC,aAAa0C,MAAMC,OACzBC,OAAO,EACPC,eAAe,EACfC,gBAAiB,CACbC,QAAS,oCAEbC,MAAOjD,IAAIkD,WAAW,4BAA6B,kBACnDC,KAAMjD,SAASkD,aAAa,iBAAkB,kBAAmBC,EAAEC,IAAIC,UAAW,CAC9EC,SAAU,IAAIC,gBAAgB,IAAI,IAAIC,SAASlB,MAAMmB,YAAYC,eAEtEC,MAAK,SAAUC,OACdA,MAAMC,YAAYC,SAAS,UAC3BF,MAAMnC"}