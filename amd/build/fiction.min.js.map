{"version":3,"file":"fiction.min.js","sources":["../src/fiction.js"],"sourcesContent":["define([\n    'jquery', 'core/log', 'mod_minilesson/definitions','mod_minilesson/yarn-bound',\n    'core/str', 'core/modal_factory', 'core/fragment','core/templates'\n],\n    function ($, log, def, YarnBound, Str, ModalFactory, Fragment, Templates) {\n        \"use strict\"; // jshint ;_;\n\n        /*\n       This file is to manage the fiction item type\n        */\n\n        log.debug('MiniLesson Fiction: initialising');\n\n        return {\n\n            runner: null,\n            controls: {},\n            itemdata: {},\n            chatdata: {},\n\n            //for making multiple instances\n            clone: function () {\n                return $.extend(true, {}, this);\n            },\n\n            init: function (index, itemdata, quizhelper) {\n                this.itemdata = itemdata;\n                this.prepare_html(itemdata);\n                this.register_events(index, itemdata, quizhelper);\n                this.presentationmode = itemdata.presention_mobilechat ? 'mobilechat' : 'plain';\n                var yarnopts = {\n                    \"dialogue\": itemdata.fictionyarn,\n                    \"combineTextAndOptionsResults\": true,\n                    \"startAt\": \"Start\"\n                };\n                log.debug('MiniLesson Fiction: initializing yarnbound with options');\n                log.debug(yarnopts);\n                try{\n                    this.runner = new YarnBound(yarnopts);\n                    this.do_render();\n                } catch (e) {\n                    var userFriendlyError = \"Yarn Parse Error: \" + e.message;\n                    this.controls.yarncontainer.html(\n                        `<div class=\"alert alert-danger\">${userFriendlyError}</div>`\n                    );\n                    log.error(\"Full Yarn Error:\");\n                    log.error(e);\n                }\n            },\n\n            prepare_html: function (itemdata) {\n                this.controls.yarncontainer = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_fiction_yarncontainer\");\n                this.controls.yarntext = this.controls.yarncontainer.find('.minilesson_fiction_yarntext');\n                this.controls.yarnmedia = this.controls.yarncontainer.find('.minilesson_fiction_yarnmedia');\n                this.controls.yarnoptions = this.controls.yarncontainer.find('.minilesson_fiction_yarnoptions');\n                this.controls.yarncontinuebutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_fiction_continuebutton\");\n                this.controls.chatwrapper = $(\"#\" + itemdata.uniqueid + \"_container .chat-wrapper\");\n                // To speed up rendering later prefetch some templates\n                Templates.prefetchTemplates(['mod_minilesson/fiction_playermessage']);\n            },\n\n\n            do_render: function (currentResult) {\n                var currentResult = this.runner.currentResult;\n                currentResult = this.add_metadata(currentResult);\n                log.debug('MiniLesson Fiction: doing render of currentResult');\n                log.debug(currentResult);\n\n                var that = this;\n                var yarncontent = {\n                    'yarntext': false,\n                    'yarnoptions': false\n                };\n\n                if (currentResult instanceof YarnBound.TextResult) {\n                    yarncontent.yarntext = currentResult;\n                    this.can_continuebutton(false);\n                    this.chatdata.picturesrc = yarncontent.yarntext.md?.character?.picturesrc;\n                    this.chatdata.charactername = yarncontent.yarntext.md?.character?.name;\n                    this.chatdata.charactertext = yarncontent.yarntext.text;\n\n                    Templates.render('mod_minilesson/fiction_charactermessage', {\n                        charactermedia: '<div class=\"chat-loader\"></div>'\n                    }).then(function (html, js) {\n                        Templates.appendNodeContents(that.controls.chatwrapper, html, js);\n                        that.scrolltobottom();\n                        setTimeout(() => {\n                            Templates.render('mod_minilesson/fiction_charactermessage', that.chatdata).then(\n                                function (html, js) {\n                                    Templates.replaceNode(\n                                        that.controls.chatwrapper.find('> .chat-window').last(),\n                                        html,\n                                        js\n                                    );\n                                    that.scrolltobottom();\n                                    that.reset_chat_data();\n                                    if (!currentResult.isDialogueEnd) {\n                                        that.can_continuebutton(true);\n                                    }\n                                }\n                            );\n                        }, 2000);\n                    });\n                    that.controls.yarnoptions.html('');\n                } else if (currentResult instanceof YarnBound.OptionsResult) {\n                    yarncontent.yarnoptions = currentResult;\n                    var chatdata = {\n                        'yarnoptions': currentResult,\n                        'presention_mobilechat': that.itemdata.presention_mobilechat,\n                        'presention_plain': that.itemdata.presention_plain,\n                    };\n                    that.controls.yarnoptions.html('');\n                    Templates.render('mod_minilesson/fictionyarnoptions', chatdata).then(\n                        function (html, js) {\n                            setTimeout(() => {\n                                that.controls.yarnoptions.html(html);\n                                Templates.runTemplateJS(js);\n                            }, 2000);\n                        });\n\n                    if ('text' in yarncontent.yarnoptions) {\n                        that.chatdata.picturesrc = yarncontent.yarnoptions.md?.character?.picturesrc;\n                        that.chatdata.charactername = yarncontent.yarnoptions.md?.character?.name;\n                        that.chatdata.charactertext = yarncontent.yarnoptions.text;\n\n                        Templates.render('mod_minilesson/fiction_charactermessage', {\n                            charactermedia: '<div class=\"chat-loader\"></div>'\n                        }).then(function (html, js) {\n                            Templates.appendNodeContents(that.controls.chatwrapper, html, js);\n                            that.scrolltobottom();\n                            setTimeout(() => {\n                                Templates.render('mod_minilesson/fiction_charactermessage', that.chatdata).then(\n                                    function (html, js) {\n                                        Templates.replaceNode(\n                                            that.controls.chatwrapper.find('> .chat-window').last(),\n                                            html,\n                                            js\n                                        );\n                                        that.scrolltobottom();\n                                        that.reset_chat_data();\n                                    }\n                                );\n                            }, 2000);\n                        });\n                    } else {\n                        that.controls.yarntext.html('');\n                    }\n                    that.can_continuebutton(false);\n\n                } else if (currentResult instanceof YarnBound.CommandResult) {\n                    // Process the command string a little. so we have command name and args\n                    //eg \"picture 1.png\"\n                    var rawCommand = currentResult.command;\n                    var parts = rawCommand.split(' ');\n                    var commandName = parts[0]; // \"picture\" \"audio etc\"\n                    var args = parts.slice(1); // [\"1.png\"]\n                    let promise = null;\n\n\n                    switch(commandName) {\n                        case 'picture': {\n                            log.debug('got picture command');\n                            const imageURL = args[0]; \n                            promise = Templates.render('mod_minilesson/fictionyarnimage', {\"imageurl\": imageURL}).then(\n                                function (html, js) {\n                                    that.controls.yarnmedia.html(html);\n                                    that.chatdata.charactermedia = html;\n                                    that.chatdata.classname = 'hasmedia';\n                                    Templates.runTemplateJS(js);\n                                });\n                            break;\n                        }\n                        case 'audio': {\n                            log.debug('got audio command');\n                            const audioURL = args[0]; \n                            promise = Templates.render('mod_minilesson/fictionyarnaudio', {\"audiourl\": audioURL}).then(\n                                function (html, js) {\n                                    that.chatdata.charactermedia = html;\n                                    that.chatdata.classname = 'hasmedia';\n                                    that.controls.yarnmedia.html(html);\n                                    Templates.runTemplateJS(js);\n                                });\n                            break;\n                        }\n                        case 'video': {\n                            log.debug('got video command');\n                            const videoURL = args[0];\n                            promise = Templates.render('mod_minilesson/fictionyarnvideo', {\"videourl\": videoURL}).then(\n                                function (html, js) {\n                                    that.chatdata.charactermedia = html;\n                                    that.chatdata.classname = 'hasmedia';\n                                    that.controls.yarnmedia.html(html);\n                                    Templates.runTemplateJS(js);\n                                });\n                            break;\n                        }\n                        case 'clearpicture': {\n                            that.controls.yarnmedia.html('');\n                            break;\n                        }\n                        case 'blahblah':\n                        default:\n                    }\n                    // In all cases just do command and then jump to next line\n                    if(!currentResult.isDialogueEnd) {\n                        // Just skip through for now\n                        if (promise) {\n                            promise.then(() => {\n                                that.do_runner_advance();\n                                that.do_render();\n                            });\n                        } else {\n                            that.do_runner_advance();\n                            that.do_render();\n                        }\n                    }\n                } else {\n                    log.debug('MiniLesson Fiction: unknown yarn result type');\n                }\n\n                // In all cases on dialog end there is no continue\n                if (currentResult.isDialogueEnd) {\n                    this.can_continuebutton(false);\n                }\n            },\n\n\n            do_runner_advance: function (steps) {\n                try {\n                    if(steps !== null){\n                        this.runner.advance(steps);\n                    } else {\n                        this.runner.advance();\n                    }\n                } catch (e) {\n                    var userFriendlyError = \"Yarn Parse Error: \" + e.message;\n                    this.controls.yarncontainer.html(\n                        `<div class=\"alert alert-danger\">${userFriendlyError}</div>`\n                    );\n                    log.error(\"Full Yarn Error:\");\n                    log.error(e);\n                }\n            },\n\n            can_continuebutton: function (cancontinue) {\n                this.controls.yarncontinuebutton.prop(\"disabled\", !cancontinue);\n                if (cancontinue){\n                    this.controls.yarncontinuebutton.show();\n                } else {\n                    this.controls.yarncontinuebutton.hide();\n                }\n            },\n\n            register_events: function (index, itemdata, quizhelper) {\n                var self = this;\n                //When click next button , report and leave it up to parent to eal with it.\n                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function () {\n                    var stepdata = {};\n                    stepdata.index = index;\n                    stepdata.hasgrade = false;\n                    stepdata.totalitems = 0;\n                    stepdata.correctitems = 0;\n                    stepdata.grade = 0;\n                    quizhelper.do_next(stepdata);\n                });\n                $(\"#\" + itemdata.uniqueid + \"_container\").on(\"showElement\", async () => {\n                    if (!self.instance) {\n                        // Maybe init yarn-bound here\n                        //this.do_render();\n                    }\n\n                    if (itemdata.timelimit > 0) {\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container\").show();\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container i\").show();\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                            height: '5px',\n                            timeLimit: itemdata.timelimit,\n                            onFinish: function () {\n                                $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").trigger('click');\n                            }\n                        });\n                    }\n                });\n\n\n                this.controls.yarncontinuebutton.on('click', function (e) {\n                    log.debug('MiniLesson Fiction: yarn continue button clicked');\n                    e.preventDefault();\n                    const playertext = $(this).text().trim();\n                    Templates.render('mod_minilesson/fiction_playermessage', {playertext: playertext}).then(\n                        function (html, js) {\n                            Templates.appendNodeContents(self.controls.chatwrapper, html, js);\n                            self.do_runner_advance();\n                            self.do_render();\n                        }\n                    );\n                   \n                });\n\n                // add an event listener for option buttons that handles option buttons added at runtime\n                this.controls.yarncontainer.on('click', '.minilesson_fiction_optionbutton', function (e) {\n                    log.debug('MiniLesson Fiction: yarn option button clicked');\n                    e.preventDefault();\n\n                    var buttons = self.controls.yarncontainer.find('.minilesson_fiction_optionbutton');\n                    var optionindex = buttons.index(this); // 0-based position in the rendered list\n                    const playertext = $(this).text().trim();\n                    Templates.render('mod_minilesson/fiction_playermessage', {playertext: playertext}).then(\n                        function (html, js) {\n                            Templates.appendNodeContents(self.controls.chatwrapper, html, js);\n                                self.do_runner_advance(optionindex);\n                                self.do_render();\n                        }\n                    );\n                });\n                \n                let scrollbtn = $(\"#\" + itemdata.uniqueid + \"_container #scroll-bottom-btn\");\n\n                this.controls.chatwrapper.on(\"scroll\", function() {\n                    const chatwrapper = self.controls.chatwrapper[0];\n                    const isatbottom = chatwrapper.scrollHeight - chatwrapper.scrollTop <= chatwrapper.clientHeight + 5;\n                    if (isatbottom) {\n                        scrollbtn.hide();\n                    } else {\n                        scrollbtn.show();\n                    }\n                });\n\n                scrollbtn.on('click', function(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    self.controls.chatwrapper.animate({\n                        scrollTop: self.controls.chatwrapper[0].scrollHeight\n                    }, 'smooth');\n                });\n                \n            },\n\n            add_metadata: function (currentthing) {\n                if (currentthing && 'markup' in currentthing && Array.isArray(currentthing.markup)) {\n                    currentthing.md = {};\n                    //for each markup entry, add the property name and values object to currentthing\n                    currentthing.markup.forEach(function (entry) {\n                        if ('properties' in entry && 'name' in entry) {\n                            currentthing.md[entry.name] = entry.properties;\n                        }\n                    });\n                    if (currentthing.md.character?.name) {\n                        const charname = currentthing.md.character.name.toLowerCase();\n                        currentthing.md.character.picturesrc = this.itemdata.filenamesmap\n                            .find(fileinfo => fileinfo.filekey === charname)?.fileurl || null;\n                    }\n                }\n                return currentthing;\n            },\n\n            register_previewbutton: function (buttonid) {\n                var previewbtn = document.getElementById(buttonid);\n                if (!previewbtn) {\n                    return;\n                }\n                previewbtn.addEventListener('click', function (e) {\n                    e.preventDefault();\n                    var form = previewbtn.form;\n                    if (!form) {\n                        return;\n                    }\n                    ModalFactory.create({\n                        type: ModalFactory.types.CANCEL,\n                        large: true,\n                        removeOnClose: true,\n                        templateContext: {\n                            classes: 'minilesson-fiction-preview-modal'\n                        },\n                        title: Str.get_string('fiction:previewmodaltitle', 'mod_minilesson'),\n                        body: Fragment.loadFragment('mod_minilesson', 'preview_fiction', M.cfg.contextid, {\n                            formdata: new URLSearchParams([...new FormData(form).entries()]).toString()\n                        })\n                    }).then(function (modal) {\n                        modal.getFooter().addClass('d-none');\n                        modal.show();\n                    });\n                    return;\n                });\n\n            },\n\n            reset_chat_data: function() {\n                this.chatdata = {\n                    charactername: null,\n                    charactermedia: null,\n                    charactertext: null,\n                    picturesrc: null,\n                    playertext: null,\n                };\n            },\n            scrolltobottom: function() {\n                if (!this.controls.chatwrapper.length) {\n                    return;\n                }\n                this.controls.chatwrapper.scrollTop(this.controls.chatwrapper[0].scrollHeight);\n                this.controls.chatwrapper.animate({\n                    scrollTop: this.controls.chatwrapper[0].scrollHeight + 5,\n                    behavior: 'smooth'\n                });\n            }\n        };\n    });"],"names":["define","$","log","def","YarnBound","Str","ModalFactory","Fragment","Templates","debug","runner","controls","itemdata","chatdata","clone","extend","this","init","index","quizhelper","prepare_html","register_events","presentationmode","presention_mobilechat","yarnopts","fictionyarn","do_render","e","userFriendlyError","message","yarncontainer","html","error","uniqueid","yarntext","find","yarnmedia","yarnoptions","yarncontinuebutton","chatwrapper","prefetchTemplates","currentResult","add_metadata","that","yarncontent","TextResult","can_continuebutton","picturesrc","md","_yarncontent$yarntext","character","_yarncontent$yarntext2","charactername","_yarncontent$yarntext3","_yarncontent$yarntext4","name","charactertext","text","render","charactermedia","then","js","appendNodeContents","scrolltobottom","setTimeout","replaceNode","last","reset_chat_data","isDialogueEnd","OptionsResult","presention_plain","runTemplateJS","_yarncontent$yarnopti","_yarncontent$yarnopti2","_yarncontent$yarnopti3","_yarncontent$yarnopti4","CommandResult","parts","command","split","commandName","args","slice","promise","imageURL","classname","audioURL","videoURL","do_runner_advance","steps","advance","cancontinue","prop","show","hide","self","on","stepdata","hasgrade","totalitems","correctitems","grade","do_next","async","instance","timelimit","progressTimer","height","timeLimit","onFinish","trigger","preventDefault","playertext","trim","optionindex","scrollbtn","scrollHeight","scrollTop","clientHeight","stopPropagation","animate","currentthing","Array","isArray","markup","forEach","entry","properties","_currentthing$md$char","charname","toLowerCase","filenamesmap","fileinfo","filekey","fileurl","register_previewbutton","buttonid","previewbtn","document","getElementById","addEventListener","form","create","type","types","CANCEL","large","removeOnClose","templateContext","classes","title","get_string","body","loadFragment","M","cfg","contextid","formdata","URLSearchParams","FormData","entries","toString","modal","getFooter","addClass","length","behavior"],"mappings":"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"}