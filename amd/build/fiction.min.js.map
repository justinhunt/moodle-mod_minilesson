{"version":3,"file":"fiction.min.js","sources":["../src/fiction.js"],"sourcesContent":["define([\n    'jquery',\n    'core/log',\n    'core/str',\n    'core/notification',\n    'mod_minilesson/definitions',\n    'mod_minilesson/yarn-bound',\n    'core/modal_factory',\n    'core/fragment',\n    'core/templates'\n], function ($, log, str, notification, def, YarnBound, ModalFactory, Fragment, Templates) {\n    \"use strict\"; // jshint ;_;\n\n    /**\n     * This file is to manage the fiction item type\n     */\n\n    log.debug('MiniLesson Fiction: initialising');\n\n    return {\n        runner: null,\n        controls: {},\n        itemdata: {},\n        chatdata: {},\n        storycomplete: false,\n        strings: {},\n        presentationmode: 'plain',\n        index: 0,\n        quizhelper: null,\n\n        // For making multiple instances\n        clone: function () {\n            return $.extend(true, {}, this);\n        },\n\n        /**\n         * Initialize the module\n         *\n         * @param {int} index\n         * @param {object} itemdata\n         * @param {object} quizhelper\n         */\n        init: function (index, itemdata, quizhelper) {\n            this.index = index;\n            this.itemdata = itemdata;\n            this.quizhelper = quizhelper;\n            this.init_strings();\n            this.prepare_html(itemdata);\n            this.register_events(this.index, itemdata, quizhelper);\n            this.presentationmode = itemdata.presention_mobilechat ? 'mobilechat' : 'plain';\n            var yarnopts = {\n                \"dialogue\": itemdata.fictionyarn,\n                \"combineTextAndOptionsResults\": true,\n                \"startAt\": \"Start\"\n            };\n            log.debug('MiniLesson Fiction: initializing yarnbound with options');\n            log.debug(yarnopts);\n            try {\n                this.runner = new YarnBound(yarnopts);\n                this.do_render();\n            } catch (e) {\n                var userFriendlyError = \"Yarn Parse Error: \" + e.message;\n                this.controls.yarncontainer.html(\n                    '<div class=\"alert alert-danger\">' + userFriendlyError + '</div>'\n                );\n                log.error(\"Full Yarn Error:\");\n                log.error(e);\n            }\n        },\n\n        /**\n         * Initialize strings\n         */\n        init_strings: function () {\n            var self = this;\n            str.get_strings([\n                {\n                    \"key\": \"nextlessonitem\",\n                    \"component\": 'mod_minilesson'\n                },\n                {\n                    \"key\": \"confirm_desc\",\n                    \"component\": 'mod_minilesson'\n                },\n                {\n                    \"key\": \"yes\",\n                    \"component\": 'moodle'\n                },\n                {\n                    \"key\": \"no\",\n                    \"component\": 'moodle'\n                },\n            ]).done(function (s) {\n                var i = 0;\n                self.strings.nextlessonitem = s[i++];\n                self.strings.confirm_desc = s[i++];\n                self.strings.yes = s[i++];\n                self.strings.no = s[i++];\n            });\n        },\n\n        /**\n         * Prepare HTML elements\n         *\n         * @param {object} itemdata\n         */\n        prepare_html: function (itemdata) {\n            this.controls.yarncontainer = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_fiction_yarncontainer\");\n            this.controls.yarntext = this.controls.yarncontainer.find('.minilesson_fiction_yarntext');\n            this.controls.yarnmedia = this.controls.yarncontainer.find('.minilesson_fiction_yarnmedia');\n            this.controls.yarnoptions = this.controls.yarncontainer.find('.minilesson_fiction_yarnoptions');\n            this.controls.yarncontinuebutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_fiction_continuebutton\");\n            this.controls.chatwrapper = $(\"#\" + itemdata.uniqueid + \"_container .chat-wrapper\");\n            // To speed up rendering later prefetch some templates\n            Templates.prefetchTemplates(['mod_minilesson/fiction_playermessage']);\n        },\n\n        /**\n         * Render the current content\n         *\n         * @param {object} currentResult\n         */\n        do_render: function (currentResult) {\n            currentResult = this.runner.currentResult;\n            currentResult = this.add_metadata(currentResult);\n            log.debug('MiniLesson Fiction: doing render of currentResult');\n            log.debug(currentResult);\n\n            var that = this;\n            var yarncontent = {\n                'yarntext': false,\n                'yarnoptions': false\n            };\n\n            if (currentResult instanceof YarnBound.TextResult) {\n                yarncontent.yarntext = currentResult;\n                this.can_continuebutton(false);\n                this.chatdata.picturesrc = yarncontent.yarntext.md?.character?.picturesrc;\n                this.chatdata.charactername = yarncontent.yarntext.md?.character?.name;\n                this.chatdata.charactertext = yarncontent.yarntext.text;\n\n                Templates.render('mod_minilesson/fiction_charactermessage', {\n                    charactermedia: '<div class=\"chat-loader\"></div>'\n                }).then(function (html, js) {\n                    Templates.appendNodeContents(that.controls.chatwrapper, html, js);\n                    that.scrolltobottom();\n                    setTimeout(() => {\n                        Templates.render('mod_minilesson/fiction_charactermessage', that.chatdata).then(\n                            function (html, js) {\n                                Templates.replaceNode(\n                                    that.controls.chatwrapper.find('> .chat-window').last(),\n                                    html,\n                                    js\n                                );\n                                that.scrolltobottom();\n                                that.reset_chat_data();\n                                if (!currentResult.isDialogueEnd) {\n                                    that.can_continuebutton(true);\n                                }\n                            }\n                        );\n                    }, 2000);\n                });\n                that.controls.yarnoptions.html('');\n            } else if (currentResult instanceof YarnBound.OptionsResult) {\n                yarncontent.yarnoptions = currentResult;\n                var chatdata = {\n                    'yarnoptions': currentResult,\n                    'presention_mobilechat': that.itemdata.presention_mobilechat,\n                    'presention_plain': that.itemdata.presention_plain,\n                };\n                that.controls.yarnoptions.html('');\n                Templates.render('mod_minilesson/fictionyarnoptions', chatdata).then(\n                    function (html, js) {\n                        setTimeout(() => {\n                            that.controls.yarnoptions.html(html);\n                            Templates.runTemplateJS(js);\n                        }, 2000);\n                    });\n\n                if ('text' in yarncontent.yarnoptions) {\n                    that.chatdata.picturesrc = yarncontent.yarnoptions.md?.character?.picturesrc;\n                    that.chatdata.charactername = yarncontent.yarnoptions.md?.character?.name;\n                    that.chatdata.charactertext = yarncontent.yarnoptions.text;\n\n                    Templates.render('mod_minilesson/fiction_charactermessage', {\n                        charactermedia: '<div class=\"chat-loader\"></div>'\n                    }).then(function (html, js) {\n                        Templates.appendNodeContents(that.controls.chatwrapper, html, js);\n                        that.scrolltobottom();\n                        setTimeout(() => {\n                            Templates.render('mod_minilesson/fiction_charactermessage', that.chatdata).then(\n                                function (html, js) {\n                                    Templates.replaceNode(\n                                        that.controls.chatwrapper.find('> .chat-window').last(),\n                                        html,\n                                        js\n                                    );\n                                    that.scrolltobottom();\n                                    that.reset_chat_data();\n                                }\n                            );\n                        }, 2000);\n                    });\n                } else {\n                    that.controls.yarntext.html('');\n                }\n                that.can_continuebutton(false);\n\n            } else if (currentResult instanceof YarnBound.CommandResult) {\n                // Process the command string a little. so we have command name and args\n                // eg \"picture 1.png\"\n                var rawCommand = currentResult.command;\n                var parts = rawCommand.split(' ');\n                var commandName = parts[0]; // \"picture\" \"audio etc\"\n                var args = parts.slice(1); // [\"1.png\"]\n                let promise = null;\n\n                switch (commandName) {\n                    case 'picture': {\n                        log.debug('got picture command');\n                        const imageURL = args[0];\n                        promise = Templates.render('mod_minilesson/fictionyarnimage', {\n                            \"imageurl\": imageURL\n                        }).then(\n                            function (html, js) {\n                                that.controls.yarnmedia.html(html);\n                                that.chatdata.charactermedia = html;\n                                that.chatdata.classname = 'hasmedia';\n                                Templates.runTemplateJS(js);\n                            });\n                        break;\n                    }\n                    case 'audio': {\n                        log.debug('got audio command');\n                        const audioURL = args[0];\n                        promise = Templates.render('mod_minilesson/fictionyarnaudio', {\n                            \"audiourl\": audioURL\n                        }).then(\n                            function (html, js) {\n                                that.chatdata.charactermedia = html;\n                                that.chatdata.classname = 'hasmedia';\n                                that.controls.yarnmedia.html(html);\n                                Templates.runTemplateJS(js);\n                            });\n                        break;\n                    }\n                    case 'video': {\n                        log.debug('got video command');\n                        const videoURL = args[0];\n                        promise = Templates.render('mod_minilesson/fictionyarnvideo', {\n                            \"videourl\": videoURL\n                        }).then(\n                            function (html, js) {\n                                that.chatdata.charactermedia = html;\n                                that.chatdata.classname = 'hasmedia';\n                                that.controls.yarnmedia.html(html);\n                                Templates.runTemplateJS(js);\n                            });\n                        break;\n                    }\n                    case 'clearpicture': {\n                        that.controls.yarnmedia.html('');\n                        break;\n                    }\n                    case 'blahblah':\n                    default:\n                }\n                // In all cases just do command and then jump to next line\n                if (!currentResult.isDialogueEnd) {\n                    // Just skip through for now\n                    if (promise) {\n                        promise.then(() => {\n                            that.do_runner_advance();\n                            that.do_render();\n                        });\n                    } else {\n                        that.do_runner_advance();\n                        that.do_render();\n                    }\n                }\n            } else {\n                log.debug('MiniLesson Fiction: unknown yarn result type');\n            }\n\n            // In all cases on dialog end there is no continue\n            if (currentResult.isDialogueEnd) {\n                this.can_continuebutton(false);\n                this.storycomplete = true;\n            }\n        },\n\n        /**\n         * Advance the yarn runner\n         *\n         * @param {int} steps\n         */\n        do_runner_advance: function (steps) {\n            try {\n                if (steps !== null) {\n                    this.runner.advance(steps);\n                } else {\n                    this.runner.advance();\n                }\n            } catch (e) {\n                var userFriendlyError = \"Yarn Parse Error: \" + e.message;\n                this.controls.yarncontainer.html(\n                    '<div class=\"alert alert-danger\">' + userFriendlyError + '</div>'\n                );\n                log.error(\"Full Yarn Error:\");\n                log.error(e);\n            }\n        },\n\n        /**\n         * Enable/disable continue button\n         *\n         * @param {bool} cancontinue\n         */\n        can_continuebutton: function (cancontinue) {\n            this.controls.yarncontinuebutton.prop(\"disabled\", !cancontinue);\n            if (cancontinue) {\n                this.controls.yarncontinuebutton.show();\n            } else {\n                this.controls.yarncontinuebutton.hide();\n            }\n        },\n\n        /**\n         * Move to next question\n         */\n        next_question: function () {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = false;\n            stepdata.totalitems = 0;\n            stepdata.correctitems = 0;\n            stepdata.grade = 0;\n            self.quizhelper.do_next(stepdata);\n        },\n\n        /**\n         * Register events\n         *\n         * @param {int} index\n         * @param {object} itemdata\n         * @param {object} quizhelper\n         */\n        register_events: function (index, itemdata, quizhelper) {\n            var self = this;\n            // When click next button, report and leave it up to parent to deal with it.\n            $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function () {\n                if (!self.storycomplete) {\n                    notification.confirm(self.strings.nextlessonitem,\n                        self.strings.confirm_desc,\n                        self.strings.yes,\n                        self.strings.no,\n                        function () {\n                            self.next_question();\n                        }\n                    );\n                } else {\n                    self.next_question();\n                }\n            });\n            $(\"#\" + itemdata.uniqueid + \"_container\").on(\"showElement\", async () => {\n                if (!self.instance) {\n                    // Maybe init yarn-bound here\n                    // this.do_render();\n                }\n\n                if (itemdata.timelimit > 0) {\n                    $(\"#\" + itemdata.uniqueid + \"_container .progress-container\").show();\n                    $(\"#\" + itemdata.uniqueid + \"_container .progress-container i\").show();\n                    $(\"#\" + itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                        height: '5px',\n                        timeLimit: itemdata.timelimit,\n                        onFinish: function () {\n                            $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").trigger('click');\n                        }\n                    });\n                }\n            });\n\n            this.controls.yarncontinuebutton.on('click', function (e) {\n                log.debug('MiniLesson Fiction: yarn continue button clicked');\n                e.preventDefault();\n                const playertext = $(this).text().trim();\n                Templates.render('mod_minilesson/fiction_playermessage', {\n                    playertext: playertext\n                }).then(\n                    function (html, js) {\n                        Templates.appendNodeContents(self.controls.chatwrapper, html, js);\n                        self.do_runner_advance();\n                        self.do_render();\n                    }\n                );\n\n            });\n\n            // Add an event listener for option buttons that handles option buttons added at runtime\n            this.controls.yarncontainer.on('click', '.minilesson_fiction_optionbutton', function (e) {\n                log.debug('MiniLesson Fiction: yarn option button clicked');\n                e.preventDefault();\n\n                var buttons = self.controls.yarncontainer.find('.minilesson_fiction_optionbutton');\n                var optionindex = buttons.index(this); // 0-based position in the rendered list\n                const playertext = $(this).text().trim();\n                Templates.render('mod_minilesson/fiction_playermessage', {\n                    playertext: playertext\n                }).then(\n                    function (html, js) {\n                        Templates.appendNodeContents(self.controls.chatwrapper, html, js);\n                        self.do_runner_advance(optionindex);\n                        self.do_render();\n                    }\n                );\n            });\n\n            let scrollbtn = $(\"#\" + itemdata.uniqueid + \"_container #scroll-bottom-btn\");\n\n            this.controls.chatwrapper.on(\"scroll\", function () {\n                const chatwrapper = self.controls.chatwrapper[0];\n                const isatbottom = chatwrapper.scrollHeight - chatwrapper.scrollTop <= chatwrapper.clientHeight + 5;\n                if (isatbottom) {\n                    scrollbtn.hide();\n                } else {\n                    scrollbtn.show();\n                }\n            });\n\n            scrollbtn.on('click', function (e) {\n                e.preventDefault();\n                e.stopPropagation();\n                self.controls.chatwrapper.animate({\n                    scrollTop: self.controls.chatwrapper[0].scrollHeight\n                }, 'smooth');\n            });\n        },\n\n        /**\n         * Add metadata to results\n         *\n         * @param {object} currentthing\n         */\n        add_metadata: function (currentthing) {\n            if (currentthing && 'markup' in currentthing && Array.isArray(currentthing.markup)) {\n                currentthing.md = {};\n                // For each markup entry, add the property name and values object to currentthing\n                currentthing.markup.forEach(function (entry) {\n                    if ('properties' in entry && 'name' in entry) {\n                        currentthing.md[entry.name] = entry.properties;\n                    }\n                });\n                if (currentthing.md.character?.name) {\n                    const charname = currentthing.md.character.name.toLowerCase();\n                    currentthing.md.character.picturesrc = this.itemdata.filenamesmap\n                        .find(fileinfo => fileinfo.filekey === charname)?.fileurl || null;\n                }\n            }\n            return currentthing;\n        },\n\n        /**\n         * Register preview button\n         *\n         * @param {string} buttonid\n         */\n        register_previewbutton: function (buttonid) {\n            var previewbtn = document.getElementById(buttonid);\n            if (!previewbtn) {\n                return;\n            }\n            previewbtn.addEventListener('click', function (e) {\n                e.preventDefault();\n                var form = previewbtn.form;\n                if (!form) {\n                    return;\n                }\n                ModalFactory.create({\n                    type: ModalFactory.types.CANCEL,\n                    large: true,\n                    removeOnClose: true,\n                    templateContext: {\n                        classes: 'minilesson-fiction-preview-modal'\n                    },\n                    title: str.get_string('fiction:previewmodaltitle', 'mod_minilesson'),\n                    body: Fragment.loadFragment('mod_minilesson', 'preview_fiction', M.cfg.contextid, {\n                        formdata: new URLSearchParams([...new FormData(form).entries()]).toString()\n                    })\n                }).then(function (modal) {\n                    modal.getFooter().addClass('d-none');\n                    modal.show();\n                });\n                return;\n            });\n\n        },\n\n        reset_chat_data: function () {\n            this.chatdata = {\n                charactername: null,\n                charactermedia: null,\n                charactertext: null,\n                picturesrc: null,\n                playertext: null,\n            };\n        },\n\n        scrolltobottom: function () {\n            if (!this.controls.chatwrapper.length) {\n                return;\n            }\n            this.controls.chatwrapper.scrollTop(this.controls.chatwrapper[0].scrollHeight);\n            this.controls.chatwrapper.animate({\n                scrollTop: this.controls.chatwrapper[0].scrollHeight + 5,\n                behavior: 'smooth'\n            });\n        }\n    };\n});"],"names":["define","$","log","str","notification","def","YarnBound","ModalFactory","Fragment","Templates","debug","runner","controls","itemdata","chatdata","storycomplete","strings","presentationmode","index","quizhelper","clone","extend","this","init","init_strings","prepare_html","register_events","presention_mobilechat","yarnopts","fictionyarn","do_render","e","userFriendlyError","message","yarncontainer","html","error","self","get_strings","done","s","i","nextlessonitem","confirm_desc","yes","no","uniqueid","yarntext","find","yarnmedia","yarnoptions","yarncontinuebutton","chatwrapper","prefetchTemplates","currentResult","add_metadata","that","yarncontent","TextResult","can_continuebutton","picturesrc","md","_yarncontent$yarntext","character","_yarncontent$yarntext2","charactername","_yarncontent$yarntext3","_yarncontent$yarntext4","name","charactertext","text","render","charactermedia","then","js","appendNodeContents","scrolltobottom","setTimeout","replaceNode","last","reset_chat_data","isDialogueEnd","OptionsResult","presention_plain","runTemplateJS","_yarncontent$yarnopti","_yarncontent$yarnopti2","_yarncontent$yarnopti3","_yarncontent$yarnopti4","CommandResult","parts","command","split","commandName","args","slice","promise","imageURL","classname","audioURL","videoURL","do_runner_advance","steps","advance","cancontinue","prop","show","hide","next_question","stepdata","hasgrade","totalitems","correctitems","grade","do_next","on","confirm","async","instance","timelimit","progressTimer","height","timeLimit","onFinish","trigger","preventDefault","playertext","trim","optionindex","scrollbtn","scrollHeight","scrollTop","clientHeight","stopPropagation","animate","currentthing","Array","isArray","markup","forEach","entry","properties","_currentthing$md$char","charname","toLowerCase","filenamesmap","fileinfo","filekey","fileurl","register_previewbutton","buttonid","previewbtn","document","getElementById","addEventListener","form","create","type","types","CANCEL","large","removeOnClose","templateContext","classes","title","get_string","body","loadFragment","M","cfg","contextid","formdata","URLSearchParams","FormData","entries","toString","modal","getFooter","addClass","length","behavior"],"mappings":"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"}