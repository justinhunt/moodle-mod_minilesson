define("mod_minilesson/wordshuffle",["jquery","core/log","core/ajax","mod_minilesson/definitions","mod_minilesson/pollyhelper","mod_minilesson/animatecss","mod_minilesson/progresstimer","core/templates"],(function($,log,ajax,def,polly,anim,progresstimer,templates){return log.debug("MiniLesson wordshuffle: initialising"),{clone:function(){return $.extend(!0,{},this)},usevoice:"Amy",init:function(index,itemdata,quizhelper){this.itemdata=itemdata,this.quizhelper=quizhelper,this.index=index;var animopts={};animopts.useanimatecss=quizhelper.useanimatecss,anim.init(animopts),this.init_controls(),this.register_events(),this.setvoice(),this.getItems()},init_controls:function(){this.controls={container:$("#"+this.itemdata.uniqueid+"_container"),listen_cont:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_listen_cont"),nextbutton:$("#"+this.itemdata.uniqueid+"_container .minilesson_nextbutton"),start_btn:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_start_btn"),skip_btn:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_skip_btn"),ctrl_btn:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_ctrl-btn"),check_btn:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_check_btn"),game:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_game"),controlsbox:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_controls"),resultscontainer:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_resultscontainer"),mainmenu:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_mainmenu"),title:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_title"),progress_container:$("#"+this.itemdata.uniqueid+"_container .progress-container"),progress_bar:$("#"+this.itemdata.uniqueid+"_container .progress-container .progress-bar"),question:$("#"+this.itemdata.uniqueid+"_container .question"),listen_btn:$("#"+this.itemdata.uniqueid+"_container .wordshuffle_listen_btn")}},next_question:function(){var stepdata={};stepdata.index=this.index,stepdata.hasgrade=!0,stepdata.totalitems=this.items.length,stepdata.correctitems=this.items.filter((function(e){return e.correct})).length,stepdata.grade=Math.round(stepdata.correctitems/stepdata.totalitems*100),this.stop_audio(),this.quizhelper.do_next(stepdata)},show_item_review:function(){var review_data={};review_data.items=this.items,review_data.totalitems=this.items.length,review_data.correctitems=this.items.filter((function(e){return e.correct})).length;var listencont=this.controls.listen_cont,qbox=this.controls.question,gamebox=this.controls.game,controlsbox=this.controls.controlsbox,resultsbox=this.controls.resultscontainer;templates.render("mod_minilesson/listitemresults",review_data).then((function(html,js){resultsbox.html(html),resultsbox.show(),gamebox.hide(),controlsbox.hide(),listencont.hide(),qbox.hide(),templates.runTemplateJS(js)}))},register_events:function(){var self=this;self.controls.nextbutton.on("click",(function(e){self.next_question()})),self.controls.start_btn.on("click",(function(){self.start()}));var audioplayerbtn=self.controls.listen_btn;audioplayerbtn.on("click",(function(){var theaudio=self.items[self.game.pointer].audio;if(!theaudio.paused)return theaudio.pause(),theaudio.currentTime=0,$(audioplayerbtn).children(".fa").removeClass("fa-stop"),void $(audioplayerbtn).children(".fa").addClass("fa-volume-up");theaudio.addEventListener("ended",(function(){$(audioplayerbtn).children(".fa").removeClass("fa-stop"),$(audioplayerbtn).children(".fa").addClass("fa-volume-up")})),theaudio.addEventListener("play",(function(){$(audioplayerbtn).children(".fa").removeClass("fa-volume-up"),$(audioplayerbtn).children(".fa").addClass("fa-stop")})),theaudio.load(),theaudio.play()})),self.controls.container.on("keydown",".single-character",(function(e){32==e.which&&(e.preventDefault(),audioplayerbtn.trigger("click"))})),self.controls.skip_btn.on("click",(function(){self.controls.ctrl_btn.prop("disabled",!0),self.controls.container.find(".wordshuffle_speech.wordshuffle_teacher_left").text(self.items[self.game.pointer].prompt+""),self.controls.container.find(".wordshuffle_targetWord").each((function(){var realidx=$(this).data("realidx"),wordshuffle_targetWord=self.items[self.game.pointer].wordshuffle_targetWords[realidx];$(this).val(wordshuffle_targetWord)})),self.stopTimer(self.items[self.game.pointer].timer),self.items[self.game.pointer].answered=!0,self.items[self.game.pointer].correct=!1,self.game.pointer<self.items.length-1?setTimeout((function(){self.controls.container.find(".wordshuffle_reply_"+self.game.pointer).hide(),self.game.pointer++,self.nextPrompt()}),2e3):self.end()})),self.controls.check_btn.on("click",(function(){self.check_answer()}))},game:{pointer:0},check_answer:function(){},setvoice:function(){this.usevoice=this.itemdata.usevoice,this.voiceoption=this.itemdata.voiceoption},getItems:function(){var text_items=this.itemdata.sentences;this.items=text_items.map((function(target){return{target:target.sentence,timer:[],answered:!1,correct:!1,audio:null,audiourl:target.audiourl?target.audiourl:"",imageurl:target.imageurl}})).filter((function(e){return""!==e.target})),$.each(this.items,(function(index,item){item.audio=new Audio,item.audio.src=item.audiourl})),this.appReady()},appReady:function(){this.controls.container.find(".wordshuffle_not_loaded").hide(),this.controls.container.find(".wordshuffle_loaded").show(),this.itemdata.hidestartpage?this.start():this.controls.start_btn.prop("disabled",!1)},gotComparison:function(comparison){var self=this;log.debug("gotComparison",comparison);var timelimit_progressbar=self.controls.progress_bar;if(comparison)log.debug("correct!!");else{if(self.itemdata.allowretry&&!timelimit_progressbar.hasClass("progress-bar-complete"))return void log.debug("incorrect!! retry");log.debug("incorrect")}self.stopTimer(self.items[self.game.pointer].timer),self.game.pointer<self.items.length-1?setTimeout((function(){self.controls.container.find(".wordshuffle_reply_"+self.game.pointer).hide(),self.game.pointer++,self.nextPrompt()}),2e3):self.end()},end:function(){var self=this;self.controls.nextbutton.prop("disabled",!0),self.updateProgressDots(),setTimeout((function(){self.controls.nextbutton.prop("disabled",!1),self.quizhelper.showitemreview?self.show_item_review():self.next_question()}),2e3)},start:function(){this.controls.ctrl_btn.prop("disabled",!0),this.items.forEach((function(item){item.spoken="",item.answered=!1,item.correct=!1})),this.game.pointer=0,this.controls.listen_cont.show(),this.controls.question.show(),this.controls.game.show(),this.controls.start_btn.hide(),this.controls.mainmenu.hide(),this.controls.controlsbox.show(),this.nextPrompt()},nextPrompt:function(){var self=this;self.controls.ctrl_btn.prop("disabled",!1),self.updateProgressDots(),self.nextReply(),null===self.items[self.game.pointer].audio||self.quizhelper.mobile_user()||(self.itemdata.hidestartpage&&0===self.game.pointer?self.controls.container.on("showElement",(()=>{setTimeout((function(){self.controls.listen_btn.trigger("click")}),1e3)})):setTimeout((function(){self.controls.listen_btn.trigger("click")}),1e3))},updateProgressDots:function(){var color,self=this,progress=self.items.map((function(item,idx){return color="gray",self.items[idx].answered&&self.items[idx].correct?color="green":self.items[idx].answered&&!self.items[idx].correct&&(color="red"),"<i style='color:"+color+"' class='fa fa-circle'></i>"})).join(" ");self.controls.title.html(progress)},nextReply:function(){var code="<div class='wordshuffle_reply wordshuffle_reply_"+this.game.pointer+" text-center' style='display:none;'>";code+="<div class='form-container'>",code+=" <i data-idx='"+this.game.pointer+"' class='wordshuffle_feedback'></i></div>",this.items[this.game.pointer].imageurl&&(code+="<div class='minilesson_sentence_image'><div class='minilesson_padded_image'><img src='"+this.items[this.game.pointer].imageurl+"' alt='Image for gap fill' /></div></div>"),this.items[this.game.pointer].definition&&(code+="<div class='definition-container'><div class='definition'>"+this.items[this.game.pointer].definition+"</div>"),code+="</div>",code+="</div>",this.controls.question.append(code);var newreply=this.controls.container.find(".wordshuffle_reply_"+this.game.pointer);anim.do_animate(newreply,"zoomIn animate__faster","in").then((function(){})),this.controls.ctrl_btn.prop("disabled",!1),this.startTimer()},startTimer:function(){var self=this;if(self.itemdata.timelimit>0){var doStartTimer=function(){self.controls.progress_container.show(),self.controls.progress_container.find("i").show(),self.controls.progress_container.find("#progresstimer").progressTimer({height:"5px",timeLimit:self.itemdata.timelimit,onFinish:function(){self.controls.skip_btn.trigger("click")}}).each((function(){self.items[self.game.pointer].timer.push($(this).attr("timer"))}))};self.itemdata.hidestartpage&&0===self.game.pointer?self.controls.container.on("showElement",(()=>{doStartTimer()})):doStartTimer()}},stopTimer:function(timers){timers.length&&timers.forEach((function(timer){clearInterval(timer)}))},stop_audio:function(){var theaudio=this.items[this.game.pointer].audio;theaudio&&!theaudio.paused&&theaudio.pause()}}}));

//# sourceMappingURL=wordshuffle.min.js.map