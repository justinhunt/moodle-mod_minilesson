function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("mod_minilesson/wordshuffle",["jquery","core/log","core/ajax","mod_minilesson/definitions","mod_minilesson/pollyhelper","mod_minilesson/animatecss","mod_minilesson/progresstimer","core/templates","core/notification","core/str"],function(a,b,c,d,e,f,g,h,i,j){"use strict";b.debug("MiniLesson wordshuffle: initialising");return{strings:{},clone:function clone(){return a.extend(!0,{},this)},usevoice:"Amy",pointerdiv:null,init:function init(a,b,c){var d=this;d.itemdata=b;d.itemdata.hidestartpage=!0;d.quizhelper=c;d.index=a;var e={useanimatecss:c.useanimatecss};f.init(e);d.init_strings();d.init_controls();d.register_events();d.setvoice();d.getItems();d.start()},init_controls:function init_controls(){var b=this,c=a("#"+b.itemdata.uniqueid+"_container");b.controls={container:c,listen_cont:c.find(".wordshuffle_listen_cont"),nextbutton:c.find(".minilesson_nextbutton"),start_btn:c.find(".wordshuffle_start_btn"),skip_btn:c.find(".wordshuffle_skip_btn"),ctrl_btn:c.find(".wordshuffle_ctrl-btn"),check_btn:c.find(".wordshuffle_check_btn"),game:c.find(".wordshuffle_game"),controlsbox:c.find(".wordshuffle_controls"),resultscontainer:c.find(".wordshuffle_resultscontainer"),mainmenu:c.find(".wordshuffle_mainmenu"),title:c.find(".wordshuffle_title"),progress_container:c.find(".progress-container"),progress_bar:c.find(".progress-container .progress-bar"),question:c.find(".question"),listen_btn:c.find(".wordshuffle_listen_btn"),retry_btn:c.find(".wordshuffle_retry_btn")}},init_strings:function init_strings(){var a=this;j.get_strings([{key:"nextlessonitem",component:"mod_minilesson"},{key:"confirm_desc",component:"mod_minilesson"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(b){var c=0;a.strings.nextlessonitem=b[c++];a.strings.confirm_desc=b[c++];a.strings.yes=b[c++];a.strings.no=b[c++]})},next_question:function next_question(){var a=this,b={};b.index=a.index;b.hasgrade=!0;b.totalitems=a.items.length;b.correctitems=a.items.filter(function(a){return a.correct}).length;b.grade=Math.round(100*(b.correctitems/b.totalitems));a.stop_audio();a.quizhelper.do_next(b)},show_item_review:function show_item_review(){var a=this,b={};b.items=a.items;b.totalitems=a.items.length;b.correctitems=a.items.filter(function(a){return a.correct}).length;var c=a.controls.listen_cont,d=a.controls.question,e=a.controls.game,f=a.controls.controlsbox,g=a.controls.resultscontainer;h.render("mod_minilesson/listitemresults",b).then(function(a,b){g.html(a);g.show();e.hide();f.hide();c.hide();d.hide();h.runTemplateJS(b)})},register_events:function register_events(){var b=this;b.controls.nextbutton.on("click",function(){if(b.items.some(function(a){return!a.answered})){i.confirm(b.strings.nextlessonitem,b.strings.confirm_desc,b.strings.yes,b.strings.no,function(){b.next_question()})}else{b.next_question()}});b.controls.start_btn.on("click",function(){b.start()});var c=b.controls.listen_btn;c.on("click",function(){var d=b.items[b.game.pointer].audio;if(!d.paused){d.pause();d.currentTime=0;a(c).children(".fa").removeClass("fa-stop");a(c).children(".fa").addClass("fa-volume-up");return}d.addEventListener("ended",function(){a(c).children(".fa").removeClass("fa-stop");a(c).children(".fa").addClass("fa-volume-up")});d.addEventListener("play",function(){a(c).children(".fa").removeClass("fa-volume-up");a(c).children(".fa").addClass("fa-stop")});d.load();d.play()});b.controls.skip_btn.on("click",function(){b.controls.ctrl_btn.prop("disabled",!0);b.controls.container.find(".wordshuffle_speech.wordshuffle_teacher_left").text(b.items[b.game.pointer].prompt+"");b.controls.container.find(".wordshuffle_targetWord").each(function(){var c=a(this).data("realidx"),d=b.items[b.game.pointer].wordshuffle_targetWords[c];a(this).val(d)});b.stopTimer(b.items[b.game.pointer].timer);b.items[b.game.pointer].answered=!0;b.items[b.game.pointer].correct=!1;if(b.game.pointer<b.items.length-1){setTimeout(function(){b.controls.container.find(".wordshuffle_reply_"+b.game.pointer).hide();b.game.pointer++;b.nextPrompt()},2e3)}else{b.end()}});b.controls.check_btn.on("click",function(){b.pointerdiv.find(".drop-slot .word").each(function(){b.placeInBank(a(this))});b.clearPerSlotFeedback();b.controls.retry_btn.hide();b.items[b.game.pointer].answered=!1;b.items[b.game.pointer].correct=!1});b.controls.retry_btn.on("click",function(){b.pointerdiv.find(".drop-slot .word").each(function(){b.placeInBank(a(this))});b.clearPerSlotFeedback();b.controls.retry_btn.hide();b.controls.check_btn.show();b.items[b.game.pointer].answered=!1;b.items[b.game.pointer].correct=!1})},game:{pointer:0},check_answer:function check_answer(){var a=this;if(a.itemdata.allowretry&&!a.items[a.game.pointer].correct){a.controls.retry_btn.show();a.controls.check_btn.hide()}else{setTimeout(function(){return a.gotComparison(!0)},2e3)}},setvoice:function setvoice(){var a=this;a.usevoice=a.itemdata.usevoice;a.voiceoption=a.itemdata.voiceoption},getItems:function getItems(){var b=this,c=b.itemdata.sentences;b.items=c.map(function(a){return{target:a.sentenceclean,timer:[],answered:!1,correct:!1,audio:null,audiourl:a.audiourl?a.audiourl:"",imageurl:a.imageurl}}).filter(function(a){return""!==a.target});if(b.itemdata.audiocontent){a.each(b.items,function(a,b){b.audio=new Audio;b.audio.src=b.audiourl});b.appReady()}else{b.appReady()}},appReady:function appReady(){var a=this;a.controls.container.find(".wordshuffle_not_loaded").hide();a.controls.container.find(".wordshuffle_loaded").show();if(a.itemdata.hidestartpage){a.start()}else{a.controls.start_btn.prop("disabled",!1)}},gotComparison:function gotComparison(a){var c=this;b.debug("gotComparison",a);var d=c.controls.progress_bar;if(a){b.debug("correct!!")}else if(!c.itemdata.allowretry||d.hasClass("progress-bar-complete")){b.debug("incorrect")}else{b.debug("incorrect!! retry");return}c.stopTimer(c.items[c.game.pointer].timer);if(c.game.pointer<c.items.length-1){setTimeout(function(){c.controls.container.find(".wordshuffle_reply_"+c.game.pointer).hide();c.game.pointer++;c.nextPrompt()},2e3)}else{c.end()}},end:function end(){var a=this;a.controls.nextbutton.prop("disabled",!0);a.updateProgressDots();setTimeout(function(){a.controls.nextbutton.prop("disabled",!1);if(a.quizhelper.showitemreview){a.show_item_review()}else{a.next_question()}},2e3)},start:function start(){var a=this;a.controls.ctrl_btn.prop("disabled",!0);a.items.forEach(function(a){a.spoken="";a.answered=!1;a.correct=!1});a.game.pointer=0;a.controls.listen_cont.show();a.controls.question.show();a.controls.game.show();a.controls.start_btn.hide();a.controls.mainmenu.hide();a.controls.controlsbox.show();a.nextPrompt()},nextPrompt:function nextPrompt(){var a=this;a.pointerdiv=a.controls.question.find(".wordshuffle_wordset_container[data-index=\"".concat(a.game.pointer,"\"]"));a.controls.retry_btn.hide();a.controls.check_btn.show();a.controls.ctrl_btn.prop("disabled",!1);a.updateProgressDots();a.showNextWordSet();if(null!==a.items[a.game.pointer].audio&&!a.quizhelper.mobile_user()){if(a.itemdata.hidestartpage&&0===a.game.pointer){a.controls.container.on("showElement",function(){setTimeout(function(){a.controls.listen_btn.trigger("click")},1e3)})}else{setTimeout(function(){a.controls.listen_btn.trigger("click")},1e3)}}},updateProgressDots:function updateProgressDots(){var a=this,b,c=a.items.map(function(c,d){b="gray";if(a.items[d].answered&&a.items[d].correct){b="green"}else if(a.items[d].answered&&!a.items[d].correct){b="red"}return"<i style='color:"+b+"' class='fa fa-circle'></i>"}).join(" ");a.controls.title.html(c)},showNextWordSet:function showNextWordSet(){var a=this;a.controls.container.find(".wordshuffle_wordset_container").hide();var b=a.controls.container.find(".wordshuffle_wordset_"+a.game.pointer);f.do_animate(b,"zoomIn animate__faster","in").then(function(){});a.controls.ctrl_btn.prop("disabled",!1);a.startTimer();a.makeDragZones()},getSlotWords:function getSlotWords(){var b=this;return b.pointerdiv.find(".drop-slot").map(function(){var b=a(this).find(".word").first().text().trim();return b||""}).get()},allFilled:function allFilled(){var a=this;return a.getSlotWords().every(Boolean)},clearPerSlotFeedback:function clearPerSlotFeedback(){var b=this;b.pointerdiv.find(".drop-slot").removeClass("border-success border-danger").addClass("border-secondary-subtle");b.pointerdiv.find("[id^='fb-']").each(function(){a(this).removeClass("text-success text-danger").addClass("text-muted").html("&nbsp;")})},setPerSlotFeedback:function setPerSlotFeedback(){var a=this,b=a.getSlotWords(),c=a.expectedAnswers(),d=[].concat(_toConsumableArray(a.fixedWords()),_toConsumableArray(c));b.forEach(function(b,d){var e=b===c[d],f=a.pointerdiv.find(".drop-slot[data-index='"+d+"']"),g=a.pointerdiv.find("#fb-"+d);f.removeClass("border-secondary-subtle border-success border-danger").addClass(e?"border-success":"border-danger");g.removeClass("text-muted text-success text-danger").addClass(e?"text-success":"text-danger").text(e?"Correct":"Wrong")});var e=[].concat(_toConsumableArray(a.fixedWords()),_toConsumableArray(a.getSlotWords()));a.items[a.game.pointer].answered=b.some(Boolean);a.items[a.game.pointer].correct=e.join(" ")===d.join(" ")},evaluateIfComplete:function evaluateIfComplete(){var a=this;if(a.allFilled()){a.controls.check_btn.hide();a.controls.skip_btn.prop("disabled",!0);a.controls.retry_btn.prop("disabled",!0);a.setPerSlotFeedback();a.check_answer();a.items[a.game.pointer].answered=!0}else{a.controls.check_btn.show();a.clearPerSlotFeedback()}},moveToSlot:function moveToSlot(a,b){var c=this;a.detach().css({top:0,left:0,position:"relative"}).appendTo(b);c.evaluateIfComplete()},placeInBank:function placeInBank(a){var b=this;a.detach().css({top:0,left:0,position:"relative"}).appendTo(b.pointerdiv.find(".word-bank"));b.evaluateIfComplete()},gapWords:function gapWords(){var a=this;return a.itemdata.sentences[a.game.pointer].gapwords},fixedWords:function fixedWords(){var a=this;return a.gapWords().filter(function(a){return!1===a.isgap}).map(function(a){return a.word})},expectedAnswers:function expectedAnswers(){var a=this;return a.gapWords().filter(function(a){return!0===a.isgap}).map(function(a){return a.word})},selectedWord:null,makeDragZones:function makeDragZones(){var b=this;if(!b.pointerdiv.attr("data-initialized")){b.pointerdiv.on("click",function(c){var d=a(c.target);if(d.is(".word")){if(!b.selectedWord||!b.selectedWord.is(d)){b.selectedWord=d}else{b.selectedWord=null}}else if(d.is(".word-bank")){if(b.selectedWord){if(b.selectedWord.parent(".drop-slot")){b.placeInBank(b.selectedWord)}b.selectedWord=null}}else if(d.is(".drop-slot")){if(b.selectedWord){b.moveToSlot(b.selectedWord,d);b.selectedWord=null}}b.highlightDropZones()});b.pointerdiv.on("keydown",function(c){if(" "===c.key||"Spacebar"===c.key){var d=a(document.activeElement);if(d.is(".word")){if(!b.selectedWord||!b.selectedWord.is(d)){b.selectedWord=d}else{b.selectedWord=null}}else if(d.is(".word-bank")){if(b.selectedWord){if(b.selectedWord.parent(".drop-slot")){b.placeInBank(b.selectedWord)}b.selectedWord=null}}else if(d.is(".drop-slot")){if(b.selectedWord){b.moveToSlot(b.selectedWord,d);b.selectedWord=null}}b.highlightDropZones();c.preventDefault()}});b.pointerdiv.attr("data-initialized",1)}},highlightDropZones:function highlightDropZones(){var b=this,c=b.pointerdiv.find(".drop-slot").removeClass("ml_ws_highlight").removeAttr("tabindex");b.pointerdiv.find(".word").removeClass("ml_ws_highlight");b.pointerdiv.find(".word-bank").removeClass("ml_ws_highlight").removeAttr("tabindex");if(b.selectedWord){if(!b.selectedWord.parent(".word-bank").length){b.pointerdiv.find(".word-bank").addClass("ml_ws_highlight").attr("tabindex",0)}c.filter(function(b,c){if(!c.querySelector(".word")){a(c).addClass("ml_ws_highlight");a(c).attr("tabindex",0);return!0}return!1});b.selectedWord.addClass("ml_ws_highlight")}},startTimer:function startTimer(){var b=this;if(0<b.itemdata.timelimit){var c=function(){b.controls.progress_container.show();b.controls.progress_container.find("i").show();var c=b.controls.progress_container.find("#progresstimer").progressTimer({height:"5px",timeLimit:b.itemdata.timelimit,onFinish:function onFinish(){b.controls.skip_btn.trigger("click")}});c.each(function(){b.items[b.game.pointer].timer.push(a(this).attr("timer"))})};if(b.itemdata.hidestartpage&&0===b.game.pointer){b.controls.container.on("showElement",function(){c()})}else{c()}}},stopTimer:function stopTimer(a){if(a.length){a.forEach(function(a){clearInterval(a)})}},stop_audio:function stop_audio(){var a=this,b=a.items[a.game.pointer].audio;if(b&&!b.paused){b.pause()}}}});
//# sourceMappingURL=wordshuffle.min.js.map
