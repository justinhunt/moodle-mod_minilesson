{"version":3,"sources":["../src/speechcards.js"],"names":["define","$","log","Ajax","def","polly","ttrecorder","anim","str","notification","debug","clone","extend","init","index","itemdata","quizhelper","init_app","console","app","passmark","pointer","jsondata","props","dryRun","language","terms","phonetics","displayterms","results","controls","ttrec","strings","i","sentences","length","sentence","phonetic","prompt","animopts","useanimatecss","init_controls","init_strings","initComponents","register_events","star_rating","uniqueid","next_button","slider","get_strings","done","s","nextlessonitem","confirm_desc","yes","no","next_question","stepdata","hasgrade","totalitems","correctitems","filter","e","points","grade","Math","round","do_next","on","confirm","click","check","is_end","setTimeout","do_end","prop","children","removeClass","addClass","opts","callback","theCallback","message","type","speechtext","capturedspeech","spoken_clean","cleanText","correct_clean","correctphonetic","similarity_js","similarity","wordsDoMatch","showStarRating","flagCorrectAndTransition","checkByPhonetic","then","similarity_php","Deferred","reject","max","stt_guided","is_stt_guided","currentPrompt","progress_dots","initSlider","text","show","writeCurrentTerm","do_animate","phraseheard","currentphrase","stars","code","forEach","star","html","correct","result","push","clearStarRating","use_ttrecorder","color","o"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'mod_minilesson/definitions',\n    'mod_minilesson/pollyhelper',\n    'mod_minilesson/ttrecorder',\n    'mod_minilesson/animatecss',\n    'core/str',\n    'core/notification'\n], function($,  log, Ajax, def, polly, ttrecorder, anim,str,notification) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('MiniLesson Speechcards: initialising');\n\n  return {\n\n    //for making multiple instances\n    clone: function () {\n        return $.extend(true, {}, this);\n    },\n\n    init: function(index, itemdata, quizhelper) {\n\n      this.init_app(index, itemdata, quizhelper);\n    },\n\n    init_app: function(index, itemdata, quizhelper) {\n\n      console.log(itemdata);\n\n      var app = {\n        passmark: 90,\n        pointer: 1,\n        jsondata: null,\n        props: null,\n        dryRun: false,\n        language: 'en-US',\n        terms: [],\n        phonetics: [],\n        displayterms: [],\n        results: [],\n        controls: {},\n        ttrec: null, //a handle on the tt recorder\n        strings: {},\n\n        init: function() {\n\n          //init terms\n          for (var i = 0; i < itemdata.sentences.length; i++) {\n            app.terms[i] = itemdata.sentences[i].sentence;\n            app.phonetics[i] = itemdata.sentences[i].phonetic;\n            app.displayterms[i] = itemdata.sentences[i].prompt;\n          }\n          app.language = itemdata.language;\n\n         //anim\n          var animopts = {};\n          animopts.useanimatecss=quizhelper.useanimatecss;\n          anim.init(animopts);\n\n          this.init_controls();\n          this.init_strings();\n          this.initComponents();\n          this.register_events();\n        },\n\n        init_controls: function() {\n          app.controls = {};\n          app.controls.star_rating = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_star_rating\");\n          app.controls.next_button = $(\"#\" + itemdata.uniqueid + \"_container .minilesson-speechcards_nextbutton\");\n          app.controls.slider = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_speechcards_target_phrase\");\n        },\n        init_strings: function() {\n            var app = this;\n            str.get_strings([\n                { \"key\": \"nextlessonitem\", \"component\": 'mod_minilesson'},\n                { \"key\": \"confirm_desc\", \"component\": 'mod_minilesson'},\n                { \"key\": \"yes\", \"component\": 'moodle'},\n                { \"key\": \"no\", \"component\": 'moodle'},\n            ]).done(function (s) {\n                var i = 0;\n                app.strings.nextlessonitem = s[i++];\n                app.strings.confirm_desc = s[i++];\n                app.strings.yes = s[i++];\n                app.strings.no = s[i++];\n            });\n        },\n        next_question: function() {\n          var stepdata = {};\n          stepdata.index = index;\n          stepdata.hasgrade = true;\n          stepdata.totalitems = app.terms.length;\n          stepdata.correctitems = app.results.filter(function(e){return e.points>0;}).length;\n          stepdata.grade = Math.round((stepdata.correctitems/stepdata.totalitems)*100);\n          quizhelper.do_next(stepdata);\n        },\n        register_events: function() {\n\n          $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n            if (app.results.length <= app.terms.length) {\n              notification.confirm(app.strings.nextlessonitem,\n                  app.strings.confirm_desc,\n                  app.strings.yes,\n                  app.strings.no,\n                  function() {\n                      app.next_question();\n                  }\n              );\n            } else {\n                app.next_question();\n            }\n          });\n\n          app.controls.next_button.click(function() {\n            //user has given up ,update word as failed\n            app.check(false);\n\n            //transition if required\n            if (app.is_end()) {\n              setTimeout(function() {\n                app.do_end();\n              }, 200);\n            } else {\n              app.controls.next_button.prop(\"disabled\", true);\n              app.controls.next_button.children('.fa').removeClass('fa-times');\n              app.controls.next_button.children('.fa').addClass('fa-spinner fa-spin');\n              setTimeout(function() {\n                app.controls.next_button.children('.fa').removeClass('fa-spinner fa-spin');\n                app.controls.next_button.children('.fa').addClass('fa-times');\n                app.controls.next_button.prop(\"disabled\", false);\n                app.do_next();\n              }, 200);\n            }\n\n          });\n        },\n\n        initComponents: function() {\n\n              var theCallback = function(message) {\n\n                switch (message.type) {\n                  case 'recording':\n\n                    break;\n\n                  case 'speech':\n                    log.debug(\"speech at speechcards\");\n                    var speechtext = message.capturedspeech;\n                    var spoken_clean  = quizhelper.cleanText(speechtext);\n                    var correct_clean = quizhelper.cleanText(app.terms[app.pointer - 1]);\n                    var correctphonetic = app.phonetics[app.pointer - 1];\n        log.debug('speechtext:',speechtext);\n        log.debug('spoken:',spoken_clean);\n        log.debug('correct:',correct_clean);\n                    //Similarity check by character matching\n                    var similarity_js = quizhelper.similarity(spoken_clean, correct_clean);\n                    log.debug('JS similarity: ' + spoken_clean + ':' + correct_clean + ':' + similarity_js);\n\n                    //Similarity check by direct-match/acceptable-mistranscription\n                    if (similarity_js >= app.passmark ||\n                      app.wordsDoMatch(spoken_clean, correct_clean)) {\n                      log.debug('local match:' + ':' + spoken_clean + ':' + correct_clean);\n                      app.showStarRating(100);\n                      app.flagCorrectAndTransition();\n                      return;\n                    }\n\n                    //Similarity check by phonetics(ajax)\n                    quizhelper.checkByPhonetic(correct_clean, spoken_clean, correctphonetic, app.language).then(function(similarity_php) {\n                      if (similarity_php === false) {\n                        return $.Deferred().reject();\n                      } else {\n                        log.debug('PHP similarity: ' + spoken_clean + ':' + correct_clean + ':' + similarity_php);\n\n                        if (similarity_php >= app.passmark) {\n                            app.showStarRating(similarity_php);\n                            app.flagCorrectAndTransition();\n                        }else{\n                            //show the greater of the ratings\n                            app.showStarRating(Math.max(similarity_js,similarity_php));\n                        }\n                      } //end of if check_by_phonetic result\n                    }); //end of check by phonetic\n\n                } //end of switch message type\n              };\n\n              //init tt recorder\n              var opts = {};\n              opts.uniqueid = itemdata.uniqueid;\n              opts.callback = theCallback;\n              opts.stt_guided=quizhelper.is_stt_guided();\n              app.ttrec = ttrecorder.clone();\n              app.ttrec.init(opts);\n              //init prompt for first card\n              //in some cases ttrecorder wants to know the target\n              app.ttrec.currentPrompt=app.displayterms[app.pointer - 1];\n\n              //init progress dots\n              app.progress_dots(app.results, app.terms);\n\n              app.initSlider();\n\n\n        },\n\n        initSlider: function() {\n          app.controls.slider.text(app.displayterms[app.pointer - 1]);\n          app.controls.slider.show();\n        },\n\n        writeCurrentTerm: function() {\n            /*\n            app.controls.slider.toggle(\"slide\",{direction:\"left\"});\n            app.controls.slider.text(app.displayterms[app.pointer - 1]);\n            app.controls.slider.toggle(\"slide\",{direction:\"right\"})\n             */\n            anim.do_animate(app.controls.slider,'zoomOut animate__faster','out').then(\n                function(){\n                    app.controls.slider.text(app.displayterms[app.pointer - 1]);\n                    anim.do_animate(app.controls.slider,'zoomIn animate__faster','in');\n                }\n            );\n        },\n\n        flagCorrectAndTransition: function() {\n\n          //update students word log if matched\n          app.check(true);\n\n          //transition if required\n          if (app.is_end()) {\n            setTimeout(function() {\n              app.do_end();\n            }, 700);\n          } else {\n            setTimeout(function() {\n              app.do_next();\n            }, 700);\n          }\n\n        },\n\n        wordsDoMatch: function(phraseheard, currentphrase) {\n          //lets lower case everything\n          phraseheard = quizhelper.cleanText(phraseheard);\n          currentphrase = quizhelper.cleanText(currentphrase);\n          if (phraseheard == currentphrase) {\n            return true;\n          }\n          return false;\n        },\n\n\n        showStarRating: function(similarity) {\n          //how many stars code\n          var stars = [true, true, true];\n          if (similarity < app.passmark) {\n            stars = [true, true, false];\n          }\n          if (similarity < .75) {\n            stars = [true, false, false];\n          }\n          if (similarity < 0.5) {\n            stars = [false, false, false];\n          }\n\n          //prepare stars html\n          var code = \"\";\n          stars.forEach(function(star) {\n            if (star === true) {\n              code += '<i class=\"fa fa-star\"></i>';\n            } else {\n              code += '<i class=\"fa fa-star-o\"></i>';\n            }\n          });\n\n          app.controls.star_rating.html(code);\n        },\n\n        check: function(correct) {\n          var points = 1;\n          if (correct == true) {\n            points = 1;\n          } else {\n            points = 0;\n          }\n          var result = {\n            points: points\n          };\n          app.results.push(result);\n        },\n\n        do_next: function() {\n          app.pointer++;\n          app.progress_dots(app.results, app.terms);\n          app.clearStarRating();\n          if (!app.is_end()) {\n            app.writeCurrentTerm();\n            //in some cases ttrecorder wants to know the target\n            if(quizhelper.use_ttrecorder()) {\n                app.ttrec.currentPrompt=app.displayterms[app.pointer - 1];\n            }\n\n          } else {\n            app.do_end();\n          }\n        },\n\n        clearStarRating: function() {\n          app.controls.star_rating.html('· · ·');\n        },\n\n        do_end: function() {\n          app.next_question();\n        },\n\n        is_end: function() {\n          //pointer is 1 based but array is, of course, 0 based\n          if (app.pointer <= app.terms.length) {\n            return false;\n          } else {\n            return true;\n          }\n        },\n\n        progress_dots: function(results, terms) {\n\n          var code = \"\";\n          var color = \"\";\n          terms.forEach(function(o, i) {\n            color = \"darkgray\";\n            if (results[i] !== undefined) {\n              if (results[i].points) {\n                color = \"green\";\n              } else {\n                color = \"red\";\n              }\n            }\n            code += '<i style=\"color:' + color + ';\" class=\"fa fa-circle\"></i>';\n          });\n\n          $(\"#\" + itemdata.uniqueid + \"_container .minilesson_progress_dots\").html(code);\n\n        },\n      }; //end of app definition\n      app.init();\n\n    } //end of init_App\n\n\n  }; //end of return value\n});"],"file":"speechcards.min.js"}