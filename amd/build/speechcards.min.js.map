{"version":3,"sources":["../src/speechcards.js"],"names":["define","$","jqui","log","Ajax","def","polly","cloudpoodll","ttrecorder","debug","clone","extend","init","index","itemdata","quizhelper","init_app","console","app","passmark","pointer","jsondata","props","dryRun","language","terms","results","controls","i","sentences","length","sentence","init_controls","initComponents","register_events","star_rating","uniqueid","next_button","next_question","stepdata","hasgrade","totalitems","correctitems","filter","e","points","grade","Math","round","do_next","on","click","check","is_end","setTimeout","do_end","opts","callback","theCallback","message","type","speechtext","capturedspeech","cleanspeechtext","cleanText","spoken","correct","similarity","wordsDoMatch","showStarRating","flagCorrectAndTransition","checkByPhonetic","then","Deferred","reject","progress_dots","writeCurrentTerm","toggle","direction","text","phraseheard","currentphrase","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","toLowerCase","costs","lastValue","j","newValue","charAt","min","replace","trim","call","stars","code","forEach","star","html","result","push","clearStarRating","color","o"],"mappings":"AAAAA,OAAM,8BAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,UAAvB,CAAmC,WAAnC,CAAgD,4BAAhD,CAA8E,4BAA9E,CACL,kCADK,CAC8B,2BAD9B,CAAD,CAEH,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAuBC,CAAvB,CAA6BC,CAA7B,CAAkCC,CAAlC,CAAyCC,CAAzC,CAAsDC,CAAtD,CAAkE,CACnE,aAMAL,CAAG,CAACM,KAAJ,CAAU,uCAAV,EAEA,MAAO,CAGHC,KAAK,CAAE,gBAAY,CACf,MAAOT,CAAAA,CAAC,CAACU,MAAF,IAAe,EAAf,CAAmB,IAAnB,CACV,CALE,CAQHC,IAAI,CAAE,cAASC,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,CAE5C,KAAKC,QAAL,CAAcH,CAAd,CAAqBC,CAArB,CAA+BC,CAA/B,CACD,CAXI,CAaLC,QAAQ,CAAE,kBAASH,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,CAE9CE,OAAO,CAACd,GAAR,CAAYW,CAAZ,EAEA,GAAII,CAAAA,CAAG,CAAG,CACRC,QAAQ,CAAE,EADF,CAERC,OAAO,CAAE,CAFD,CAGRC,QAAQ,CAAE,IAHF,CAIRC,KAAK,CAAE,IAJC,CAKRC,MAAM,GALE,CAMRC,QAAQ,CAAE,OANF,CAORC,KAAK,CAAE,EAPC,CAQRC,OAAO,CAAE,EARD,CASRC,QAAQ,CAAE,EATF,CAWRf,IAAI,CAAE,eAAW,CAGf,IAAK,GAAIgB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGd,CAAQ,CAACe,SAAT,CAAmBC,MAAvC,CAA+CF,CAAC,EAAhD,CAAoD,CAClDV,CAAG,CAACO,KAAJ,CAAUG,CAAV,EAAed,CAAQ,CAACe,SAAT,CAAmBD,CAAnB,EAAsBG,QACtC,CACD5B,CAAG,CAACM,KAAJ,CAAU,WAAV,CAAuBS,CAAG,CAACO,KAA3B,EACAP,CAAG,CAACM,QAAJ,CAAeV,CAAQ,CAACU,QAAxB,CAEA,KAAKQ,aAAL,GACA,KAAKC,cAAL,GACA,KAAKC,eAAL,EACD,CAvBO,CAyBRF,aAAa,CAAE,wBAAW,CACxBd,CAAG,CAACS,QAAJ,CAAe,EAAf,CACAT,CAAG,CAACS,QAAJ,CAAaQ,WAAb,CAA2BlC,CAAC,CAAC,IAAMa,CAAQ,CAACsB,QAAf,CAA0B,oCAA3B,CAA5B,CACAlB,CAAG,CAACS,QAAJ,CAAaU,WAAb,CAA2BpC,CAAC,CAAC,IAAMa,CAAQ,CAACsB,QAAf,CAA0B,+CAA3B,CAC7B,CA7BO,CA8BRE,aAAa,CAAE,wBAAW,CACxB,GAAIC,CAAAA,CAAQ,CAAG,CACN1B,KADM,CACEA,CADF,CAEN2B,QAFM,IAGNC,UAHM,CAGOvB,CAAG,CAACO,KAAJ,CAAUK,MAHjB,CAINY,YAJM,CAISxB,CAAG,CAACQ,OAAJ,CAAYiB,MAAZ,CAAmB,SAASC,CAAT,CAAW,CAAC,MAAgB,EAAT,CAAAA,CAAC,CAACC,MAAU,CAAlD,EAAoDf,MAJ7D,CAAf,CAKAS,CAAQ,CAACO,KAAT,CAAiBC,IAAI,CAACC,KAAL,CAAuD,GAA5C,EAACT,CAAQ,CAACE,UAAT,CAAoBF,CAAQ,CAACG,YAA9B,CAAX,CAAjB,CACA3B,CAAU,CAACkC,OAAX,CAAmBV,CAAnB,CACD,CAtCO,CAuCRL,eAAe,CAAE,0BAAW,CAE1BjC,CAAC,CAAC,IAAMa,CAAQ,CAACsB,QAAf,CAA0B,mCAA3B,CAAD,CAAiEc,EAAjE,CAAoE,OAApE,CAA6E,UAAY,CACvFhC,CAAG,CAACoB,aAAJ,EACD,CAFD,EAIApB,CAAG,CAACS,QAAJ,CAAaU,WAAb,CAAyBc,KAAzB,CAA+B,UAAW,CAExCjC,CAAG,CAACkC,KAAJ,KAGA,GAAIlC,CAAG,CAACmC,MAAJ,EAAJ,CAAkB,CAChBC,UAAU,CAAC,UAAW,CACpBpC,CAAG,CAACqC,MAAJ,EACD,CAFS,CAEP,GAFO,CAGX,CAJD,IAIO,CACLD,UAAU,CAAC,UAAW,CACpBpC,CAAG,CAAC+B,OAAJ,EACD,CAFS,CAEP,GAFO,CAGX,CAEF,CAfD,CAgBD,CA7DO,CA+DRhB,cAAc,CAAE,yBAAW,IAkDnBuB,CAAAA,CAAI,CAAG,EAlDY,CAmDvBA,CAAI,CAACpB,QAAL,CAActB,CAAQ,CAACsB,QAAvB,CACAoB,CAAI,CAACC,QAAL,CAlDgB,QAAdC,CAAAA,WAAc,CAASC,CAAT,CAAkB,CAElC,OAAQA,CAAO,CAACC,IAAhB,EACE,IAAK,WAAL,CAEE,MAEF,IAAK,QAAL,CACEzD,CAAG,CAACM,KAAJ,CAAU,uBAAV,EADF,GAEMoD,CAAAA,CAAU,CAAGF,CAAO,CAACG,cAF3B,CAGMC,CAAe,CAAG7C,CAAG,CAAC8C,SAAJ,CAAcH,CAAd,CAHxB,CAKMI,CAAM,CAAGF,CALf,CAMMG,CAAO,CAAGhD,CAAG,CAACO,KAAJ,CAAUP,CAAG,CAACE,OAAJ,CAAc,CAAxB,CANhB,CASM+C,CAAU,CAAGjD,CAAG,CAACiD,UAAJ,CAAeF,CAAf,CAAuBC,CAAvB,CATnB,CAUE/D,CAAG,CAACM,KAAJ,CAAU,kBAAoBwD,CAApB,CAA6B,GAA7B,CAAmCC,CAAnC,CAA6C,GAA7C,CAAmDC,CAA7D,EAGA,GAAIA,CAAU,EAAIjD,CAAG,CAACC,QAAlB,EACFD,CAAG,CAACkD,YAAJ,CAAiBL,CAAjB,CAAkC7C,CAAG,CAACO,KAAJ,CAAUP,CAAG,CAACE,OAAJ,CAAc,CAAxB,CAAlC,CADF,CACiE,CAC/DjB,CAAG,CAACM,KAAJ,CAAU,gBAAuBwD,CAAvB,CAAgC,GAAhC,CAAsCC,CAAhD,EACAhD,CAAG,CAACmD,cAAJ,CAAmB,GAAnB,EACAnD,CAAG,CAACoD,wBAAJ,GACA,MACD,CAGDpD,CAAG,CAACqD,eAAJ,CAAoBN,CAApB,CAA4BC,CAA5B,EAAqCM,IAArC,CAA0C,SAASL,CAAT,CAAqB,CAC7D,GAAI,KAAAA,CAAJ,CAA0B,CACxB,MAAOlE,CAAAA,CAAC,CAACwE,QAAF,GAAaC,MAAb,EACR,CAFD,IAEO,CACLvE,CAAG,CAACM,KAAJ,CAAU,mBAAqBwD,CAArB,CAA8B,GAA9B,CAAoCC,CAApC,CAA8C,GAA9C,CAAoDC,CAA9D,EACAjD,CAAG,CAACmD,cAAJ,CAAmBF,CAAnB,EACA,GAAIA,CAAU,EAAIjD,CAAG,CAACC,QAAtB,CAAgC,CAC9BD,CAAG,CAACoD,wBAAJ,EACD,CACF,CACF,CAVD,EA3BJ,CAwCD,CAQC,CACA9D,CAAU,CAACI,IAAX,CAAgB4C,CAAhB,EAIFtC,CAAG,CAACyD,aAAJ,CAAkBzD,CAAG,CAACQ,OAAtB,CAA+BR,CAAG,CAACO,KAAnC,EAEAP,CAAG,CAAC0D,gBAAJ,EAGD,CA7HO,CA+HRA,gBAAgB,CAAE,2BAAW,CAC3B3E,CAAC,CAAC,uCAAD,CAAD,CAA2C4E,MAA3C,CAAkD,OAAlD,CAA0D,CAACC,SAAS,CAAC,MAAX,CAA1D,EACA7E,CAAC,CAAC,uCAAD,CAAD,CAA2C8E,IAA3C,CAAgD7D,CAAG,CAACO,KAAJ,CAAUP,CAAG,CAACE,OAAJ,CAAc,CAAxB,CAAhD,EACAnB,CAAC,CAAC,uCAAD,CAAD,CAA2C4E,MAA3C,CAAkD,OAAlD,CAA0D,CAACC,SAAS,CAAC,OAAX,CAA1D,CACD,CAnIO,CAqIRR,wBAAwB,CAAE,mCAAW,CAGnCpD,CAAG,CAACkC,KAAJ,KAGA,GAAIlC,CAAG,CAACmC,MAAJ,EAAJ,CAAkB,CAChBC,UAAU,CAAC,UAAW,CACpBpC,CAAG,CAACqC,MAAJ,EACD,CAFS,CAEP,GAFO,CAGX,CAJD,IAIO,CACLD,UAAU,CAAC,UAAW,CACpBpC,CAAG,CAAC+B,OAAJ,EACD,CAFS,CAEP,GAFO,CAGX,CAEF,CArJO,CAuJRmB,YAAY,CAAE,sBAASY,CAAT,CAAsBC,CAAtB,CAAqC,CAEjDD,CAAW,CAAG9D,CAAG,CAAC8C,SAAJ,CAAcgB,CAAd,CAAd,CACAC,CAAa,CAAG/D,CAAG,CAAC8C,SAAJ,CAAciB,CAAd,CAAhB,CACA,GAAID,CAAW,EAAIC,CAAnB,CAAkC,CAChC,QACD,CACD,QACD,CA/JO,CAiKRd,UAAU,CAAE,oBAASe,CAAT,CAAaC,CAAb,CAAiB,IACvBC,CAAAA,CAAM,CAAGF,CADc,CAEvBG,CAAO,CAAGF,CAFa,CAG3B,GAAID,CAAE,CAACpD,MAAH,CAAYqD,CAAE,CAACrD,MAAnB,CAA2B,CACzBsD,CAAM,CAAGD,CAAT,CACAE,CAAO,CAAGH,CACX,CACD,GAAII,CAAAA,CAAY,CAAGF,CAAM,CAACtD,MAA1B,CACA,GAAoB,CAAhB,EAAAwD,CAAJ,CAAuB,CACrB,MAAO,EACR,CACD,MAAO,CAACA,CAAY,CAAGpE,CAAG,CAACqE,YAAJ,CAAiBH,CAAjB,CAAyBC,CAAzB,CAAhB,EAAqDG,UAAU,CAACF,CAAD,CACvE,CA7KO,CA8KRC,YAAY,CAAE,sBAASL,CAAT,CAAaC,CAAb,CAAiB,CAC7BD,CAAE,CAAGA,CAAE,CAACO,WAAH,EAAL,CACAN,CAAE,CAAGA,CAAE,CAACM,WAAH,EAAL,CAGA,OADIC,CAAAA,CAAK,GACT,CAAS9D,CAAC,CAAG,CAAb,CACM+D,CADN,CAAgB/D,CAAC,EAAIsD,CAAE,CAACpD,MAAxB,CAAgCF,CAAC,EAAjC,CAAqC,CAC/B+D,CAD+B,CACnB/D,CADmB,CAEnC,IAAK,GAAIgE,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,EAAIT,CAAE,CAACrD,MAAxB,CAAgC8D,CAAC,EAAjC,CAAqC,CACnC,GAAS,CAAL,EAAAhE,CAAJ,CACE8D,CAAK,CAACE,CAAD,CAAL,CAAWA,CAAX,CADF,IAEK,CACH,GAAQ,CAAJ,CAAAA,CAAJ,CAAW,CACT,GAAIC,CAAAA,CAAQ,CAAGH,CAAK,CAACE,CAAC,CAAG,CAAL,CAApB,CACA,GAAIV,CAAE,CAACY,MAAH,CAAUlE,CAAC,CAAG,CAAd,GAAoBuD,CAAE,CAACW,MAAH,CAAUF,CAAC,CAAG,CAAd,CAAxB,CACEC,CAAQ,CAAG9C,IAAI,CAACgD,GAAL,CAAShD,IAAI,CAACgD,GAAL,CAASF,CAAT,CAAmBF,CAAnB,CAAT,CACTD,CAAK,CAACE,CAAD,CADI,EACG,CADd,CAEFF,CAAK,CAACE,CAAC,CAAG,CAAL,CAAL,CAAeD,CAAf,CACAA,CAAS,CAAGE,CACb,CACF,CACF,CACD,GAAQ,CAAJ,CAAAjE,CAAJ,CACE8D,CAAK,CAACP,CAAE,CAACrD,MAAJ,CAAL,CAAmB6D,CACtB,CACD,MAAOD,CAAAA,CAAK,CAACP,CAAE,CAACrD,MAAJ,CACb,CAvMO,CAyMRkC,SAAS,CAAE,mBAASe,CAAT,CAAe,CACxB,MAAOA,CAAAA,CAAI,CAACU,WAAL,GAAmBO,OAAnB,CAA2B,YAA3B,CAAyC,EAAzC,EAA6CA,OAA7C,CAAqD,MAArD,CAA6D,GAA7D,EAAkEC,IAAlE,EACR,CA3MO,CA8MR1B,eAAe,CAAE,yBAASN,CAAT,CAAiBC,CAAjB,CAA0B,CAEzC,MAAO9D,CAAAA,CAAI,CAAC8F,IAAL,CAAU,CAAC,CAChB,WAAc,kCADE,CAEhB,KAAQ,CACN,OAAUjC,CADJ,CAEN,QAAWC,CAFL,CAGN,SAAYhD,CAAG,CAACM,QAHV,CAFQ,CAAD,CAAV,EAOH,CAPG,CASR,CAzNO,CA2NR6C,cAAc,CAAE,wBAASF,CAAT,CAAqB,CAEnC,GAAIgC,CAAAA,CAAK,CAAG,UAAZ,CACA,GAAiB,CAAb,CAAAhC,CAAJ,CAAoB,CAClBgC,CAAK,CAAG,UACT,CACD,GAAIhC,CAAU,CAAGjD,CAAG,CAACC,QAArB,CAA+B,CAC7BgF,CAAK,CAAG,UACT,CACD,GAAiB,EAAb,CAAAhC,CAAJ,CAAsB,CACpBgC,CAAK,CAAG,UACT,CAGD,GAAIC,CAAAA,CAAI,CAAG,EAAX,CACAD,CAAK,CAACE,OAAN,CAAc,SAASC,CAAT,CAAe,CAC3B,GAAI,KAAAA,CAAJ,CAAmB,CACjBF,CAAI,EAAI,8BACT,CAFD,IAEO,CACLA,CAAI,EAAI,gCACT,CACF,CAND,EAQAlF,CAAG,CAACS,QAAJ,CAAaQ,WAAb,CAAyBoE,IAAzB,CAA8BH,CAA9B,CACD,CAnPO,CAqPRhD,KAAK,CAAE,eAASc,CAAT,CAAkB,CACvB,GAAIrB,CAAAA,CAAM,CAAG,CAAb,CACA,GAAI,IAAAqB,CAAJ,CAAqB,CACnBrB,CAAM,CAAG,CACV,CAFD,IAEO,CACLA,CAAM,CAAG,CACV,CACD,GAAI2D,CAAAA,CAAM,CAAG,CACX3D,MAAM,CAAEA,CADG,CAAb,CAGA3B,CAAG,CAACQ,OAAJ,CAAY+E,IAAZ,CAAiBD,CAAjB,CACD,CAhQO,CAkQRvD,OAAO,CAAE,kBAAW,CAClB/B,CAAG,CAACE,OAAJ,GACAF,CAAG,CAACyD,aAAJ,CAAkBzD,CAAG,CAACQ,OAAtB,CAA+BR,CAAG,CAACO,KAAnC,EACAP,CAAG,CAACwF,eAAJ,GACA,GAAI,CAACxF,CAAG,CAACmC,MAAJ,EAAL,CAAmB,CACjBnC,CAAG,CAAC0D,gBAAJ,EACD,CAFD,IAEO,CACL1D,CAAG,CAACqC,MAAJ,EACD,CACF,CA3QO,CA6QRmD,eAAe,CAAE,0BAAW,CAC1BxF,CAAG,CAACS,QAAJ,CAAaQ,WAAb,CAAyBoE,IAAzB,CAA8B,gBAA9B,CACD,CA/QO,CAiRRhD,MAAM,CAAE,iBAAW,CACjBrC,CAAG,CAACoB,aAAJ,EACD,CAnRO,CAqRRe,MAAM,CAAE,iBAAW,CAEjB,GAAInC,CAAG,CAACE,OAAJ,EAAeF,CAAG,CAACO,KAAJ,CAAUK,MAA7B,CAAqC,CACnC,QACD,CAFD,IAEO,CACL,QACD,CACF,CA5RO,CA8RR6C,aAAa,CAAE,uBAASjD,CAAT,CAAkBD,CAAlB,CAAyB,IAElC2E,CAAAA,CAAI,CAAG,EAF2B,CAGlCO,CAAK,CAAG,EAH0B,CAItClF,CAAK,CAAC4E,OAAN,CAAc,SAASO,CAAT,CAAYhF,CAAZ,CAAe,CAC3B+E,CAAK,CAAG,UAAR,CACA,GAAIjF,CAAO,CAACE,CAAD,CAAP,SAAJ,CAA8B,CAC5B,GAAIF,CAAO,CAACE,CAAD,CAAP,CAAWiB,MAAf,CAAuB,CACrB8D,CAAK,CAAG,OACT,CAFD,IAEO,CACLA,CAAK,CAAG,KACT,CACF,CACDP,CAAI,EAAI,oBAAqBO,CAArB,CAA6B,iCACtC,CAVD,EAYA1G,CAAC,CAAC,IAAMa,CAAQ,CAACsB,QAAf,CAA0B,sCAA3B,CAAD,CAAoEmE,IAApE,CAAyEH,CAAzE,CAED,CAhTO,CAAV,CAkTAlF,CAAG,CAACN,IAAJ,EAED,CArUI,CAyUR,CApVK,CAAN","sourcesContent":["define(['jquery', 'jqueryui', 'core/log', 'core/ajax', 'mod_poodlltime/definitions', 'mod_poodlltime/pollyhelper',\n  'mod_poodlltime/cloudpoodllloader','mod_poodlltime/ttrecorder'\n], function($, jqui, log, Ajax, def, polly, cloudpoodll, ttrecorder) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('Poodll Time Speechcards: initialising');\n\n  return {\n\n      //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n      },\n\n\n      init: function(index, itemdata, quizhelper) {\n\n      this.init_app(index, itemdata, quizhelper);\n    },\n\n    init_app: function(index, itemdata, quizhelper) {\n\n      console.log(itemdata);\n\n      var app = {\n        passmark: 75,\n        pointer: 1,\n        jsondata: null,\n        props: null,\n        dryRun: false,\n        language: 'en-US',\n        terms: [],\n        results: [],\n        controls: {},\n\n        init: function() {\n\n          //init terms\n          for (var i = 0; i < itemdata.sentences.length; i++) {\n            app.terms[i] = itemdata.sentences[i].sentence;\n          }\n          log.debug(\"app terms\", app.terms);\n          app.language = itemdata.language;\n\n          this.init_controls();\n          this.initComponents();\n          this.register_events();\n        },\n\n        init_controls: function() {\n          app.controls = {};\n          app.controls.star_rating = $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_star_rating\");\n          app.controls.next_button = $(\"#\" + itemdata.uniqueid + \"_container .poodlltime-speechcards_nextbutton\");\n        },\n        next_question: function() {\n          var stepdata = {};\n          stepdata.index = index;\n          stepdata.hasgrade = true;\n          stepdata.totalitems = app.terms.length;\n          stepdata.correctitems = app.results.filter(function(e){return e.points>0;}).length;\n          stepdata.grade = Math.round((stepdata.totalitems/stepdata.correctitems)*100);\n          quizhelper.do_next(stepdata);\n        },\n        register_events: function() {\n\n          $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_nextbutton\").on('click', function(e) {\n            app.next_question();\n          });\n\n          app.controls.next_button.click(function() {\n            //user has given up ,update word as failed\n            app.check(false);\n\n            //transition if required\n            if (app.is_end()) {\n              setTimeout(function() {\n                app.do_end();\n              }, 200);\n            } else {\n              setTimeout(function() {\n                app.do_next();\n              }, 200);\n            }\n\n          });\n        },\n\n        initComponents: function() {\n\n          var theCallback = function(message) {\n\n            switch (message.type) {\n              case 'recording':\n\n                break;\n\n              case 'speech':\n                log.debug(\"speech at speechcards\");\n                var speechtext = message.capturedspeech;\n                var cleanspeechtext = app.cleanText(speechtext);\n\n                var spoken = cleanspeechtext;\n                var correct = app.terms[app.pointer - 1];\n\n                //Similarity check by character matching\n                var similarity = app.similarity(spoken, correct);\n                log.debug('JS similarity: ' + spoken + ':' + correct + ':' + similarity);\n\n                //Similarity check by direct-match/acceptable-mistranscription\n                if (similarity >= app.passmark ||\n                  app.wordsDoMatch(cleanspeechtext, app.terms[app.pointer - 1])) {\n                  log.debug('local match:' + ':' + spoken + ':' + correct);\n                  app.showStarRating(100);\n                  app.flagCorrectAndTransition();\n                  return;\n                }\n\n                //Similarity check by phonetics(ajax)\n                app.checkByPhonetic(spoken, correct).then(function(similarity) {\n                  if (similarity === false) {\n                    return $.Deferred().reject();\n                  } else {\n                    log.debug('PHP similarity: ' + spoken + ':' + correct + ':' + similarity);\n                    app.showStarRating(similarity);\n                    if (similarity >= app.passmark) {\n                      app.flagCorrectAndTransition();\n                    }\n                  } //end of if check_by_phonetic result\n                }); //end of check by phonetic\n\n            } //end of switch message type\n          };\n\n          //init cloudpoodll push recorder\n         // cloudpoodll.init('poodlltime-recorder-speechcards-' + itemdata.id, theCallback);\n\n         //tt recorder\n            var opts = {};\n            opts.uniqueid=itemdata.uniqueid;\n            opts.callback=theCallback;\n            ttrecorder.init(opts);\n\n\n          //init progress dots\n          app.progress_dots(app.results, app.terms);\n\n          app.writeCurrentTerm();\n\n\n        },\n\n        writeCurrentTerm: function() {\n          $(\".poodlltime_speechcards_target_phrase\").toggle(\"slide\",{direction:\"left\"})\n          $(\".poodlltime_speechcards_target_phrase\").text(app.terms[app.pointer - 1]);\n          $(\".poodlltime_speechcards_target_phrase\").toggle(\"slide\",{direction:\"right\"})\n        },\n\n        flagCorrectAndTransition: function() {\n\n          //update students word log if matched\n          app.check(true);\n\n          //transition if required\n          if (app.is_end()) {\n            setTimeout(function() {\n              app.do_end();\n            }, 700);\n          } else {\n            setTimeout(function() {\n              app.do_next();\n            }, 700);\n          }\n\n        },\n\n        wordsDoMatch: function(phraseheard, currentphrase) {\n          //lets lower case everything\n          phraseheard = app.cleanText(phraseheard);\n          currentphrase = app.cleanText(currentphrase);\n          if (phraseheard == currentphrase) {\n            return true;\n          }\n          return false;\n        },\n\n        similarity: function(s1, s2) {\n          var longer = s1;\n          var shorter = s2;\n          if (s1.length < s2.length) {\n            longer = s2;\n            shorter = s1;\n          }\n          var longerLength = longer.length;\n          if (longerLength == 0) {\n            return 1.0;\n          }\n          return (longerLength - app.editDistance(longer, shorter)) / parseFloat(longerLength);\n        },\n        editDistance: function(s1, s2) {\n          s1 = s1.toLowerCase();\n          s2 = s2.toLowerCase();\n\n          var costs = new Array();\n          for (var i = 0; i <= s1.length; i++) {\n            var lastValue = i;\n            for (var j = 0; j <= s2.length; j++) {\n              if (i == 0)\n                costs[j] = j;\n              else {\n                if (j > 0) {\n                  var newValue = costs[j - 1];\n                  if (s1.charAt(i - 1) != s2.charAt(j - 1))\n                    newValue = Math.min(Math.min(newValue, lastValue),\n                      costs[j]) + 1;\n                  costs[j - 1] = lastValue;\n                  lastValue = newValue;\n                }\n              }\n            }\n            if (i > 0)\n              costs[s2.length] = lastValue;\n          }\n          return costs[s2.length];\n        },\n\n        cleanText: function(text) {\n          return text.toLowerCase().replace(/[^\\w\\s]|_/g, \"\").replace(/\\s+/g, \" \").trim();\n        },\n\n        //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n        checkByPhonetic: function(spoken, correct) {\n\n          return Ajax.call([{\n            'methodname': 'mod_poodlltime_check_by_phonetic',\n            'args': {\n              'spoken': spoken,\n              'correct': correct,\n              'language': app.language,\n            }\n          }])[0];\n\n        },\n\n        showStarRating: function(similarity) {\n          //how many stars code\n          var stars = [true, true, true];\n          if (similarity < 1) {\n            stars = [true, true, false];\n          }\n          if (similarity < app.passmark) {\n            stars = [true, false, false];\n          }\n          if (similarity < 0.5) {\n            stars = [false, false, false];\n          }\n\n          //prepare stars html\n          var code = \"\";\n          stars.forEach(function(star) {\n            if (star === true) {\n              code += '<i class=\"fa fa-star\"></i>';\n            } else {\n              code += '<i class=\"fa fa-star-o\"></i>';\n            }\n          });\n\n          app.controls.star_rating.html(code);\n        },\n\n        check: function(correct) {\n          var points = 1;\n          if (correct == true) {\n            points = 1;\n          } else {\n            points = 0;\n          }\n          var result = {\n            points: points\n          };\n          app.results.push(result);\n        },\n\n        do_next: function() {\n          app.pointer++;\n          app.progress_dots(app.results, app.terms);\n          app.clearStarRating();\n          if (!app.is_end()) {\n            app.writeCurrentTerm();\n          } else {\n            app.do_end();\n          }\n        },\n\n        clearStarRating: function() {\n          app.controls.star_rating.html('· · ·');\n        },\n\n        do_end: function() {\n          app.next_question();\n        },\n\n        is_end: function() {\n          //pointer is 1 based but array is, of course, 0 based\n          if (app.pointer <= app.terms.length) {\n            return false;\n          } else {\n            return true;\n          }\n        },\n\n        progress_dots: function(results, terms) {\n\n          var code = \"\";\n          var color = \"\";\n          terms.forEach(function(o, i) {\n            color = \"darkgray\";\n            if (results[i] !== undefined) {\n              if (results[i].points) {\n                color = \"green\";\n              } else {\n                color = \"red\";\n              }\n            }\n            code += '<i style=\"color:' + color + ';\" class=\"fa fa-circle\"></i>';\n          });\n\n          $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_progress_dots\").html(code);\n\n        },\n      }; //end of app definition\n      app.init();\n\n    } //end of init_App\n\n\n  }; //end of return value\n});"],"file":"speechcards.min.js"}