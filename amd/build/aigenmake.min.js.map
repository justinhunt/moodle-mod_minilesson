{"version":3,"file":"aigenmake.min.js","sources":["../src/aigenmake.js"],"sourcesContent":["define(\n    ['jquery','core/log','core/templates','core/fragment','core/modal_factory',\n        'core/str','core/config','core/modal_events', 'core_table/dynamic', 'core/ajax'],\n    function ($,log,templates,Fragment,Modalfactory,Str,Config,ModalEvents, DyanamicTable, Ajax) {\n        \"use strict\"; // jshint ;_;\n\n    /*\n    This file contains class and ID definitions.\n    */\n\n        log.debug('MiniLesson AiGen Config Maker: initialising');\n\n        return{\n            controls: {},\n            itemdatas: [],\n            itemcontrols: [],\n            //pass in config, amd set up table\n            init: function (uniqid) {\n                //pick up opts from html\n                var self = this;\n                self.init_controls(uniqid);\n                self.register_events(uniqid);\n                self.set_data();\n            },\n\n            init_controls: function (uniqid) {\n                //set up the controls\n                var self = this;\n                self.controls.selectgenerate = $('#' + uniqid + ' select[name=\"generatemethod\"]');\n                self.controls.aigenmakebtn = $('#' + uniqid + '_aigen_make_btn');\n                self.controls.fieldmappings = $('#' + uniqid + ' #id_fieldmappings');\n                self.controls.aigenmake_textarea = $('#' + uniqid + '_aigen_make_textarea');\n            },\n\n            register_events: function (uniqid) {\n                //register events\n                var self = this;\n\n                //On clicking the make aigen button\n                 self.controls.aigenmakebtn.on('click', function (e) {\n                    var items = [];\n                    var itemcontrols = $('.ml_aigen_item');\n                    // Get the lesson title and description\n                    var lessonTitle = $('#' + uniqid + '_ml_aigen_lesson_title input').val();\n                    var lessonDescription = $('#' + uniqid + '_ml_aigen_lesson_description textarea').val();\n\n                    //loop through each item\n                    itemcontrols.each(function (index, itemcontrol) {\n                        var itemdata = {};\n\n                       //set the itemnumber\n                        itemdata.itemnumber = Number($(itemcontrol).data('itemnumber'));\n\n                        //get the prompt\n                        var promptTextArea = $(itemcontrol).find('textarea[name=\"aigenprompt\"]');\n                        itemdata.prompt = promptTextArea.val();\n\n                        //get the generate method\n                        var generateMethodSelect = $(itemcontrol).find('select[name=\"generatemethod\"]');\n                        itemdata.generatemethod = generateMethodSelect.val();\n\n                        //get the generate fields\n                        var generateFieldsCheckboxes = $(itemcontrol).find('.aigen_fields-to-generate input[type=\"checkbox\"]');\n                        var generateFields = [];\n                        generateFieldsCheckboxes.each(function () {\n                            var generateField = {};\n                            generateField.name = $(this).attr('name');\n                            generateField.generate  = $(this).is(':checked') ? 1 : 0;\n                            if (itemdata.generatemethod == \"reuse\" && generateField.generate) {\n                                generateField.mapping = $(itemcontrol).find('select[name=\"' + generateField.name + '_mapping\"]').val();\n                            } else {\n                                generateField.mapping = '';\n                            }\n                            generateFields.push(generateField);\n                        });\n                        itemdata.generatefields = generateFields;\n\n                         //get the file areas\n                        var generateFileareasCheckboxes = $(itemcontrol).find('.aigen_fileareas-to-generate input[type=\"checkbox\"]');\n                        var generateFileareas = [];\n                        generateFileareasCheckboxes.each(function () {\n                            var generateFilearea = {};\n                            generateFilearea.name = $(this).attr('name');\n                            generateFilearea.generate  = $(this).is(':checked') ? 1 : 0;\n                            if (generateFilearea.generate) {\n                                generateFilearea.mapping = $(itemcontrol).find('select[name=\"' + generateFilearea.name + '_mapping\"]').val();\n                            }\n                            generateFileareas.push(generateFilearea);\n                        });\n                        itemdata.generatefileareas = generateFileareas;\n\n                        //Get the overall image context for the item (if any) e.g \"user_topic\" - \"A man and a boy are walking in a park\"\n                        var overallimagecontext = $(itemcontrol).find('select[name=\"overall_image_context\"]').val();\n                        itemdata.overallimagecontext = overallimagecontext;\n\n                        //get the prompt field mappings div\n                        var promptFields = [];\n                        var mappingsSelects = $(itemcontrol).find('.aigen_promptfield-mappings select');\n                        mappingsSelects.each(function () {\n                            var promptField = {};\n                            promptField.name = $(this).data('name');\n                            promptField.mapping = $(this).val();\n                            promptFields.push(promptField);\n                        });\n                        itemdata.promptfields = promptFields;\n\n                        // Add the current itemdata to the items array\n                        items.push(itemdata);\n\n                    });// End of itemcontrols.each\n\n                    var alldata = {};\n                    alldata.lessonTitle = lessonTitle;\n                    alldata.lessonDescription = lessonDescription;\n                    alldata.items = items;\n\n                    if (self.controls.fieldmappings.length) {\n                        alldata[self.controls.fieldmappings.attr('name')] = JSON.parse(self.controls.fieldmappings.val());\n                    }\n\n                    self.controls.aigenmake_textarea.val(JSON.stringify(alldata, null, 2));\n                    log.debug('AiGen make button clicked, items: ' + JSON.stringify(alldata, null,2));\n                 });\n\n                //On reload of the prompt field to contextdata mapping\n                $(document).on('click','.aigen-reload-button', function (e, data) {\n                    e.preventDefault();\n\n                    //get the prompt text area\n                    var promptTextArea = $(this).closest('.ml_aigen_item').find('textarea[name=\"aigenprompt\"]');\n                    var newprompt = promptTextArea.val();\n\n                    //update the mappings div\n                    var mappingsDiv = $(this).closest('.ml_aigen_item').find('.ml_aigen_mappings');\n                    mappingsDiv.data('promptfields',self.extractFieldsFromString(newprompt).join(','));\n\n                    //update the prompt fields mappings div\n                    var mappingsdata = {\n                        availablecontext: mappingsDiv.data('availablecontext').split(',').filter(element => element.trim() !== \"\"),\n                        aigenpromptfields: mappingsDiv.data('promptfields').split(',').filter(element => element.trim() !== \"\"),\n                    };\n                    var promptfieldmappingsDiv = $(this).closest('.ml_aigen_item').find('.aigen_promptfield-mappings');\n                    templates.render('mod_minilesson/aigenpromptfieldmappings',mappingsdata).then(\n                        function (html,js) {\n                            promptfieldmappingsDiv.html(html);\n                        }\n                    );// End of templates\n                });\n\n                //On change of the select, update the config\n                self.controls.selectgenerate.on('change', function () {\n                    self.regenerate_item_form(this);\n                });\n\n            },  // end of register_events\n\n            regenerate_item_form: function (selectgenerateelement, itemdata = null, itemcontrol = null) {\n                var self = this;\n                //get the value of the select\n                var selectedValue = $(selectgenerateelement).val();\n                //log the value\n                log.debug('Selected generate method: ' + selectedValue);\n                //the prompt text area\n                var promptTextArea = $(selectgenerateelement).closest('.ml_aigen_item').find('textarea[name=\"aigenprompt\"]');\n                var newprompt = promptTextArea.data(selectedValue + 'prompt');\n                promptTextArea.val(newprompt);\n                //If this is a reuse generate method the text area should be readonly\n                if (selectedValue === 'reuse') {\n                    promptTextArea.attr('readonly', true);\n                } else {\n                    promptTextArea.removeAttr('readonly');\n                }\n\n                //prepare the mappings div data\n                var mappingsDiv = $(selectgenerateelement).closest('.ml_aigen_item').find('.ml_aigen_mappings');\n                mappingsDiv.data('promptfields',self.extractFieldsFromString(newprompt).join(','));\n                var mappingsdata = {\n                    methodreuse: selectedValue === 'reuse',\n                    aigenplaceholders: mappingsDiv.data('aigenplaceholders').split(',').filter(element => element.trim() !== \"\"),\n                    availablecontext: mappingsDiv.data('availablecontext').split(',').filter(element => element.trim() !== \"\"),\n                    aigenpromptfields: mappingsDiv.data('promptfields').split(',').filter(element => element.trim() !== \"\"),\n                };\n\n                //prepare the files areas div data\n                var fileareasDiv = $(selectgenerateelement).closest('.ml_aigen_item').find('.ml_aigen_filearea_mappings');\n                var fileareasData = {\n                    methodreuse: selectedValue === 'reuse',\n                    aigenplaceholders: self.splitDataField(fileareasDiv.data('aigenplaceholders')),\n                    contextfileareas: self.splitDataField(fileareasDiv.data('contextfileareas')),\n                    aigenfileareas: self.splitDataField(fileareasDiv.data('aigenfileareas')),\n                    availablecontext: self.splitDataField(fileareasDiv.data('availablecontext')),\n                };\n\n                // Render mappings first, then render file areas after mappings has finished.\n                templates.render('mod_minilesson/aigenmappings', mappingsdata)\n                .then(function (html, js) {\n                    log.debug('redoing mappingsdiv: ');\n                    mappingsDiv.html(html);\n                    // Chain the second render so it runs after the first is done\n                    return templates.render('mod_minilesson/aigenfilemappings', fileareasData);\n                })\n                .then(function (html, js) {\n                    log.debug('redoing fileareadata: ');\n                    fileareasDiv.html(html);\n                }).then(function () {\n                // If we have itemdata, set the fields accordingly\n                    if (itemdata && itemcontrol) {\n                        log.debug('updating after regenerating form');\n                        self.updateTheFields(itemdata, itemcontrol);\n                    }\n                });\n            },\n\n            updateTheFields: function (theitemdata, theitemcontrol) {\n\n                //get the generate fields\n                theitemdata.generatefields.forEach(function (generateField) {\n                    var $generateCheckbox = $(theitemcontrol).find('.aigen_fields-to-generate input[type=\"checkbox\"][name=\"' + generateField.name + '\"]');\n                    $generateCheckbox.prop('checked', generateField.generate);\n                    if (generateField.generate) {\n                        if (theitemdata.generatemethod == \"reuse\") {\n                            var $mappingSelect = $(theitemcontrol).find('select[name=\"' + generateField.name + '_mapping\"]');\n                            $mappingSelect.val(generateField.mapping);\n                        }\n                    }\n                });\n\n                //set the file areas\n                theitemdata.generatefileareas.forEach(function (generateFilearea) {\n                    var $generateFileareasCheckbox = $(theitemcontrol).find('.aigen_fileareas-to-generate input[type=\"checkbox\"][name=\"' + generateFilearea.name + '\"]');\n                    $generateFileareasCheckbox.prop('checked', generateFilearea.generate);\n                    if (generateFilearea.generate) {\n                        var $mappingSelect = $(theitemcontrol).find('select[name=\"' + generateFilearea.name + '_mapping\"]');\n                        $mappingSelect.val(generateFilearea.mapping);\n                    }\n                });\n\n                //set the overall image context\n                var overallimagecontext = $(theitemcontrol).find('select[name=\"overall_image_context\"]');\n                overallimagecontext.val(theitemdata.overallimagecontext);\n\n                //set the prompt field mappings div\n                theitemdata.promptfields.forEach(function (promptField) {\n                    var $mappingsSelect = $(theitemcontrol).find('.aigen_promptfield-mappings select[data-name=\"' + promptField.name + '\"]');\n                    $mappingsSelect.val(promptField.mapping);\n                });\n            },\n\n            set_data: function () {\n                //set up the controls\n                var self = this;\n                try {\n                    var textareavalue = self.controls.aigenmake_textarea.val();\n                    var jsonvalue = JSON.parse(textareavalue);\n                    jsonvalue.items.forEach(function (itemdata, index) {\n                        var itemcontrol = $('.ml_aigen_item[data-itemnumber=\"' + index + '\"]');\n\n                        //set the prompt\n                        var promptTextArea = $(itemcontrol).find('textarea[name=\"aigenprompt\"]');\n                        promptTextArea.val(itemdata.prompt);\n\n                        //set the generate method\n                        var generateMethodSelect = $(itemcontrol).find('select[name=\"generatemethod\"]');\n                        generateMethodSelect.val(itemdata.generatemethod);\n                        promptTextArea.data(itemdata.generatemethod + 'prompt', itemdata.prompt);\n                        log.debug('Setting generate method to: ' + itemdata.generatemethod);\n                        // We need to do this to make sure the correct fields are on the page, before we set data to them.\n                        log.debug('triggering');\n\n                        // Regenerate the form and, once both renders finish, set the values for this item\n                        self.regenerate_item_form(generateMethodSelect[0], itemdata, itemcontrol);\n\n                    });\n                } catch (error) {\n                    log.debug('Invalid JSON');\n                    log.debug(error);\n                }\n            },\n\n            splitDataField: function (datafield) {\n                if (!datafield || datafield.trim() === '') {\n                    return [];\n                } else {\n                    return datafield.split(',').filter(element => element.trim() !== \"\")\n                }\n            },\n\n            extractFieldsFromString: function (input) {\n                const regex = new RegExp('\\\\{(\\\\w+)\\\\}', 'g'); // fresh regex every time\n                return Array.from(input.matchAll(regex)).reduce(function (a,i) {\n                    if (a.indexOf(i[1]) === -1) {\n                        a.push(i[1]);\n                    }\n                    return a;\n                }, []);\n            },\n\n            registerAiGenerateAction: function (wrapperselector) {\n                var self = this;\n                var wrapper = document.querySelector(wrapperselector);\n                if (wrapper) {\n                    wrapper.addEventListener('submit', function (e) {\n                        if (e.target.elements.hasOwnProperty('templateid')) {\n                            e.preventDefault();\n                            Modalfactory.create({\n                                type: Modalfactory.types.SAVE_CANCEL,\n                                title: Str.get_string('aigenmodaltitle', 'mod_minilesson'),\n                                body: self.callAiGenerateContextFormApi(e.target),\n                                large: true,\n                                removeOnClose: true\n                            }).then(function (modal) {\n                                modal.getRoot().on('submit ' + ModalEvents.save, function (e) {\n                                    e.preventDefault();\n                                    var form = this.querySelector('form');\n                                    modal.setBody(self.callAiGenerateContextFormApi(form).then(function (html, js) {\n                                        if (html === 'submitted') {\n                                            modal.destroy();\n                                            self.refreshTable(wrapper.dataset.tableuniqueid);\n                                            document.querySelector('#page')?.scrollTo({ top : 0, behavior : 'smooth' });\n                                            return ['', ''];\n                                        }\n                                        return [html, js];\n                                    }));\n                                });\n                                modal.show();\n                            });\n                        }\n                    });\n                    self.checkProgressBar(wrapper.dataset.tableuniqueid);\n                }\n            },\n\n            callAiGenerateContextFormApi: function (form) {\n                return Fragment.loadFragment(\n                    'mod_minilesson',\n                    'aigen_contextform',\n                    Config.contextid,\n                    {\n                        url: form.getAttribute('action'),\n                        params: new URLSearchParams(new FormData(form)).toString()\n                    }\n                );\n            },\n\n            refreshTable: function (tableuniqueid) {\n                var self = this;\n                try {\n                    var tableRoot = DyanamicTable.getTableFromId(tableuniqueid);\n                    DyanamicTable.refreshTableContent(tableRoot).then(function () {\n                        self.checkProgressBar(tableuniqueid);\n                    });\n                } catch (e) {\n                    log.debug(e);\n                }\n            },\n\n            checkProgressBar: function (tableuniqueid, pinginterval = 1) {\n                var self = this;\n                try {\n                    var tableRoot = DyanamicTable.getTableFromId(tableuniqueid);\n                } catch (e) {\n                    log.debug(e);\n                }\n                var table = tableRoot.querySelector('table');\n                if (!table) {\n                    return;\n                }\n                var updateinterval = parseInt(table.getAttribute('data-updateinterval'));\n                if (updateinterval > 0) {\n                    pinginterval = updateinterval;\n                }\n                if (tableRoot) {\n                    var idmap = {};\n                    tableRoot.querySelectorAll('[data-region=\"progressbar\"]')\n                    .forEach(function (progressbar) {\n                        var id = parseInt(progressbar.getAttribute('data-id'));\n                        if (id > 0) {\n                            idmap[id] = progressbar;\n                        }\n                    });\n                    var ids = Object.keys(idmap).map(parseInt);\n                    if (Object.keys(ids).length > 0) {\n                        Ajax.call([{\n                            methodname: 'mod_minilesson_update_progressbars',\n                            args: {\n                                contextid: Config.contextid,\n                                ids: ids\n                            }\n                        }])[0].then(function (response) {\n                            response.forEach(function (line) {\n                                if (ids.indexOf(line.id) > -1) {\n                                    var progressbarrow = idmap[line.id].closest('tr');\n                                    line.columns.forEach(function (coldata, index) {\n                                        if (coldata.update) {\n                                            var columntd = progressbarrow.querySelector('td.c' + index);\n                                            if (columntd) {\n                                                columntd.innerHTML = coldata.data;\n                                                columntd.dataset.column = coldata.column;\n                                            }\n                                        }\n                                    });\n                                }\n                            });\n                            setTimeout(function () {\n                                self.checkProgressBar(tableuniqueid);\n                            }, pinginterval * 1000);\n                        });\n                    }\n                }\n            },\n\n            manageFilter: function () {\n                var self = this;\n                var allcheckbox = document.querySelector('.minilesson_template_tag_all');\n                var othercheckbox = document.querySelectorAll('.minilesson_template_tag_others');\n                var allChecks = [].concat(allcheckbox, Array.from(othercheckbox));\n\n                allcheckbox.addEventListener('change', function () {\n                    othercheckbox.forEach(function (cb) {\n                        cb.disabled = allcheckbox.checked;\n                    });\n                });\n\n                document.addEventListener('change', e => {\n                    if (allChecks.includes(e.target)) {\n                        const filters = allChecks.filter(function (cb) {\n                            return cb.checked && !cb.disabled;\n                        }).map(function (cb) {\n                            return cb.value;\n                        });\n                        self.loadContents(filters);\n                    }\n                });\n            },\n\n            loadContents: function (filters) {\n                var rootelement = document.querySelector('[data-region=\"mod_minilesson_aigentemplates\"]');\n                Fragment.loadFragment(\n                    'mod_minilesson',\n                    'templates',\n                    M.cfg.contextid,\n                    {\n                        filters: JSON.stringify(filters),\n                    }\n                ).then(function (html, js) {\n                    templates.replaceNodeContents(rootelement, html, js);\n                });\n            }\n        };//end of return value\n    }\n);"],"names":["define","$","log","templates","Fragment","Modalfactory","Str","Config","ModalEvents","DyanamicTable","Ajax","debug","controls","itemdatas","itemcontrols","init","uniqid","this","init_controls","register_events","set_data","selectgenerate","aigenmakebtn","fieldmappings","aigenmake_textarea","self","on","e","items","lessonTitle","val","lessonDescription","each","index","itemcontrol","itemdata","itemnumber","Number","data","promptTextArea","find","prompt","generateMethodSelect","generatemethod","generateFieldsCheckboxes","generateFields","generateField","name","attr","generate","is","mapping","push","generatefields","generateFileareasCheckboxes","generateFileareas","generateFilearea","generatefileareas","overallimagecontext","promptFields","promptField","promptfields","alldata","length","JSON","parse","stringify","document","preventDefault","newprompt","closest","mappingsDiv","extractFieldsFromString","join","mappingsdata","availablecontext","split","filter","element","trim","aigenpromptfields","promptfieldmappingsDiv","render","then","html","js","regenerate_item_form","selectgenerateelement","selectedValue","removeAttr","methodreuse","aigenplaceholders","fileareasDiv","fileareasData","splitDataField","contextfileareas","aigenfileareas","updateTheFields","theitemdata","theitemcontrol","forEach","prop","textareavalue","error","datafield","input","regex","RegExp","Array","from","matchAll","reduce","a","i","indexOf","registerAiGenerateAction","wrapperselector","wrapper","querySelector","addEventListener","target","elements","hasOwnProperty","create","type","types","SAVE_CANCEL","title","get_string","body","callAiGenerateContextFormApi","large","removeOnClose","modal","getRoot","save","form","setBody","destroy","refreshTable","dataset","tableuniqueid","scrollTo","top","behavior","show","checkProgressBar","loadFragment","contextid","url","getAttribute","params","URLSearchParams","FormData","toString","tableRoot","getTableFromId","refreshTableContent","pinginterval","table","updateinterval","parseInt","idmap","querySelectorAll","progressbar","id","ids","Object","keys","map","call","methodname","args","response","line","progressbarrow","columns","coldata","update","columntd","innerHTML","column","setTimeout","manageFilter","allcheckbox","othercheckbox","allChecks","concat","cb","disabled","checked","includes","filters","value","loadContents","rootelement","M","cfg","replaceNodeContents"],"mappings":"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"}