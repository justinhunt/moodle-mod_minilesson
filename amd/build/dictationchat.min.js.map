{"version":3,"sources":["../src/dictationchat.js"],"names":["define","$","log","ajax","def","polly","anim","templates","debug","clone","extend","usevoice","init","index","itemdata","quizhelper","self","animopts","useanimatecss","register_events","setvoice","getItems","next_question","stepdata","hasgrade","totalitems","items","length","correctitems","filter","e","correct","grade","Math","round","stop_audio","do_next","show_item_review","forEach","item","itemwordlist","dictate_targetWords","data","push","wordmatch","join","regex","RegExp","answerclass","result","target","replace","review_data","gamebox","uniqueid","controlsbox","recorderbox","resultsbox","title","listencontroler","render","then","html","js","show","hide","runTemplateJS","on","start","audioplayerbtn","theaudio","game","pointer","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","text","displayprompt","each","realidx","dictate_targetWord","val","setTimeout","answered","nextPrompt","end","check_answer","which","srcElement","maxLength","parseInt","attributes","value","myLength","key","nextIdx","next","focus","previousIdx","previous","passage","transcript","hasClass","getComparison","comparison","gotComparison","voiceoption","text_items","sentences","map","sentence","trim","split","spliton_regexp","prompt","typed","audiourl","imageurl","Audio","src","appReady","console","allCorrect","matched","obj","wordnumber","thereply","do_animate","getWords","thetext","toLowerCase","chunks","words","i","match","callback","comparePassageToTranscript","language","ajaxresult","payloadobject","JSON","parse","updateProgressDots","showitemreview","spoken","nopunc","nopunc_regexp","dots","nonspaces_regexp","code","newprompt","nextReply","color","icon","progress","idx","dictate_targetWordsCode","word","append","newreply","first","trigger"],"mappings":"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","sourcesContent":["define(['jquery',\n  'core/log',\n  'core/ajax',\n  'mod_minilesson/definitions',\n  'mod_minilesson/pollyhelper',\n  'mod_minilesson/animatecss',\n  'core/templates'\n    ], function($, log, ajax, def, polly, anim, templates) {\n  \"use strict\"; // jshint ;_;\n\n  log.debug('MiniLesson dictation chat: initialising');\n\n  return {\n\n      //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n      },\n\n      usevoice: 'Amy',\n\n      init: function(index, itemdata, quizhelper) {\n        var self = this;\n        self.itemdata = itemdata;\n        self.quizhelper = quizhelper;\n        self.index = index;\n\n        //anim\n        var animopts = {};\n        animopts.useanimatecss=quizhelper.useanimatecss;\n        anim.init(animopts);\n\n        self.register_events();\n        self.setvoice();\n        self.getItems();\n\n    },\n    next_question:function(){\n      var self=this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems=self.items.length;\n      stepdata.correctitems=self.items.filter(function(e) {return e.correct;}).length;\n      stepdata.grade = Math.round((stepdata.correctitems/stepdata.totalitems)*100);\n\n      //stop audio\n      self.stop_audio();\n\n      //move to next question\n      self.quizhelper.do_next(stepdata);\n    },\n\n    show_item_review:function(){\n      var self=this;\n\n      self.items.forEach(function(item){\n          var itemwordlist = [];\n\n          item.dictate_targetWords.forEach(function(data) {\n              if (data !== '') {\n                  itemwordlist.push(data);\n              }\n          });\n          var wordmatch = itemwordlist.join(\"\");\n          var regex = new RegExp(wordmatch, \"gi\");\n          var answerclass = item.correct ? 'correctitem' : 'wrongitem';\n          var result = item.target.replace(regex, ` <span class=\"${answerclass}\">${wordmatch}</span>`);\n          item.target = result;\n      });\n\n      var review_data = {};\n      review_data.items = self.items;\n      review_data.totalitems=self.items.length;\n      review_data.correctitems=self.items.filter(function(e) {return e.correct;}).length;\n\n      //display results\n      var gamebox= $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_game\");\n      var controlsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_controls\");\n      var recorderbox = $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_speakbtncontainer\");\n      var resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_resultscontainer\");\n      var resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_resultscontainer\");\n      var title = $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_title\");\n      var listencontroler = $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_listen_controler\");\n      templates.render('mod_minilesson/listitemresults',review_data).then(\n        function(html,js){\n            resultsbox.html(html);\n            //show and hide\n            resultsbox.show();\n            gamebox.hide();\n            controlsbox.hide();\n            recorderbox.hide();\n            title.hide();\n            listencontroler.hide();\n            // Run js for audio player events\n            templates.runTemplateJS(js);\n        }\n      );// End of templates\n    },\n\n    register_events: function() {\n\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n        self.next_question();\n      });\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_start_btn\").on(\"click\", function() {\n        self.start();\n      });\n\n      var audioplayerbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_listen_btn\");\n      audioplayerbtn.on(\"click\", function() {\n        var theaudio = self.items[self.game.pointer].audio;\n        if(!theaudio.paused){\n          theaudio.pause();\n          theaudio.currentTime=0;\n          audioplayerbtn.children('.fa').removeClass('fa-stop');\n          audioplayerbtn.children('.fa').addClass('fa-volume-up');\n          return;\n        }\n\n        theaudio.addEventListener('ended', function () {\n          audioplayerbtn.children('.fa').removeClass('fa-stop');\n          audioplayerbtn.children('.fa').addClass('fa-volume-up');\n        });\n\n        theaudio.addEventListener('play', function () {\n          audioplayerbtn.children('.fa').removeClass('fa-volume-up');\n          audioplayerbtn.children('.fa').addClass('fa-stop');\n        });\n\n        theaudio.load();\n        theaudio.play();\n      });\n\n      //on skip button click\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_skip_btn\").on(\"click\", function() {\n        //disable buttons\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_ctrl-btn\").prop(\"disabled\", true);\n        //reveal prompt\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_speech.dictate_teacher_left\").text(self.items[self.game.pointer].displayprompt + \"\");\n        //reveal answers\n        //reveal the answer\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_targetWord\").each(function() {\n          var realidx = $(this).data(\"realidx\");\n          var dictate_targetWord = self.items[self.game.pointer].dictate_targetWords[realidx];\n          $(this).val(dictate_targetWord);\n        });\n\n\n          //move on after short time, to next prompt, or next question\n          if (self.game.pointer < self.items.length - 1) {\n            setTimeout(function() {\n              self.items[self.game.pointer].answered = true;\n              self.items[self.game.pointer].correct = false;\n              self.game.pointer++;\n              self.nextPrompt();\n            }, 3000);\n          } else {\n            self.end();\n          }\n      });\n\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_check_btn\").on(\"click\", function() {\n        self.check_answer();\n      });\n\n      //listen for enter key\n      $(\"#\" + self.itemdata.uniqueid + \"_container\").on(\"keydown\",\".dictate_targetWord\", function(e) {\n        if (e.which == 13) {\n          self.check_answer();\n        }\n      });\n\n      //auto nav between inputs\n      $(\"#\" + self.itemdata.uniqueid + \"_container\").on(\"keyup\",\".dictate_targetWord\", function(e) {\n\n        //move focus between textboxes\n        //log.debug(e);\n        var target = e.srcElement || e.target;\n        var maxLength = parseInt(target.attributes[\"maxlength\"].value, 10);\n        var myLength = target.value.length;\n        var key = e.which;\n        if (myLength >= maxLength) {\n          var nextIdx = $(this).data('idx') + 1;\n          var next = $(\"#\" + self.itemdata.uniqueid + \"_container input.dictate_targetWord[data-idx=\\\"\"+nextIdx+\"\\\"\");\n          if (next.length === 1){\n            next.focus();\n          }\n\n          // Move to previous field if empty (user pressed backspace or delete)\n        } else if (( key == 8 || key == 46 ) && myLength === 0) {\n          var previousIdx = $(this).data('idx') - 1;\n          var previous = $(\"#\" + self.itemdata.uniqueid + \"_container input.dictate_targetWord[data-idx=\\\"\"+previousIdx+\"\\\"\");\n          if (previous.length === 1){\n            previous.focus();\n          }\n        }\n      });\n\n    },\n\n    game: {\n      pointer: 0\n    },\n\n    check_answer: function(){\n      var self = this;\n      var passage = self.items[self.game.pointer].target;\n      var transcript = '';\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_targetBit\").each(function() {\n        if($(this).hasClass('dictate_targetWord')){\n          transcript += $(this).val();\n        }else if($(this).hasClass('dictate_targetWordPunc')){\n          transcript += $(this).text();\n        }\n      });\n\n    //the old code looped over dictate_targetWord, pushed to transcriptArray, and joined with a space\n    //But that did not account for words split by punc, eg It's.\n      // Kept that here for now, but can delete  I think.\n      /*\n      var transcriptArray = [];\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_targetWord\").each(function() {\n        transcriptArray.push($(this).val().trim() == \"\" ? \"|\" : $(this).val().trim());\n      });\n     var transcript = transcriptArray.join(\" \");\n    */\n\n      self.getComparison(passage, transcript, function(comparison) {\n        self.gotComparison(comparison, transcript);\n      });\n    },\n    setvoice: function() {\n        var self = this;\n        self.usevoice = self.itemdata.usevoice;\n        self.voiceoption=self.itemdata.voiceoption;\n        return;\n    },\n    getItems: function() {\n      var self = this;\n      var text_items = self.itemdata.sentences;\n\n      self.items = text_items.map(function(target) {\n        return {\n          dictate_targetWords: target.sentence.trim().split(self.quizhelper.spliton_regexp).filter(function(e) {\n            return e !== \"\";\n          }),\n          target: target.sentence,\n          prompt: target.prompt,\n          displayprompt: target.displayprompt,\n          typed: \"\",\n          answered: false,\n          correct: false,\n          audio: null,\n          audiourl: target.audiourl ? target.audiourl : \"\",\n          imageurl: target.imageurl,\n        };\n      }).filter(function(e) {\n        return e.target !== \"\";\n      });\n\n      $.each(self.items, function(index, item) {\n          item.audio = new Audio();\n          item.audio.src = item.audiourl;\n          if (self.items.filter(function(e) {\n              return e.audio == null;\n            }).length == 0) {\n            self.appReady();\n          } else {\n            console.log(self.items);\n          }\n      });\n\n    },\n    appReady: function() {\n      var self = this;\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_not_loaded\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_loaded\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_start_btn\").prop(\"disabled\", false);\n    },\n    gotComparison: function(comparison, typed) {\n\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_targetWord\").removeClass(\"dictate_correct dictate_incorrect\");\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_feedback\").removeClass(\"fa fa-check fa-times\");\n\n      var allCorrect = comparison.filter(function(e) {\n        return !e.matched;\n      }).length == 0;\n\n      if (allCorrect) {\n\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_targetWord\").addClass(\"dictate_correct\").prop(\"disabled\",true);\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_feedback\").addClass(\"fa fa-check\");\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_speech.dictate_teacher_left\").text(self.items[self.game.pointer].displayprompt + \"\");\n\n        self.items[self.game.pointer].answered = true;\n        self.items[self.game.pointer].correct = true;\n        self.items[self.game.pointer].typed = typed;\n\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_ctrl-btn\").prop(\"disabled\", true);\n        if (self.game.pointer < self.items.length - 1) {\n          setTimeout(function() {\n            self.game.pointer++;\n            self.nextPrompt();\n          }, 2200);\n        } else {\n            self.end();\n        }\n\n      } else {\n\n        comparison.forEach(function(obj) {\n          if (!obj.matched) {\n            $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_targetWord[data-idx='\" + obj.wordnumber + \"']\").addClass(\"dictate_incorrect\");\n            $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_feedback[data-idx='\" + obj.wordnumber + \"']\").addClass(\"fa fa-times\");\n          } else {\n            $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_targetWord[data-idx='\" + obj.wordnumber + \"']\").addClass(\"dictate_correct\").prop(\"disabled\",true);\n            $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_feedback[data-idx='\" + obj.wordnumber + \"']\").addClass(\"fa fa-check\");\n          }\n        });\n        var thereply = $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_reply_\" + self.game.pointer);\n        anim.do_animate(thereply,'shakeX animate__faster').then(\n            function() {$(\"#\" + self.itemdata.uniqueid + \"_container .dictate_ctrl-btn\").prop(\"disabled\", false);}\n        );\n        /*\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_reply_\" + self.game.pointer).effect(\"shake\", function() {\n          $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_ctrl-btn\").prop(\"disabled\", false);\n        }\n        );\n        */\n\n      }\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_targetWord.dictate_correct\").each(function() {\n        var realidx = $(this).data(\"realidx\");\n        var dictate_targetWord = self.items[self.game.pointer].dictate_targetWords[realidx];\n        $(this).val(dictate_targetWord);\n      });\n\n    },\n    getWords: function(thetext) {\n      var self = this;\n      var checkcase = false;\n      if (checkcase == 'false') {\n        thetext = thetext.toLowerCase();\n      }\n      var chunks = thetext.split(self.quizhelper.spliton_regexp).filter(function(e) {\n        return e !== \"\";\n      });\n      var words = [];\n      for (var i = 0; i < chunks.length; i++) {\n        if (!chunks[i].match(self.quizhelper.spliton_regexp)) {\n          words.push(chunks[i]);\n        }\n      }\n      return words;\n    },\n    getComparison: function(passage, transcript, callback) {\n        var self = this;\n\n        $(\".dictate_ctrl-btn\").prop(\"disabled\", true);\n        var phonetic ='';//we do not want a phonetic match in dictation.\n        self.quizhelper.comparePassageToTranscript(passage,transcript,phonetic,self.itemdata.language).then(function(ajaxresult) {\n            var payloadobject = JSON.parse(ajaxresult);\n            if (payloadobject) {\n                callback(payloadobject);\n            } else {\n                callback(false);\n            }\n        });\n\n    },\n\n    end: function() {\n      var self = this;\n      $(\".minilesson_nextbutton\").prop(\"disabled\",true);\n\n      //progress dots are updated on next_item. The last item has no next item, so we update from here\n      self.updateProgressDots();\n\n      //disable the buttons and go to next question or review\n      setTimeout(function() {\n        $(\".minilesson_nextbutton\").prop(\"disabled\",false);\n        if(self.quizhelper.showitemreview){\n          self.show_item_review();\n        }else{\n          self.next_question();\n        }\n      }, 2200);\n    },\n\n    start: function() {\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_ctrl-btn\").prop(\"disabled\", true);\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_title\").show();\n\n      self.items.forEach(function(item) {\n        item.spoken = \"\";\n        item.answered = false;\n        item.correct = false;\n      });\n\n      self.game.pointer = 0;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_game\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_start_btn\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_mainmenu\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_controls\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_image_container\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_description\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_maintitle\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_listen_controler\").show();\n\n      self.nextPrompt();\n\n    },\n    nextPrompt: function() {\n\n      var self = this;\n      var target = self.items[self.game.pointer].target;\n      var prompt = self.items[self.game.pointer].prompt;\n      var displayprompt = self.items[self.game.pointer].displayprompt;\n\n      var nopunc = prompt.replace(self.quizhelper.nopunc_regexp,\"\");\n      var dots = nopunc.replace(self.quizhelper.nonspaces_regexp, 'â€¢');\n      var code = \"<div class='dictate_prompt dictate_prompt_\" + self.game.pointer + \"' style='display:none;'>\";\n\n      code += \"<i class='fa fa-graduation-cap dictate_speech-icon-left'></i>\";\n      code += \"<div style='margin-left:90px;' class='dictate_speech dictate_teacher_left'>\";\n      code += dots;\n      code += \"</div>\";\n      code += \"</div>\";\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_game\").html(code);\n      $(\".dictate_ctrl-btn\").prop(\"disabled\", false);\n\n      self.updateProgressDots();\n\n      var newprompt = $(\".dictate_prompt_\" + self.game.pointer);\n      anim.do_animate(newprompt,'zoomIn animate__faster','in').then(\n          function(){}\n      );\n      /*\n      $(\".dictate_prompt_\" + self.game.pointer).toggle(\"slide\", {\n        direction: 'left'\n      });\n       */\n\n      self.nextReply();\n\n    },\n\n    updateProgressDots: function() {\n      var self = this;\n      var color,icon;\n      var progress = self.items.map(function(item, idx) {\n        color = \"#E6E9FD\";\n        icon = \"fa fa-square\";\n        if (self.items[idx].answered && self.items[idx].correct) {\n          color = \"#74DC72\";\n          icon = 'fa fa-check-square';\n        } else if (self.items[idx].answered && !self.items[idx].correct) {\n          color = \"#FB6363\";\n          icon = \"fa fa-window-close\";\n        }\n        return \"<i style='color:\" + color + \"' class='\"+ icon +\" pl-1'></i>\";\n      }).join(\" \");\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_title\").html(progress);\n    },\n\n    nextReply: function() {\n      var self = this;\n      var target = self.items[self.game.pointer].target;\n      var code = \"<div class='dictate_reply dictate_reply_\" + self.game.pointer + \"' style='display:none;'>\";\n      code += \"<i class='fa fa-user dictate_speech-icon-right'></i>\";\n      var dictate_targetWordsCode = \"\";\n      var idx = 1;\n      self.items[self.game.pointer].dictate_targetWords.forEach(function(word, realidx) {\n        if (!word.match(self.quizhelper.spliton_regexp)) {\n          dictate_targetWordsCode += \"<ruby><input type='text' maxlength='\" + word.length + \"' size='\" + (word.length + 1) + \"' class='dictate_targetBit dictate_targetWord' data-realidx='\" + realidx + \"' data-idx='\" + idx + \"'><rt><i data-idx='\" + idx + \"' class='dictate_feedback'></i></rt></ruby>\";\n          idx++;\n        } else {\n          dictate_targetWordsCode += \"<span class='dictate_targetBit dictate_targetWordPunc' data-idx='\" + idx + \"'>\" + word + \"</span>\";\n        }\n      });\n      code += \"<div style='margin-right:90px;' class='dictate_speech dictate_right'>\" + dictate_targetWordsCode + \"</div>\";\n      code += \"</div>\";\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_game\").append(code);\n      var newreply = $(\".dictate_reply_\" + self.game.pointer);\n      anim.do_animate(newreply,'zoomIn animate__faster','in').then(\n          function(){}\n      );\n      /*\n      $(\".dictate_reply_\" + self.game.pointer).toggle(\"slide\", {\n        direction: 'right'\n      });\n       */\n      $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_ctrl-btn\").prop(\"disabled\", false);\n      setTimeout(function() {\n        $(\".dictate_targetWord\").first().focus();\n        $(\"#\" + self.itemdata.uniqueid + \"_container .dictate_listen_btn\").trigger('click');\n      }, 500);\n    },\n\n    // Stop audio .. usually when leaving the item or sentence\n    stop_audio: function(){\n      var self =this;\n      //pause audio if its playing\n      var theaudio = self.items[self.game.pointer].audio;\n      if(theaudio && !theaudio.paused) {\n        theaudio.pause();\n      }\n    }\n\n  };\n});"],"file":"dictationchat.min.js"}