define("mod_minilesson/h5p",["jquery","core/log","mod_minilesson/definitions"],(function($,log,def,anim){return log.debug("MiniLesson H5P: initialising"),{clone:function(){return $.extend(!0,{correctitems:0,totalitems:0},this)},init:function(index,itemdata,quizhelper){this.itemdata=itemdata,this.register_events(index,itemdata,quizhelper),log.debug("MiniLesson H5P URL: "+itemdata.h5purl),log.debug("MiniLesson H5P Total Marks: "+itemdata.totalmarks)},next_question:function(){var stepdata={};stepdata.index=this.index,stepdata.hasgrade=!0,stepdata.totalitems=this.totalitems,stepdata.correctitems=this.correctitems,stepdata.grade=this.totalitems>0?100*this.correctitems/this.totalitems:0,this.quizhelper.do_next(stepdata)},register_events:function(index,itemdata,quizhelper){var self=this;self.index=index,self.quizhelper=quizhelper;var h5pplayer=$("#"+itemdata.uniqueid+"_h5pplayer");$("#"+itemdata.uniqueid+"_container .minilesson_nextbutton").on("click",(function(e){self.next_question()}));var iframe=h5pplayer.find("iframe")[0];iframe&&addEventListener("message",(event=>{window!==event.target||"h5p"!==event.data.context||iframe.getAttribute("data-gradelistener")||(iframe.contentWindow.H5P.externalDispatcher.on("xAPI",(function(event){event.getMaxScore()>0&&(console.log("gradehit"),self.correctitems=event.getScore(),self.totalitems=event.getMaxScore())})),iframe.setAttribute("data-gradelistener",1))}))}}}));

//# sourceMappingURL=h5p.min.js.map