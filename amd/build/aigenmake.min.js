define("mod_minilesson/aigenmake",["jquery","core/log","core/templates"],(function($,log,templates){return log.debug("MiniLesson AiGen Config Maker: initialising"),{controls:{},init:function(uniqid){this.init_controls(uniqid),this.register_events(uniqid)},init_controls:function(uniqid){this.controls.selectgenerate=$("#"+uniqid+' select[name="generatemethod"]'),this.controls.aigenmakebtn=$("#"+uniqid+"_aigen_make_btn")},register_events:function(uniqid){var self=this;self.controls.aigenmakebtn.on("click",(function(e){e.preventDefault();var items=[],itemcontrols=$(".ml_aigen_item"),aigenmake_textarea=$("#"+uniqid+"_aigen_make_textarea"),lessonTitle=$("#"+uniqid+"_ml_aigen_lesson_title input").val(),lessonDescription=$("#"+uniqid+"_ml_aigen_lesson_description textarea").val();itemcontrols.each((function(index,itemcontrol){var itemdata={};itemdata.itemnumber=Number($(itemcontrol).data("itemnumber"));var promptTextArea=$(itemcontrol).find('textarea[name="aigenprompt"]');itemdata.prompt=promptTextArea.val();var generateMethodSelect=$(itemcontrol).find('select[name="generatemethod"]');itemdata.generatemethod=generateMethodSelect.val();var generateFieldsCheckboxes=$(itemcontrol).find('.aigen_fields-to-generate input[type="checkbox"]'),generateFields=[];generateFieldsCheckboxes.each((function(){var generateField={};generateField.name=$(this).attr("name"),generateField.generate=$(this).is(":checked")?1:0,"reuse"==itemdata.generatemethod&&generateField.generate?generateField.mapping=$(itemcontrol).find('select[name="'+generateField.name+'_mapping"]').val():generateField.mapping="",generateFields.push(generateField)})),itemdata.generatefields=generateFields;var generateFileareasCheckboxes=$(itemcontrol).find('.aigen_fileareas-to-generate input[type="checkbox"]'),generateFileareas=[];generateFileareasCheckboxes.each((function(){var generateFilearea={};generateFilearea.name=$(this).attr("name"),generateFilearea.generate=$(this).is(":checked")?1:0,generateFilearea.generate&&(generateFilearea.mapping=$(itemcontrol).find('select[name="'+generateFilearea.name+'_mapping"]').val()),generateFileareas.push(generateFilearea)})),itemdata.generatefileareas=generateFileareas;var promptFields=[];$(itemcontrol).find(".aigen_promptfield-mappings select").each((function(){var promptField={};promptField.name=$(this).data("name"),promptField.mapping=$(this).val(),promptFields.push(promptField)})),itemdata.promptfields=promptFields,items.push(itemdata)}));var alldata={};alldata.lessonTitle=lessonTitle,alldata.lessonDescription=lessonDescription,alldata.items=items,aigenmake_textarea.val(JSON.stringify(alldata,null,2)),log.debug("AiGen make button clicked, items: "+JSON.stringify(alldata,null,2))})),$(document).on("click",".aigen-reload-button",(function(e,data){e.preventDefault();var newprompt=$(this).closest(".ml_aigen_item").find('textarea[name="aigenprompt"]').val(),mappingsDiv=$(this).closest(".ml_aigen_item").find(".ml_aigen_mappings");mappingsDiv.data("promptfields",self.extractFieldsFromString(newprompt).join(","));var mappingsdata={availablecontext:mappingsDiv.data("availablecontext").split(",").filter((element=>""!==element.trim())),aigenpromptfields:mappingsDiv.data("promptfields").split(",").filter((element=>""!==element.trim()))},promptfieldmappingsDiv=$(this).closest(".ml_aigen_item").find(".aigen_promptfield-mappings");templates.render("mod_minilesson/aigenpromptfieldmappings",mappingsdata).then((function(html,js){promptfieldmappingsDiv.html(html)}))})),self.controls.selectgenerate.on("change",(function(){var selectedValue=$(this).val();log.debug("Selected generate method: "+selectedValue);var promptTextArea=$(this).closest(".ml_aigen_item").find('textarea[name="aigenprompt"]'),newprompt=promptTextArea.data(selectedValue+"prompt");promptTextArea.val(newprompt),"reuse"===selectedValue?promptTextArea.attr("readonly",!0):promptTextArea.removeAttr("readonly");var mappingsDiv=$(this).closest(".ml_aigen_item").find(".ml_aigen_mappings");mappingsDiv.data("promptfields",self.extractFieldsFromString(newprompt).join(","));var mappingsdata={methodreuse:"reuse"==selectedValue,aigenplaceholders:mappingsDiv.data("aigenplaceholders").split(",").filter((element=>""!==element.trim())),availablecontext:mappingsDiv.data("availablecontext").split(",").filter((element=>""!==element.trim())),aigenpromptfields:mappingsDiv.data("promptfields").split(",").filter((element=>""!==element.trim()))};templates.render("mod_minilesson/aigenmappings",mappingsdata).then((function(html,js){log.debug("redoing mappingsdiv: "),mappingsDiv.html(html)}));var fileareasDiv=$(this).closest(".ml_aigen_item").find(".ml_aigen_filearea_mappings"),fileareasData={methodreuse:"reuse"==selectedValue,aigenplaceholders:self.splitDataField(fileareasDiv.data("aigenplaceholders")),contextfileareas:self.splitDataField(fileareasDiv.data("contextfileareas")),aigenfileareas:self.splitDataField(fileareasDiv.data("aigenfileareas"))};templates.render("mod_minilesson/aigenfilemappings",fileareasData).then((function(html,js){log.debug("redoing fileareadata: "),fileareasDiv.html(html)}))}))},splitDataField:function(datafield){return datafield&&""!==datafield.trim()?datafield.split(",").filter((element=>""!==element.trim())):[]},extractFieldsFromString:function(input){const regex=/\{(\w+)\}/g,matches=[];let match;for(;null!==(match=regex.exec(input));)matches.push(match[1]);return[...new Set(matches)]}}}));

//# sourceMappingURL=aigenmake.min.js.map