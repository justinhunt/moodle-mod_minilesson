{"version":3,"file":"quizfinished.min.js","sources":["../src/quizfinished.js"],"sourcesContent":["define(['jquery', 'core/log','core/modal_factory','core/str','core/modal_events',\n        'mod_minilesson/definitions','core/templates', 'mod_minilesson/correctionsmarkup',\n        'mod_minilesson/passagereading'],\n    function($, log,ModalFactory, str, ModalEvents, def, templates, correctionsmarkup, passagereading) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('Poodll Minilesson Finished page: initialising');\n\n  return {\n\n    strings: {},\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function() {\n        this.init_strings();\n        this.register_events();\n\n    },\n\n    register_events: function(){\n        var that = this;\n        $('body').on('click','.btn_finished_attempt',function(e) {\n\n            e.preventDefault();\n            var buttonhref= $(this).data('href');\n\n            //if its not a reattempt ... proceed\n            if($(this).data('action')!=='reattempt') {\n                window.location.href = buttonhref;\n                return;\n            }\n\n            //if its a reattempt, confirm and proceed\n            ModalFactory.create({\n                type: ModalFactory.types.SAVE_CANCEL,\n                title: that.strings.reattempttitle,\n                body: that.strings.reattemptbody\n            })\n            .then(function(modal) {\n                modal.setSaveButtonText(that.strings.reattempt);\n                var root = modal.getRoot();\n                root.on(ModalEvents.save, function() {\n                    window.location.href = buttonhref;\n                });\n                modal.show();\n            });\n      });\n\n      $('body').on('click','.mod_minilesson_finishedanswerdetailslink',function(e) {\n          e.preventDefault();\n          var type = $(this).data('type');\n          var resultstemplate = $(this).data('resultstemplate');\n          var resultsdata = $(this).data('resultsdata');\n          var thetarget = $(this).data('target');\n          if(thetarget === undefined){return;}\n          var resultsbox = $('#' + thetarget);\n          if(resultsbox === undefined){return;}\n          if(resultsbox.is(':visible')){\n              resultsbox.hide();\n              return;\n          }\n          if(!resultsbox.is(':visible') && resultsbox.html().length > 0){\n              resultsbox.show();\n              return;\n          }\n          //otherwise load the results and show the box\n          templates.render('mod_minilesson/' + resultstemplate,resultsdata).then(\n              function(html,js){\n                  resultsbox.html(html);\n                  //do corrections markup .. if we have them\n                  if(resultsdata.hasOwnProperty('grammarerrors')){\n                      correctionsmarkup.init({ \"correctionscontainer\": resultsbox,\n                          \"grammarerrors\": resultsdata.grammarerrors,\n                          \"grammarmatches\": resultsdata.grammarmatches,\n                          \"insertioncount\": resultsdata.insertioncount});\n                  }\n                  //do passage results\n                  if(resultsdata.hasOwnProperty('unreached')){\n                      passagereading.doComparisonMarkup(resultsdata.comparison,thetarget);\n                  }\n\n                  //show and hide\n                  resultsbox.show();\n                  templates.runTemplateJS(js);\n              }\n          );// End of templates\n      });\n    },\n\n    init_strings: function(){\n        var that = this;\n        // set up strings\n        str.get_strings([\n            {\"key\": \"reattempttitle\",       \"component\": 'mod_minilesson'},\n            {\"key\": \"reattemptbody\",           \"component\": 'mod_minilesson'},\n            {\"key\": \"reattempt\",           \"component\": 'mod_minilesson'}\n\n        ]).done(function(s) {\n            var i = 0;\n            that.strings.reattempttitle = s[i++];\n            that.strings.reattemptbody = s[i++];\n            that.strings.reattempt = s[i++];\n        });\n    }\n  };\n});"],"names":["define","$","log","ModalFactory","str","ModalEvents","def","templates","correctionsmarkup","passagereading","debug","strings","clone","extend","this","init","init_strings","register_events","that","on","e","preventDefault","buttonhref","data","create","type","types","SAVE_CANCEL","title","reattempttitle","body","reattemptbody","then","modal","setSaveButtonText","reattempt","getRoot","save","window","location","href","show","resultstemplate","resultsdata","thetarget","undefined","resultsbox","is","hide","html","length","render","js","hasOwnProperty","grammarerrors","grammarmatches","insertioncount","doComparisonMarkup","comparison","runTemplateJS","get_strings","done","s","i"],"mappings":"AAAAA,qCAAO,CAAC,SAAU,WAAW,qBAAqB,WAAW,oBACrD,6BAA6B,iBAAkB,mCAC/C,kCACJ,SAASC,EAAGC,IAAIC,aAAcC,IAAKC,YAAaC,IAAKC,UAAWC,kBAAmBC,uBAOrFP,IAAIQ,MAAM,iDAEH,CAELC,QAAS,GAGPC,MAAO,kBACIX,EAAEY,QAAO,EAAM,GAAIC,OAGhCC,KAAM,gBACGC,oBACAC,mBAITA,gBAAiB,eACTC,KAAOJ,KACXb,EAAE,QAAQkB,GAAG,QAAQ,yBAAwB,SAASC,GAElDA,EAAEC,qBACEC,WAAYrB,EAAEa,MAAMS,KAAK,QAGD,cAAzBtB,EAAEa,MAAMS,KAAK,UAMhBpB,aAAaqB,OAAO,CAChBC,KAAMtB,aAAauB,MAAMC,YACzBC,MAAOV,KAAKP,QAAQkB,eACpBC,KAAMZ,KAAKP,QAAQoB,gBAEtBC,MAAK,SAASC,OACXA,MAAMC,kBAAkBhB,KAAKP,QAAQwB,WAC1BF,MAAMG,UACZjB,GAAGd,YAAYgC,MAAM,WACtBC,OAAOC,SAASC,KAAOlB,cAE3BW,MAAMQ,UAhBNH,OAAOC,SAASC,KAAOlB,cAoBjCrB,EAAE,QAAQkB,GAAG,QAAQ,6CAA4C,SAASC,GACtEA,EAAEC,iBACSpB,EAAEa,MAAMS,KAAK,YACpBmB,gBAAkBzC,EAAEa,MAAMS,KAAK,mBAC/BoB,YAAc1C,EAAEa,MAAMS,KAAK,eAC3BqB,UAAY3C,EAAEa,MAAMS,KAAK,kBACZsB,IAAdD,eACCE,WAAa7C,EAAE,IAAM2C,gBACPC,IAAfC,aACAA,WAAWC,GAAG,YACbD,WAAWE,QAGXF,WAAWC,GAAG,aAAeD,WAAWG,OAAOC,OAAS,EACxDJ,WAAWL,OAIflC,UAAU4C,OAAO,kBAAoBT,gBAAgBC,aAAaX,MAC9D,SAASiB,KAAKG,IACVN,WAAWG,KAAKA,MAEbN,YAAYU,eAAe,kBAC1B7C,kBAAkBO,KAAK,sBAA0B+B,yBAC5BH,YAAYW,6BACXX,YAAYY,8BACZZ,YAAYa,iBAGnCb,YAAYU,eAAe,cAC1B5C,eAAegD,mBAAmBd,YAAYe,WAAWd,WAI7DE,WAAWL,OACXlC,UAAUoD,cAAcP,aAMtCpC,aAAc,eACNE,KAAOJ,KAEXV,IAAIwD,YAAY,CACZ,KAAQ,2BAAqC,kBAC7C,KAAQ,0BAAwC,kBAChD,KAAQ,sBAAoC,oBAE7CC,MAAK,SAASC,OACTC,EAAI,EACR7C,KAAKP,QAAQkB,eAAiBiC,EAAEC,KAChC7C,KAAKP,QAAQoB,cAAgB+B,EAAEC,KAC/B7C,KAAKP,QAAQwB,UAAY2B,EAAEC"}