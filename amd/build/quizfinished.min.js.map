{"version":3,"sources":["../src/quizfinished.js"],"names":["define","$","log","ModalFactory","str","ModalEvents","def","templates","correctionsmarkup","passagereading","debug","strings","clone","extend","init","init_strings","register_events","that","on","e","preventDefault","buttonhref","data","window","location","href","create","type","types","SAVE_CANCEL","title","reattempttitle","body","reattemptbody","then","modal","setSaveButtonText","reattempt","root","getRoot","save","show","showbutton","document","querySelector","target","id","textContent","dataset","hideText","showText","resultstemplate","resultsdata","teacherreport","thetarget","resultsbox","is","hide","html","length","render","js","hasOwnProperty","grammarerrors","grammarmatches","insertioncount","doComparisonMarkup","comparison","runTemplateJS","get_strings","done","s","i"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log','core/modal_factory','core/str','core/modal_events',\n        'mod_minilesson/definitions','core/templates', 'mod_minilesson/correctionsmarkup',\n        'mod_minilesson/passagereading'],\n    function($, log,ModalFactory, str, ModalEvents, def, templates, correctionsmarkup, passagereading) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('Poodll Minilesson Finished page: initialising');\n\n  return {\n\n    strings: {},\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function() {\n        this.init_strings();\n        this.register_events();\n\n    },\n\n    register_events: function(){\n        var that = this;\n        $('body').on('click','.btn_finished_attempt',function(e) {\n\n            e.preventDefault();\n            var buttonhref= $(this).data('href');\n\n            //if its not a reattempt ... proceed\n            if($(this).data('action')!=='reattempt') {\n                window.location.href = buttonhref;\n                return;\n            }\n\n            //if its a reattempt, confirm and proceed\n            ModalFactory.create({\n                type: ModalFactory.types.SAVE_CANCEL,\n                title: that.strings.reattempttitle,\n                body: that.strings.reattemptbody\n            })\n            .then(function(modal) {\n                modal.setSaveButtonText(that.strings.reattempt);\n                var root = modal.getRoot();\n                root.on(ModalEvents.save, function() {\n                    window.location.href = buttonhref;\n                });\n                modal.show();\n            });\n      });\n\n    var showbutton = document.querySelector('.itemscoresbutton');\n    $('#itemscores').on('hidden.bs.collapse shown.bs.collapse', function (e) {\n        if (e.target.id === 'itemscores' && showbutton) {\n            if (e.type === 'shown') {\n                showbutton.textContent = showbutton.dataset.hideText;\n            } else {\n                showbutton.textContent = showbutton.dataset.showText;\n            }\n        }\n    })\n\n      $('body').on('click','.mod_minilesson_finishedanswerdetailslink',function(e) {\n          e.preventDefault();\n          var type = $(this).data('type');\n          var resultstemplate = $(this).data('resultstemplate');\n          var resultsdata = $(this).data('resultsdata');\n          var teacherreport = $(this).data('teacherreport');\n          resultsdata.teacherreport = teacherreport;\n\n          var thetarget = $(this).data('target');\n          if(thetarget === undefined){return;}\n          var resultsbox = $('#' + thetarget);\n          if(resultsbox === undefined){return;}\n          if(resultsbox.is(':visible')){\n              resultsbox.hide();\n              return;\n          }\n          if(!resultsbox.is(':visible') && resultsbox.html().length > 0){\n              resultsbox.show();\n              return;\n          }\n          //otherwise load the results and show the box\n          templates.render('mod_minilesson/' + resultstemplate,resultsdata).then(\n              function(html,js){\n                  resultsbox.html(html);\n                  //do corrections markup .. if we have them\n                  if(resultsdata.hasOwnProperty('grammarerrors')){\n                      correctionsmarkup.init({ \"correctionscontainer\": resultsbox,\n                          \"grammarerrors\": resultsdata.grammarerrors,\n                          \"grammarmatches\": resultsdata.grammarmatches,\n                          \"insertioncount\": resultsdata.insertioncount});\n                  }\n                  //do passage results\n                  if(resultsdata.hasOwnProperty('unreached')){\n                      passagereading.doComparisonMarkup(resultsdata.comparison,thetarget);\n                  }\n\n                  //show and hide\n                  resultsbox.show();\n                  templates.runTemplateJS(js);\n              }\n          );// End of templates\n      });\n    },\n\n    init_strings: function(){\n        var that = this;\n        // set up strings\n        str.get_strings([\n            {\"key\": \"reattempttitle\",       \"component\": 'mod_minilesson'},\n            {\"key\": \"reattemptbody\",           \"component\": 'mod_minilesson'},\n            {\"key\": \"reattempt\",           \"component\": 'mod_minilesson'}\n\n        ]).done(function(s) {\n            var i = 0;\n            that.strings.reattempttitle = s[i++];\n            that.strings.reattemptbody = s[i++];\n            that.strings.reattempt = s[i++];\n        });\n    }\n  };\n});"],"file":"quizfinished.min.js"}