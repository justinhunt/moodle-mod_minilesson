{"version":3,"file":"quizfinished.min.js","sources":["../src/quizfinished.js"],"sourcesContent":["define(\n    ['jquery', 'core/log','core/modal_factory','core/str','core/modal_events',\n        'mod_minilesson/definitions','core/templates', 'mod_minilesson/correctionsmarkup',\n        'mod_minilesson/passagereading'],\n    function ($, log,ModalFactory, str, ModalEvents, def, templates, correctionsmarkup, passagereading) {\n        \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the quiz stage\n    */\n\n        log.debug('Poodll Minilesson Finished page: initialising');\n\n        return {\n\n            strings: {},\n\n          //for making multiple instances\n            clone: function () {\n                return $.extend(true, {}, this);\n            },\n\n            init: function () {\n                this.init_strings();\n                this.register_events();\n\n            },\n\n            register_events: function () {\n                var that = this;\n                $('body').on('click','.btn_finished_attempt',function (e) {\n\n                          e.preventDefault();\n                          var buttonhref = $(this).data('href');\n\n                          //if its not a reattempt ... proceed\n                    if ($(this).data('action') !== 'reattempt') {\n                        window.location.href = buttonhref;\n                        return;\n                    }\n\n                  //if its a reattempt, confirm and proceed\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: that.strings.reattempttitle,\n                        body: that.strings.reattemptbody\n                            })\n                          .then(function (modal) {\n                              modal.setSaveButtonText(that.strings.reattempt);\n                              var root = modal.getRoot();\n                              root.on(ModalEvents.save, function () {\n                                  window.location.href = buttonhref;\n                              });\n                              modal.show();\n                          });\n                });\n\n                var showbutton = document.querySelector('.itemscoresbutton');\n                $('#itemscores').on('hidden.bs.collapse shown.bs.collapse', function (e) {\n                    if (e.target.id === 'itemscores' && showbutton) {\n                        if (e.type === 'shown') {\n                            showbutton.textContent = showbutton.dataset.hideText;\n                        } else {\n                            showbutton.textContent = showbutton.dataset.showText;\n                        }\n                    }\n                })\n\n                $('body').on('click','.mod_minilesson_finishedanswerdetailslink',function (e) {\n                            e.preventDefault();\n                            var type = $(this).data('type');\n                            var resultstemplate = $(this).data('resultstemplate');\n                            var resultsdata = $(this).data('resultsdata');\n                            var teacherreport = $(this).data('teacherreport');\n                            resultsdata.teacherreport = teacherreport;\n\n                            var thetarget = $(this).data('target');\n                    if (thetarget === undefined) {\n                        return;}\n                    var resultsbox = $('#' + thetarget);\n                    if (resultsbox === undefined) {\n                        return;}\n                    if (resultsbox.is(':visible')) {\n                        resultsbox.hide();\n                        return;\n                    }\n                    if (!resultsbox.is(':visible') && resultsbox.html().length > 0) {\n                        resultsbox.show();\n                        return;\n                    }\n        //otherwise load the results and show the box\n                    templates.render('mod_minilesson/' + resultstemplate,resultsdata).then(\n                        function (html,js) {\n                            resultsbox.html(html);\n                            //do corrections markup .. if we have them\n                            if (resultsdata.hasOwnProperty('grammarerrors')) {\n                                correctionsmarkup.init({ \"correctionscontainer\": resultsbox,\n                                    \"grammarerrors\": resultsdata.grammarerrors,\n                                    \"grammarmatches\": resultsdata.grammarmatches,\n                                    \"insertioncount\": resultsdata.insertioncount});\n                            }\n                            //do passage results\n                            if (resultsdata.hasOwnProperty('unreached')) {\n                                passagereading.doComparisonMarkup(resultsdata.comparison,thetarget);\n                            }\n\n                            //show and hide\n                            resultsbox.show();\n                            templates.runTemplateJS(js);\n                        }\n                    );// End of templates\n                });\n            },\n\n            init_strings: function () {\n                var that = this;\n        // set up strings\n                str.get_strings([\n                {\"key\": \"reattempttitle\",       \"component\": 'mod_minilesson'},\n                {\"key\": \"reattemptbody\",           \"component\": 'mod_minilesson'},\n                {\"key\": \"reattempt\",           \"component\": 'mod_minilesson'}\n\n                ]).done(function (s) {\n                          var i = 0;\n                          that.strings.reattempttitle = s[i++];\n                          that.strings.reattemptbody = s[i++];\n                          that.strings.reattempt = s[i++];\n                });\n            }\n        };\n    }\n);"],"names":["define","$","log","ModalFactory","str","ModalEvents","def","templates","correctionsmarkup","passagereading","debug","strings","clone","extend","this","init","init_strings","register_events","that","on","e","preventDefault","buttonhref","data","create","type","types","SAVE_CANCEL","title","reattempttitle","body","reattemptbody","then","modal","setSaveButtonText","reattempt","getRoot","save","window","location","href","show","showbutton","document","querySelector","target","id","textContent","dataset","hideText","showText","resultstemplate","resultsdata","teacherreport","thetarget","undefined","resultsbox","is","hide","html","length","render","js","hasOwnProperty","grammarerrors","grammarmatches","insertioncount","doComparisonMarkup","comparison","runTemplateJS","get_strings","done","s","i"],"mappings":"AAAAA,qCACI,CAAC,SAAU,WAAW,qBAAqB,WAAW,oBAClD,6BAA6B,iBAAkB,mCAC/C,kCACJ,SAAUC,EAAGC,IAAIC,aAAcC,IAAKC,YAAaC,IAAKC,UAAWC,kBAAmBC,uBAOhFP,IAAIQ,MAAM,iDAEH,CAEHC,QAAS,GAGTC,MAAO,kBACIX,EAAEY,QAAO,EAAM,GAAIC,OAG9BC,KAAM,gBACGC,oBACAC,mBAITA,gBAAiB,eACTC,KAAOJ,KACXb,EAAE,QAAQkB,GAAG,QAAQ,yBAAwB,SAAUC,GAE7CA,EAAEC,qBACEC,WAAarB,EAAEa,MAAMS,KAAK,QAGL,cAA3BtB,EAAEa,MAAMS,KAAK,UAMjBpB,aAAaqB,OAAO,CAChBC,KAAMtB,aAAauB,MAAMC,YACzBC,MAAOV,KAAKP,QAAQkB,eACpBC,KAAMZ,KAAKP,QAAQoB,gBAEhBC,MAAK,SAAUC,OACZA,MAAMC,kBAAkBhB,KAAKP,QAAQwB,WAC1BF,MAAMG,UACZjB,GAAGd,YAAYgC,MAAM,WACtBC,OAAOC,SAASC,KAAOlB,cAE3BW,MAAMQ,UAhBZH,OAAOC,SAASC,KAAOlB,kBAoB3BoB,WAAaC,SAASC,cAAc,qBACxC3C,EAAE,eAAekB,GAAG,wCAAwC,SAAUC,GAC9C,eAAhBA,EAAEyB,OAAOC,IAAuBJ,aACjB,UAAXtB,EAAEK,KACFiB,WAAWK,YAAcL,WAAWM,QAAQC,SAE5CP,WAAWK,YAAcL,WAAWM,QAAQE,aAKxDjD,EAAE,QAAQkB,GAAG,QAAQ,6CAA4C,SAAUC,GAC/DA,EAAEC,iBACSpB,EAAEa,MAAMS,KAAK,YACpB4B,gBAAkBlD,EAAEa,MAAMS,KAAK,mBAC/B6B,YAAcnD,EAAEa,MAAMS,KAAK,eAC3B8B,cAAgBpD,EAAEa,MAAMS,KAAK,iBACjC6B,YAAYC,cAAgBA,kBAExBC,UAAYrD,EAAEa,MAAMS,KAAK,kBACnBgC,IAAdD,eAEAE,WAAavD,EAAE,IAAMqD,gBACNC,IAAfC,aAEAA,WAAWC,GAAG,YACdD,WAAWE,QAGVF,WAAWC,GAAG,aAAeD,WAAWG,OAAOC,OAAS,EACzDJ,WAAWf,OAIflC,UAAUsD,OAAO,kBAAoBV,gBAAgBC,aAAapB,MAC9D,SAAU2B,KAAKG,IACXN,WAAWG,KAAKA,MAEZP,YAAYW,eAAe,kBAC3BvD,kBAAkBO,KAAK,sBAA0ByC,yBAC5BJ,YAAYY,6BACXZ,YAAYa,8BACZb,YAAYc,iBAGlCd,YAAYW,eAAe,cAC3BtD,eAAe0D,mBAAmBf,YAAYgB,WAAWd,WAI7DE,WAAWf,OACXlC,UAAU8D,cAAcP,aAMxC9C,aAAc,eACNE,KAAOJ,KAEXV,IAAIkE,YAAY,CAChB,KAAQ,2BAAqC,kBAC7C,KAAQ,0BAAwC,kBAChD,KAAQ,sBAAoC,oBAEzCC,MAAK,SAAUC,OACJC,EAAI,EACRvD,KAAKP,QAAQkB,eAAiB2C,EAAEC,KAChCvD,KAAKP,QAAQoB,cAAgByC,EAAEC,KAC/BvD,KAAKP,QAAQwB,UAAYqC,EAAEC"}