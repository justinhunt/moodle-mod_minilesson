{"version":3,"sources":["../src/shortanswer.js"],"names":["define","$","log","def","polly","ttrecorder","anim","debug","ttrec","passmark","fullycorrect","partiallycorrect","clone","extend","init","index","itemdata","quizhelper","animopts","useanimatecss","register_events","init_components","next_question","self","stepdata","hasgrade","totalitems","correctmarks","correctitems","partialmarks","grade","do_next","prepare_audio","each","sentences","sentence","fetch_polly_url","voiceoption","usevoice","then","audiourl","uniqueid","attr","on","prop","html","correctanswer","setTimeout","app","partialresponses","i","length","originalsentence","cleanText","processFeedback","speechtext","cleanspeechtext","spoken","matched","x","similar","similarity","spokenIsCorrect","process_accepted_response","checkByPhonetic","phonetic","language","comparePassageToTranscript","alternates","ajaxresult","result","JSON","parse","haserror","theanswer","audiorecorder","do_animate","theCallback","message","type","capturedspeech","audiotextanswer","opts","callback","stt_guided","is_stt_guided","allsentences","currentPrompt","textinput","textinputvalue","val","phraseheard","currentphrase","sentenceindex","percent","parseInt","show_text","text","answerdisplay","addClass"],"mappings":"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","sourcesContent":["define(['jquery',\n      'core/log',\n      'mod_minilesson/definitions',\n      'mod_minilesson/pollyhelper',\n      'mod_minilesson/ttrecorder',\n      'mod_minilesson/animatecss'],\n    function($, log, def, polly, ttrecorder, anim) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('MiniLesson ShortAnswer: initialising');\n\n  return {\n\n    //a handle on the tt recorder\n    ttrec: null,\n\n    passmark: 100,//lower this if it often doesnt match (was 85)\n\n    fullycorrect: false,\n\n    partiallycorrect: false,\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n\n      //anim\n      var animopts = {};\n      animopts.useanimatecss=quizhelper.useanimatecss;\n      anim.init(animopts);\n      this.itemdata = itemdata;\n\n      this.register_events(index, itemdata, quizhelper);\n      this.init_components(index, itemdata, quizhelper);\n    },\n    next_question: function() {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = self.itemdata.correctmarks;\n      stepdata.correctitems = 0;\n      if (self.fullycorrect) {\n        stepdata.correctitems = self.itemdata.correctmarks;\n      } else if (self.partiallycorrect) {\n        stepdata.correctitems = self.itemdata.partialmarks;\n      }\n      if (stepdata.correctitems > 0) {\n        stepdata.grade = 100 * stepdata.correctitems / stepdata.totalitems;\n      }\n      log.debug('stepdata');\n      log.debug(stepdata);\n      self.quizhelper.do_next(stepdata);\n    },\n\n    /* NOT NEEDED */\n    prepare_audio: function(itemdata) {\n      // debugger;\n      $.each(itemdata.sentences, function(index, sentence) {\n        polly.fetch_polly_url(sentence.sentence, itemdata.voiceoption, itemdata.usevoice).then(function(audiourl) {\n          $(\"#\" + itemdata.uniqueid + \"_option\" + (index+1)).attr(\"data-src\", audiourl);\n        });\n      });\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n\n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n        self.next_question();\n      });\n\n      $(\"#\" + itemdata.uniqueid + \"_container .\" + itemdata.uniqueid + \"_option\").on('click', function(e) {\n\n        $(\".\" + itemdata.uniqueid + \"_option\").prop(\"disabled\", true);\n        $(\".\" + itemdata.uniqueid + \"_fb\").html(\"<i style='color:red;' class='fa fa-times'></i>\");\n        $(\".\" + itemdata.uniqueid + \"_option\" + itemdata.correctanswer + \"_fb\").html(\"<i style='color:green;' class='fa fa-check'></i>\");\n\n        $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n        setTimeout(function() {\n          $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n          self.next_question();\n        }, 2000);\n\n      });\n\n    },\n\n    init_components: function(index, itemdata, quizhelper) {\n      var app= this;\n      var sentences = itemdata.sentences;//sentence & phonetic\n      var partialresponses = itemdata.partialresponses;\n\n      log.debug('initcomponents_shortanswer');\n      log.debug(sentences);\n\n      //clean the text of any junk\n      for(var i=0;i<sentences.length;i++){\n          sentences[i].originalsentence= sentences[i].sentence;\n          sentences[i].sentence=quizhelper.cleanText(sentences[i].sentence);\n      }\n\n      for(var i=0;i<partialresponses.length;i++){\n          partialresponses[i].originalsentence= partialresponses[i].sentence;\n          partialresponses[i].sentence = quizhelper.cleanText(partialresponses[i].sentence);\n      }\n\n      var processFeedback = async function(speechtext) {\n        var cleanspeechtext = quizhelper.cleanText(speechtext);\n        var spoken = cleanspeechtext;\n\n        log.debug('speechtext:',speechtext);\n        log.debug('cleanspeechtext:',spoken);\n\n        var matched=false;\n        var percent=0;\n\n        //Similarity check by direct-match/acceptable-mistranscriptio\n        for(var x=0;x<sentences.length;x++){\n          //if this is the correct answer index, just move on\n          if(sentences[x].sentence===''){continue;}\n          var similar = quizhelper.similarity(spoken, sentences[x].sentence);\n          log.debug('JS similarity: ' + spoken + ':' + sentences[x].sentence + ':' + similar);\n          if (similar >= app.passmark ||\n              app.spokenIsCorrect(quizhelper, cleanspeechtext, sentences[x].sentence)) {\n              percent = app.process_accepted_response(itemdata, x);\n              matched=true;\n              break;\n          }//end of if similarity\n        }//end of for x\n\n        //Similarity check by phonetics(ajax)\n        //this is an expensive call since it goes out to the server and possibly to the cloud\n        if(!matched) {\n          for (x = 0; x < sentences.length; x++) {\n            var similarity = await quizhelper.checkByPhonetic(sentences[x].sentence, spoken, sentences[x].phonetic, itemdata.language);\n            log.debug(similarity, 'PHP similarity');\n            if (!similarity || similarity < app.passmark) {\n              //keep looking\n            } else {\n              matched = true;\n              log.debug('PHP similarity: ' + spoken + similarity);\n              percent = app.process_accepted_response(itemdata, x);\n              break;\n            }\n          }//end of Similarity check by phonetics(ajax) loop\n        }\n\n        //we do not do a passage match check , but this is how we would ..\n        if(!matched ) {\n          for (x = 0; x < sentences.length; x++) {\n            var ajaxresult = await quizhelper.comparePassageToTranscript(sentences[x].sentence, spoken, sentences[x].phonetic, itemdata.language, itemdata.alternates);\n            var result = JSON.parse(ajaxresult);\n            var haserror=false;\n            for (var i=0;i<result.length;i++){\n              if(result[i].matched===false){haserror=true;break;}\n            }\n            if(!haserror){\n              percent = app.process_accepted_response(itemdata, x);\n              matched=true;\n              break;\n            }\n          }\n        }\n        app.fullycorrect = matched;\n\n        if (!matched) {\n          //Similarity check by direct-match/acceptable-mistranscriptio\n          for(var x=0;x<partialresponses.length;x++){\n            //if this is the correct answer index, just move on\n            if(partialresponses[x].sentence===''){continue;}\n            var similar = quizhelper.similarity(spoken, partialresponses[x].sentence);\n            log.debug('JS similarity: ' + spoken + ':' + partialresponses[x].sentence + ':' + similar);\n            if (similar >= app.passmark ||\n                app.spokenIsCorrect(quizhelper, cleanspeechtext, partialresponses[x].sentence)) {\n                percent = app.process_accepted_response(itemdata, x);\n                matched=true;\n                break;\n            }//end of if similarity\n          }//end of for x\n        }\n\n        //Similarity check by phonetics(ajax)\n        //this is an expensive call since it goes out to the server and possibly to the cloud\n        if(!matched) {\n          for (x = 0; x < partialresponses.length; x++) {\n            var similarity = await quizhelper.checkByPhonetic(partialresponses[x].sentence, spoken, partialresponses[x].phonetic, itemdata.language);\n            log.debug(similarity, 'PHP similarity');\n            if (!similarity || similarity < app.passmark) {\n              //keep looking\n            } else {\n              matched = true;\n              log.debug('PHP similarity: ' + spoken + similarity);\n              percent = app.process_accepted_response(itemdata, x);\n              break;\n            }\n          }//end of Similarity check by phonetics(ajax) loop\n        }\n\n        if(!matched ) {\n          for (x = 0; x < partialresponses.length; x++) {\n            var ajaxresult = await quizhelper.comparePassageToTranscript(partialresponses[x].sentence, spoken, partialresponses[x].phonetic, itemdata.language, itemdata.alternates);\n            var result = JSON.parse(ajaxresult);\n            var haserror=false;\n            for (var i=0;i<result.length;i++){\n              if(result[i].matched===false){haserror=true;break;}\n            }\n            if(!haserror){\n              percent = app.process_accepted_response(itemdata, x);\n              matched=true;\n              break;\n            }\n          }\n        }\n\n        app.partiallycorrect = matched;\n\n          //if we got a match then process it\n        if(matched){\n          //proceed to next question\n          $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n          setTimeout(function () {\n            $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n            app.next_question();\n          }, 2000);\n          return;\n        }else{\n          //shake the screen\n          var theanswer = $(\"#\" + itemdata.uniqueid + \"_correctanswer\");\n          if (!itemdata.audiorecorder) {\n            theanswer = $(\"#\" + itemdata.uniqueid + \"_container .textinput_responsetype\");\n          }\n          anim.do_animate(theanswer,'rubberBand animate__faster').then(\n              function() {}\n          );\n          //$(\"#\" + itemdata.uniqueid + \"_correctanswer\").effect(\"shake\");\n        }\n      }\n\n      var theCallback = async function(message) {\n\n        switch (message.type) {\n          case 'recording':\n\n            break;\n\n          case 'speech':\n            log.debug(\"speech at shortanswer\");\n            log.debug(message.capturedspeech);\n            app.itemdata.audiotextanswer = message.capturedspeech;\n            await processFeedback(message.capturedspeech);\n        } //end of switch message type\n      }; //end of callback declaration\n\n      if (itemdata.audiorecorder) {\n        //init TT recorder\n        var opts = {};\n        opts.uniqueid = itemdata.uniqueid;\n        log.debug('sa uniqueid:' + itemdata.uniqueid);\n        opts.callback = theCallback;\n        opts.stt_guided=quizhelper.is_stt_guided();\n        app.ttrec = ttrecorder.clone();\n        app.ttrec.init(opts);\n\n        //set the prompt for TT Rec\n        var allsentences=\"\";\n        for(var i=0;i<sentences.length;i++){\n          allsentences += sentences[i].sentence + ' ';\n          sentences[i].originalsentence= sentences[i].sentence;\n          sentences[i].sentence=quizhelper.cleanText(sentences[i].sentence);\n        }\n        app.ttrec.currentPrompt=allsentences;\n      } else {\n        $(\"#\" + itemdata.uniqueid + \"_container .shortanswer_check_btn\").on('click', function(e) {\n            var textinput = $(\"#\" + itemdata.uniqueid + \"_container .textinput_responsetype\");\n            var textinputvalue = textinput.val();\n            if (!textinputvalue){\n              return;\n            }\n            processFeedback(textinputvalue);\n        });\n      }\n\n    } ,//end of init components\n\n    spokenIsCorrect: function(quizhelper, phraseheard, currentphrase) {\n      //lets lower case everything\n      phraseheard = quizhelper.cleanText(phraseheard);\n      currentphrase = quizhelper.cleanText(currentphrase);\n      if (phraseheard === currentphrase) {\n        return true;\n      }\n      return false;\n    },\n\n    process_accepted_response: function(itemdata, sentenceindex){\n      var percent = sentenceindex >= 0 ? itemdata.correctmarks : 0;\n      //TO DO .. disable TT recorder here\n      //disable TT recorder\n\n      if(percent > 0) {\n        //turn dots into text (if they were dots)\n        if (parseInt(itemdata.show_text) === 0) {\n          for (var i = 0; i < itemdata.sentences.length; i++) {\n            if (itemdata.audiorecorder) {\n              $(\"#\" + itemdata.uniqueid + \"_option\" + (i + 1) + ' .minilesson_sentence').text(itemdata.sentences[i].sentence);\n            }\n          }\n        }\n\n        if (itemdata.audiorecorder) {\n          //hightlight successgit cm\n          var  answerdisplay =  $(\"#\" + itemdata.uniqueid + \"_correctanswer\");\n          answerdisplay.text(itemdata.audiotextanswer);\n          answerdisplay.addClass(\"minilesson_success\");\n        } else {\n          var textinput = $(\"#\" + itemdata.uniqueid + \"_container .textinput_responsetype\");\n          textinput.addClass('textinput_success');\n        }\n      }\n\n      return percent;\n\n    },\n\n  };\n});"],"file":"shortanswer.min.js"}