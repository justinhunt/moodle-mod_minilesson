{"version":3,"file":"listenrepeat.min.js","sources":["../src/listenrepeat.js"],"sourcesContent":["define(['jquery',\n      'core/log',\n      'core/ajax',\n      'mod_minilesson/definitions',\n      'mod_minilesson/pollyhelper',\n      'mod_minilesson/ttrecorder',\n      'mod_minilesson/animatecss',\n      'core/templates'\n    ], function($, log, ajax, def, polly, ttrecorder, anim, templates) {\n  \"use strict\"; // jshint ;_;\n\n  log.debug('MiniLesson listen and repeat: initialising');\n\n  return {\n\n    //a handle on the tt recorder\n    ttrec: null,\n\n    //for making multiple instances\n    clone: function () {\n      return $.extend(true, {}, this);\n    },\n\n    init: function (index, itemdata, quizhelper) {\n      var self = this;\n      var theCallback = function (message) {\n\n        switch (message.type) {\n          case 'recording':\n            break;\n\n          case 'speech':\n            log.debug(\"speech at listen_repeat\");\n            //var wordcount = quizhelper.count_words(message.capturedspeech);\n            self.getComparison(\n                self.items[self.game.pointer].target,\n                message.capturedspeech,\n                self.items[self.game.pointer].phonetic,\n                function (comparison) {\n                  self.gotComparison(comparison, message);\n                }\n            );\n            break;\n\n        }\n\n      };\n\n      if (quizhelper.use_ttrecorder()) {\n        var opts = {};\n        opts.uniqueid = itemdata.uniqueid;\n        opts.callback = theCallback;\n        opts.stt_guided = quizhelper.is_stt_guided();\n        opts.wwwroot = quizhelper.is_stt_guided();\n        self.ttrec = ttrecorder.clone();\n        self.ttrec.init(opts);\n      } else {\n        //init cloudpoodll push recorder\n        cloudpoodll.init('minilesson-recorder-listenrepeat-' + itemdata.id, theCallback);\n      }\n\n      self.itemdata = itemdata;\n      self.quizhelper = quizhelper;\n      self.index = index;\n\n      //anim\n      var animopts = {};\n      animopts.useanimatecss = quizhelper.useanimatecss;\n      anim.init(animopts);\n\n      self.register_events();\n      self.setvoice();\n      self.getItems();\n    },\n\n    next_question: function (percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = self.items.length;\n      stepdata.correctitems = self.items.filter(function (e) {\n        return e.correct;\n      }).length;\n      stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n\n      //stop audio\n      self.stop_audio();\n\n      //transition\n      self.quizhelper.do_next(stepdata);\n    },\n\n    show_item_review: function () {\n      var self = this;\n      var review_data = {};\n      review_data.items = self.items;\n      review_data.totalitems = self.items.length;\n      review_data.correctitems = self.items.filter(function (e) {\n        return e.correct;\n      }).length;\n\n      //display results\n      var gamebox = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\");\n      var controlsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_controls\");\n      var recorderbox = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speakbtncontainer\");\n      var resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_resultscontainer\");\n      templates.render('mod_minilesson/listitemresults', review_data).then(\n          function (html, js) {\n            resultsbox.html(html);\n            //show and hide\n            resultsbox.show();\n            gamebox.hide();\n            controlsbox.hide();\n            recorderbox.hide();\n            // Run js for audio player events\n            templates.runTemplateJS(js);\n          }\n      );// End of templates\n    },\n\n    register_events: function () {\n\n      var self = this;\n      //on next button click\n      $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function (e) {\n        self.next_question();\n      });\n      //on start button click\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").on(\"click\", function () {\n        self.start();\n      });\n\n\n      //AUDIO PLAYER Button events\n      var audioplayerbtn=$(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_btn\");\n      // On listen button click\n      audioplayerbtn.on(\"click\", function () {\n        var theaudio = self.items[self.game.pointer].audio;\n\n        //if we are already playing stop playing\n        if(!theaudio.paused){\n          theaudio.pause();\n          theaudio.currentTime=0;\n          $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n          $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n          return;\n        }\n\n        //change icon to indicate playing state\n        theaudio.addEventListener('ended', function () {\n          $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n          $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n        });\n\n        theaudio.addEventListener('play', function () {\n          $(audioplayerbtn).children('.fa').removeClass('fa-volume-up');\n          $(audioplayerbtn).children('.fa').addClass('fa-stop');\n        });\n        theaudio.load();\n        theaudio.play();\n      });\n\n      //on skip button click\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_skip_btn\").on(\"click\", function () {\n        //disable the buttons\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n        //reveal the prompt\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speech.landr_teacher_left\").text(self.items[self.game.pointer].displayprompt + \"\");\n        //reveal the answer\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input\").each(function () {\n          var realidx = $(this).data(\"realidx\");\n          var landr_word_input = self.items[self.game.pointer].landr_targetWords[realidx];\n          $(this).val(landr_word_input);\n        });\n\n        //mark as answered and incorrect\n        self.items[self.game.pointer].answered = true;\n        self.items[self.game.pointer].correct = false;\n\n        //next prompt or end\n        if (self.game.pointer < self.items.length - 1) {\n          //move on after short time to next prompt\n          setTimeout(function () {\n            self.game.pointer++;\n            self.nextPrompt();\n          }, 2200);\n          //end question\n        } else {\n          self.end();\n        }\n      });\n\n    },\n\n\n    game: {\n      pointer: 0\n    },\n    usevoice: '',\n    setvoice: function () {\n      var self = this;\n      self.usevoice = self.itemdata.usevoice;\n      self.voiceoption = self.itemdata.voiceoption;\n      return;\n    },\n    getItems: function () {\n      var self = this;\n      var text_items = self.itemdata.sentences;\n\n      self.items = text_items.map(function (target) {\n        return {\n          landr_targetWords: target.sentence.trim().split(self.quizhelper.spliton_regexp).filter(function (e) {\n            return e !== \"\";\n          }),\n          target: target.sentence,\n          prompt: target.prompt,\n          displayprompt: target.displayprompt,\n          phonetic: target.phonetic,\n          typed: \"\",\n          answered: false,\n          correct: false,\n          audio: null,\n          audiourl: target.audiourl ? target.audiourl : \"\",\n          imageurl: target.imageurl,\n        };\n      }).filter(function (e) {\n        return e.target !== \"\";\n      });\n\n\n      $.each(self.items, function (index, item) {\n        item.audio = new Audio();\n        item.audio.src = item.audiourl;\n        if (self.items.filter(function (e) {\n          return e.audio === null;\n        }).length === 0) {\n          self.appReady();\n        }\n      });\n    },\n\n    appReady: function () {\n      var self = this;\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_not_loaded\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_loaded\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").prop(\"disabled\", false);\n    },\n    gotComparison: function (comparison, typed) {\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input\").removeClass(\"landr_correct landr_incorrect\");\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback_icon\").removeClass(\"fa fa-check fa-times\");\n\n      var allCorrect = comparison.filter(function (e) {\n        return !e.matched;\n      }).length == 0;\n\n      if (allCorrect && comparison && comparison.length > 0) {\n\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input\").addClass(\"landr_correct\");\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback_icon\").addClass(\"fa fa-check\");\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speech.landr_teacher_left\").text(self.items[self.game.pointer].displayprompt + \"\");\n\n        self.items[self.game.pointer].answered = true;\n        self.items[self.game.pointer].correct = true;\n        self.items[self.game.pointer].typed = typed;\n\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n        if (self.game.pointer < self.items.length - 1) {\n          setTimeout(function () {\n            self.game.pointer++;\n            self.nextPrompt();\n          }, 2200);\n        } else {\n          self.end();\n        }\n\n      } else {\n        //mark up the words as correct or not\n        comparison.forEach(function (obj) {\n          if (!obj.matched) {\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input[data-idx='\" + obj.wordnumber + \"']\").addClass(\"landr_incorrect\");\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback_icon[data-idx='\" + obj.wordnumber + \"']\").addClass(\"fa fa-times\");\n          } else {\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input[data-idx='\" + obj.wordnumber + \"']\").addClass(\"landr_correct\");\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback_icon[data-idx='\" + obj.wordnumber + \"']\").addClass(\"fa fa-check\");\n          }\n        });\n        var thereply = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_reply_\" + self.game.pointer);\n        anim.do_animate(thereply, 'shakeX animate__faster').then(\n            function () {\n              $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", false);\n            }\n        );\n\n      }\n      //show all the correct words\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input.landr_correct\").each(function () {\n        var realidx = $(this).data(\"realidx\");\n        var landr_word_input = self.items[self.game.pointer].landr_targetWords[realidx];\n        $(this).val(landr_word_input);\n      });\n\n    },\n\n    getWords: function (thetext) {\n      var self = this;\n      var checkcase = false;\n      if (checkcase == 'false') {\n        thetext = thetext.toLowerCase();\n      }\n      var chunks = thetext.split(self.quizhelper.spliton_regexp).filter(function (e) {\n        return e !== \"\";\n      });\n      var words = [];\n      for (var i = 0; i < chunks.length; i++) {\n        if (!chunks[i].match(self.quizhelper.spliton_regexp)) {\n          words.push(chunks[i]);\n        }\n      }\n      return words;\n    },\n    getComparison: function (passage, transcript, phonetic, callback) {\n      var self = this;\n\n      $(\".landr_ctrl-btn\").prop(\"disabled\", true);\n      self.quizhelper.comparePassageToTranscript(passage, transcript, phonetic, self.itemdata.language, self.itemdata.alternates).then(function (ajaxresult) {\n        var payloadobject = JSON.parse(ajaxresult);\n        if (payloadobject) {\n          callback(payloadobject);\n        } else {\n          callback(false);\n        }\n      });\n\n    },\n    end: function () {\n      var self = this;\n      $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n      //progress dots are updated on next_item. The last item has no next item, so we update from here\n      self.updateProgressDots();\n\n      //disable the buttons and go to next question or review\n      setTimeout(function () {\n        $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n        if (self.quizhelper.showitemreview) {\n          self.show_item_review();\n        } else {\n          self.next_question();\n        }\n      }, 2200);\n\n    },\n    start: function () {\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speakbtncontainer\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_title\").show();\n\n      self.items.forEach(function (item) {\n        item.spoken = \"\";\n        item.answered = false;\n        item.correct = false;\n      });\n\n      self.game.pointer = 0;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_cont\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_mainmenu\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_controls\").show();\n\n      self.nextPrompt();\n\n    },\n\n    nextPrompt: function () {\n      var showText = parseInt(this.itemdata.show_text);\n      var self = this;\n\n      //target is the speech we expect\n      var target = self.items[self.game.pointer].target;\n      //in some cases ttrecorder wants to know the target\n      if (self.quizhelper.use_ttrecorder()) {\n        self.ttrec.currentPrompt = target;\n      }\n      var displayprompt = self.items[self.game.pointer].displayprompt;\n      if (!showText) {\n        var nopunc = displayprompt.replace(self.quizhelper.nopunc_regexp, \"\");\n        var dots = nopunc.replace(self.quizhelper.nonspaces_regexp, 'â€¢');\n        var showprompt = dots;\n      } else {\n        var showprompt = displayprompt;\n      }\n\n      templates.render('mod_minilesson/listenrepeat_prompt',\n          {showprompt: showprompt, pointer: self.game.pointer})\n          .then(function (html, js) {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").html(html);\n                $(\".landr_ctrl-btn\").prop(\"disabled\", false);\n                self.updateProgressDots();\n                var newprompt = $(\".landr_prompt_\" + self.game.pointer);\n                anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n                    function () {\n                    }\n                );\n                self.nextReply();\n              }\n          );// End of templates\n    },\n\n    updateProgressDots: function () {\n      var self = this;\n      var color;\n      var progress = self.items.map(function (item, idx) {\n        color = \"gray\";\n        if (self.items[idx].answered && self.items[idx].correct) {\n          color = \"green\";\n        } else if (self.items[idx].answered && !self.items[idx].correct) {\n          color = \"red\";\n        }\n        return \"<i style='color:\" + color + \"' class='fa fa-circle'></i>\";\n      }).join(\" \");\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_title\").html(progress);\n    },\n\n    nextReply: function () {\n      var self = this;\n      var idx = 0;\n      var words = self.items[self.game.pointer].landr_targetWords.map(function (word, realidx) {\n        var theword = {};\n        if (!word.match(self.quizhelper.spliton_regexp)) {\n          idx++;\n          theword.isword = true;\n          theword.idx = idx;\n          theword.length = word.length;\n          theword.lengthplusone = word.length + 1;\n          theword.realidx = realidx;\n        } else {\n          theword.isword = false;\n          theword.text = word;\n        }\n        return theword;\n      });\n      var displaytimer = self.itemdata.timelimit > 0;\n\n      templates.render('mod_minilesson/listenrepeat_reply',\n          {words: words, pointer: self.game.pointer, imageurl: self.items[self.game.pointer].imageurl, displaytimer})\n          .then(function (html, js) {\n            //update html reply area\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").append(html);\n            // set handle to the reply and animate it in\n            var newreply = $(\".landr_reply_\" + self.game.pointer);\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function () {\n                }\n            );\n\n            // Enable the skip button\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", false);\n\n            //play the audio if we are not a mobile user and that is the setting\n            if (!self.quizhelper.mobile_user()) {\n              setTimeout(function () {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_btn\").trigger('click');\n              }, 1000);\n            }\n\n            if (displaytimer) {\n              $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game .progress-container\").show();\n              $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game .progress-container i\").show();\n              $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game .progress-container #progresstimer\").progressTimer({\n                  height: '5px',\n                  timeLimit: self.itemdata.timelimit,\n                  onFinish: function() {\n                      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_skip_btn\").trigger('click');\n                  }\n              });\n            }\n          });//end of templates.render\n    },//end of next reply\n\n    // Stop audio .. usually when leaving the item or sentence\n    stop_audio: function(){\n      var self =this;\n      //pause audio if its playing\n      var theaudio = self.items[self.game.pointer].audio;\n      if(theaudio && !theaudio.paused) {\n        theaudio.pause();\n      }\n    }\n\n  } // end of return\n});//end of define"],"names":["define","$","log","ajax","def","polly","ttrecorder","anim","templates","debug","ttrec","clone","extend","this","init","index","itemdata","quizhelper","self","theCallback","message","type","getComparison","items","game","pointer","target","capturedspeech","phonetic","comparison","gotComparison","use_ttrecorder","opts","uniqueid","callback","stt_guided","is_stt_guided","wwwroot","cloudpoodll","id","animopts","useanimatecss","register_events","setvoice","getItems","next_question","percent","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","stop_audio","do_next","show_item_review","review_data","gamebox","controlsbox","recorderbox","resultsbox","render","then","html","js","show","hide","runTemplateJS","on","start","audioplayerbtn","theaudio","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","text","displayprompt","each","realidx","data","landr_word_input","landr_targetWords","val","answered","setTimeout","nextPrompt","end","usevoice","voiceoption","text_items","sentences","map","sentence","trim","split","spliton_regexp","prompt","typed","audiourl","imageurl","item","Audio","src","appReady","matched","forEach","obj","wordnumber","thereply","do_animate","getWords","thetext","chunks","words","i","match","push","passage","transcript","comparePassageToTranscript","language","alternates","ajaxresult","payloadobject","JSON","parse","updateProgressDots","showitemreview","spoken","showText","parseInt","show_text","currentPrompt","showprompt","replace","nopunc_regexp","nonspaces_regexp","newprompt","nextReply","color","progress","idx","join","word","theword","isword","lengthplusone","displaytimer","timelimit","append","newreply","mobile_user","trigger","progressTimer","height","timeLimit","onFinish"],"mappings":"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"}