{"version":3,"sources":["../src/listenrepeat.js"],"names":["define","$","log","ajax","def","polly","ttrecorder","anim","templates","debug","ttrec","clone","extend","init","index","itemdata","quizhelper","self","theCallback","message","type","getComparison","items","game","pointer","target","capturedspeech","phonetic","comparison","gotComparison","use_ttrecorder","opts","uniqueid","callback","stt_guided","is_stt_guided","wwwroot","cloudpoodll","id","animopts","useanimatecss","register_events","setvoice","getItems","next_question","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","stop_audio","do_next","show_item_review","review_data","gamebox","controlsbox","recorderbox","resultsbox","render","then","html","js","show","hide","runTemplateJS","on","start","audioplayerbtn","theaudio","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","text","displayprompt","each","realidx","data","landr_word_input","landr_targetWords","val","answered","setTimeout","nextPrompt","end","usevoice","voiceoption","text_items","sentences","map","sentence","trim","split","spliton_regexp","prompt","typed","audiourl","imageurl","item","Audio","src","appReady","allCorrect","matched","forEach","obj","wordnumber","thereply","do_animate","getWords","thetext","toLowerCase","chunks","words","i","match","push","passage","transcript","comparePassageToTranscript","language","alternates","ajaxresult","payloadobject","JSON","parse","updateProgressDots","showitemreview","spoken","showText","parseInt","show_text","currentPrompt","nopunc","replace","nopunc_regexp","dots","nonspaces_regexp","showprompt","newprompt","nextReply","color","progress","idx","join","word","theword","isword","lengthplusone","displaytimer","timelimit","append","newreply","mobile_user","trigger","progressTimer","height","timeLimit","onFinish"],"mappings":"AAAAA,OAAM,+BAAC,CAAC,QAAD,CACD,UADC,CAED,WAFC,CAGD,4BAHC,CAID,4BAJC,CAKD,2BALC,CAMD,2BANC,CAOD,gBAPC,CAAD,CAQC,SAASC,CAAT,CAAYC,CAAZ,CAAiBC,CAAjB,CAAuBC,CAAvB,CAA4BC,CAA5B,CAAmCC,CAAnC,CAA+CC,CAA/C,CAAqDC,CAArD,CAAgE,CACrE,aAEAN,CAAG,CAACO,KAAJ,CAAU,4CAAV,EAEA,MAAO,CAGLC,KAAK,CAAE,IAHF,CAMLC,KAAK,CAAE,gBAAY,CACjB,MAAOV,CAAAA,CAAC,CAACW,MAAF,IAAe,EAAf,CAAmB,IAAnB,CACR,CARI,CAULC,IAAI,CAAE,cAAUC,CAAV,CAAiBC,CAAjB,CAA2BC,CAA3B,CAAuC,IACvCC,CAAAA,CAAI,CAAG,IADgC,CAEvCC,CAAW,CAAG,SAAUC,CAAV,CAAmB,CAEnC,OAAQA,CAAO,CAACC,IAAhB,EACE,IAAK,WAAL,CACE,MAEF,IAAK,QAAL,CACElB,CAAG,CAACO,KAAJ,CAAU,yBAAV,EAEAQ,CAAI,CAACI,aAAL,CACIJ,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BC,MADlC,CAEIN,CAAO,CAACO,cAFZ,CAGIT,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BG,QAHlC,CAII,SAAUC,CAAV,CAAsB,CACpBX,CAAI,CAACY,aAAL,CAAmBD,CAAnB,CAA+BT,CAA/B,CACD,CANL,EAQA,MAfJ,CAmBD,CAvB0C,CAyB3C,GAAIH,CAAU,CAACc,cAAX,EAAJ,CAAiC,CAC/B,GAAIC,CAAAA,CAAI,CAAG,CACNC,QADM,CACKjB,CAAQ,CAACiB,QADd,CAENC,QAFM,CAEKf,CAFL,CAGNgB,UAHM,CAGOlB,CAAU,CAACmB,aAAX,EAHP,CAINC,OAJM,CAIIpB,CAAU,CAACmB,aAAX,EAJJ,CAAX,CAKAlB,CAAI,CAACP,KAAL,CAAaJ,CAAU,CAACK,KAAX,EAAb,CACAM,CAAI,CAACP,KAAL,CAAWG,IAAX,CAAgBkB,CAAhB,CACD,CARD,IAQO,CAELM,WAAW,CAACxB,IAAZ,CAAiB,oCAAsCE,CAAQ,CAACuB,EAAhE,CAAoEpB,CAApE,CACD,CAEDD,CAAI,CAACF,QAAL,CAAgBA,CAAhB,CACAE,CAAI,CAACD,UAAL,CAAkBA,CAAlB,CACAC,CAAI,CAACH,KAAL,CAAaA,CAAb,CAGA,GAAIyB,CAAAA,CAAQ,CAAG,CACNC,aADM,CACUxB,CAAU,CAACwB,aADrB,CAAf,CAEAjC,CAAI,CAACM,IAAL,CAAU0B,CAAV,EAEAtB,CAAI,CAACwB,eAAL,GACAxB,CAAI,CAACyB,QAAL,GACAzB,CAAI,CAAC0B,QAAL,EACD,CA5DI,CA8DLC,aAAa,CAAE,wBAAmB,IAC5B3B,CAAAA,CAAI,CAAG,IADqB,CAE5B4B,CAAQ,CAAG,EAFiB,CAGhCA,CAAQ,CAAC/B,KAAT,CAAiBG,CAAI,CAACH,KAAtB,CACA+B,CAAQ,CAACC,QAAT,IACAD,CAAQ,CAACE,UAAT,CAAsB9B,CAAI,CAACK,KAAL,CAAW0B,MAAjC,CACAH,CAAQ,CAACI,YAAT,CAAwBhC,CAAI,CAACK,KAAL,CAAW4B,MAAX,CAAkB,SAAUC,CAAV,CAAa,CACrD,MAAOA,CAAAA,CAAC,CAACC,OACV,CAFuB,EAErBJ,MAFH,CAGAH,CAAQ,CAACQ,KAAT,CAAiBC,IAAI,CAACC,KAAL,CAA2D,GAAhD,EAACV,CAAQ,CAACI,YAAT,CAAwBJ,CAAQ,CAACE,UAAlC,CAAX,CAAjB,CAGA9B,CAAI,CAACuC,UAAL,GAGAvC,CAAI,CAACD,UAAL,CAAgByC,OAAhB,CAAwBZ,CAAxB,CACD,CA9EI,CAgFLa,gBAAgB,CAAE,2BAAY,IACxBzC,CAAAA,CAAI,CAAG,IADiB,CAExB0C,CAAW,CAAG,EAFU,CAG5BA,CAAW,CAACrC,KAAZ,CAAoBL,CAAI,CAACK,KAAzB,CACAqC,CAAW,CAACZ,UAAZ,CAAyB9B,CAAI,CAACK,KAAL,CAAW0B,MAApC,CACAW,CAAW,CAACV,YAAZ,CAA2BhC,CAAI,CAACK,KAAL,CAAW4B,MAAX,CAAkB,SAAUC,CAAV,CAAa,CACxD,MAAOA,CAAAA,CAAC,CAACC,OACV,CAF0B,EAExBJ,MAFH,CAL4B,GAUxBY,CAAAA,CAAO,CAAG3D,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,wBAAhC,CAVa,CAWxB6B,CAAW,CAAG5D,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAXS,CAYxB8B,CAAW,CAAG7D,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,qCAAhC,CAZS,CAaxB+B,CAAU,CAAG9D,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,oCAAhC,CAbU,CAc5BxB,CAAS,CAACwD,MAAV,CAAiB,gCAAjB,CAAmDL,CAAnD,EAAgEM,IAAhE,CACI,SAAUC,CAAV,CAAgBC,CAAhB,CAAoB,CAClBJ,CAAU,CAACG,IAAX,CAAgBA,CAAhB,EAEAH,CAAU,CAACK,IAAX,GACAR,CAAO,CAACS,IAAR,GACAR,CAAW,CAACQ,IAAZ,GACAP,CAAW,CAACO,IAAZ,GAEA7D,CAAS,CAAC8D,aAAV,CAAwBH,CAAxB,CACD,CAVL,CAYD,CA1GI,CA4GL1B,eAAe,CAAE,0BAAY,CAE3B,GAAIxB,CAAAA,CAAI,CAAG,IAAX,CAEAhB,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,mCAAhC,CAAD,CAAsEuC,EAAtE,CAAyE,OAAzE,CAAkF,UAAa,CAC7FtD,CAAI,CAAC2B,aAAL,EACD,CAFD,EAIA3C,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,6BAAhC,CAAD,CAAgEuC,EAAhE,CAAmE,OAAnE,CAA4E,UAAY,CACtFtD,CAAI,CAACuD,KAAL,EACD,CAFD,EAMA,GAAIC,CAAAA,CAAc,CAACxE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,8BAAhC,CAApB,CAEAyC,CAAc,CAACF,EAAf,CAAkB,OAAlB,CAA2B,UAAY,CACrC,GAAIG,CAAAA,CAAQ,CAAGzD,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BmD,KAA7C,CAGA,GAAG,CAACD,CAAQ,CAACE,MAAb,CAAoB,CAClBF,CAAQ,CAACG,KAAT,GACAH,CAAQ,CAACI,WAAT,CAAqB,CAArB,CACA7E,CAAC,CAACwE,CAAD,CAAD,CAAkBM,QAAlB,CAA2B,KAA3B,EAAkCC,WAAlC,CAA8C,SAA9C,EACA/E,CAAC,CAACwE,CAAD,CAAD,CAAkBM,QAAlB,CAA2B,KAA3B,EAAkCE,QAAlC,CAA2C,cAA3C,EACA,MACD,CAGDP,CAAQ,CAACQ,gBAAT,CAA0B,OAA1B,CAAmC,UAAY,CAC7CjF,CAAC,CAACwE,CAAD,CAAD,CAAkBM,QAAlB,CAA2B,KAA3B,EAAkCC,WAAlC,CAA8C,SAA9C,EACA/E,CAAC,CAACwE,CAAD,CAAD,CAAkBM,QAAlB,CAA2B,KAA3B,EAAkCE,QAAlC,CAA2C,cAA3C,CACD,CAHD,EAKAP,CAAQ,CAACQ,gBAAT,CAA0B,MAA1B,CAAkC,UAAY,CAC5CjF,CAAC,CAACwE,CAAD,CAAD,CAAkBM,QAAlB,CAA2B,KAA3B,EAAkCC,WAAlC,CAA8C,cAA9C,EACA/E,CAAC,CAACwE,CAAD,CAAD,CAAkBM,QAAlB,CAA2B,KAA3B,EAAkCE,QAAlC,CAA2C,SAA3C,CACD,CAHD,EAIAP,CAAQ,CAACS,IAAT,GACAT,CAAQ,CAACU,IAAT,EACD,CAxBD,EA2BAnF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DuC,EAA/D,CAAkE,OAAlE,CAA2E,UAAY,CAErFtE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DqD,IAA/D,CAAoE,UAApE,KAEApF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,6CAAhC,CAAD,CAAgFsD,IAAhF,CAAqFrE,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8B+D,aAA9B,CAA8C,EAAnI,EAEAtF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,8BAAhC,CAAD,CAAiEwD,IAAjE,CAAsE,UAAY,IAC5EC,CAAAA,CAAO,CAAGxF,CAAC,CAAC,IAAD,CAAD,CAAQyF,IAAR,CAAa,SAAb,CADkE,CAE5EC,CAAgB,CAAG1E,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BoE,iBAA9B,CAAgDH,CAAhD,CAFyD,CAGhFxF,CAAC,CAAC,IAAD,CAAD,CAAQ4F,GAAR,CAAYF,CAAZ,CACD,CAJD,EAOA1E,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BsE,QAA9B,IACA7E,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8B4B,OAA9B,IAGA,GAAInC,CAAI,CAACM,IAAL,CAAUC,OAAV,CAAoBP,CAAI,CAACK,KAAL,CAAW0B,MAAX,CAAoB,CAA5C,CAA+C,CAE7C+C,UAAU,CAAC,UAAY,CACrB9E,CAAI,CAACM,IAAL,CAAUC,OAAV,GACAP,CAAI,CAAC+E,UAAL,EACD,CAHS,CAGP,IAHO,CAKX,CAPD,IAOO,CACL/E,CAAI,CAACgF,GAAL,EACD,CACF,CA3BD,CA6BD,CApLI,CAuLL1E,IAAI,CAAE,CACJC,OAAO,CAAE,CADL,CAvLD,CA0LL0E,QAAQ,CAAE,EA1LL,CA2LLxD,QAAQ,CAAE,mBAAY,CACpB,GAAIzB,CAAAA,CAAI,CAAG,IAAX,CACAA,CAAI,CAACiF,QAAL,CAAgBjF,CAAI,CAACF,QAAL,CAAcmF,QAA9B,CACAjF,CAAI,CAACkF,WAAL,CAAmBlF,CAAI,CAACF,QAAL,CAAcoF,WAElC,CAhMI,CAiMLxD,QAAQ,CAAE,mBAAY,IAChB1B,CAAAA,CAAI,CAAG,IADS,CAEhBmF,CAAU,CAAGnF,CAAI,CAACF,QAAL,CAAcsF,SAFX,CAIpBpF,CAAI,CAACK,KAAL,CAAa8E,CAAU,CAACE,GAAX,CAAe,SAAU7E,CAAV,CAAkB,CAC5C,MAAO,CACLmE,iBAAiB,CAAEnE,CAAM,CAAC8E,QAAP,CAAgBC,IAAhB,GAAuBC,KAAvB,CAA6BxF,CAAI,CAACD,UAAL,CAAgB0F,cAA7C,EAA6DxD,MAA7D,CAAoE,SAAUC,CAAV,CAAa,CAClG,MAAa,EAAN,GAAAA,CACR,CAFkB,CADd,CAIL1B,MAAM,CAAEA,CAAM,CAAC8E,QAJV,CAKLI,MAAM,CAAElF,CAAM,CAACkF,MALV,CAMLpB,aAAa,CAAE9D,CAAM,CAAC8D,aANjB,CAOL5D,QAAQ,CAAEF,CAAM,CAACE,QAPZ,CAQLiF,KAAK,CAAE,EARF,CASLd,QAAQ,GATH,CAUL1C,OAAO,GAVF,CAWLuB,KAAK,CAAE,IAXF,CAYLkC,QAAQ,CAAEpF,CAAM,CAACoF,QAAP,CAAkBpF,CAAM,CAACoF,QAAzB,CAAoC,EAZzC,CAaLC,QAAQ,CAAErF,CAAM,CAACqF,QAbZ,CAeR,CAhBY,EAgBV5D,MAhBU,CAgBH,SAAUC,CAAV,CAAa,CACrB,MAAoB,EAAb,GAAAA,CAAC,CAAC1B,MACV,CAlBY,CAAb,CAqBAxB,CAAC,CAACuF,IAAF,CAAOvE,CAAI,CAACK,KAAZ,CAAmB,SAAUR,CAAV,CAAiBiG,CAAjB,CAAuB,CACxCA,CAAI,CAACpC,KAAL,CAAa,GAAIqC,CAAAA,KAAjB,CACAD,CAAI,CAACpC,KAAL,CAAWsC,GAAX,CAAiBF,CAAI,CAACF,QAAtB,CACA,GAEc,CAFV,GAAA5F,CAAI,CAACK,KAAL,CAAW4B,MAAX,CAAkB,SAAUC,CAAV,CAAa,CACjC,MAAmB,KAAZ,GAAAA,CAAC,CAACwB,KACV,CAFG,EAED3B,MAFH,CAEiB,CACf/B,CAAI,CAACiG,QAAL,EACD,CACF,CARD,CASD,CAnOI,CAqOLA,QAAQ,CAAE,mBAAY,CACpB,GAAIjG,CAAAA,CAAI,CAAG,IAAX,CACAhB,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,8BAAhC,CAAD,CAAiEqC,IAAjE,GACApE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,0BAAhC,CAAD,CAA6DoC,IAA7D,GACAnE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,6BAAhC,CAAD,CAAgEqD,IAAhE,CAAqE,UAArE,IACD,CA1OI,CA2OLxD,aAAa,CAAE,uBAAUD,CAAV,CAAsBgF,CAAtB,CAA6B,CAC1C,GAAI3F,CAAAA,CAAI,CAAG,IAAX,CAEAhB,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,8BAAhC,CAAD,CAAiEgD,WAAjE,CAA6E,+BAA7E,EACA/E,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,iCAAhC,CAAD,CAAoEgD,WAApE,CAAgF,sBAAhF,EAEA,GAAImC,CAAAA,CAAU,CAED,CAFI,EAAAvF,CAAU,CAACsB,MAAX,CAAkB,SAAUC,CAAV,CAAa,CAC9C,MAAO,CAACA,CAAC,CAACiE,OACX,CAFgB,EAEdpE,MAFH,CAIA,GAAImE,CAAU,EAAIvF,CAAd,EAAgD,CAApB,CAAAA,CAAU,CAACoB,MAA3C,CAAuD,CAErD/C,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,8BAAhC,CAAD,CAAiEiD,QAAjE,CAA0E,eAA1E,EACAhF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,iCAAhC,CAAD,CAAoEiD,QAApE,CAA6E,aAA7E,EACAhF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,6CAAhC,CAAD,CAAgFsD,IAAhF,CAAqFrE,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8B+D,aAA9B,CAA8C,EAAnI,EAEAtE,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BsE,QAA9B,IACA7E,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8B4B,OAA9B,IACAnC,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BoF,KAA9B,CAAsCA,CAAtC,CAEA3G,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DqD,IAA/D,CAAoE,UAApE,KACA,GAAIpE,CAAI,CAACM,IAAL,CAAUC,OAAV,CAAoBP,CAAI,CAACK,KAAL,CAAW0B,MAAX,CAAoB,CAA5C,CAA+C,CAC7C+C,UAAU,CAAC,UAAY,CACrB9E,CAAI,CAACM,IAAL,CAAUC,OAAV,GACAP,CAAI,CAAC+E,UAAL,EACD,CAHS,CAGP,IAHO,CAIX,CALD,IAKO,CACL/E,CAAI,CAACgF,GAAL,EACD,CAEF,CApBD,IAoBO,CAELrE,CAAU,CAACyF,OAAX,CAAmB,SAAUC,CAAV,CAAe,CAChC,GAAI,CAACA,CAAG,CAACF,OAAT,CAAkB,CAChBnH,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,yCAA/B,CAA2EsF,CAAG,CAACC,UAA/E,CAA4F,IAA7F,CAAD,CAAoGtC,QAApG,CAA6G,iBAA7G,EACAhF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4CAA/B,CAA8EsF,CAAG,CAACC,UAAlF,CAA+F,IAAhG,CAAD,CAAuGtC,QAAvG,CAAgH,aAAhH,CACD,CAHD,IAGO,CACLhF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,yCAA/B,CAA2EsF,CAAG,CAACC,UAA/E,CAA4F,IAA7F,CAAD,CAAoGtC,QAApG,CAA6G,eAA7G,EACAhF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4CAA/B,CAA8EsF,CAAG,CAACC,UAAlF,CAA+F,IAAhG,CAAD,CAAuGtC,QAAvG,CAAgH,aAAhH,CACD,CACF,CARD,EASA,GAAIuC,CAAAA,CAAQ,CAAGvH,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,0BAA/B,CAA4Df,CAAI,CAACM,IAAL,CAAUC,OAAvE,CAAhB,CACAjB,CAAI,CAACkH,UAAL,CAAgBD,CAAhB,CAA0B,wBAA1B,EAAoDvD,IAApD,CACI,UAAY,CACVhE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DqD,IAA/D,CAAoE,UAApE,IACD,CAHL,CAMD,CAEDpF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4CAAhC,CAAD,CAA+EwD,IAA/E,CAAoF,UAAY,IAC1FC,CAAAA,CAAO,CAAGxF,CAAC,CAAC,IAAD,CAAD,CAAQyF,IAAR,CAAa,SAAb,CADgF,CAE1FC,CAAgB,CAAG1E,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BoE,iBAA9B,CAAgDH,CAAhD,CAFuE,CAG9FxF,CAAC,CAAC,IAAD,CAAD,CAAQ4F,GAAR,CAAYF,CAAZ,CACD,CAJD,CAMD,CAnSI,CAqSL+B,QAAQ,CAAE,kBAAUC,CAAV,CAAmB,IACvB1G,CAAAA,CAAI,CAAG,IADgB,CAG3B,GAAiB,OAAb,IAAJ,CAA0B,CACxB0G,CAAO,CAAGA,CAAO,CAACC,WAAR,EACX,CAKD,OAJIC,CAAAA,CAAM,CAAGF,CAAO,CAAClB,KAAR,CAAcxF,CAAI,CAACD,UAAL,CAAgB0F,cAA9B,EAA8CxD,MAA9C,CAAqD,SAAUC,CAAV,CAAa,CAC7E,MAAa,EAAN,GAAAA,CACR,CAFY,CAIb,CADI2E,CAAK,CAAG,EACZ,CAASC,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGF,CAAM,CAAC7E,MAA3B,CAAmC+E,CAAC,EAApC,CAAwC,CACtC,GAAI,CAACF,CAAM,CAACE,CAAD,CAAN,CAAUC,KAAV,CAAgB/G,CAAI,CAACD,UAAL,CAAgB0F,cAAhC,CAAL,CAAsD,CACpDoB,CAAK,CAACG,IAAN,CAAWJ,CAAM,CAACE,CAAD,CAAjB,CACD,CACF,CACD,MAAOD,CAAAA,CACR,CArTI,CAsTLzG,aAAa,CAAE,uBAAU6G,CAAV,CAAmBC,CAAnB,CAA+BxG,CAA/B,CAAyCM,CAAzC,CAAmD,CAChE,GAAIhB,CAAAA,CAAI,CAAG,IAAX,CAEAhB,CAAC,CAAC,iBAAD,CAAD,CAAqBoF,IAArB,CAA0B,UAA1B,KACApE,CAAI,CAACD,UAAL,CAAgBoH,0BAAhB,CAA2CF,CAA3C,CAAoDC,CAApD,CAAgExG,CAAhE,CAA0EV,CAAI,CAACF,QAAL,CAAcsH,QAAxF,CAAkGpH,CAAI,CAACF,QAAL,CAAcuH,UAAhH,EAA4HrE,IAA5H,CAAiI,SAAUsE,CAAV,CAAsB,CACrJ,GAAIC,CAAAA,CAAa,CAAGC,IAAI,CAACC,KAAL,CAAWH,CAAX,CAApB,CACA,GAAIC,CAAJ,CAAmB,CACjBvG,CAAQ,CAACuG,CAAD,CACT,CAFD,IAEO,CACLvG,CAAQ,IACT,CACF,CAPD,CASD,CAnUI,CAoULgE,GAAG,CAAE,cAAY,CACf,GAAIhF,CAAAA,CAAI,CAAG,IAAX,CACAhB,CAAC,CAAC,wBAAD,CAAD,CAA4BoF,IAA5B,CAAiC,UAAjC,KAGApE,CAAI,CAAC0H,kBAAL,GAGA5C,UAAU,CAAC,UAAY,CACrB9F,CAAC,CAAC,wBAAD,CAAD,CAA4BoF,IAA5B,CAAiC,UAAjC,KACA,GAAIpE,CAAI,CAACD,UAAL,CAAgB4H,cAApB,CAAoC,CAClC3H,CAAI,CAACyC,gBAAL,EACD,CAFD,IAEO,CACLzC,CAAI,CAAC2B,aAAL,EACD,CACF,CAPS,CAOP,IAPO,CASX,CArVI,CAsVL4B,KAAK,CAAE,gBAAY,CACjB,GAAIvD,CAAAA,CAAI,CAAG,IAAX,CAEAhB,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DqD,IAA/D,CAAoE,UAApE,KACApF,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,qCAAhC,CAAD,CAAwEoC,IAAxE,GACAnE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,yBAAhC,CAAD,CAA4DoC,IAA5D,GAEAnD,CAAI,CAACK,KAAL,CAAW+F,OAAX,CAAmB,SAAUN,CAAV,CAAgB,CACjCA,CAAI,CAAC8B,MAAL,CAAc,EAAd,CACA9B,CAAI,CAACjB,QAAL,IACAiB,CAAI,CAAC3D,OAAL,GACD,CAJD,EAMAnC,CAAI,CAACM,IAAL,CAAUC,OAAV,CAAoB,CAApB,CAEAvB,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,wBAAhC,CAAD,CAA2DoC,IAA3D,GACAnE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,6BAAhC,CAAD,CAAgEqC,IAAhE,GACApE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,+BAAhC,CAAD,CAAkEoC,IAAlE,GACAnE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DqC,IAA/D,GACApE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DoC,IAA/D,GAEAnD,CAAI,CAAC+E,UAAL,EAED,CA7WI,CA+WLA,UAAU,CAAE,qBAAY,IAClB8C,CAAAA,CAAQ,CAAGC,QAAQ,CAAC,KAAKhI,QAAL,CAAciI,SAAf,CADD,CAElB/H,CAAI,CAAG,IAFW,CAKlBQ,CAAM,CAAGR,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BC,MALrB,CAOtB,GAAIR,CAAI,CAACD,UAAL,CAAgBc,cAAhB,EAAJ,CAAsC,CACpCb,CAAI,CAACP,KAAL,CAAWuI,aAAX,CAA2BxH,CAC5B,CACD,GAAI8D,CAAAA,CAAa,CAAGtE,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8B+D,aAAlD,CACA,GAAI,CAACuD,CAAL,CAAe,IACTI,CAAAA,CAAM,CAAG3D,CAAa,CAAC4D,OAAd,CAAsBlI,CAAI,CAACD,UAAL,CAAgBoI,aAAtC,CAAqD,EAArD,CADA,CAETC,CAAI,CAAGH,CAAM,CAACC,OAAP,CAAelI,CAAI,CAACD,UAAL,CAAgBsI,gBAA/B,CAAiD,QAAjD,CAFE,CAGTC,CAAU,CAAGF,CAClB,CAJD,IAIO,CACL,GAAIE,CAAAA,CAAU,CAAGhE,CAClB,CAED/E,CAAS,CAACwD,MAAV,CAAiB,oCAAjB,CACI,CAACuF,UAAU,CAAEA,CAAb,CAAyB/H,OAAO,CAAEP,CAAI,CAACM,IAAL,CAAUC,OAA5C,CADJ,EAEKyC,IAFL,CAEU,SAAUC,CAAV,CAAoB,CACpBjE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,wBAAhC,CAAD,CAA2DkC,IAA3D,CAAgEA,CAAhE,EACAjE,CAAC,CAAC,iBAAD,CAAD,CAAqBoF,IAArB,CAA0B,UAA1B,KACApE,CAAI,CAAC0H,kBAAL,GACA,GAAIa,CAAAA,CAAS,CAAGvJ,CAAC,CAAC,iBAAmBgB,CAAI,CAACM,IAAL,CAAUC,OAA9B,CAAjB,CACAjB,CAAI,CAACkH,UAAL,CAAgB+B,CAAhB,CAA2B,wBAA3B,CAAqD,IAArD,EAA2DvF,IAA3D,CACI,UAAY,CACX,CAFL,EAIAhD,CAAI,CAACwI,SAAL,EACD,CAZT,CAcD,CAhZI,CAkZLd,kBAAkB,CAAE,6BAAY,IAC1B1H,CAAAA,CAAI,CAAG,IADmB,CAE1ByI,CAF0B,CAG1BC,CAAQ,CAAG1I,CAAI,CAACK,KAAL,CAAWgF,GAAX,CAAe,SAAUS,CAAV,CAAgB6C,CAAhB,CAAqB,CACjDF,CAAK,CAAG,MAAR,CACA,GAAIzI,CAAI,CAACK,KAAL,CAAWsI,CAAX,EAAgB9D,QAAhB,EAA4B7E,CAAI,CAACK,KAAL,CAAWsI,CAAX,EAAgBxG,OAAhD,CAAyD,CACvDsG,CAAK,CAAG,OACT,CAFD,IAEO,IAAIzI,CAAI,CAACK,KAAL,CAAWsI,CAAX,EAAgB9D,QAAhB,EAA4B,CAAC7E,CAAI,CAACK,KAAL,CAAWsI,CAAX,EAAgBxG,OAAjD,CAA0D,CAC/DsG,CAAK,CAAG,KACT,CACD,MAAO,mBAAqBA,CAArB,CAA6B,6BACrC,CARc,EAQZG,IARY,CAQP,GARO,CAHe,CAY9B5J,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,yBAAhC,CAAD,CAA4DkC,IAA5D,CAAiEyF,CAAjE,CACD,CA/ZI,CAiaLF,SAAS,CAAE,oBAAY,IACjBxI,CAAAA,CAAI,CAAG,IADU,CAEjB2I,CAAG,CAAG,CAFW,CAGjB9B,CAAK,CAAG7G,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BoE,iBAA9B,CAAgDU,GAAhD,CAAoD,SAAUwD,CAAV,CAAgBrE,CAAhB,CAAyB,CACvF,GAAIsE,CAAAA,CAAO,CAAG,EAAd,CACA,GAAI,CAACD,CAAI,CAAC9B,KAAL,CAAW/G,CAAI,CAACD,UAAL,CAAgB0F,cAA3B,CAAL,CAAiD,CAC/CkD,CAAG,GACHG,CAAO,CAACC,MAAR,IACAD,CAAO,CAACH,GAAR,CAAcA,CAAd,CACAG,CAAO,CAAC/G,MAAR,CAAiB8G,CAAI,CAAC9G,MAAtB,CACA+G,CAAO,CAACE,aAAR,CAAwBH,CAAI,CAAC9G,MAAL,CAAc,CAAtC,CACA+G,CAAO,CAACtE,OAAR,CAAkBA,CACnB,CAPD,IAOO,CACLsE,CAAO,CAACC,MAAR,IACAD,CAAO,CAACzE,IAAR,CAAewE,CAChB,CACD,MAAOC,CAAAA,CACR,CAdW,CAHS,CAkBjBG,CAAY,CAA6B,CAA1B,CAAAjJ,CAAI,CAACF,QAAL,CAAcoJ,SAlBZ,CAoBrB3J,CAAS,CAACwD,MAAV,CAAiB,mCAAjB,CACI,CAAC8D,KAAK,CAAEA,CAAR,CAAetG,OAAO,CAAEP,CAAI,CAACM,IAAL,CAAUC,OAAlC,CAA2CsF,QAAQ,CAAE7F,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BsF,QAAnF,CAA6FoD,YAAY,CAAZA,CAA7F,CADJ,EAEKjG,IAFL,CAEU,SAAUC,CAAV,CAAoB,CAExBjE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,wBAAhC,CAAD,CAA2DoI,MAA3D,CAAkElG,CAAlE,EAEA,GAAImG,CAAAA,CAAQ,CAAGpK,CAAC,CAAC,gBAAkBgB,CAAI,CAACM,IAAL,CAAUC,OAA7B,CAAhB,CACAjB,CAAI,CAACkH,UAAL,CAAgB4C,CAAhB,CAA0B,wBAA1B,CAAoD,IAApD,EAA0DpG,IAA1D,CACI,UAAY,CACX,CAFL,EAMAhE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DqD,IAA/D,CAAoE,UAApE,KAGA,GAAI,CAACpE,CAAI,CAACD,UAAL,CAAgBsJ,WAAhB,EAAL,CAAoC,CAClCvE,UAAU,CAAC,UAAY,CACrB9F,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,8BAAhC,CAAD,CAAiEuI,OAAjE,CAAyE,OAAzE,CACD,CAFS,CAEP,GAFO,CAGX,CAED,GAAIL,CAAJ,CAAkB,CAChBjK,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4CAAhC,CAAD,CAA+EoC,IAA/E,GACAnE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,8CAAhC,CAAD,CAAiFoC,IAAjF,GACAnE,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,2DAAhC,CAAD,CAA8FwI,aAA9F,CAA4G,CACxGC,MAAM,CAAE,KADgG,CAExGC,SAAS,CAAEzJ,CAAI,CAACF,QAAL,CAAcoJ,SAF+E,CAGxGQ,QAAQ,CAAE,mBAAW,CACjB1K,CAAC,CAAC,IAAMgB,CAAI,CAACF,QAAL,CAAciB,QAApB,CAA+B,4BAAhC,CAAD,CAA+DuI,OAA/D,CAAuE,OAAvE,CACH,CALuG,CAA5G,CAOD,CACF,CAjCL,CAkCD,CAvdI,CA0dL/G,UAAU,CAAE,qBAAU,IAChBvC,CAAAA,CAAI,CAAE,IADU,CAGhByD,CAAQ,CAAGzD,CAAI,CAACK,KAAL,CAAWL,CAAI,CAACM,IAAL,CAAUC,OAArB,EAA8BmD,KAHzB,CAIpB,GAAGD,CAAQ,EAAI,CAACA,CAAQ,CAACE,MAAzB,CAAiC,CAC/BF,CAAQ,CAACG,KAAT,EACD,CACF,CAjeI,CAoeR,CAjfK,CAAN","sourcesContent":["define(['jquery',\n      'core/log',\n      'core/ajax',\n      'mod_minilesson/definitions',\n      'mod_minilesson/pollyhelper',\n      'mod_minilesson/ttrecorder',\n      'mod_minilesson/animatecss',\n      'core/templates'\n    ], function($, log, ajax, def, polly, ttrecorder, anim, templates) {\n  \"use strict\"; // jshint ;_;\n\n  log.debug('MiniLesson listen and repeat: initialising');\n\n  return {\n\n    //a handle on the tt recorder\n    ttrec: null,\n\n    //for making multiple instances\n    clone: function () {\n      return $.extend(true, {}, this);\n    },\n\n    init: function (index, itemdata, quizhelper) {\n      var self = this;\n      var theCallback = function (message) {\n\n        switch (message.type) {\n          case 'recording':\n            break;\n\n          case 'speech':\n            log.debug(\"speech at listen_repeat\");\n            //var wordcount = quizhelper.count_words(message.capturedspeech);\n            self.getComparison(\n                self.items[self.game.pointer].target,\n                message.capturedspeech,\n                self.items[self.game.pointer].phonetic,\n                function (comparison) {\n                  self.gotComparison(comparison, message);\n                }\n            );\n            break;\n\n        }\n\n      };\n\n      if (quizhelper.use_ttrecorder()) {\n        var opts = {};\n        opts.uniqueid = itemdata.uniqueid;\n        opts.callback = theCallback;\n        opts.stt_guided = quizhelper.is_stt_guided();\n        opts.wwwroot = quizhelper.is_stt_guided();\n        self.ttrec = ttrecorder.clone();\n        self.ttrec.init(opts);\n      } else {\n        //init cloudpoodll push recorder\n        cloudpoodll.init('minilesson-recorder-listenrepeat-' + itemdata.id, theCallback);\n      }\n\n      self.itemdata = itemdata;\n      self.quizhelper = quizhelper;\n      self.index = index;\n\n      //anim\n      var animopts = {};\n      animopts.useanimatecss = quizhelper.useanimatecss;\n      anim.init(animopts);\n\n      self.register_events();\n      self.setvoice();\n      self.getItems();\n    },\n\n    next_question: function (percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = self.items.length;\n      stepdata.correctitems = self.items.filter(function (e) {\n        return e.correct;\n      }).length;\n      stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n\n      //stop audio\n      self.stop_audio();\n\n      //transition\n      self.quizhelper.do_next(stepdata);\n    },\n\n    show_item_review: function () {\n      var self = this;\n      var review_data = {};\n      review_data.items = self.items;\n      review_data.totalitems = self.items.length;\n      review_data.correctitems = self.items.filter(function (e) {\n        return e.correct;\n      }).length;\n\n      //display results\n      var gamebox = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\");\n      var controlsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_controls\");\n      var recorderbox = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speakbtncontainer\");\n      var resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_resultscontainer\");\n      templates.render('mod_minilesson/listitemresults', review_data).then(\n          function (html, js) {\n            resultsbox.html(html);\n            //show and hide\n            resultsbox.show();\n            gamebox.hide();\n            controlsbox.hide();\n            recorderbox.hide();\n            // Run js for audio player events\n            templates.runTemplateJS(js);\n          }\n      );// End of templates\n    },\n\n    register_events: function () {\n\n      var self = this;\n      //on next button click\n      $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function (e) {\n        self.next_question();\n      });\n      //on start button click\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").on(\"click\", function () {\n        self.start();\n      });\n\n\n      //AUDIO PLAYER Button events\n      var audioplayerbtn=$(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_btn\");\n      // On listen button click\n      audioplayerbtn.on(\"click\", function () {\n        var theaudio = self.items[self.game.pointer].audio;\n\n        //if we are already playing stop playing\n        if(!theaudio.paused){\n          theaudio.pause();\n          theaudio.currentTime=0;\n          $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n          $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n          return;\n        }\n\n        //change icon to indicate playing state\n        theaudio.addEventListener('ended', function () {\n          $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n          $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n        });\n\n        theaudio.addEventListener('play', function () {\n          $(audioplayerbtn).children('.fa').removeClass('fa-volume-up');\n          $(audioplayerbtn).children('.fa').addClass('fa-stop');\n        });\n        theaudio.load();\n        theaudio.play();\n      });\n\n      //on skip button click\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_skip_btn\").on(\"click\", function () {\n        //disable the buttons\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n        //reveal the prompt\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speech.landr_teacher_left\").text(self.items[self.game.pointer].displayprompt + \"\");\n        //reveal the answer\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input\").each(function () {\n          var realidx = $(this).data(\"realidx\");\n          var landr_word_input = self.items[self.game.pointer].landr_targetWords[realidx];\n          $(this).val(landr_word_input);\n        });\n\n        //mark as answered and incorrect\n        self.items[self.game.pointer].answered = true;\n        self.items[self.game.pointer].correct = false;\n\n        //next prompt or end\n        if (self.game.pointer < self.items.length - 1) {\n          //move on after short time to next prompt\n          setTimeout(function () {\n            self.game.pointer++;\n            self.nextPrompt();\n          }, 2200);\n          //end question\n        } else {\n          self.end();\n        }\n      });\n\n    },\n\n\n    game: {\n      pointer: 0\n    },\n    usevoice: '',\n    setvoice: function () {\n      var self = this;\n      self.usevoice = self.itemdata.usevoice;\n      self.voiceoption = self.itemdata.voiceoption;\n      return;\n    },\n    getItems: function () {\n      var self = this;\n      var text_items = self.itemdata.sentences;\n\n      self.items = text_items.map(function (target) {\n        return {\n          landr_targetWords: target.sentence.trim().split(self.quizhelper.spliton_regexp).filter(function (e) {\n            return e !== \"\";\n          }),\n          target: target.sentence,\n          prompt: target.prompt,\n          displayprompt: target.displayprompt,\n          phonetic: target.phonetic,\n          typed: \"\",\n          answered: false,\n          correct: false,\n          audio: null,\n          audiourl: target.audiourl ? target.audiourl : \"\",\n          imageurl: target.imageurl,\n        };\n      }).filter(function (e) {\n        return e.target !== \"\";\n      });\n\n\n      $.each(self.items, function (index, item) {\n        item.audio = new Audio();\n        item.audio.src = item.audiourl;\n        if (self.items.filter(function (e) {\n          return e.audio === null;\n        }).length === 0) {\n          self.appReady();\n        }\n      });\n    },\n\n    appReady: function () {\n      var self = this;\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_not_loaded\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_loaded\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").prop(\"disabled\", false);\n    },\n    gotComparison: function (comparison, typed) {\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input\").removeClass(\"landr_correct landr_incorrect\");\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback_icon\").removeClass(\"fa fa-check fa-times\");\n\n      var allCorrect = comparison.filter(function (e) {\n        return !e.matched;\n      }).length == 0;\n\n      if (allCorrect && comparison && comparison.length > 0) {\n\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input\").addClass(\"landr_correct\");\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback_icon\").addClass(\"fa fa-check\");\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speech.landr_teacher_left\").text(self.items[self.game.pointer].displayprompt + \"\");\n\n        self.items[self.game.pointer].answered = true;\n        self.items[self.game.pointer].correct = true;\n        self.items[self.game.pointer].typed = typed;\n\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n        if (self.game.pointer < self.items.length - 1) {\n          setTimeout(function () {\n            self.game.pointer++;\n            self.nextPrompt();\n          }, 2200);\n        } else {\n          self.end();\n        }\n\n      } else {\n        //mark up the words as correct or not\n        comparison.forEach(function (obj) {\n          if (!obj.matched) {\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input[data-idx='\" + obj.wordnumber + \"']\").addClass(\"landr_incorrect\");\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback_icon[data-idx='\" + obj.wordnumber + \"']\").addClass(\"fa fa-times\");\n          } else {\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input[data-idx='\" + obj.wordnumber + \"']\").addClass(\"landr_correct\");\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback_icon[data-idx='\" + obj.wordnumber + \"']\").addClass(\"fa fa-check\");\n          }\n        });\n        var thereply = $(\"#\" + self.itemdata.uniqueid + \"_container .landr_reply_\" + self.game.pointer);\n        anim.do_animate(thereply, 'shakeX animate__faster').then(\n            function () {\n              $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", false);\n            }\n        );\n\n      }\n      //show all the correct words\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_word_input.landr_correct\").each(function () {\n        var realidx = $(this).data(\"realidx\");\n        var landr_word_input = self.items[self.game.pointer].landr_targetWords[realidx];\n        $(this).val(landr_word_input);\n      });\n\n    },\n\n    getWords: function (thetext) {\n      var self = this;\n      var checkcase = false;\n      if (checkcase == 'false') {\n        thetext = thetext.toLowerCase();\n      }\n      var chunks = thetext.split(self.quizhelper.spliton_regexp).filter(function (e) {\n        return e !== \"\";\n      });\n      var words = [];\n      for (var i = 0; i < chunks.length; i++) {\n        if (!chunks[i].match(self.quizhelper.spliton_regexp)) {\n          words.push(chunks[i]);\n        }\n      }\n      return words;\n    },\n    getComparison: function (passage, transcript, phonetic, callback) {\n      var self = this;\n\n      $(\".landr_ctrl-btn\").prop(\"disabled\", true);\n      self.quizhelper.comparePassageToTranscript(passage, transcript, phonetic, self.itemdata.language, self.itemdata.alternates).then(function (ajaxresult) {\n        var payloadobject = JSON.parse(ajaxresult);\n        if (payloadobject) {\n          callback(payloadobject);\n        } else {\n          callback(false);\n        }\n      });\n\n    },\n    end: function () {\n      var self = this;\n      $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n      //progress dots are updated on next_item. The last item has no next item, so we update from here\n      self.updateProgressDots();\n\n      //disable the buttons and go to next question or review\n      setTimeout(function () {\n        $(\".minilesson_nextbutton\").prop(\"disabled\", false);\n        if (self.quizhelper.showitemreview) {\n          self.show_item_review();\n        } else {\n          self.next_question();\n        }\n      }, 2200);\n\n    },\n    start: function () {\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speakbtncontainer\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_title\").show();\n\n      self.items.forEach(function (item) {\n        item.spoken = \"\";\n        item.answered = false;\n        item.correct = false;\n      });\n\n      self.game.pointer = 0;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_cont\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_mainmenu\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_controls\").show();\n\n      self.nextPrompt();\n\n    },\n\n    nextPrompt: function () {\n      var showText = parseInt(this.itemdata.show_text);\n      var self = this;\n\n      //target is the speech we expect\n      var target = self.items[self.game.pointer].target;\n      //in some cases ttrecorder wants to know the target\n      if (self.quizhelper.use_ttrecorder()) {\n        self.ttrec.currentPrompt = target;\n      }\n      var displayprompt = self.items[self.game.pointer].displayprompt;\n      if (!showText) {\n        var nopunc = displayprompt.replace(self.quizhelper.nopunc_regexp, \"\");\n        var dots = nopunc.replace(self.quizhelper.nonspaces_regexp, '•');\n        var showprompt = dots;\n      } else {\n        var showprompt = displayprompt;\n      }\n\n      templates.render('mod_minilesson/listenrepeat_prompt',\n          {showprompt: showprompt, pointer: self.game.pointer})\n          .then(function (html, js) {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").html(html);\n                $(\".landr_ctrl-btn\").prop(\"disabled\", false);\n                self.updateProgressDots();\n                var newprompt = $(\".landr_prompt_\" + self.game.pointer);\n                anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n                    function () {\n                    }\n                );\n                self.nextReply();\n              }\n          );// End of templates\n    },\n\n    updateProgressDots: function () {\n      var self = this;\n      var color;\n      var progress = self.items.map(function (item, idx) {\n        color = \"gray\";\n        if (self.items[idx].answered && self.items[idx].correct) {\n          color = \"green\";\n        } else if (self.items[idx].answered && !self.items[idx].correct) {\n          color = \"red\";\n        }\n        return \"<i style='color:\" + color + \"' class='fa fa-circle'></i>\";\n      }).join(\" \");\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_title\").html(progress);\n    },\n\n    nextReply: function () {\n      var self = this;\n      var idx = 0;\n      var words = self.items[self.game.pointer].landr_targetWords.map(function (word, realidx) {\n        var theword = {};\n        if (!word.match(self.quizhelper.spliton_regexp)) {\n          idx++;\n          theword.isword = true;\n          theword.idx = idx;\n          theword.length = word.length;\n          theword.lengthplusone = word.length + 1;\n          theword.realidx = realidx;\n        } else {\n          theword.isword = false;\n          theword.text = word;\n        }\n        return theword;\n      });\n      var displaytimer = self.itemdata.timelimit > 0;\n\n      templates.render('mod_minilesson/listenrepeat_reply',\n          {words: words, pointer: self.game.pointer, imageurl: self.items[self.game.pointer].imageurl, displaytimer})\n          .then(function (html, js) {\n            //update html reply area\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").append(html);\n            // set handle to the reply and animate it in\n            var newreply = $(\".landr_reply_\" + self.game.pointer);\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function () {\n                }\n            );\n\n            // Enable the skip button\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", false);\n\n            //play the audio if we are not a mobile user and that is the setting\n            if (!self.quizhelper.mobile_user()) {\n              setTimeout(function () {\n                $(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_btn\").trigger('click');\n              }, 1000);\n            }\n\n            if (displaytimer) {\n              $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game .progress-container\").show();\n              $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game .progress-container i\").show();\n              $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game .progress-container #progresstimer\").progressTimer({\n                  height: '5px',\n                  timeLimit: self.itemdata.timelimit,\n                  onFinish: function() {\n                      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_skip_btn\").trigger('click');\n                  }\n              });\n            }\n          });//end of templates.render\n    },//end of next reply\n\n    // Stop audio .. usually when leaving the item or sentence\n    stop_audio: function(){\n      var self =this;\n      //pause audio if its playing\n      var theaudio = self.items[self.game.pointer].audio;\n      if(theaudio && !theaudio.paused) {\n        theaudio.pause();\n      }\n    }\n\n  } // end of return\n});//end of define"],"file":"listenrepeat.min.js"}