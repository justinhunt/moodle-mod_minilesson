{"version":3,"sources":["../src/listenrepeat.js"],"names":["define","$","log","ajax","def","polly","ttrecorder","anim","templates","str","notification","debug","ttrec","clone","extend","init","index","itemdata","quizhelper","self","theCallback","message","type","getComparison","items","game","pointer","target","capturedspeech","phonetic","comparison","gotComparison","use_ttrecorder","opts","uniqueid","callback","stt_guided","is_stt_guided","wwwroot","cloudpoodll","id","strings","animopts","useanimatecss","init_controls","init_strings","register_events","setvoice","getItems","controls","container","nextbutton","start_btn","skip_btn","ctrl_btn","controlsbox","resultscontainer","speakbtncontainer","mainmenu","title","question","speech_container","landr_correctfeedback","landr_incorrectfeedback","landr_fbcontainer","landr_feedback","landr_listen_btn","progress_container","get_strings","done","s","i","nextlessonitem","confirm_desc","yes","no","next_question","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","stop_audio","do_next","show_item_review","review_data","gamebox","recorderbox","resultsbox","audioplayerbtn","render","then","html","js","show","hide","runTemplateJS","on","some","item","answered","confirm","start","theaudio","audio","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","prop","find","text","displayprompt","each","realidx","data","landr_word_input","landr_targetWords","val","stopTimer","timer","setTimeout","nextPrompt","end","usevoice","voiceoption","text_items","sentences","map","sentence","trim","split","spliton_regexp","prompt","typed","audiourl","imageurl","Audio","src","appReady","hidestartpage","allCorrect","matched","forEach","obj","wordnumber","thereply","do_animate","getWords","thetext","toLowerCase","chunks","words","match","push","passage","transcript","comparePassageToTranscript","language","alternates","ajaxresult","payloadobject","JSON","parse","updateProgressDots","showitemreview","spoken","showText","parseInt","show_text","currentPrompt","nopunc","replace","nopunc_regexp","dots","nonspaces_regexp","showprompt","newprompt","nextReply","color","progress","idx","join","word","theword","isword","lengthplusone","displaytimer","timelimit","append","newreply","mobile_user","trigger","startTimer","doStartTimer","progresbar","progressTimer","height","timeLimit","onFinish","attr","timers","clearInterval"],"mappings":"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","sourcesContent":["define(['jquery',\n      'core/log',\n      'core/ajax',\n      'mod_minilesson/definitions',\n      'mod_minilesson/pollyhelper',\n      'mod_minilesson/ttrecorder',\n      'mod_minilesson/animatecss',\n      'core/templates',\n      'core/str',\n      'core/notification'\n    ], function($, log, ajax, def, polly, ttrecorder, anim, templates,str,notification) {\n  \"use strict\"; // jshint ;_;\n\n  log.debug('MiniLesson listen and repeat: initialising');\n\n  return {\n\n    //a handle on the tt recorder\n    ttrec: null,\n\n    //for making multiple instances\n    clone: function () {\n      return $.extend(true, {}, this);\n    },\n\n    init: function (index, itemdata, quizhelper) {\n      var self = this;\n      var theCallback = function (message) {\n\n        switch (message.type) {\n          case 'recording':\n            break;\n\n          case 'speech':\n            log.debug(\"speech at listen_repeat\");\n            //var wordcount = quizhelper.count_words(message.capturedspeech);\n            self.getComparison(\n                self.items[self.game.pointer].target,\n                message.capturedspeech,\n                self.items[self.game.pointer].phonetic,\n                function (comparison) {\n                  self.gotComparison(comparison, message);\n                }\n            );\n            break;\n\n        }\n\n      };\n\n      if (quizhelper.use_ttrecorder()) {\n        var opts = {};\n        opts.uniqueid = itemdata.uniqueid;\n        opts.callback = theCallback;\n        opts.stt_guided = quizhelper.is_stt_guided();\n        opts.wwwroot = quizhelper.is_stt_guided();\n        self.ttrec = ttrecorder.clone();\n        self.ttrec.init(opts);\n      } else {\n        //init cloudpoodll push recorder\n        cloudpoodll.init('minilesson-recorder-listenrepeat-' + itemdata.id, theCallback);\n      }\n\n      self.itemdata = itemdata;\n      self.quizhelper = quizhelper;\n      self.index = index;\n      self.strings = {};\n\n      //anim\n      var animopts = {};\n      animopts.useanimatecss = quizhelper.useanimatecss;\n      anim.init(animopts);\n\n      self.init_controls();\n      self.init_strings();\n      self.register_events();\n      self.setvoice();\n      self.getItems();\n    },\n\n    init_controls: function() {\n      var self = this;\n      self.controls = {\n        container: $(\"#\" + self.itemdata.uniqueid + \"_container\"),\n        nextbutton: $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\"),\n        start_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\"),\n        skip_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_skip_btn\"),\n        ctrl_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\"),\n        game: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\"),\n        controlsbox: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_controls\"),\n        resultscontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_resultscontainer\"),\n        speakbtncontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speakbtncontainer\"),\n        mainmenu: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_mainmenu\"),\n        title: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_title\"),\n        question: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_question\"),\n        speech_container: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speechcontainer\"),\n        landr_correctfeedback: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_correctfeedback\"),\n        landr_incorrectfeedback: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_incorrectfeedback\"),\n        landr_fbcontainer: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_fbcontainer\"),\n        landr_feedback: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback\"),\n        landr_listen_btn: $(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_btn\"),\n        progress_container: $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container\"),\n      };\n    },\n\n    init_strings: function() {\n        var self = this;\n        str.get_strings([\n            { \"key\": \"nextlessonitem\", \"component\": 'mod_minilesson'},\n            { \"key\": \"confirm_desc\", \"component\": 'mod_minilesson'},\n            { \"key\": \"yes\", \"component\": 'moodle'},\n            { \"key\": \"no\", \"component\": 'moodle'},\n        ]).done(function (s) {\n            var i = 0;\n            self.strings.nextlessonitem = s[i++];\n            self.strings.confirm_desc = s[i++];\n            self.strings.yes = s[i++];\n            self.strings.no = s[i++];\n        });\n    },\n\n    next_question: function (percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = self.items.length;\n      stepdata.correctitems = self.items.filter(function (e) {\n        return e.correct;\n      }).length;\n      stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n\n      //stop audio\n      self.stop_audio();\n\n      //transition\n      self.quizhelper.do_next(stepdata);\n    },\n\n    show_item_review: function () {\n      var self = this;\n      var review_data = {};\n      review_data.items = self.items;\n      review_data.totalitems = self.items.length;\n      review_data.correctitems = self.items.filter(function (e) {\n        return e.correct;\n      }).length;\n\n      //display results\n      var gamebox = self.controls.game;\n      var controlsbox = self.controls.controlsbox;\n      var recorderbox = self.controls.speakbtncontainer;\n      var resultsbox = self.controls.resultscontainer;\n      var audioplayerbtn = self.controls.landr_listen_btn;\n      templates.render('mod_minilesson/listitemresults', review_data).then(\n          function (html, js) {\n            resultsbox.html(html);\n            //show and hide\n            resultsbox.show();\n            gamebox.hide();\n            controlsbox.hide();\n            recorderbox.hide();\n            audioplayerbtn.hide();\n            // Run js for audio player events\n            templates.runTemplateJS(js);\n          }\n      );// End of templates\n    },\n\n    register_events: function () {\n\n      var self = this;\n      //on next button click\n      self.controls.nextbutton.on('click', function (e) {\n        if (self.items.some(item => !item.answered)) {\n            notification.confirm(self.strings.nextlessonitem,\n                self.strings.confirm_desc,\n                self.strings.yes,\n                self.strings.no,\n                function() {\n                    self.next_question();\n                }\n            );\n        } else {\n            self.next_question();\n        }\n      });\n      //on start button click\n      self.controls.start_btn.on(\"click\", function () {\n        self.start();\n      });\n\n\n      //AUDIO PLAYER Button events\n      var audioplayerbtn = self.controls.landr_listen_btn;\n      // On listen button click\n      audioplayerbtn.on(\"click\", function () {\n        var theaudio = self.items[self.game.pointer].audio;\n\n        //if we are already playing stop playing\n        if(!theaudio.paused){\n          theaudio.pause();\n          theaudio.currentTime=0;\n          $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n          $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n          return;\n        }\n\n        //change icon to indicate playing state\n        theaudio.addEventListener('ended', function () {\n          $(audioplayerbtn).children('.fa').removeClass('fa-stop');\n          $(audioplayerbtn).children('.fa').addClass('fa-volume-up');\n        });\n\n        theaudio.addEventListener('play', function () {\n          $(audioplayerbtn).children('.fa').removeClass('fa-volume-up');\n          $(audioplayerbtn).children('.fa').addClass('fa-stop');\n        });\n        theaudio.load();\n        theaudio.play();\n      });\n\n      //on skip button click\n      self.controls.skip_btn.on(\"click\", function () {\n        //disable the buttons\n        self.controls.ctrl_btn.prop(\"disabled\", true);\n        //reveal the prompt\n        self.controls.container.find('.landr_speech.landr_teacher_left').text(self.items[self.game.pointer].displayprompt + \"\");\n        //reveal the answer\n        self.controls.container.find('.landr_word_input').each(function () {\n          var realidx = $(this).data(\"realidx\");\n          var landr_word_input = self.items[self.game.pointer].landr_targetWords[realidx];\n          $(this).val(landr_word_input);\n        });\n\n        //mark as answered and incorrect\n        self.items[self.game.pointer].answered = true;\n        self.items[self.game.pointer].correct = false;\n\n        //Stop timer\n        self.stopTimer(self.items[self.game.pointer].timer);\n\n        //next prompt or end\n        if (self.game.pointer < self.items.length - 1) {\n          self.controls.skip_btn.prop(\"disabled\", true);\n          self.controls.skip_btn.children('.fa').removeClass('fa-arrow-right');\n          self.controls.skip_btn.children('.fa').addClass('fa-spinner fa-spin');\n          //move on after short time to next prompt\n          setTimeout(function () {\n            self.controls.skip_btn.children('.fa').removeClass('fa-spinner fa-spin');\n            self.controls.skip_btn.children('.fa').addClass('fa-arrow-right');\n            self.controls.skip_btn.prop(\"disabled\", false);\n            self.game.pointer++;\n            self.nextPrompt();\n          }, 2200);\n          //end question\n        } else {\n          self.end();\n        }\n      });\n\n    },\n\n\n    game: {\n      pointer: 0\n    },\n    usevoice: '',\n    setvoice: function () {\n      var self = this;\n      self.usevoice = self.itemdata.usevoice;\n      self.voiceoption = self.itemdata.voiceoption;\n      return;\n    },\n    getItems: function () {\n      var self = this;\n      var text_items = self.itemdata.sentences;\n\n      self.items = text_items.map(function (target) {\n        return {\n          landr_targetWords: target.sentence.trim().split(self.quizhelper.spliton_regexp).filter(function (e) {\n            return e !== \"\";\n          }),\n          target: target.sentence,\n          prompt: target.prompt,\n          displayprompt: target.displayprompt,\n          phonetic: target.phonetic,\n          typed: \"\",\n          answered: false,\n          correct: false,\n          audio: null,\n          timer: [],\n          audiourl: target.audiourl ? target.audiourl : \"\",\n          imageurl: target.imageurl,\n        };\n      }).filter(function (e) {\n        return e.target !== \"\";\n      });\n\n\n      $.each(self.items, function (index, item) {\n        item.audio = new Audio();\n        item.audio.src = item.audiourl;\n        if (self.items.filter(function (e) {\n          return e.audio === null;\n        }).length === 0) {\n          self.appReady();\n        }\n      });\n    },\n\n    appReady: function () {\n      var self = this;\n      self.controls.container.find('.landr_not_loaded').hide();\n      self.controls.container.find('.landr_loaded').show();\n      if(self.itemdata.hidestartpage){\n        self.start();\n      }else{\n        self.controls.start_btn.prop(\"disabled\", false);\n      }\n\n    },\n\n    gotComparison: function (comparison, typed) {\n      var self = this;\n\n      self.controls.container.find('.landr_word_input').removeClass(\"landr_correct landr_incorrect\");\n      self.controls.container.find('.landr_feedback_icon').removeClass(\"fa fa-check fa-times\");\n\n      var allCorrect = comparison.filter(function (e) {\n        return !e.matched;\n      }).length == 0;\n\n      if (allCorrect && comparison && comparison.length > 0) {\n\n        self.controls.container.find('.landr_word_input').addClass(\"landr_correct\");\n        self.controls.container.find('.landr_feedback_icon').addClass(\"fa fa-check\");\n        self.controls.container.find('.landr_speech.landr_teacher_left').text(self.items[self.game.pointer].displayprompt + \"\");\n\n        self.items[self.game.pointer].answered = true;\n        self.items[self.game.pointer].correct = true;\n        self.items[self.game.pointer].typed = typed;\n\n        //stop timer\n        self.stopTimer(self.items[self.game.pointer].timer);\n\n        self.controls.ctrl_btn.prop(\"disabled\", true);\n        if (self.game.pointer < self.items.length - 1) {\n          setTimeout(function () {\n            self.game.pointer++;\n            self.nextPrompt();\n          }, 2200);\n        } else {\n          self.end();\n        }\n\n      } else {\n        //mark up the words as correct or not\n        comparison.forEach(function (obj) {\n          if (!obj.matched) {\n            self.controls.container.find('.landr_word_input[data-idx=\"' + obj.wordnumber + '\"]').addClass(\"landr_incorrect\");\n            self.controls.container.find('.landr_feedback_icon[data-idx=\"' + obj.wordnumber + '\"]').addClass(\"fa fa-times\");\n          } else {\n            self.controls.container.find('.landr_word_input[data-idx=\"' + obj.wordnumber + '\"]').addClass(\"landr_correct\");\n            self.controls.container.find('.landr_feedback_icon[data-idx=\"' + obj.wordnumber + '\"]').addClass(\"fa fa-check\");\n          }\n        });\n        var thereply = self.controls.container.find('.landr_reply_' + self.game.pointer);\n        anim.do_animate(thereply, 'shakeX animate__faster').then(\n            function () {\n              self.controls.ctrl_btn.prop(\"disabled\", false);\n            }\n        );\n\n      }\n      //show all the correct words\n      self.controls.container.find('.landr_word_input.landr_correct').each(function () {\n        var realidx = $(this).data(\"realidx\");\n        var landr_word_input = self.items[self.game.pointer].landr_targetWords[realidx];\n        $(this).val(landr_word_input);\n      });\n\n    },\n\n    getWords: function (thetext) {\n      var self = this;\n      var checkcase = false;\n      if (checkcase == 'false') {\n        thetext = thetext.toLowerCase();\n      }\n      var chunks = thetext.split(self.quizhelper.spliton_regexp).filter(function (e) {\n        return e !== \"\";\n      });\n      var words = [];\n      for (var i = 0; i < chunks.length; i++) {\n        if (!chunks[i].match(self.quizhelper.spliton_regexp)) {\n          words.push(chunks[i]);\n        }\n      }\n      return words;\n    },\n    getComparison: function (passage, transcript, phonetic, callback) {\n      var self = this;\n\n      self.controls.ctrl_btn.prop(\"disabled\", true);\n      self.quizhelper.comparePassageToTranscript(passage, transcript, phonetic, self.itemdata.language, self.itemdata.alternates).then(function (ajaxresult) {\n        var payloadobject = JSON.parse(ajaxresult);\n        if (payloadobject) {\n          callback(payloadobject);\n        } else {\n          callback(false);\n        }\n      });\n\n    },\n    end: function () {\n      var self = this;\n      self.controls.nextbutton.prop(\"disabled\", true);\n\n      //progress dots are updated on next_item. The last item has no next item, so we update from here\n      self.updateProgressDots();\n\n      //disable the buttons and go to next question or review\n      setTimeout(function () {\n        self.controls.nextbutton.prop(\"disabled\", false);\n        if (self.quizhelper.showitemreview) {\n          self.show_item_review();\n        } else {\n          self.next_question();\n        }\n      }, 2200);\n\n    },\n    start: function () {\n      var self = this;\n\n      self.controls.ctrl_btn.prop(\"disabled\", true);\n      self.controls.speakbtncontainer.show();\n      self.controls.title.show();\n\n      self.items.forEach(function (item) {\n        item.spoken = \"\";\n        item.answered = false;\n        item.correct = false;\n      });\n\n      self.game.pointer = 0;\n\n      self.controls.game.show();\n      self.controls.start_btn.hide();\n      self.controls.container.find('.landr_listen_cont').show();\n      self.controls.mainmenu.hide();\n      self.controls.controlsbox.show();\n\n      self.nextPrompt();\n\n    },\n\n    nextPrompt: function () {\n      var showText = parseInt(this.itemdata.show_text);\n      var self = this;\n\n      //target is the speech we expect\n      var target = self.items[self.game.pointer].target;\n      //in some cases ttrecorder wants to know the target\n      if (self.quizhelper.use_ttrecorder()) {\n        self.ttrec.currentPrompt = target;\n      }\n      var displayprompt = self.items[self.game.pointer].displayprompt;\n      if (!showText) {\n        var nopunc = displayprompt.replace(self.quizhelper.nopunc_regexp, \"\");\n        var dots = nopunc.replace(self.quizhelper.nonspaces_regexp, '•');\n        var showprompt = dots;\n      } else {\n        var showprompt = displayprompt;\n      }\n\n      templates.render('mod_minilesson/listenrepeat_prompt',\n          {showprompt: showprompt, pointer: self.game.pointer})\n          .then(function (html, js) {\n                self.controls.game.html(html);\n                self.controls.ctrl_btn.prop(\"disabled\", false);\n                self.updateProgressDots();\n                var newprompt = self.controls.container.find(\".landr_prompt_\" + self.game.pointer);\n                anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n                    function () {\n                    }\n                );\n                self.nextReply();\n              }\n          );// End of templates\n    },\n\n    updateProgressDots: function () {\n      var self = this;\n      var color;\n      var progress = self.items.map(function (item, idx) {\n        color = \"gray\";\n        if (self.items[idx].answered && self.items[idx].correct) {\n          color = \"green\";\n        } else if (self.items[idx].answered && !self.items[idx].correct) {\n          color = \"red\";\n        }\n        return \"<i style='color:\" + color + \"' class='fa fa-circle'></i>\";\n      }).join(\" \");\n      self.controls.title.html(progress);\n    },\n\n    nextReply: function () {\n      var self = this;\n      var idx = 0;\n      var words = self.items[self.game.pointer].landr_targetWords.map(function (word, realidx) {\n        var theword = {};\n        if (!word.match(self.quizhelper.spliton_regexp)) {\n          idx++;\n          theword.isword = true;\n          theword.idx = idx;\n          theword.length = word.length;\n          theword.lengthplusone = word.length + 1;\n          theword.realidx = realidx;\n        } else {\n          theword.isword = false;\n          theword.text = word;\n        }\n        return theword;\n      });\n      var displaytimer = self.itemdata.timelimit > 0;\n\n      templates.render('mod_minilesson/listenrepeat_reply',\n          {words: words, pointer: self.game.pointer, imageurl: self.items[self.game.pointer].imageurl, displaytimer})\n          .then(function (html, js) {\n            //update html reply area\n            self.controls.game.append(html);\n            // set handle to the reply and animate it in\n            var newreply = self.controls.container.find(\".landr_reply_\" + self.game.pointer);\n            anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n                function () {\n                }\n            );\n\n            // Enable the skip button\n            self.controls.ctrl_btn.prop(\"disabled\", false);\n\n            //we autoplay the audio on item entry, if its not a mobile user\n            //and we have a startpage (or we have a startpage but its not the first item)\n            if (!self.quizhelper.mobile_user()){\n              if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                  self.controls.container.on(\"showElement\", () => {\n                      setTimeout(function() {\n                          self.controls.landr_listen_btn.trigger('click');\n                      }, 1000);\n                  });\n              }else{\n                  setTimeout(function() {\n                      self.controls.landr_listen_btn.trigger('click');\n                  }, 1000);\n              }\n            }\n\n            //do the timer\n            if (displaytimer) {\n              self.startTimer();\n            }\n\n          });//end of templates.render\n    },//end of next reply\n\n    // Stop audio .. usually when leaving the item or sentence\n    stop_audio: function(){\n      var self =this;\n      //pause audio if its playing\n      var theaudio = self.items[self.game.pointer].audio;\n      if(theaudio && !theaudio.paused) {\n        theaudio.pause();\n      }\n    },\n\n    startTimer: function(){\n        var self = this;\n        var progress_container = self.controls.progress_container;\n        // If we have a time limit, set up the timer, otherwise return\n        if (self.itemdata.timelimit > 0) {\n            // This is a function to start the timer (we call it conditionally below)\n            var doStartTimer = function() {\n                  // This shows progress bar\n                progress_container.show();\n                progress_container.find('i').show();\n                var progresbar = progress_container.find('#progresstimer').progressTimer({\n                    height: '5px',\n                    timeLimit: self.itemdata.timelimit,\n                    onFinish: function() {\n                        self.controls.skip_btn.trigger('click');\n                    }\n                });\n                progresbar.each(function() {\n                    self.items[self.game.pointer].timer.push($(this).attr('timer'));\n                });\n            }\n\n            // This adds the timer and starts it. But if we dont have a start page and its the first item\n            // we need to defer the timer start until the item is shown\n            if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                self.controls.container.on(\"showElement\", () => {\n                    doStartTimer();\n                });\n            }else{\n                doStartTimer();\n            }\n        }\n    }, //end of start timer\n\n    stopTimer: function(timers) {\n        if (timers.length) {\n            timers.forEach(function(timer) {\n                clearInterval(timer);\n            });\n        }\n    },// end of stop timer\n\n  } // end of return\n});//end of define"],"file":"listenrepeat.min.js"}