{"version":3,"sources":["../src/listenrepeat.js"],"names":["define","$","log","ajax","def","polly","cloudpoodll","ttrecorder","debug","clone","extend","init","index","itemdata","quizhelper","self","theCallback","message","type","getComparison","items","game","pointer","target","capturedspeech","comparison","gotComparison","use_ttrecorder","opts","uniqueid","callback","id","register_events","setvoice","getItems","next_question","stepdata","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","do_next","on","start","audio","load","play","prop","text","setTimeout","answered","nextPrompt","end","spliton","usevoice","mf","voice","text_items","customtext1","split","map","landr_targetWords","trim","typed","each","item","fetch_polly_url","then","audiourl","Audio","src","appReady","hide","show","removeClass","allCorrect","matched","addClass","forEach","obj","wordnumber","effect","realidx","data","landr_targetWord","val","getWords","thetext","toLowerCase","chunks","words","i","match","push","passage","transcript","call","methodname","args","alternatives","language","done","ajaxresult","payloadobject","JSON","parse","fail","err","console","numCorrect","totalNum","html","spoken","code","replace","color","progress","idx","join","toggle","direction","nextReply","landr_targetWordsCode","word","append","mobile_user","trigger"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'core/ajax', 'mod_poodlltime/definitions', 'mod_poodlltime/pollyhelper', 'mod_poodlltime/cloudpoodllloader','mod_poodlltime/ttrecorder'],\n    function($, log, ajax, def, polly, cloudpoodll, ttrecorder) {\n  \"use strict\"; // jshint ;_;\n\n  log.debug('Poodll Time listen and repeat: initialising');\n\n  return {\n\n      //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n      },\n\n      init: function(index, itemdata, quizhelper) {\n        var self = this;\n        var theCallback = function(message) {\n\n            switch (message.type) {\n                case 'recording':\n                    break;\n\n                case 'speech':\n                    log.debug(\"speech at listen_repeat\");\n                    self.getComparison(\n                        self.items[self.game.pointer].target,\n                        message.capturedspeech,\n                        function(comparison) {\n                            self.gotComparison(comparison, message);\n                        }\n                    );\n                    break;\n\n            }\n\n        };\n\n        if(quizhelper.use_ttrecorder()) {\n            var opts = {};\n            opts.uniqueid = itemdata.uniqueid;\n            opts.callback = theCallback;\n            ttrecorder.clone().init(opts);\n        }else{\n            //init cloudpoodll push recorder\n            cloudpoodll.init('poodlltime-recorder-listenrepeat-' + itemdata.id, theCallback);\n        }\n\n        self.itemdata = itemdata;\n        self.quizhelper = quizhelper;\n        self.index = index;\n        self.register_events();\n        self.setvoice();\n        self.getItems();\n    },\n\n    next_question:function(percent){\n      var self=this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems=self.items.length;\n      stepdata.correctitems=self.items.filter(function(e) {return e.correct;}).length;\n      stepdata.grade = Math.round((stepdata.totalitems/stepdata.correctitems)*100);\n      self.quizhelper.do_next(stepdata);\n    },\n    register_events: function() {\n\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .poodlltime_nextbutton\").on('click', function(e) {\n        self.next_question();\n      });\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").on(\"click\", function() {\n        self.start();\n      });\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_btn\").on(\"click\", function() {\n        self.items[self.game.pointer].audio.load();\n        self.items[self.game.pointer].audio.play();\n      });\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_skip_btn\").on(\"click\", function() {\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speech.landr_teacher_left\").text(self.items[self.game.pointer].target + \"\");\n        setTimeout(function() {\n          if (self.game.pointer < self.items.length - 1) {\n            self.items[self.game.pointer].answered = true;\n            self.items[self.game.pointer].correct = false;\n            self.game.pointer++;\n            self.nextPrompt();\n          } else {\n            self.end();\n          }\n        }, 3000);\n      });\n      \n    },\n    spliton: new RegExp('([,.!?:;\" ])', 'g'),\n    game: {\n      pointer: 0\n    },\n    usevoice: '',\n    setvoice: function() {\n      var self = this;\n      var language = \"English(US)\";\n      var mf = \"Female\";\n      var voice;\n      switch (language) {\n        case \"English(US)\":\n          voice = mf === 'Male' ? 'Joey' : 'Kendra';\n          break;\n        case \"English(GB)\":\n          voice = mf === 'Male' ? 'Brian' : 'Amy';\n          break;\n        case \"English(AU)\":\n          voice = mf === 'Male' ? 'Russell' : 'Nicole';\n          break;\n        case \"English(IN)\":\n          voice = mf === 'Male' ? 'Aditi' : 'Raveena';\n          break;\n        case \"English(Welsh)\":\n          voice = mf === 'Male' ? 'Geraint' : 'Geraint';\n          break;\n        case \"Danish\":\n          voice = mf === 'Male' ? 'Mads' : 'Naja';\n          break;\n        case \"Dutch\":\n          voice = mf === 'Male' ? 'Ruben' : 'Lotte';\n          break;\n        case \"French(FR)\":\n          voice = mf === 'Male' ? 'Mathieu' : 'Celine';\n          break;\n        case \"French(CA)\":\n          voice = mf === 'Male' ? 'Chantal' : 'Chantal';\n          break;\n        case \"German\":\n          voice = mf === 'Male' ? 'Hans' : 'Marlene';\n          break;\n        case \"Icelandic\":\n          voice = mf === 'Male' ? 'Karl' : 'Dora';\n          break;\n        case \"Italian\":\n          voice = mf === 'Male' ? 'Carla' : 'Giorgio';\n          break;\n        case \"Japanese\":\n          voice = mf === 'Male' ? 'Takumi' : 'Mizuki';\n          break;\n        case \"Korean\":\n          voice = mf === 'Male' ? 'Seoyan' : 'Seoyan';\n          break;\n        case \"Norwegian\":\n          voice = mf === 'Male' ? 'Liv' : 'Liv';\n          break;\n        case \"Polish\":\n          voice = mf === 'Male' ? 'Jacek' : 'Ewa';\n          break;\n        case \"Portugese(BR)\":\n          voice = mf === 'Male' ? 'Ricardo' : 'Vitoria';\n          break;\n        case \"Portugese(PT)\":\n          voice = mf === 'Male' ? 'Cristiano' : 'Ines';\n          break;\n        case \"Romanian\":\n          voice = mf === 'Male' ? 'Carmen' : 'Carmen';\n          break;\n        case \"Russian\":\n          voice = mf === 'Male' ? 'Maxim' : 'Tatyana';\n          break;\n        case \"Spanish(ES)\":\n          voice = mf === 'Male' ? 'Enrique' : 'Conchita';\n          break;\n        case \"Spanish(US)\":\n          voice = mf === 'Male' ? 'Miguel' : 'Penelope';\n          break;\n        case \"Swedish\":\n          voice = mf === 'Male' ? 'Astrid' : 'Astrid';\n          break;\n        case \"Turkish\":\n          voice = mf === 'Male' ? 'Filiz' : 'Filiz';\n          break;\n        case \"Welsh\":\n          voice = mf === 'Male' ? 'Gwyneth' : 'Gwyneth';\n          break;\n        default:\n          voice = mf === 'Male' ? 'Brian' : 'Amy';\n      }\n      self.usevoice = voice;\n    },\n    getItems: function() {\n      var self = this;\n\n      var text_items = self.itemdata.customtext1.split(\"\\n\");\n\n      self.items = text_items.map(function(target) {\n        return {\n          landr_targetWords: target.trim().split(self.spliton).filter(function(e) {\n            return e !== \"\";\n          }),\n          target: target,\n          typed: \"\",\n          answered: false,\n          correct: false,\n          audio: null\n        };\n      }).filter(function(e) {\n        return e.target !== \"\";\n      });\n\n      $.each(self.items, function(index, item) {\n        polly.fetch_polly_url(item.target, 'text', self.usevoice).then(function(audiourl) {\n          item.audio = new Audio();\n          item.audio.src = audiourl;\n          if (self.items.filter(function(e) {\n              return e.audio == null\n            }).length == 0) {\n            self.appReady();\n          }\n        });\n      });\n\n    },\n    appReady: function() {\n      var self = this;\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_not_loaded\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_loaded\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").prop(\"disabled\", false);\n    },\n    gotComparison: function(comparison, typed) {\n\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_targetWord\").removeClass(\"landr_correct landr_incorrect\");\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback\").removeClass(\"fa fa-check fa-times\");\n\n      var allCorrect = comparison.filter(function(e){return !e.matched;}).length==0;\n      \n      if (allCorrect) {\n        \n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_targetWord\").addClass(\"landr_correct\");\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback\").addClass(\"fa fa-check\");\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speech.landr_teacher_left\").text(self.items[self.game.pointer].target + \"\");\n\n        self.items[self.game.pointer].answered = true;\n        self.items[self.game.pointer].correct = true;\n        self.items[self.game.pointer].typed = typed;\n\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n        if (self.game.pointer < self.items.length - 1) {\n          setTimeout(function() {\n            self.game.pointer++;\n            self.nextPrompt();\n          }, 3000);\n        } else {\n          setTimeout(function() {\n            self.end();\n          }, 3000);\n        }\n\n      } else {\n\n        comparison.forEach(function(obj) {\n          if(!obj.matched){\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_targetWord[data-idx='\" + obj.wordnumber + \"']\").addClass(\"landr_incorrect\");\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback[data-idx='\" + obj.wordnumber + \"']\").addClass(\"fa fa-times\");\n          } else {\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_targetWord[data-idx='\" + obj.wordnumber + \"']\").addClass(\"landr_correct\");\n            $(\"#\" + self.itemdata.uniqueid + \"_container .landr_feedback[data-idx='\" + obj.wordnumber + \"']\").addClass(\"fa fa-check\");\n          }\n        });\n\n        $(\"#\" + self.itemdata.uniqueid + \"_container .landr_reply_\" + self.game.pointer).effect(\"shake\", function() {\n          $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", false);\n        });\n\n      }\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_targetWord.landr_correct\").each(function() {\n        var realidx = $(this).data(\"realidx\");\n        var landr_targetWord = self.items[self.game.pointer].landr_targetWords[realidx];\n        $(this).val(landr_targetWord);\n      });\n\n    },\n    getWords: function(thetext) {\n      var self = this;\n      var checkcase = false;\n      if (checkcase == 'false') {\n        thetext = thetext.toLowerCase();\n      }\n      var chunks = thetext.split(self.spliton).filter(function(e) {\n        return e !== \"\";\n      });\n      var words = [];\n      for (var i = 0; i < chunks.length; i++) {\n        if (!chunks[i].match(self.spliton)) {\n          words.push(chunks[i]);\n        }\n      }\n      return words;\n    },\n    getComparison: function(passage, transcript, callback) {\n      var self = this;\n      \n      $(\".landr_ctrl-btn\").prop(\"disabled\", true);\n\n      ajax.call([{\n        methodname: 'mod_poodlltime_compare_passage_to_transcript',\n        args: {\n          passage: passage,\n          transcript: transcript,\n          alternatives: '',\n          language: 'en-US'\n        },\n        done: function(ajaxresult) {\n          var payloadobject = JSON.parse(ajaxresult);\n          if (payloadobject) {\n            callback(payloadobject);\n          } else {\n            callback(false);\n          }\n        },\n        fail: function(err) {\n          console.log(err);\n        }\n      }]);\n\n    },\n    end: function() {\n      var self = this;\n\n      var numCorrect = self.items.filter(function(e) {\n        return e.correct;\n      }).length;\n\n      var totalNum = self.items.length;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_results\").html(\"TOTAL<br/>\" + numCorrect + \"/\" + totalNum).show();\n      \n      $(\".poodlltime_nextbutton\").prop(\"disabled\",true);\n      setTimeout(function() {\n        \n        $(\".poodlltime_nextbutton\").prop(\"disabled\",false);\n        self.next_question();\n        \n      }, 2000);\n\n    },\n    start: function() {\n      var self = this;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", true);\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_speakbtncontainer\").show();\n\n      self.items.forEach(function(item) {\n        item.spoken = \"\";\n        item.answered = false;\n        item.correct = false;\n      });\n\n      self.game.pointer = 0;\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").show();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_start_btn\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_mainmenu\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_controls\").show();\n\n      self.nextPrompt();\n\n    },\n    nextPrompt: function() {\n\n      var showText = false;\n      var self = this;\n\n      var target = self.items[self.game.pointer].target;\n      var code = \"<div class='landr_prompt landr_prompt_\" + self.game.pointer + \"' style='display:none;'>\";\n\n      code += \"<i class='fa fa-graduation-cap landr_speech-icon-left'></i>\";\n      code += \"<div style='margin-left:90px;' class='landr_speech landr_teacher_left'>\";\n      if(!showText){\n        code += target.replace(/[^a-zA-Z0-9 ]/g, '').replace(/[a-zA-Z0-9]/g, 'â€¢');\n      } else{\n        code += target;\n      }\n      code += \"</div>\";\n      code += \"</div>\";\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").html(code);\n      $(\".landr_ctrl-btn\").prop(\"disabled\", false);\n\n      var color;\n\n      var progress = self.items.map(function(item, idx) {\n        color = \"gray\";\n        if (self.items[idx].answered && self.items[idx].correct) {\n          color = \"green\";\n        } else if (self.items[idx].answered && !self.items[idx].correct) {\n          color = \"red\";\n        }\n        return \"<i style='color:\" + color + \"' class='fa fa-circle'></i>\";\n      }).join(\" \");\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_title\").html(progress);\n      $(\".landr_prompt_\" + self.game.pointer).toggle(\"slide\", {\n        direction: 'left'\n      });\n\n      self.nextReply();\n\n    },\n    nextReply: function() {\n      var self = this;\n      var target = self.items[self.game.pointer].target;\n      var code = \"<div class='landr_reply landr_reply_\" + self.game.pointer + \"' style='display:none;'>\";\n      code += \"<i class='fa fa-user landr_speech-icon-right'></i>\";\n      var landr_targetWordsCode = \"\";\n      var idx = 1;\n      self.items[self.game.pointer].landr_targetWords.forEach(function(word, realidx) {\n        if (!word.match(self.spliton)) {\n          landr_targetWordsCode += \"<ruby><input disabled type='text' maxlength='\" + word.length + \"' size='\" + (word.length + 1) + \"' class='landr_targetWord' data-realidx='\" + realidx + \"' data-idx='\" + idx + \"'><rt><i data-idx='\" + idx + \"' class='landr_feedback'></i></rt></ruby>\";\n          idx++;\n\n        } else {\n          landr_targetWordsCode += word;\n        }\n      });\n      code += \"<div style='margin-right:90px;' class='landr_speech landr_right'>\" + landr_targetWordsCode + \"</div>\";\n      code += \"</div>\";\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_game\").append(code);\n      $(\".landr_reply_\" + self.game.pointer).toggle(\"slide\", {\n        direction: 'right'\n      });\n      $(\"#\" + self.itemdata.uniqueid + \"_container .landr_ctrl-btn\").prop(\"disabled\", false);\n      if(!self.quizhelper.mobile_user()){\n        setTimeout(function(){\n          $(\"#\" + self.itemdata.uniqueid + \"_container .landr_listen_btn\").trigger('click');\n        },1000);\n      }\n    }\n\n  };\n});"],"file":"listenrepeat.min.js"}