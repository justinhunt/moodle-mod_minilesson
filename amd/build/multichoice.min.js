define ("mod_minilesson/multichoice",["jquery","core/log","mod_minilesson/definitions","mod_minilesson/pollyhelper","mod_minilesson/animatecss"],function(a,b,c,d,e){"use strict";b.debug("MiniLesson Multichoice: initialising");return{clone:function clone(){return a.extend(!0,{},this)},init:function init(a,b,c){if(b.hasOwnProperty("audiocontent")&&!0===b.audiocontent){this.prepare_audio(b)}this.itemdata=b;this.register_events(a,b,c);var d={useanimatecss:c.useanimatecss};e.init(d)},next_question:function next_question(a){var b=this,c={};c.index=b.index;c.hasgrade=!0;c.totalitems=1;c.correctitems=0<a?1:0;c.grade=a;b.quizhelper.do_next(c)},register_events:function register_events(b,c,d){var f=this;f.index=b;f.quizhelper=d;var g=null,h=a("#"+c.uniqueid+"_player"),j=a("#"+c.uniqueid+"_container .minilesson_nextbutton"),k=a("#"+c.uniqueid+"_container .minilesson_mc_confirmchoice"),l=a("#"+c.uniqueid+"_container .minilesson_resultspanel"),m=a("#"+c.uniqueid+"_container .minilesson_resultspanel_swish"),n=a("#"+c.uniqueid+"_container .minilesson_swishstars"),o=a("#"+c.uniqueid+"_container .minilesson_swishscore");j.on("click",function(){f.next_question(0)});if(1===c.confirmchoice||"1"===c.confirmchoice){j.hide()}var p=function(){if(a("#"+c.uniqueid+"_container .minilesson_mc_response").hasClass("minilesson_mc_disabled")){return}var b=a(g).data("index");a("#"+c.uniqueid+"_container .minilesson_mc_response").addClass("minilesson_mc_disabled");a("#"+c.uniqueid+"_option"+b).addClass("minilesson_mc_selected");var h=b==c.correctanswer?1:0,p=100*h;if(d.showitemreview){a("#"+c.uniqueid+"_container .minilesson_mc_unanswered").hide();a("#"+c.uniqueid+"_container .minilesson_mc_wrong").show();a("#"+c.uniqueid+"_option"+c.correctanswer+" .minilesson_mc_wrong").hide();a("#"+c.uniqueid+"_option"+c.correctanswer+" .minilesson_mc_right").show();if(c.hasOwnProperty("audiocontent")&&!0===c.audiocontent){for(var q=0;q<c.sentences.length;q++){a("#"+c.uniqueid+"_option"+(q+1));a("#"+c.uniqueid+"_option"+(q+1)+" .minilesson_sentence").text(c.sentences[q].sentence)}}k.hide();m.data("possible","1");m.data("achieved",h);o.text(h+"/"+1);if(0<h){n.html("\u2B50")}else{n.html("\u274C")}l.show();e.do_animate(m,"zoomIn animate__faster","in");j.off("click");j.on("click",function(){f.next_question(p)});j.show()}else{a(".minilesson_nextbutton").prop("disabled",!0);setTimeout(function(){a(".minilesson_nextbutton").prop("disabled",!1);f.next_question(p)},2e3)}};a("#"+c.uniqueid+"_container .minilesson_mc_response").on("click",function(){g=this;if(0===c.confirmchoice||"0"===c.confirmchoice){p()}else{var b=a(this).data("index");a("#"+c.uniqueid+"_container .minilesson_mc_response").removeClass("minilesson_mc_selected");a("#"+c.uniqueid+"_option"+b).addClass("minilesson_mc_selected");f.showConfirmButton(c)}});a("#"+c.uniqueid+"_container .minilesson_mc_confirmchoice").on("click",function(){p()});a("#"+c.uniqueid+"_container .minilesson_mc_audioplayer").on("click",function(){if(a("#"+c.uniqueid+"_container .minilesson_mc_audioplayer").hasClass("minilesson_mc_disabled")){return}if(!f.playing){var b=this;f.playing=!0;h.attr("src",a(this).attr("data-src"));h[0].play();h[0].onended=function(){a(b).find(".minilesson_mc_playstate").removeClass("fa-spin fa-spinner").addClass("fa-play");f.playing=!1};a(b).find(".minilesson_mc_playstate").removeClass("fa-play").addClass("fa-spin fa-spinner")}else{h[0].pause();h[0].currentTime=0;a("#"+c.uniqueid+"_container .minilesson_mc_playstate").removeClass("fa-spin fa-spinner").addClass("fa-play");f.playing=!1}});a("#"+c.uniqueid+"_container").on("showElement",function(){if(0<c.timelimit){a("#"+c.uniqueid+"_container .progress-container").show();a("#"+c.uniqueid+"_container .progress-container i").show();a("#"+c.uniqueid+"_container .progress-container #progresstimer").progressTimer({height:"5px",timeLimit:c.timelimit,onFinish:function onFinish(){j.trigger("click")}})}})},showConfirmButton:function showConfirmButton(b){var c=a("#"+b.uniqueid+"_container .minilesson_mc_confirmchoice");e.do_animate(c,"zoomIn animate__faster","in")},prepare_audio:function prepare_audio(b){a.each(b.sentences,function(c,e){d.fetch_polly_url(e.sentence,b.voiceoption,b.usevoice).then(function(d){a("#"+b.uniqueid+"_audioplayer"+(c+1)).attr("data-src",d)})})}}});
//# sourceMappingURL=multichoice.min.js.map
