define(["jquery","core/log","core/notification","core/str"],(function($,log,notification,str){return log.debug("MiniLesson mediaprompts: initialising"),{controls:{},strings:{},init:function(opts){var that=this;this.init_strings(),this.init_controls(),this.register_events(),$.each(opts,(function(key,value){(log.debug("key: "+key+" value: "+value),1===value)&&($("#ml_mediaprompt_panel_"+key).show(),that.controls.select.find('option[value="'+key+'"]').prop("disabled",!0))})),that.controls.select.find('option[value="0"]').prop("disabled",!0),that.controls.select.prop("selectedIndex",0)},init_strings:function(){var that=this;str.get_strings([{key:"reallydeletemediaprompt",component:"mod_minilesson"},{key:"deletemediaprompt",component:"mod_minilesson"},{key:"delete",component:"core"},{key:"deletefilesfirst",component:"mod_minilesson"},{key:"cleartextfirst",component:"mod_minilesson"}]).done((function(s){var i=0;that.strings.reallydeletemediaprompt=s[i++],that.strings.deletemediaprompt=s[i++],that.strings.delete=s[i++],that.strings.deletefilesfirst=s[i++],that.strings.cleartextfirst=s[i++]}))},init_controls:function(){this.controls.select=$("#id_mediaprompts"),this.controls.selectcontainer=$("#fitem_id_mediaprompts")},register_events:function(){var that=this;log.debug("register events"),this.controls.select.on("change",(function(){log.debug("changed");var mediaprompt=$(this).val(),thefieldset=$("#ml_mediaprompt_panel_"+mediaprompt);"addtextarea"!==mediaprompt&&thefieldset.insertAfter(that.controls.selectcontainer),thefieldset.fadeIn(500),that.controls.select.find('option[value="'+mediaprompt+'"]').prop("disabled",!0),that.controls.select.prop("selectedIndex",0)})),$(".ml_mediaprompt_panel button.close").on("click",(function(){var thefieldset=$(this).closest("fieldset"),keyfieldname=thefieldset.data("keyfield");thefieldset.data("mediaprompt");switch(keyfieldname){case"itemttsdialog":case"itemttspassage":case"itemtts":var keyfield=thefieldset.find("textarea[name='"+keyfieldname+"']");break;default:keyfield=thefieldset.find("input[name='"+keyfieldname+"']")}var legend=thefieldset.find("legend:first").text(),dodelete=function(){keyfield&&keyfield.val(""),thefieldset.hide();var mediaprompt=thefieldset.data("mediaprompt");that.controls.select.find('option[value="'+mediaprompt+'"]').prop("disabled",!1)};switch(keyfieldname){case"itemmedia":notification.confirm(that.strings.deletemediaprompt,that.strings.deletefilesfirst+" "+that.strings.reallydeletemediaprompt+legend+"?",that.strings.delete,"",dodelete);break;case"itemtextarea":notification.confirm(that.strings.deletemediaprompt,that.strings.cleartextfirst+" "+that.strings.reallydeletemediaprompt+legend+"?",that.strings.delete,"",dodelete);break;default:keyfield.length>0&&""!=keyfield.val()?notification.confirm(that.strings.deletemediaprompt,that.strings.reallydeletemediaprompt+legend+"?",that.strings.delete,"",dodelete):dodelete()}}))}}}));

//# sourceMappingURL=mediaprompts.min.js.map