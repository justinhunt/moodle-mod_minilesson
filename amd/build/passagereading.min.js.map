{"version":3,"sources":["../src/passagereading.js"],"names":["define","$","log","def","ttrecorder","notification","str","templates","debug","allwords","strings","totals","correct","incorrect","unreached","read","accuracy","score","comparison","clone","extend","init","index","itemdata","quizhelper","init_strings","init_components","register_events","self","get_strings","done","s","i","reattempt","reallyreattempt","next_question","stepdata","hasgrade","totalitems","correctitems","percent","length","Math","round","totalmarks","grade","resultsdata","do_next","nextbutton","on","e","preventDefault","reattemptbutton","confirm","resultscontainer","hide","reattemptcontainer","recordercontainer","show","removeClass","allspaces","uniqueid","timelimit","progressTimer","height","timeLimit","onFinish","trigger","find","opts","callback","theCallback","message","type","speechtext","capturedspeech","spoken_clean","cleanText","getComparison","passagetext","gotComparison","stt_guided","is_stt_guided","ttrec","passage","transcript","phonetic","thebutton","prop","comparePassageToTranscript","language","alternates","then","ajaxresult","payloadobject","JSON","parse","containerid","doComparisonMarkup","correctwords","incorrectwords","unreachedwords","showitemreview","render","html","allCorrect","filter","matched","addClass","lastmatched","forEach","obj","theword","wordnumber","thespace","nextword","hasClass"],"mappings":"AAAAA,OAAM,iCAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,4BAAvB,CACH,2BADG,CACyB,mBADzB,CAC6C,UAD7C,CACyD,gBADzD,CAAD,CAEF,SAASC,CAAT,CAAYC,CAAZ,CAAiBC,CAAjB,CAAsBC,CAAtB,CAAkCC,CAAlC,CAAgDC,CAAhD,CAAqDC,CAArD,CAAgE,CAClE,aAMAL,CAAG,CAACM,KAAJ,CAAU,0CAAV,EA8QA,MA5QS,CAEPC,QAAQ,CAAE,EAFH,CAGPC,OAAO,CAAE,EAHF,CAIPC,MAAM,CAAE,CAACC,OAAO,CAAE,CAAV,CAAYC,SAAS,CAAE,CAAvB,CAAyBC,SAAS,CAAE,CAApC,CAAsCC,IAAI,CAAE,CAA5C,CAA8CC,QAAQ,CAAE,CAAxD,CAA0DC,KAAK,CAAE,CAAjE,CAAmEC,UAAU,CAAE,EAA/E,CAJD,CAOLC,KAAK,CAAE,gBAAY,CACf,MAAOlB,CAAAA,CAAC,CAACmB,MAAF,IAAe,EAAf,CAAmB,IAAnB,CACX,CATK,CAWPC,IAAI,CAAE,cAASC,CAAT,CAAgBC,CAAhB,CAA0BC,CAA1B,CAAsC,CAC1C,KAAKF,KAAL,CAAaA,CAAb,CACA,KAAKC,QAAL,CAAgBA,CAAhB,CACA,KAAKC,UAAL,CAAkBA,CAAlB,CACA,KAAKC,YAAL,GACA,KAAKC,eAAL,CAAqBF,CAArB,CAAgCD,CAAhC,EACA,KAAKI,eAAL,CAAqBL,CAArB,CAA4BC,CAA5B,CAAsCC,CAAtC,CAED,CAnBM,CAqBPC,YAAY,CAAE,uBAAU,CACtB,GAAIG,CAAAA,CAAI,CAAG,IAAX,CACAtB,CAAG,CAACuB,WAAJ,CAAgB,CACZ,CAAE,IAAO,WAAT,CAAsB,UAAa,gBAAnC,CADY,CAEZ,CAAE,IAAO,iBAAT,CAA4B,UAAa,gBAAzC,CAFY,CAAhB,EAGGC,IAHH,CAGQ,SAAUC,CAAV,CAAa,CACjB,GAAIC,CAAAA,CAAC,CAAG,CAAR,CACAJ,CAAI,CAAClB,OAAL,CAAauB,SAAb,CAAyBF,CAAC,CAACC,CAAC,EAAF,CAA1B,CACAJ,CAAI,CAAClB,OAAL,CAAawB,eAAb,CAA+BH,CAAC,CAACC,CAAC,EAAF,CACnC,CAPD,CAQH,CA/BQ,CAiCPG,aAAa,CAAE,wBAAW,IACpBP,CAAAA,CAAI,CAAG,IADa,CAEpBQ,CAAQ,CAAG,EAFS,CAGxBA,CAAQ,CAACd,KAAT,CAAiBM,CAAI,CAACN,KAAtB,CACAc,CAAQ,CAACC,QAAT,IACAD,CAAQ,CAACE,UAAT,CAAsB,CAAtB,CACAF,CAAQ,CAACG,YAAT,CAAwB,CAAxB,CACA,GAAIC,CAAAA,CAAO,CAAG,CAAd,CACA,GAAyB,CAAtB,CAAAZ,CAAI,CAACnB,QAAL,CAAcgC,MAAjB,CAA4B,CAC1BD,CAAO,CAAGE,IAAI,CAACC,KAAL,CAAyD,GAA9C,EAACf,CAAI,CAACjB,MAAL,CAAYC,OAAZ,CAAqBgB,CAAI,CAACnB,QAAL,CAAcgC,MAApC,CAAX,CAAV,CAEA,GAA8B,CAA3B,CAAAb,CAAI,CAACL,QAAL,CAAcqB,UAAjB,CAAgC,CAC9BR,CAAQ,CAACE,UAAT,CAAsBV,CAAI,CAACL,QAAL,CAAcqB,UAApC,CACAR,CAAQ,CAACG,YAAT,CAAwBG,IAAI,CAACC,KAAL,CAAYf,CAAI,CAACjB,MAAL,CAAYC,OAAZ,CAAqBgB,CAAI,CAACnB,QAAL,CAAcgC,MAApC,CAA8Cb,CAAI,CAACL,QAAL,CAAcqB,UAAvE,CACzB,CAHD,IAGK,CACHR,CAAQ,CAACE,UAAT,CAAsBV,CAAI,CAACnB,QAAL,CAAcgC,MAApC,CACAL,CAAQ,CAACG,YAAT,CAAwBX,CAAI,CAACjB,MAAL,CAAYC,OACrC,CACF,CAEDwB,CAAQ,CAACS,KAAT,CAAiBL,CAAjB,CACAJ,CAAQ,CAACU,WAAT,CAAuBlB,CAAI,CAACjB,MAA5B,CACA,KAAKa,UAAL,CAAgBuB,OAAhB,CAAwBX,CAAxB,CACD,CAxDM,CA0DPT,eAAe,CAAE,yBAASL,CAAT,CAAgBC,CAAhB,CAAsC,CACrD,GAAIK,CAAAA,CAAI,CAAG,IAAX,CAEAA,CAAI,CAACoB,UAAL,CAAgBC,EAAhB,CAAmB,OAAnB,CAA4B,SAASC,CAAT,CAAY,CACtCA,CAAC,CAACC,cAAF,GACAvB,CAAI,CAACO,aAAL,EACD,CAHD,EAKAP,CAAI,CAACwB,eAAL,CAAqBH,EAArB,CAAwB,OAAxB,CAAiC,SAASC,CAAT,CAAY,CAC3CA,CAAC,CAACC,cAAF,GACA9C,CAAY,CAACgD,OAAb,CAAqBzB,CAAI,CAAClB,OAAL,CAAauB,SAAlC,CACoBL,CAAI,CAAClB,OAAL,CAAawB,eADjC,CAEoBN,CAAI,CAAClB,OAAL,CAAauB,SAFjC,CAE2C,EAF3C,CAGoB,UAAU,CACNL,CAAI,CAAC0B,gBAAL,CAAsBC,IAAtB,GACA3B,CAAI,CAAC4B,kBAAL,CAAwBD,IAAxB,GACA3B,CAAI,CAAC6B,iBAAL,CAAuBC,IAAvB,GAEA9B,CAAI,CAACnB,QAAL,CAAckD,WAAd,CAA0B,sCAA1B,EACA/B,CAAI,CAACgC,SAAL,CAAeD,WAAf,CAA2B,sCAA3B,CACH,CAVrB,CAWD,CAbD,EAiBA1D,CAAC,CAAC,IAAMsB,CAAQ,CAACsC,QAAf,CAA0B,YAA3B,CAAD,CAA0CZ,EAA1C,CAA6C,aAA7C,CAA4D,UAAM,CAChE,GAAyB,CAArB,CAAA1B,CAAQ,CAACuC,SAAb,CAA4B,CACxB7D,CAAC,CAAC,IAAMsB,CAAQ,CAACsC,QAAf,CAA0B,gCAA3B,CAAD,CAA8DH,IAA9D,GACAzD,CAAC,CAAC,IAAMsB,CAAQ,CAACsC,QAAf,CAA0B,kCAA3B,CAAD,CAAgEH,IAAhE,GACAzD,CAAC,CAAC,IAAMsB,CAAQ,CAACsC,QAAf,CAA0B,+CAA3B,CAAD,CAA6EE,aAA7E,CAA2F,CACvFC,MAAM,CAAE,KAD+E,CAEvFC,SAAS,CAAE1C,CAAQ,CAACuC,SAFmE,CAGvFI,QAAQ,CAAE,mBAAW,CACjBtC,CAAI,CAACoB,UAAL,CAAgBmB,OAAhB,CAAwB,OAAxB,CACH,CALsF,CAA3F,CAOH,CACF,CAZD,CAcD,CAjGM,CAmGPzC,eAAe,CAAE,yBAASF,CAAT,CAAoBD,CAApB,CAA6B,CACxC,GAAIK,CAAAA,CAAI,CAAC,IAAT,CACAA,CAAI,CAACnB,QAAL,CAAgBR,CAAC,CAAC,IAAM2B,CAAI,CAACL,QAAL,CAAcsC,QAApB,CAA+B,4CAAhC,CAAjB,CACAjC,CAAI,CAACgC,SAAL,CAAiB3D,CAAC,CAAC,IAAM2B,CAAI,CAACL,QAAL,CAAcsC,QAApB,CAA+B,6CAAhC,CAAlB,CACAjC,CAAI,CAAC6B,iBAAL,CAAyBxD,CAAC,CAAC,IAAM2B,CAAI,CAACL,QAAL,CAAcsC,QAApB,CAA+B,iDAAhC,CAA1B,CACAjC,CAAI,CAAC4B,kBAAL,CAA0BvD,CAAC,CAAC,IAAM2B,CAAI,CAACL,QAAL,CAAcsC,QAApB,CAA+B,kDAAhC,CAA3B,CACAjC,CAAI,CAAC0B,gBAAL,CAAwBrD,CAAC,CAAC,IAAM2B,CAAI,CAACL,QAAL,CAAcsC,QAApB,CAA+B,gDAAhC,CAAzB,CACAjC,CAAI,CAACwB,eAAL,CAAwBxB,CAAI,CAAC4B,kBAAL,CAAwBY,IAAxB,CAA6B,qBAA7B,CAAxB,CACAxC,CAAI,CAACoB,UAAL,CAAkB/C,CAAC,CAAC,IAAMsB,CAAQ,CAACsC,QAAf,CAA0B,mCAA3B,CAAnB,CARwC,GAqCpCQ,CAAAA,CAAI,CAAG,EArC6B,CAsCxCA,CAAI,CAACR,QAAL,CAAgBtC,CAAQ,CAACsC,QAAzB,CACAQ,CAAI,CAACC,QAAL,CA7BkB,QAAdC,CAAAA,WAAc,CAASC,CAAT,CAAkB,CAElC,OAAQA,CAAO,CAACC,IAAhB,EACE,IAAK,WAAL,CAEE,MAEF,IAAK,QAAL,IACMC,CAAAA,CAAU,CAAGF,CAAO,CAACG,cAD3B,CAEMC,CAAY,CAAIpD,CAAU,CAACqD,SAAX,CAAqBH,CAArB,CAFtB,CAIExE,CAAG,CAACM,KAAJ,CAAU,aAAV,CAAwBkE,CAAxB,EACAxE,CAAG,CAACM,KAAJ,CAAU,SAAV,CAAoBoE,CAApB,EACAhD,CAAI,CAACkD,aAAL,CACElD,CAAI,CAACL,QAAL,CAAcwD,WADhB,CAEEH,CAFF,CAHe,EAGf,CAIE,SAAS1D,CAAT,CAAqB,CACjBU,CAAI,CAACoD,aAAL,CAAmB9D,CAAnB,CAA+BsD,CAA/B,CACH,CANH,EAXJ,CAsBD,CAKD,CACAH,CAAI,CAACY,UAAL,CAAgBzD,CAAU,CAAC0D,aAAX,EAAhB,CACAtD,CAAI,CAACuD,KAAL,CAAa/E,CAAU,CAACe,KAAX,EAAb,CACAS,CAAI,CAACuD,KAAL,CAAW9D,IAAX,CAAgBgD,CAAhB,CAKL,CAlJM,CAoJPS,aAAa,CAAE,uBAASM,CAAT,CAAkBC,CAAlB,CAA8BC,CAA9B,CAAwChB,CAAxC,CAAkD,CAC/D,GAAI1C,CAAAA,CAAI,CAAG,IAAX,CAGA3B,CAAC,CAAC,IAAM2B,CAAI,CAAC2D,SAAZ,CAAD,CAAyBC,IAAzB,CAA8B,UAA9B,KAEA5D,CAAI,CAACJ,UAAL,CAAgBiE,0BAAhB,CAA2CL,CAA3C,CAAmDC,CAAnD,CAA8DC,CAA9D,CAAuE1D,CAAI,CAACL,QAAL,CAAcmE,QAArF,CAA+F9D,CAAI,CAACL,QAAL,CAAcoE,UAA7G,EAAyHC,IAAzH,CAA8H,SAASC,CAAT,CAAqB,CAC7I,GAAIC,CAAAA,CAAa,CAAGC,IAAI,CAACC,KAAL,CAAWH,CAAX,CAApB,CACA,GAAIC,CAAJ,CAAmB,CACfxB,CAAQ,CAACwB,CAAD,CACX,CAFD,IAEO,CACHxB,CAAQ,IACX,CACL,CAPF,CASD,CAnKM,CAqKPU,aAAa,CAAE,uBAAS9D,CAAT,CAA4B,CACzC,GAAIU,CAAAA,CAAI,CAAG,IAAX,CACA1B,CAAG,CAACM,KAAJ,CAAU,eAAV,EACA,GAAIyF,CAAAA,CAAW,CAAGrE,CAAI,CAACL,QAAL,CAAcsC,QAAd,CAAyB,YAA3C,CACAjC,CAAI,CAACsE,kBAAL,CAAwBhF,CAAxB,CAAoC+E,CAApC,EAJyC,GAOrCE,CAAAA,CAAY,CAAGlG,CAAC,CAAC,IAAMgG,CAAN,CAAoB,6CAArB,CAPqB,CAQrCG,CAAc,CAAGnG,CAAC,CAAC,IAAMgG,CAAN,CAAoB,+CAArB,CARmB,CASrCI,CAAc,CAAGpG,CAAC,CAAC,IAAMgG,CAAN,CAAoB,+CAArB,CATmB,CAUzCrE,CAAI,CAACjB,MAAL,CAAYC,OAAZ,CAAsBuF,CAAY,CAAC1D,MAAnC,CACAb,CAAI,CAACjB,MAAL,CAAYE,SAAZ,CAAwBuF,CAAc,CAAC3D,MAAvC,CACAb,CAAI,CAACjB,MAAL,CAAYG,SAAZ,CAAwBuF,CAAc,CAAC5D,MAAvC,CACAb,CAAI,CAACjB,MAAL,CAAYI,IAAZ,CAAmBqF,CAAc,CAAC3D,MAAf,CAAwB0D,CAAY,CAAC1D,MAAxD,CACAb,CAAI,CAACjB,MAAL,CAAYK,QAAZ,CAAuB0B,IAAI,CAACC,KAAL,CAAsD,GAA3C,EAACf,CAAI,CAACjB,MAAL,CAAYC,OAAZ,CAAsBgB,CAAI,CAACjB,MAAL,CAAYI,IAAnC,CAAX,CAAvB,CACAa,CAAI,CAACjB,MAAL,CAAYM,KAAZ,CAAoByB,IAAI,CAACC,KAAL,CAAyD,GAA9C,EAACf,CAAI,CAACjB,MAAL,CAAYC,OAAZ,CAAqBgB,CAAI,CAACnB,QAAL,CAAcgC,MAApC,CAAX,CAApB,CACAb,CAAI,CAACjB,MAAL,CAAYO,UAAZ,CAAyBA,CAAzB,CACAhB,CAAG,CAACM,KAAJ,EAAW,gBAAiBoB,CAAI,CAACjB,MAAL,CAAYC,OAAxC,GACAV,CAAG,CAACM,KAAJ,EAAW,WAAYoB,CAAI,CAACnB,QAAL,CAAcgC,MAArC,GAGA,GAAG,CAACb,CAAI,CAACJ,UAAL,CAAgB8E,cAApB,CAAmC,CAEjC1E,CAAI,CAACnB,QAAL,CAAckD,WAAd,CAA0B,sCAA1B,EACA/B,CAAI,CAACgC,SAAL,CAAeD,WAAf,CAA2B,sCAA3B,EACA/B,CAAI,CAACO,aAAL,EACD,CALD,IAKK,CAGH5B,CAAS,CAACgG,MAAV,CAAiB,sCAAjB,CAAwD3E,CAAI,CAACjB,MAA7D,EAAqEiF,IAArE,CACE,SAASY,CAAT,CAAiB,CACb5E,CAAI,CAAC6B,iBAAL,CAAuBF,IAAvB,GACA3B,CAAI,CAAC0B,gBAAL,CAAsBkD,IAAtB,CAA2BA,CAA3B,EACA5E,CAAI,CAAC0B,gBAAL,CAAsBI,IAAtB,GACA9B,CAAI,CAAC4B,kBAAL,CAAwBE,IAAxB,EACH,CANH,CAQD,CACF,CA3MM,CA6MTwC,kBAAkB,CAAE,4BAAShF,CAAT,CAAqB+E,CAArB,CAAiC,IAC7CxF,CAAAA,CAAQ,CAAGR,CAAC,CAAC,IAAMgG,CAAN,CAAoB,kCAArB,CADiC,CAE7CrC,CAAS,CAAG3D,CAAC,CAAC,IAAM,EAAEgG,CAAR,CAAsB,oCAAvB,CAFgC,CAKjDxF,CAAQ,CAACkD,WAAT,CAAqB,sCAArB,EACAC,CAAS,CAACD,WAAV,CAAsB,sCAAtB,EAGA,GAAI8C,CAAAA,CAAU,CAA8D,CAA3D,EAAAvF,CAAU,CAACwF,MAAX,CAAkB,SAASxD,CAAT,CAAW,CAAC,MAAO,CAACA,CAAC,CAACyD,OAAS,CAAjD,EAAmDlE,MAApE,CAGA,GAAIgE,CAAU,EAAIvF,CAAd,EAAgD,CAApB,CAAAA,CAAU,CAACuB,MAA3C,CAAuD,CAEnDvC,CAAG,CAACM,KAAJ,CAAU,4BAAV,EACAC,CAAQ,CAACmG,QAAT,CAAkB,YAAlB,EACAhD,CAAS,CAACgD,QAAV,CAAmB,YAAnB,CAEH,CAND,IAMO,CACH1G,CAAG,CAACM,KAAJ,CAAU,gCAAV,EACA,GAAIqG,CAAAA,CAAW,CAAG,CAAlB,CACA3F,CAAU,CAAC4F,OAAX,CAAmB,SAASC,CAAT,CAAc,IACzBC,CAAAA,CAAO,CAAG/G,CAAC,CAAC,IAAMgG,CAAN,CAAoB,qDAApB,CAA4Ec,CAAG,CAACE,UAAhF,CAA6F,IAA9F,CADc,CAEzBC,CAAQ,CAAGjH,CAAC,CAAC,IAAMgG,CAAN,CAAoB,sDAApB,CAA6Ec,CAAG,CAACE,UAAjF,CAA8F,IAA/F,CAFa,CAI7B,GAAG,CAACF,CAAG,CAACJ,OAAR,CAAgB,CACZK,CAAO,CAACJ,QAAR,CAAiB,cAAjB,EACAM,CAAQ,CAACN,QAAT,CAAkB,cAAlB,CACH,CAHD,IAGO,CACHI,CAAO,CAACJ,QAAR,CAAiB,YAAjB,EACAM,CAAQ,CAACN,QAAT,CAAkB,YAAlB,EACA,GAAGC,CAAW,CAAGE,CAAG,CAACE,UAArB,CAAgC,CAC5BJ,CAAW,CAAGE,CAAG,CAACE,UACrB,CACJ,CACJ,CAdD,EAiBA/F,CAAU,CAAC4F,OAAX,CAAmB,SAASC,CAAT,CAAc,IACzBC,CAAAA,CAAO,CAAG/G,CAAC,CAAC,IAAMgG,CAAN,CAAoB,qDAApB,CAA4Ec,CAAG,CAACE,UAAhF,CAA6F,IAA9F,CADc,CAEzBC,CAAQ,CAAGjH,CAAC,CAAC,IAAMgG,CAAN,CAAoB,sDAApB,CAA6Ec,CAAG,CAACE,UAAjF,CAA8F,IAA/F,CAFa,CAGzBE,CAAQ,CAAGlH,CAAC,CAAC,IAAMgG,CAAN,CAAoB,qDAApB,EAA6Ec,CAAG,CAACE,UAAJ,CAAiB,CAA9F,EAAmG,IAApG,CAHa,CAK7B,GAAGJ,CAAW,CAAGE,CAAG,CAACE,UAAlB,EAAgCD,CAAO,CAACI,QAAR,CAAiB,cAAjB,CAAnC,CAAoE,CAChEJ,CAAO,CAACJ,QAAR,CAAiB,cAAjB,EACAM,CAAQ,CAACN,QAAT,CAAkB,cAAlB,EACAI,CAAO,CAACrD,WAAR,CAAoB,cAApB,EACAuD,CAAQ,CAACvD,WAAT,CAAqB,cAArB,CACH,CAED,GAAmB,CAAhB,CAAAwD,CAAQ,CAAC1E,MAAZ,CAAqB,CACjB,GAAGuE,CAAO,CAACI,QAAR,CAAiB,cAAjB,GAAoCD,CAAQ,CAACC,QAAT,CAAkB,YAAlB,CAAvC,CAAuE,CACnEF,CAAQ,CAACvD,WAAT,CAAqB,cAArB,CACH,CAFD,IAEM,IAAGqD,CAAO,CAACI,QAAR,CAAiB,YAAjB,GAAkCD,CAAQ,CAACC,QAAT,CAAkB,cAAlB,CAArC,CAAuE,CACzEF,CAAQ,CAACvD,WAAT,CAAqB,YAArB,CACH,CACJ,CACJ,CAnBD,CAoBH,CAEJ,CAzQQ,CA6QV,CAxRK,CAAN","sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions',\n    'mod_minilesson/ttrecorder','core/notification','core/str', 'core/templates'],\n    function($, log, def, ttrecorder, notification, str, templates) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the Passage Reading item type\n   */\n\n  log.debug('MiniLesson Passage Reading: initialising');\n\n  var app= {\n\n    allwords: {},\n    strings: {},\n    totals: {correct: 0,incorrect: 0,unreached: 0,read: 0,accuracy: 0,score: 0,comparison: {}},\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      this.index = index;\n      this.itemdata = itemdata;\n      this.quizhelper = quizhelper;\n      this.init_strings();\n      this.init_components(quizhelper,itemdata);\n      this.register_events(index, itemdata, quizhelper);\n\n    },\n\n    init_strings: function(){\n      var self = this;\n      str.get_strings([\n          { \"key\": \"reattempt\", \"component\": 'mod_minilesson'},\n          { \"key\": \"reallyreattempt\", \"component\": 'mod_minilesson'},\n      ]).done(function (s) {\n          var i = 0;\n          self.strings.reattempt = s[i++];\n          self.strings.reallyreattempt = s[i++];\n      });\n  },\n\n    next_question: function() {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 0;\n      stepdata.correctitems = 0;\n      var percent = 0;\n      if(self.allwords.length> 0) {\n        percent = Math.round((self.totals.correct /self.allwords.length) * 100 );\n        //If total marks is set, we use percent to calc correct items / total items\n        if(self.itemdata.totalmarks > 0){\n          stepdata.totalitems = self.itemdata.totalmarks;\n          stepdata.correctitems = Math.round((self.totals.correct /self.allwords.length) * self.itemdata.totalmarks);\n        }else{\n          stepdata.totalitems = self.allwords.length;\n          stepdata.correctitems = self.totals.correct;\n        }\n      }\n\n      stepdata.grade = percent;\n      stepdata.resultsdata = self.totals;\n      this.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n      var self = this;\n\n      self.nextbutton.on('click', function(e) {\n        e.preventDefault();\n        self.next_question();\n      });\n\n      self.reattemptbutton.on('click', function(e) {\n        e.preventDefault();\n        notification.confirm(self.strings.reattempt,\n                            self.strings.reallyreattempt,\n                            self.strings.reattempt,'',\n                            function(){\n                                self.resultscontainer.hide();\n                                self.reattemptcontainer.hide();\n                                self.recordercontainer.show();\n                                 //Reset all words css\n                                self.allwords.removeClass(\"pr_correct pr_incorrect pr_unreached\");\n                                self.allspaces.removeClass(\"pr_correct pr_incorrect pr_unreached\");\n                            });\n      });\n\n\n\n      $(\"#\" + itemdata.uniqueid + \"_container\").on('showElement', () => {\n        if (itemdata.timelimit > 0) {\n            $(\"#\" + itemdata.uniqueid + \"_container .progress-container\").show();\n            $(\"#\" + itemdata.uniqueid + \"_container .progress-container i\").show();\n            $(\"#\" + itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                height: '5px',\n                timeLimit: itemdata.timelimit,\n                onFinish: function() {\n                    self.nextbutton.trigger('click');\n                }\n            });\n        }\n      });\n\n    },\n\n    init_components: function(quizhelper,itemdata){\n          var self=this;\n          self.allwords = $(\"#\" + self.itemdata.uniqueid + \"_container .mod_minilesson_mu_passage_word\");\n          self.allspaces = $(\"#\" + self.itemdata.uniqueid + \"_container .mod_minilesson_mu_passage_space\");\n          self.recordercontainer = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_passagereading_speakbtncontainer\");\n          self.reattemptcontainer = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_passagereading_reattemptcontainer\");\n          self.resultscontainer = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_passagereading_resultscontainer\");\n          self.reattemptbutton =  self.reattemptcontainer.find(\".ml_reattemptbutton\");\n          self.nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n\n          var theCallback = function(message) {\n\n            switch (message.type) {\n              case 'recording':\n\n                break;\n\n              case 'speech':\n                var speechtext = message.capturedspeech;\n                var spoken_clean  = quizhelper.cleanText(speechtext);\n                var phonetic = ''; // TO DO - add phonetic option\n                log.debug('speechtext:',speechtext);\n                log.debug('spoken:',spoken_clean);\n                self.getComparison(\n                  self.itemdata.passagetext,\n                  spoken_clean,\n                  phonetic,\n                  function(comparison) {\n                      self.gotComparison(comparison, message);\n                  }\n              );\n\n\n            } //end of switch message type\n          };\n\n          //init tt recorder\n          var opts = {};\n          opts.uniqueid = itemdata.uniqueid;\n          opts.callback = theCallback;\n          opts.stt_guided=quizhelper.is_stt_guided();\n          self.ttrec = ttrecorder.clone();\n          self.ttrec.init(opts);\n          //init prompt for first card\n          //in some cases ttrecorder wants to know the target\n          //app.ttrec.currentPrompt=app.displayterms[app.pointer - 1];\n\n    }, //end of init components\n\n    getComparison: function(passage, transcript, phonetic, callback) {\n      var self = this;\n\n      //TO DO disable the TT Recorder button\n      $(\"#\" + self.thebutton ).prop(\"disabled\", true);\n\n      self.quizhelper.comparePassageToTranscript(passage,transcript,phonetic,self.itemdata.language, self.itemdata.alternates).then(function(ajaxresult) {\n            var payloadobject = JSON.parse(ajaxresult);\n            if (payloadobject) {\n                callback(payloadobject);\n            } else {\n                callback(false);\n            }\n       });\n\n    },\n\n    gotComparison: function(comparison, typed) {\n      var self = this;\n      log.debug(\"gotComparison\");\n      var containerid = self.itemdata.uniqueid + \"_container\";\n      self.doComparisonMarkup(comparison, containerid);\n\n      //update our scores\n      var correctwords = $(\"#\" + containerid + \" .mod_minilesson_mu_passage_word.pr_correct\");\n      var incorrectwords = $(\"#\" + containerid + \" .mod_minilesson_mu_passage_word.pr_incorrect\");\n      var unreachedwords = $(\"#\" + containerid + \" .mod_minilesson_mu_passage_word.pr_unreached\");\n      self.totals.correct = correctwords.length;\n      self.totals.incorrect = incorrectwords.length;\n      self.totals.unreached = unreachedwords.length;\n      self.totals.read = incorrectwords.length + correctwords.length;\n      self.totals.accuracy = Math.round((self.totals.correct / self.totals.read) * 100);\n      self.totals.score = Math.round((self.totals.correct /self.allwords.length) * 100);\n      self.totals.comparison = comparison;\n      log.debug((\"total correct\", self.totals.correct));\n      log.debug((\"allwords\", self.allwords.length));\n\n      //display results or move next if not show item review\n      if(!self.quizhelper.showitemreview){\n        //clear markup .. though it was briefly shown (so we could calculate the score)\n        self.allwords.removeClass(\"pr_correct pr_incorrect pr_unreached\");\n        self.allspaces.removeClass(\"pr_correct pr_incorrect pr_unreached\");\n        self.next_question();\n      }else{\n        //display results\n       //Hide the recorder and show the reattempt button and results\n        templates.render('mod_minilesson/passagereadingresults',self.totals).then(\n          function(html,js){\n              self.recordercontainer.hide();\n              self.resultscontainer.html(html);\n              self.resultscontainer.show();\n              self.reattemptcontainer.show();\n          }\n        );\n      }//end of show item review or transition\n    },\n\n  doComparisonMarkup: function(comparison, containerid){\n      var allwords = $(\"#\" + containerid + \" .mod_minilesson_mu_passage_word\");\n      var allspaces = $(\"#\" + + containerid + \"  .mod_minilesson_mu_passage_space\");\n\n      //Reset all words css\n      allwords.removeClass(\"pr_correct pr_incorrect pr_unreached\");\n      allspaces.removeClass(\"pr_correct pr_incorrect pr_unreached\");\n\n      //how many correct\n      var allCorrect = comparison.filter(function(e){return !e.matched;}).length==0;\n\n      //mark up the words as correct or not\n      if (allCorrect && comparison && comparison.length > 0) {\n\n          log.debug(\"gotComparison: all correct\");\n          allwords.addClass(\"pr_correct\");\n          allspaces.addClass(\"pr_correct\");\n\n      } else {\n          log.debug(\"gotComparison: not all correct\");\n          var lastmatched = 0;\n          comparison.forEach(function(obj) {\n              var theword = $(\"#\" + containerid + \"  .mod_minilesson_mu_passage_word[data-wordnumber='\" + obj.wordnumber + \"']\");\n              var thespace = $(\"#\" + containerid + \"  .mod_minilesson_mu_passage_space[data-wordnumber='\" + obj.wordnumber + \"']\");\n\n              if(!obj.matched){\n                  theword.addClass(\"pr_incorrect\");\n                  thespace.addClass(\"pr_incorrect\");\n              } else {\n                  theword.addClass(\"pr_correct\");\n                  thespace.addClass(\"pr_correct\");\n                  if(lastmatched < obj.wordnumber){\n                      lastmatched = obj.wordnumber;\n                  }\n              }\n          });\n\n          //2nd pass now we know what each word is\n          comparison.forEach(function(obj) {\n              var theword = $(\"#\" + containerid + \"  .mod_minilesson_mu_passage_word[data-wordnumber='\" + obj.wordnumber + \"']\");\n              var thespace = $(\"#\" + containerid + \"  .mod_minilesson_mu_passage_space[data-wordnumber='\" + obj.wordnumber + \"']\");\n              var nextword = $(\"#\" + containerid + \"  .mod_minilesson_mu_passage_word[data-wordnumber='\" + (obj.wordnumber + 1) + \"']\");\n              //mark incorrect as unreached if after last match\n              if(lastmatched < obj.wordnumber && theword.hasClass('pr_incorrect')){\n                  theword.addClass(\"pr_unreached\");\n                  thespace.addClass(\"pr_unreached\");\n                  theword.removeClass(\"pr_incorrect\");\n                  thespace.removeClass(\"pr_incorrect\");\n              }\n              //clear formatting on spaces in between correct/incorrect and incorrect/correct words\n              if(nextword.length>0){\n                  if(theword.hasClass('pr_incorrect') && nextword.hasClass('pr_correct')){\n                      thespace.removeClass('pr_incorrect');\n                  }else if(theword.hasClass('pr_correct') && nextword.hasClass('pr_incorrect')){\n                      thespace.removeClass('pr_correct');\n                  }\n              }\n          });\n      }\n\n  }\n\n  };//end of return objects\n  return app;\n});"],"file":"passagereading.min.js"}