define(["jquery","core/log","mod_minilesson/definitions","mod_minilesson/cloudpoodllloader","mod_minilesson/ttrecorder"],(function($,log,def,cloudpoodll,ttrecorder){return log.debug("MiniLesson Passage Reading: initialising"),{clone:function(){return $.extend(!0,{},this)},init:function(index,itemdata,quizhelper){this.itemdata=itemdata,this.quizhelper=quizhelper,this.init_components(quizhelper,itemdata),this.register_events(index,itemdata,quizhelper)},next_question:function(percent){var stepdata={};stepdata.index=self.index,stepdata.hasgrade=!0,stepdata.totalitems=1,stepdata.correctitems=percent>0?1:0,stepdata.grade=percent,this.quizhelper.do_next(stepdata)},register_events:function(index,itemdata,quizhelper){var self=this;$("#"+itemdata.uniqueid+"_container .minilesson_nextbutton").on("click",(function(e){self.next_question(0)}))},init_components:function(quizhelper,itemdata){var self=this;self.allwords=$("#"+self.itemdata.uniqueid+"_container.mod_minilesson_mu_passage_word"),self.thebutton="thettrbutton";var theCallback=function(message){switch(message.type){case"recording":break;case"speech":log.debug("speech at speechcards");var speechtext=message.capturedspeech,spoken_clean=quizhelper.cleanText(speechtext);log.debug("speechtext:",speechtext),log.debug("spoken:",spoken_clean),self.getComparison(self.itemdata.passagetext,spoken_clean,"",(function(comparison){self.gotComparison(comparison,message)}))}};if(quizhelper.use_ttrecorder()){var opts={};opts.uniqueid=itemdata.uniqueid,opts.callback=theCallback,opts.stt_guided=quizhelper.is_stt_guided(),self.ttrec=ttrecorder.clone(),self.ttrec.init(opts)}else cloudpoodll.init("minilesson-recorder-passagereading-"+itemdata.id,theCallback)},getComparison:function(passage,transcript,phonetic,callback){$("#"+this.thebutton).prop("disabled",!0),this.quizhelper.comparePassageToTranscript(passage,transcript,phonetic,this.itemdata.language).then((function(ajaxresult){var payloadobject=JSON.parse(ajaxresult);callback(payloadobject||!1)}))},gotComparison:function(comparison,typed){var self=this;log.debug("gotComparison"),self.allwords.removeClass("pr_correct pr_incorrect"),0==comparison.filter((function(e){return!e.matched})).length&&comparison&&comparison.length>0?(log.debug("gotComparison: all correct"),$("#"+self.allwords).addClass("pr_correct"),self.items[self.game.pointer].answered=!0,self.items[self.game.pointer].correct=!0,self.items[self.game.pointer].typed=typed,$("#"+self.thebutton).prop("disabled",!0),self.game.pointer<self.items.length-1?setTimeout((function(){self.game.pointer++,self.nextPrompt()}),2200):self.end()):(log.debug("gotComparison: not all correct"),comparison.forEach((function(obj){log.debug("#"+self.itemdata.uniqueid+"_container .mod_minilesson_mu_passage_word[data-wordnumber='"+obj.wordnumber+"']"),obj.matched?$("#"+self.itemdata.uniqueid+"_container .mod_minilesson_mu_passage_word[data-wordnumber='"+obj.wordnumber+"']").addClass("pr_correct"):$("#"+self.itemdata.uniqueid+"_container .mod_minilesson_mu_passage_word[data-wordnumber='"+obj.wordnumber+"']").addClass("pr_incorrect")})))}}}));

//# sourceMappingURL=passagereading.min.js.map