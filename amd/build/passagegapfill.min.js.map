{"version":3,"sources":["../src/passagegapfill.js"],"names":["define","$","log","ajax","def","polly","anim","progresstimer","templates","debug","clone","extend","hintsused","controls","gapitems","items","init","index","itemdata","quizhelper","self","animopts","useanimatecss","register_controls","register_events","getGapItems","rootelement","document","querySelector","uniqueid","audioplayer","resultsbox","finishbtn","hintbtn","nextbtn","prepare_audio","fetch_polly_url","passagedata","plaintext","voiceoption","usevoice","then","audiourl","attr","next_question","stepdata","get_stepdata","do_next","submit_grade","report_step_grade","hasgrade","totalitems","length","correctitems","filter","e","correct","grade","Math","round","penalty","max","show_item_review","review_data","render","html","js","runTemplateJS","on","preventDefault","give_hint","check_answer","addEventListener","inputelement","target","forEach","item","displaywrong","readonly","concat","map","gapitem","gapelement","parentElement","classList","remove","value","text","add","showitemreview","setAttribute","anyhintdisplayed","element","placeholder","replaceposition","slice","parseInt","hints","data","words","wordindex","isgap","appReady","start","end","prop","setTimeout","question","show","stopTimer","timer","clearInterval"],"mappings":"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","sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'mod_minilesson/definitions',\n    'mod_minilesson/pollyhelper',\n    'mod_minilesson/animatecss',\n    'mod_minilesson/progresstimer',\n    'core/templates'\n], function($, log, ajax, def, polly, anim, progresstimer, templates) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('MiniLesson passage gap fill: initialising');\n\n    return {\n\n        // For making multiple instances\n        clone: function() {\n            return $.extend(true, {hintsused: 0}, this);\n        },\n\n        controls: {},\n        gapitems: [],\n        items: [],\n        hintsused: 0,\n\n        init: function(index, itemdata, quizhelper) {\n            var self = this;\n            self.itemdata = itemdata;\n            self.quizhelper = quizhelper;\n            self.index = index;\n\n            // Animation. - we might use this to shake the incorrect text boxes or something. See how its used in speakinggapfill.js\n            var animopts = {};\n            animopts.useanimatecss = quizhelper.useanimatecss;\n            anim.init(animopts);\n\n            self.register_controls();\n           // self.prepare_audio(); .. we pass the audio url in from PHP now, so no need to prepare it here.\n            self.register_events();\n            self.getGapItems();\n        },\n\n        register_controls: function() {\n            var self = this;\n            self.controls.rootelement = document.querySelector(`#${self.itemdata.uniqueid}_container`);\n            self.controls.audioplayer =$(\"#\" + self.itemdata.uniqueid + \"_container .pgapfill_audio_player\");\n            self.controls.resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .passage_gapfill_results_actions\");\n            self.controls.finishbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_finishbutton\");\n            self.controls.hintbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_hintbutton\");\n            self.controls.nextbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n        },\n\n        prepare_audio: function() {\n            var self = this;\n            polly.fetch_polly_url(self.itemdata.passagedata.plaintext, self.itemdata.voiceoption,\n                self.itemdata.usevoice).then(function(audiourl) {\n                self.controls.audioplayer.attr(\"src\", audiourl);\n            });\n        },\n\n        next_question: function() {\n            var self = this;\n            var stepdata = self.get_stepdata();\n            self.quizhelper.do_next(stepdata);\n        },\n\n        submit_grade: function() {\n            var self = this;\n            var stepdata = self.get_stepdata();\n            self.quizhelper.report_step_grade(stepdata);\n        },\n\n        get_stepdata: function() {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = true;\n            stepdata.totalitems = self.items.length;\n            stepdata.correctitems = self.items.filter(e => e.correct).length;\n            stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n            stepdata.penalty = self.hintsused * 30;\n            stepdata.grade = Math.max(0, stepdata.grade - stepdata.penalty);\n            return stepdata;\n        },\n\n        show_item_review:function(){\n            var self=this;\n            var review_data = self.get_stepdata();\n            var resultsbox = self.controls.resultsbox;\n            review_data.items = self.items;\n\n            //display results\n            templates.render('mod_minilesson/passagegapfillresults',review_data).then(\n              function(html,js){\n                  resultsbox.html(html);\n\n                  // Run js for audio player events\n                  templates.runTemplateJS(js);\n              }\n            );// End of templates\n        },\n\n        register_events: function() {\n\n            var self = this;\n\n            self.controls.nextbtn.on('click', function() {\n                self.next_question();\n            });\n\n\n            self.controls.hintbtn.on(\"click\", function(e) {\n                e.preventDefault();\n                self.give_hint();\n            });\n\n            self.controls.finishbtn.on(\"click\", function(e) {\n                e.preventDefault();\n                self.check_answer([], true, true);\n                // Prevent submit grade when finishing.\n                // self.submit_grade();\n                self.show_item_review();\n            });\n\n            self.controls.rootelement.addEventListener('input', e => {\n                const inputelement = e.target;\n                self.items.forEach(item => {\n                    if (item.inputelement === inputelement) {\n                        self.check_answer(item, false);\n                    }\n                });\n            });\n\n\n        },\n\n\n        check_answer: function(items = null, displaywrong = true, readonly = false) {\n            var self = this;\n            items = [].concat(items);\n            if (items.length === 0) {\n                items = self.items;\n            }\n            self.items.map(gapitem => {\n                if (!gapitem.inputelement) {\n                    return;\n                }\n                const gapelement = gapitem.inputelement.parentElement;\n                gapelement.classList.remove('psg_gapfill_wrong', 'psg_gapfill_correct');\n                gapitem.correct = gapitem.inputelement.value === gapitem.text;\n                if (gapitem.correct) {\n                    gapelement.classList.add('psg_gapfill_correct');\n                } else if (displaywrong) {\n                    gapelement.classList.add('psg_gapfill_wrong');\n                }\n                if (readonly) {\n                    if (self.quizhelper.showitemreview) {\n                        gapitem.inputelement.value = gapitem.text;\n                        gapelement.classList.add('pgapfill_gap_reviewing');\n                    }\n                    gapitem.inputelement.setAttribute('readonly', 'readonly');\n                }\n                return gapitem;\n            });\n        },\n\n        give_hint: function() {\n            var self = this;\n            var anyhintdisplayed = false;\n            self.items.forEach(element => {\n                const inputelement = element.inputelement;\n                if (!inputelement) {\n                    return;\n                }\n                if (inputelement.value !== element.text) {\n                    const placeholder = inputelement.placeholder;\n                    const replaceposition = self.hintsused === 1 ? 1: element.placeholder.length - 1;\n                    inputelement.placeholder = placeholder.slice(0, replaceposition) +\n                        element.text[replaceposition] + placeholder.slice(replaceposition + 1);\n                    inputelement.setAttribute('placeholder', inputelement.placeholder);\n                    inputelement.value = '';\n                    anyhintdisplayed = true;\n                }\n                inputelement.setAttribute('data-hints', 1 + self.hintsused);\n            });\n            if (anyhintdisplayed) {\n                self.hintsused++;\n            }\n            if (self.hintsused >= parseInt(self.itemdata.hints)) {\n                self.controls.hintbtn.remove();\n            } else if (self.hintsused === 1 && self.hintsused < parseInt(self.itemdata.hints)) {\n                self.controls.hintbtn.text(self.controls.hintbtn.data('alttext'));\n            }\n        },\n\n\n\n        getGapItems: function() {\n            //TO DO implement this\n            // This function prepares the gap items from the passage data.\n           log.debug(\"getting gap items\");\n\n            var self = this;\n            var passagedata = self.itemdata.passagedata;\n\n            //We probably want something like this to track the inputboxes and assoc data so we can work with it from JS\n            //Right now it doesnt do anything special\n            //check item_passagegapfill exportfortemplate function to prepare the passagedata to use here\n            //Alternatively any data we need could also be set as attributes on divs in mustache template and picked up here.\n            self.gapitems = passagedata.words.map(target => ({\n                wordindex: target.wordindex,\n                text: target.text,\n                placeholder: target.placeholder,\n                isgap: target.isgap,\n                correct: false\n            }));\n            self.items = self.gapitems.filter(gapitem => gapitem.isgap).map(item => {\n                item.inputelement = self.controls.rootelement\n                    .querySelector(`.pgapfill_gap_input[data-wordindex=\"${item.wordindex}\"]`);\n                return item;\n            });\n        },\n\n        appReady: function() {\n            var self = this;\n            self.start();\n        },\n\n\n        end: function() {\n            var self = this;\n            $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n            //disable the buttons and go to next question or review\n            setTimeout(function() {\n                $(\".minilesson_nextbutton\").prop(\"disabled\",false);\n                if(self.quizhelper.showitemreview){\n                    self.show_item_review();\n                }else{\n                    self.next_question();\n                }\n            }, 2000);\n        },\n\n        start: function() {\n            var self = this;\n            self.controls.question.show();\n\n        },\n\n\n        stopTimer: function(timer) {\n            if (timer) {\n                    clearInterval(timer);\n            }\n        },\n\n\n    };\n});"],"file":"passagegapfill.min.js"}