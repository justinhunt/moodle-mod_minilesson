{"version":3,"file":"passagegapfill.min.js","sources":["../src/passagegapfill.js"],"sourcesContent":["define(['jquery',\n    'core/log',\n    'core/ajax',\n    'mod_minilesson/definitions',\n    'mod_minilesson/pollyhelper',\n    'mod_minilesson/animatecss',\n    'mod_minilesson/progresstimer',\n    'core/templates'\n], function($, log, ajax, def, polly, anim, progresstimer, templates) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('MiniLesson passage gap fill: initialising');\n\n    return {\n\n        // For making multiple instances\n        clone: function() {\n            return $.extend(true, {}, this);\n        },\n\n        controls: {},\n        gapitems: [],\n\n        init: function(index, itemdata, quizhelper) {\n            var self = this;\n            self.itemdata = itemdata;\n            self.quizhelper = quizhelper;\n            self.index = index;\n\n            // Animation. - we might use this to shake the incorrect text boxes or something. See how its used in speakinggapfill.js\n            var animopts = {};\n            animopts.useanimatecss = quizhelper.useanimatecss;\n            anim.init(animopts);\n\n            self.register_controls();\n           // self.prepare_audio(); .. we pass the audio url in from PHP now, so no need to prepare it here.\n            self.register_events();\n            self.getGapItems();\n        },\n\n        register_controls: function() {\n            var self = this;\n            self.controls.audioplayer =$(\"#\" + self.itemdata.uniqueid + \"_container .pgapfill_audio_player\");\n            self.controls.resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container .pgapfill_resultscontainer\");\n            self.controls.checkbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_checkbutton\");\n            self.controls.hintbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_hintbutton\");\n            self.controls.nextbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n        },\n\n        prepare_audio: function() {\n            var self = this;\n            polly.fetch_polly_url(self.itemdata.passagedata.plaintext, self.itemdata.voiceoption, self.itemdata.usevoice).then(function(audiourl) {\n                self.controls.audioplayer.attr(\"src\", audiourl);\n            });\n        },\n\n        next_question: function() {\n            var self = this;\n            var stepdata = {};\n            stepdata.index = self.index;\n            stepdata.hasgrade = true;\n            stepdata.totalitems = self.items.length;\n            stepdata.correctitems = self.items.filter(function(e) {\n                return e.correct;\n            }).length;\n            stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n            self.quizhelper.do_next(stepdata);\n        },\n\n        show_item_review:function(){\n            var self=this;\n            var review_data = {};\n            review_data.items = self.items;\n            review_data.totalitems=self.items.length;\n            review_data.correctitems=self.items.filter(function(e) {return e.correct;}).length;\n\n\n            //display results\n            templates.render('mod_minilesson/passagegapfillresults',review_data).then(\n              function(html,js){\n                  resultsbox.html(html);\n                  //show and hide\n                  resultsbox.show();\n\n\n                  // Run js for audio player events\n                  templates.runTemplateJS(js);\n              }\n            );// End of templates\n        },\n\n        register_events: function() {\n\n            var self = this;\n\n            self.controls.nextbtn.on('click', function(e) {\n                self.next_question();\n            });\n\n\n            self.controls.hintbtn.on(\"click\", function() {\n                self.give_hint();\n            });\n\n            self.controls.checkbtn.on(\"click\", function() {\n                self.check_answer();\n            });\n\n\n        },\n\n\n        check_answer: function() {\n\n        },\n\n        give_hint: function() {\n\n        },\n\n\n\n        getGapItems: function() {\n            //TO DO implement this\n            // This function prepares the gap items from the passage data.\n           log.debug(\"getting gap items\");\n\n            var self = this;\n            var passagedata = self.itemdata.passagedata;\n\n            //We probably want something like this to track the inputboxes and assoc data so we can work with it from JS - right now it doesnt do anything special\n            //check item_passagegapfill exportfortemplate function to prepare the passagedata to use here\n            //Alternatively any data we need could also be set as attributes on divs in mustache template and picked up here.\n            self.gapitems = passagedata.words.map(function(target) {\n                return {\n                    wordindex: target.wordindex,\n                    text: target.text,\n                    placeholder: target.placeholder,\n                    isgap: target.isgap,\n                };\n            }).filter(function(e) {\n                return e.target !== \"\";\n            });\n        },\n\n        appReady: function() {\n            var self = this;\n            self.start();\n        },\n\n\n        end: function() {\n            var self = this;\n            $(\".minilesson_nextbutton\").prop(\"disabled\", true);\n\n            //disable the buttons and go to next question or review\n            setTimeout(function() {\n                $(\".minilesson_nextbutton\").prop(\"disabled\",false);\n                if(self.quizhelper.showitemreview){\n                    self.show_item_review();\n                }else{\n                    self.next_question();\n                }\n            }, 2000);\n        },\n\n        start: function() {\n            var self = this;\n            self.controls.question.show();\n\n        },\n\n\n        stopTimer: function(timer) {\n            if (timer) {\n                    clearInterval(timer);\n            }\n        },\n\n\n    };\n});"],"names":["define","$","log","ajax","def","polly","anim","progresstimer","templates","debug","clone","extend","this","controls","gapitems","init","index","itemdata","quizhelper","animopts","useanimatecss","register_controls","register_events","getGapItems","audioplayer","uniqueid","resultsbox","checkbtn","hintbtn","nextbtn","prepare_audio","self","fetch_polly_url","passagedata","plaintext","voiceoption","usevoice","then","audiourl","attr","next_question","stepdata","hasgrade","totalitems","items","length","correctitems","filter","e","correct","grade","Math","round","do_next","show_item_review","review_data","render","html","js","show","runTemplateJS","on","give_hint","check_answer","words","map","target","wordindex","text","placeholder","isgap","appReady","start","end","prop","setTimeout","showitemreview","question","stopTimer","timer","clearInterval"],"mappings":"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"}