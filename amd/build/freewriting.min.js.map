{"version":3,"sources":["../src/freewriting.js"],"names":["define","$","log","str","notification","def","correctionsmarkup","templates","SimpleKeyboard","KeyboardLayouts","debug","transcript_evaluation","rawscore","percentscore","strings","clone","extend","init","index","itemdata","quizhelper","init_strings","init_components","register_events","self","get_strings","done","s","i","notsubmitted","notsubmit","submitnow","cancel","next_question","stepdata","hasgrade","totalitems","totalmarks","lessonitemid","id","correctitems","grade","resultsdata","do_next","calculate_score","wordsratio","countwords","stats","words","targetwordcount","relevanceratio","relevance","score","Math","round","marks","nextbutton","on","e","preventDefault","wordcount","count_words","thetextarea","val","submitted","confirm","submitbutton","click","enablevkeyboard","KeyboardClass","default","keyboardConfig","onChange","input","onKeyPress","button","customKeys","customkeys","charArray","split","filter","c","trim","length","upperArray","map","toUpperCase","lowerRow","join","upperRow","layout","display","useStandardCaps","mergeDisplay","LayoutsClass","keyboardLayouts","layoutName","get_keyboard_layout","language","get","keyboard","uniqueid","keyboardtoggle","kbContainers","container","find","is","hide","show","setInput","target","value","text","nopasting","bind","transcript","do_evaluation","timelimit","progressTimer","height","timeLimit","onFinish","ontimelimitreached","allwords","actionbox","pendingbox","resultsbox","timerdisplay","do_corrections_markup","grammarerrors","grammarmatches","insertioncount","correctionscontainer","speechtext","evaluateTranscript","itemid","then","ajaxresult","JSON","parse","reviewsettings","isNaN","rawspeech","maxscore","ystarcnt","gstarcnt","templatedata","Object","assign","showscorestarrating","yellowstars","Array","fill","M","cfg","graystars","showitemreview","render","html","js","hasOwnProperty","runTemplateJS","timerelement","timerinterval","attr","clearInterval","trigger","currentLayout","options","shiftToggle","setOptions","addClass","removeClass","lang","langCode","substring","toLowerCase"],"mappings":"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","sourcesContent":["define([\n    'jquery', 'core/log', 'core/str', 'core/notification', 'mod_minilesson/definitions', 'mod_minilesson/correctionsmarkup', 'core/templates', 'mod_minilesson/external/simplekeyboard', 'mod_minilesson/external/keyboardlayouts'],\n    function ($, log, str, notification, def, correctionsmarkup, templates, SimpleKeyboard, KeyboardLayouts) {\n        \"use strict\"; // jshint ;_;\n\n        /*\n        This file is to manage the free writing item type\n        */\n\n        log.debug('MiniLesson FreeWriting: initialising');\n\n        return {\n\n            transcript_evaluation: null,\n            rawscore: 0,\n            percentscore: 0,\n            strings: {},\n\n            //for making multiple instances\n            clone: function () {\n                return $.extend(true, {}, this);\n            },\n\n            init: function (index, itemdata, quizhelper) {\n                this.itemdata = itemdata;\n                log.debug('itemdata', itemdata);\n                this.quizhelper = quizhelper;\n                this.init_strings();\n                this.init_components(quizhelper, itemdata);\n                this.register_events(index, itemdata, quizhelper);\n            },\n\n            init_strings: function () {\n                var self = this;\n                str.get_strings([\n                    { \"key\": \"notsubmitted\", \"component\": 'mod_minilesson' },\n                    { \"key\": \"notsubmit\", \"component\": 'mod_minilesson' },\n                    { \"key\": \"submitnow\", \"component\": 'mod_minilesson' },\n                    { \"key\": \"cancel\", \"component\": 'core' },\n                ]).done(function (s) {\n                    var i = 0;\n                    self.strings.notsubmitted = s[i++];\n                    self.strings.notsubmit = s[i++];\n                    self.strings.submitnow = s[i++];\n                    self.strings.cancel = s[i++];\n                });\n            },\n\n            next_question: function () {\n                var self = this;\n                var stepdata = {};\n                stepdata.index = self.index;\n                stepdata.hasgrade = true;\n                stepdata.totalitems = self.itemdata.totalmarks;\n                stepdata.lessonitemid = self.itemdata.id;\n                stepdata.correctitems = self.rawscore > 0 ? self.rawscore : 0;\n                stepdata.grade = self.percentscore;\n                stepdata.resultsdata = self.transcript_evaluation;\n                self.quizhelper.do_next(stepdata);\n            },\n\n            calculate_score: function (transcript_evaluation) {\n                var self = this;\n\n                if (transcript_evaluation === null) {\n                    return 0;\n                }\n\n                //words ratio\n                var wordsratio = 1;\n                if (self.itemdata.countwords) {\n                    wordsratio = transcript_evaluation.stats.words / self.itemdata.targetwordcount;\n                    if (wordsratio > 1) {\n                        wordsratio = 1;\n                    }\n                }\n\n                //relevance\n                var relevanceratio = 1;\n                if (self.itemdata.relevance > 0) {\n                    relevanceratio = (transcript_evaluation.stats.relevance + 10) / 100;\n                    if (relevanceratio > 1) {\n                        relevanceratio = 1;\n                    }\n                }\n                //calculate score based on AI grade * relevance * wordcount\n                var score = Math.round(transcript_evaluation.marks * relevanceratio * wordsratio);\n                return score;\n            },\n\n            register_events: function (index, itemdata, quizhelper) {\n\n                var self = this;\n                self.index = index;\n                self.quizhelper = quizhelper;\n\n                self.nextbutton.on('click', function (e) {\n                    e.preventDefault();\n                    var wordcount = self.quizhelper.count_words(self.thetextarea.val());\n                    var submitted = self.transcript_evaluation !== null;\n                    if (submitted || wordcount === 0) {\n                        self.next_question();\n                    } else {\n                        notification.confirm(\n                            self.strings.notsubmit,\n                            self.strings.notsubmitted,\n                            self.strings.submitnow,\n                            '',\n                            function () {\n                                self.submitbutton.click();\n                            }\n                        );\n                    }\n                });\n\n                if (self.itemdata.enablevkeyboard && self.itemdata.enablevkeyboard != '0') {\n                    var KeyboardClass = SimpleKeyboard.default || SimpleKeyboard;\n\n                    var keyboardConfig = {\n                        onChange: input => self.onChange(input),\n                        onKeyPress: button => self.onKeyPress(button)\n                    };\n\n                    if (self.itemdata.enablevkeyboard == '2') {\n                        // Custom Layout\n                        var customKeys = self.itemdata.customkeys || \"\";\n                        // 1. Clean up the string (remove extra spaces)\n                        var charArray = customKeys.split(' ').filter(c => c.trim() !== \"\");\n                        // If no spaces, and not empty, split by character\n                        if (charArray.length === 0 && customKeys.trim().length > 0) {\n                            charArray = customKeys.trim().split('');\n                        }\n\n                        // 2. Map to uppercase\n                        var upperArray = charArray.map(c => c.toUpperCase());\n\n                        // 3. Join back into the format simple-keyboard expects\n                        var lowerRow = charArray.join(' ') + ' {shift}';\n                        var upperRow = upperArray.join(' ') + ' {shift}';\n\n                        keyboardConfig.layout = {\n                            'default': [lowerRow],\n                            'shift': [upperRow]\n                        };\n                        keyboardConfig.display = {\n                            '{shift}': 'â‡§'\n                        };\n                        keyboardConfig.useStandardCaps = false;\n                        keyboardConfig.mergeDisplay = true;\n\n                    } else {\n                        // Standard Language Layout\n                        var LayoutsClass = KeyboardLayouts.default || KeyboardLayouts;\n                        var keyboardLayouts = new LayoutsClass();\n                        var layoutName = self.get_keyboard_layout(self.itemdata.language);\n                        var layout = keyboardLayouts.get(layoutName);\n                        $.extend(keyboardConfig, layout);\n                    }\n\n                    self.keyboard = new KeyboardClass(\".simple-keyboard-\" + self.itemdata.uniqueid, keyboardConfig);\n\n                    self.keyboardtoggle.on('click', function (e) {\n                        var kbContainers = self.container.find(\".simple-keyboard-\" + self.itemdata.uniqueid);\n                        if (kbContainers.is(\":visible\")) {\n                            kbContainers.hide();\n                        } else {\n                            kbContainers.show();\n                        }\n                    });\n\n                    self.thetextarea.on('input', function (e) {\n                        self.keyboard.setInput(e.target.value);\n                    });\n                }\n\n                self.thetextarea.on('input', function (e) {\n                    e.preventDefault();\n                    var wordcount = self.quizhelper.count_words(self.thetextarea.val());\n                    self.wordcount.text(wordcount);\n                });\n\n                if (self.itemdata.nopasting > 0) {\n                    self.thetextarea.bind(\"cut copy paste\", function (e) {\n                        e.preventDefault();\n                    });\n                    self.thetextarea.bind(\"contextmenu\", function (e) {\n                        e.preventDefault();\n                    });\n                }\n\n                self.submitbutton.on('click', function (e) {\n                    e.preventDefault();\n                    var transcript = self.thetextarea.val();\n                    //update the wordcount\n                    var wordcount = self.quizhelper.count_words(transcript);\n                    self.wordcount.text(wordcount);\n\n                    self.do_evaluation(transcript);\n                });\n\n                $(\"#\" + itemdata.uniqueid + \"_container\").on(\"showElement\", () => {\n                    if (itemdata.timelimit > 0) {\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container\").show();\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container i\").show();\n                        $(\"#\" + itemdata.uniqueid + \"_container .progress-container #progresstimer\").progressTimer({\n                            height: '5px',\n                            timeLimit: itemdata.timelimit,\n                            onFinish: function () {\n                                self.ontimelimitreached();\n                            }\n                        });\n                    }\n                });\n\n            },\n\n            ontimelimitreached: function () {\n                var self = this;\n                var submitted = self.transcript_evaluation !== null;\n                var wordcount = self.quizhelper.count_words(self.thetextarea.val());\n                if (wordcount == 0) {\n                    self.next_question();\n                } else if (!submitted) {\n                    self.submitbutton.click();\n                }\n            },\n\n            init_components: function (quizhelper, itemdata) {\n                var self = this;\n                self.container = $(\"#\" + self.itemdata.uniqueid + \"_container\");\n                self.allwords = $(\"#\" + self.itemdata.uniqueid + \"_container.mod_minilesson_mu_passage_word\");\n                self.submitbutton = $(\"#\" + itemdata.uniqueid + \"_container .ml_freewriting_submitbutton\");\n                self.nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n                self.thetextarea = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_freewriting_textarea\");\n                self.wordcount = $(\"#\" + self.itemdata.uniqueid + \"_container span.ml_wordcount\");\n                self.actionbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_freewriting_actionbox\");\n                self.keyboardtoggle = $(\"#\" + self.itemdata.uniqueid + \"_container .ml_simple_keyboard_toggle\");\n                self.pendingbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_freewriting_pendingbox\");\n                self.resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_freewriting_resultsbox\");\n                self.timerdisplay = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_freewriting_timerdisplay\");\n            }, //end of init components\n\n            do_corrections_markup: function (grammarerrors, grammarmatches, insertioncount) {\n                var self = this;\n                //corrected text container is created at runtime, so it wont exist at init_components time\n                //that's why we find it here\n                var correctionscontainer = self.resultsbox.find('.mlfsr_correctedtext');\n\n                correctionsmarkup.init({\n                    \"correctionscontainer\": correctionscontainer,\n                    \"grammarerrors\": grammarerrors,\n                    \"grammarmatches\": grammarmatches,\n                    \"insertioncount\": insertioncount\n                });\n            },\n\n            do_evaluation: function (speechtext) {\n                var self = this;\n\n                //show a spinner while we do the AI stuff\n                self.resultsbox.hide();\n                self.actionbox.hide();\n                self.pendingbox.show();\n\n                //do evaluation\n                this.quizhelper.evaluateTranscript(speechtext, this.itemdata.itemid).then(function (ajaxresult) {\n                    var transcript_evaluation = JSON.parse(ajaxresult);\n                    if (transcript_evaluation) {\n                        transcript_evaluation.reviewsettings = self.itemdata.reviewsettings;\n                        //calculate raw score and percent score\n                        transcript_evaluation.rawscore = self.calculate_score(transcript_evaluation);\n                        self.rawscore = self.calculate_score(transcript_evaluation);\n                        self.percentscore = 0;\n                        if (self.itemdata.totalmarks > 0) {\n                            self.percentscore = Math.round((self.rawscore / self.itemdata.totalmarks) * 100);\n                        }\n                        if (isNaN(self.percentscore)) {\n                            self.percentscore = 0;\n                        }\n                        //add raw and percent score to trancript_evaluation for mustache\n                        transcript_evaluation.rawscore = self.rawscore;\n                        transcript_evaluation.percentscore = self.percentscore;\n                        transcript_evaluation.rawspeech = speechtext;\n                        transcript_evaluation.maxscore = self.itemdata.totalmarks;\n                        self.transcript_evaluation = transcript_evaluation;\n\n                        var ystarcnt = 0;\n                        var gstarcnt;\n                        const templatedata = Object.assign({}, transcript_evaluation);\n                        if (transcript_evaluation.reviewsettings.showscorestarrating) {\n                            if (self.percentscore == 0) {\n                                ystarcnt = 0;\n                            } else if (self.percentscore < 19) {\n                                ystarcnt = 1;\n                            } else if (self.percentscore < 39) {\n                                ystarcnt = 2;\n                            } else if (self.percentscore < 59) {\n                                ystarcnt = 3;\n                            } else if (self.percentscore < 79) {\n                                ystarcnt = 4;\n                            } else {\n                                ystarcnt = 5;\n                            }\n\n                            gstarcnt = 5 - ystarcnt;\n                            templatedata.yellowstars = new Array(ystarcnt).fill(M.cfg, 0, ystarcnt);\n                            templatedata.graystars = new Array(gstarcnt).fill(M.cfg, 0, gstarcnt);\n                        }\n\n                        log.debug(templatedata);\n\n                        //display results or move next if not show item review\n                        if (!self.quizhelper.showitemreview) {\n                            self.next_question();\n                        } else {\n                            templates.render('mod_minilesson/freewritingresults',Object.assign({}, templatedata)).then(\n                                function (html, js) {\n                                    self.resultsbox.html(html);\n                                    //do corrections markup\n                                    if (transcript_evaluation.hasOwnProperty('grammarerrors')) {\n                                        self.do_corrections_markup(\n                                            transcript_evaluation.grammarerrors,\n                                            transcript_evaluation.grammarmatches,\n                                            transcript_evaluation.insertioncount\n                                        );\n                                    }\n                                    //show and hide\n                                    self.resultsbox.show();\n                                    self.pendingbox.hide();\n                                    self.actionbox.hide();\n                                    templates.runTemplateJS(js);\n                                    //reset timer and wordcount on this page, in case reattempt\n                                    self.wordcount.text('0');\n                                    //self.ttrec.timer.reset();\n                                    //var displaytime = self.ttrec.timer.fetch_display_time();\n                                    //self.timerdisplay.html(displaytime);\n                                }\n                            );// End of templates\n                            // progresstimer clear interval when submitted and timelimit not finished\n                            if (self.itemdata.timelimit > 0) {\n                                var timerelement = $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container #progresstimer\");\n                                var timerinterval = timerelement.attr('timer');\n                                if (timerinterval) {\n                                    clearInterval(timerinterval);\n                                }\n                            }\n                        }//end of show item review or not\n                    } else {\n                        log.debug('transcript_evaluation: oh no it failed');\n                        self.resultsbox.hide();\n                        self.pendingbox.hide();\n                        self.actionbox.show();\n                    }\n                });\n            },\n\n            onChange: function (input) {\n                this.thetextarea.val(input);\n                this.thetextarea.trigger('input');\n            },\n\n            onKeyPress: function (button) {\n                var self = this;\n                if (button === \"{shift}\" || button === \"{lock}\") {\n                    var currentLayout = self.keyboard.options.layoutName;\n                    var shiftToggle = currentLayout === \"default\" ? \"shift\" : \"default\";\n\n                    self.keyboard.setOptions({\n                        layoutName: shiftToggle\n                    });\n\n                    var kbContainers = self.container.find(\".simple-keyboard-\" + self.itemdata.uniqueid);\n                    if (shiftToggle === \"shift\") {\n                        kbContainers.addClass(\"vkeyboard-shifted\");\n                    } else {\n                        kbContainers.removeClass(\"vkeyboard-shifted\");\n                    }\n                }\n            },\n\n            get_keyboard_layout: function (lang) {\n                // Use first two letters of language code (e.g. en from en-US)\n                var langCode = lang.substring(0, 2).toLowerCase();\n                switch (langCode) {\n                    case 'en': return 'english';\n                    case 'de': return 'german';\n                    case 'es': return 'spanish';\n                    case 'fr': return 'french';\n                    case 'it': return 'italian';\n                    case 'ja': return 'japanese';\n                    case 'ko': return 'korean';\n                    case 'pt': return 'portuguese';\n                    case 'ru': return 'russian';\n                    case 'tr': return 'turkish';\n                    case 'uk': return 'ukrainian';\n                    case 'zh': return 'chinese';\n                    case 'ar': return 'arabic';\n                    case 'el': return 'greek';\n                    case 'he': return 'hebrew';\n                    case 'hi': return 'hindi';\n                    case 'th': return 'thai';\n                    case 'ur': return 'urdu';\n                    default: return 'english';\n                }\n            }\n        };\n    });"],"file":"freewriting.min.js"}