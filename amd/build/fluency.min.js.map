{"version":3,"file":"fluency.min.js","sources":["../src/fluency.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions','mod_minilesson/pollyhelper',\n    'mod_minilesson/ttrecorder', 'mod_minilesson/animatecss',\n    'mod_minilesson/progresstimer', 'core/templates', 'core/chartjs', 'core/str', 'core/notification'],\n    function($, log, def,polly, ttrecorder,anim, progresstimer, templates, chartjs, str, notification) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the fluency item type\n   */\n\n  log.debug('MiniLesson Fluency: initialising');\n\n  var thefluencyitem = {\n    phonemeWarningThreshold: 90, // Upper threshold for phoneme warning rate\n    phonemeErrorThreshold: 70, // Upper threshold for phoneme error rate\n    hidewarning: false, // Whether to hide the orange and just show red\n    speechConfig: null,\n    //this is just a placeholder for the actual text which is from the sentences in items\n    referencetext: 'I met my love by the gas works wall',\n    game: {pointer: 0},\n    usevoice: '',\n    items: null,\n    strings: {},\n\n    //for making multiple instances\n    clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      this.itemdata = itemdata;\n      this.quizhelper = quizhelper;\n      this.index = index;\n      this.init_components(quizhelper, itemdata);\n      this.init_strings();\n\n      //correct threshold\n      this.phonemeWarningThreshold = itemdata.correctthreshold || this.phonemeWarningThreshold;\n      if(this.phonemeErrorThreshold >= this.phonemeWarningThreshold) {\n          this.phonemeErrorThreshold = Math.max(this.phonemeWarningThreshold - 25, 1);\n      }\n\n      //Hide warning\n      this.hidewarning = itemdata.hidewarning === 1;\n\n      // Anim\n      var animopts = {};\n      animopts.useanimatecss = quizhelper.useanimatecss;\n      anim.init(animopts);\n\n      //Events and voice and items parse\n      this.register_events(index, itemdata, quizhelper);\n      this.setvoice();\n      this.getItems();\n    },\n\n    init_components: function(quizhelper,itemdata){\n      var self=this;\n\n      self.thebutton = \"thettrbutton\"; // To Do impl. this\n      self.container = $(\"#\" + self.itemdata.uniqueid + \"_container\");\n      self.wordcount = $(\"#\" + self.itemdata.uniqueid + \"_container span.ml_wordcount\");\n      self.actionbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_fluency_actionbox\");\n      self.pendingbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_fluency_pendingbox\");\n      self.resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.fluency_resultscontainer\");\n      self.timerdisplay = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_fluency_timerdisplay\");\n      self.audioplayerbtn =$(\"#\" + self.itemdata.uniqueid + \"_container .fluency_listen_btn\");\n      self.audioplayerbtn_audiomodel =$(\"#\" + self.itemdata.uniqueid + \"_container .fluency_listen_btn.audiomodel\");\n      self.audioplayerbtn_audioself =$(\"#\" + self.itemdata.uniqueid + \"_container .fluency_listen_btn.audioself\");\n      self.skipbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_skip_btn\");\n      self.startbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_start_btn\");\n      self.smallnextbtn = $(\"#\" + self.itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n      self.ctrlbtns =  $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_ctrl_btn\");\n      self.speakbtncont = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_speakbtncontainer\");\n      self.questioncont = $(\"#\" + self.itemdata.uniqueid + \"_container .question\");\n      self.listencont = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_listen_cont\");\n      self.mainmenu = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_mainmenu\");\n      self.mainstage = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_mainstage\");\n      self.controls = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_controls\");\n      self.progresscont = $(\"#\" + self.itemdata.uniqueid + \"_container .progress-container\");\n      self.description = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_description\");\n      self.image = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_image_container\");\n      self.maintitle = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_maintitle\");\n      self.itemquestion = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_itemtext\");\n      self.title = $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_title\");\n\n      // Callback: Recorder updates.\n      var recorderCallback = function(message) {\n\n        switch (message.type) {\n          case 'recording':\n            break;\n\n          case 'pronunciation_results':\n            var speechresults= message.results;\n            log.debug(speechresults);\n            self.do_evaluation_feedback(speechresults);\n            self.do_evaluation_stars(speechresults);\n            self.do_recolor_continue_button(speechresults);\n            // self.do_evaluation_results(speechresults);\n            break;\n\n            case 'mediasaved':\n                // Save the returned media URL with the current item\n                // There is a potential race condition here, since audio is set from blob in do_evaluation_feedback if not here.\n                self.items[self.game.pointer].audioself = new Audio();\n                self.items[self.game.pointer].audioself.src = message.mediaurl;\n                log.debug('Media saved at fluency: ' + self.mediaurl);\n                break;\n\n        } //end of switch message type\n      };\n\n        //init tt recorder\n        var opts = {};\n        opts.uniqueid = itemdata.uniqueid;\n        opts.callback = recorderCallback;\n        opts.stt_guided=false;\n        opts.referencetext=this.referencetext;\n        self.ttrec = ttrecorder.clone();\n        self.ttrec.init(opts);\n\n    }, //end of init components\n\n    setvoice: function() {\n            var self = this;\n            self.usevoice = self.itemdata.usevoice;\n            self.voiceoption=self.itemdata.voiceoption;\n            return;\n    },\n\n    getItems: function() {\n      var self = this;\n      var text_items = self.itemdata.sentences;\n\n      self.items = text_items.map(function(target) {\n          return {\n              target: target.sentence,\n              prompt: target.prompt,\n              parsedstring: target.parsedstring,\n              displayprompt: target.displayprompt,\n              definition: target.definition,\n              phonetic: target.phonetic,\n              words: target.words,\n              typed: \"\",\n              timer: [],\n              answered: false,\n              correct: false,\n              audio: null,\n              audiourl: target.audiourl ? target.audiourl : \"\",\n              imageurl: target.imageurl,\n              hintdisplay: target.hintdisplay,\n          };\n      }).filter(function(e) {\n          return e.target !== \"\";\n      });\n\n      $.each(self.items, function(index, item) {\n          item.audio = new Audio();\n          item.audio.src = item.audiourl;\n          if (self.items.filter(function(e) {\n              return e.audio === null;\n            }).length === 0) {\n            self.appReady();\n          }\n      });\n    },\n\n    appReady: function() {\n      var self = this;\n      $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_not_loaded\").hide();\n      $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_loaded\").show();\n      if(self.itemdata.hidestartpage){\n          self.start();\n      }else{\n          $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_start_btn\").prop(\"disabled\", false);\n      }\n  },\n\n  init_strings: function() {\n        var self = this;\n        str.get_strings([\n            { \"key\": \"nextlessonitem\", \"component\": 'mod_minilesson'},\n            { \"key\": \"confirm_desc\", \"component\": 'mod_minilesson'},\n            { \"key\": \"yes\", \"component\": 'moodle'},\n            { \"key\": \"no\", \"component\": 'moodle'},\n        ]).done(function (s) {\n            var i = 0;\n            self.strings.nextlessonitem = s[i++];\n            self.strings.confirm_desc = s[i++];\n            self.strings.yes = s[i++];\n            self.strings.no = s[i++];\n        });\n    },\n\n    next_question: function() {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = self.items.length;\n      stepdata.correctitems = self.items.filter(function(e) {\n                return e.correct;\n            }).length;\n      stepdata.grade = Math.round((stepdata.correctitems / stepdata.totalitems) * 100);\n\n        //stop audio\n        self.stop_audio();\n\n      //prepare results data for detailed review on finished page or by teacher\n      var results_data = {};\n      results_data.correctitems = self.items.filter(function(e) {return e.correct;}).length;\n      results_data.totalitems = self.items.length;\n      var includeaudioself = self.itemdata.savemedia === 1; // if false only get current session audio, not saved on s3 for later\n      results_data.items = self.items_for_results_display(includeaudioself);\n      stepdata.resultsdata = results_data;\n      self.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n      // On next button click\n      self.smallnextbtn.on('click', function(e) {\n            if (self.items.some(item => !item.answered)) {\n                notification.confirm(self.strings.nextlessonitem,\n                    self.strings.confirm_desc,\n                    self.strings.yes,\n                    self.strings.no,\n                    function() {\n                        self.next_question();\n                    }\n                );\n            } else {\n                self.next_question();\n            }\n      });\n\n      // On start button click\n      self.startbtn.on(\"click\", function() {\n          self.start();\n      });\n\n      //AUDIO PLAYER Button events\n      // On listen button click\n      self.audioplayerbtn.on(\"click\", function () {\n        const $button = $(this);  // capture the button\n        var theaudioaudioself, theaudio;\n        if($button.hasClass('audioself')) {\n          theaudioaudioself = self.items[self.game.pointer].audioself;\n        }else{\n          theaudio = self.items[self.game.pointer].audio;\n        }\n\n        if (theaudioaudioself) {\n            if(!theaudioaudioself.paused){\n                theaudioaudioself.pause();\n                theaudioaudioself.currentTime=0;\n                $button.children('.fa').removeClass('fa-stop');\n                $button.children('.fa').addClass('fa-play');\n                return;\n        }\n\n            theaudioaudioself.addEventListener('ended', function () {\n                $button.children('.fa').removeClass('fa-stop');\n                $button.children('.fa').addClass('fa-play');\n            });\n\n            theaudioaudioself.addEventListener('play', function () {\n                $button.children('.fa').removeClass('fa-play');\n                $button.children('.fa').addClass('fa-stop');\n            });\n            theaudioaudioself.load();\n            theaudioaudioself.play();\n        }\n\n        if(!theaudio.paused){\n            theaudio.pause();\n            theaudio.currentTime=0;\n            $button.children('.fa').removeClass('fa-stop');\n            $button.children('.fa').addClass('fa-volume-up');\n            return;\n        }\n\n        //change icon to indicate playing state\n        theaudio.addEventListener('ended', function () {\n            $button.children('.fa').removeClass('fa-stop');\n            $button.children('.fa').addClass('fa-volume-up');\n        });\n\n        theaudio.addEventListener('play', function () {\n            $button.children('.fa').removeClass('fa-volume-up');\n            $button.children('.fa').addClass('fa-stop');\n        });\n        theaudio.load();\n        theaudio.play();\n      });\n\n\n      // On skip button click\n      self.skipbtn.on(\"click\", function() {\n\n          self.stopTimer(self.items[self.game.pointer].timer);\n\n          if (self.game.pointer < self.items.length - 1) {\n              // Disable button and show spinner in place of text or arrow\n              self.skipbtn.prop(\"disabled\", true);\n              self.skipbtn.children('.fa').removeClass('fa-arrow-right');\n              self.skipbtn.children('.fa').addClass('fa-spinner fa-spin');\n\n\n              // Move on after short time to next prompt\n              setTimeout(function() {\n                // Re enable button and reset icons and text.\n                  self.skipbtn.children('.fa').removeClass('fa-spinner fa-spin');\n                  self.skipbtn.children('.fa').addClass('fa-arrow-right');\n                  self.skipbtn.prop(\"disabled\", false);\n\n                  // Move to next item.\n                  self.container.find(\".fluency_reply_\" + self.game.pointer).hide();\n                  self.game.pointer++;\n                  self.nextPrompt();\n              }, 1500);\n              // End question\n          } else {\n              self.end();\n          }\n      });\n    },\n\n    end: function() {\n      var self = this;\n      self.smallnextbtn.prop(\"disabled\", true);\n\n      //progress dots are updated on next_item. The last item has no next item, so we update from here\n      self.updateProgressDots();\n\n      setTimeout(function() {\n          self.smallnextbtn.prop(\"disabled\",false);\n          if(self.quizhelper.showitemreview){\n               self.title.hide();\n              self.show_item_review();\n          }else{\n              self.next_question();\n          }\n      }, 2000);\n\n  },\n\n  start: function() {\n      var self = this;\n\n      self.ctrlbtns.prop(\"disabled\", true);\n      self.speakbtncont.show();\n\n      self.items.forEach(function(item) {\n          item.spoken = \"\";\n          item.answered = false;\n          item.correct = false;\n      });\n\n      self.game.pointer = 0;\n\n      self.questioncont.show();\n      self.listencont.show();\n      self.startbtn.hide();\n      self.mainmenu.hide();\n      self.description.hide();\n      self.image.hide();\n      self.maintitle.show();\n      self.itemquestion.show();\n      self.controls.show();\n\n      self.nextPrompt();\n  },\n\n  show_item_review:function(){\n      var self=this;\n      //build review data\n      var review_data = {};\n      review_data.correctitems = self.items.filter(function(e) {return e.correct;}).length;\n      review_data.totalitems = self.items.length;\n      var includeaudioself = true;\n      review_data.items = self.items_for_results_display(includeaudioself, true);\n\n      //display results\n      templates.render('mod_minilesson/listitemresults',review_data).then(\n        function(html,js){\n            self.resultsbox.html(html);\n            //show and hide\n            self.resultsbox.show();\n            self.mainstage.hide();\n            // Run js for audio player events\n            templates.runTemplateJS(js);\n        }\n      );// End of templates\n    },\n\n  updateProgressDots: function(){\n      var self = this;\n      var color,icon;\n      var progress = self.items.map(function(item, idx) {\n          color = \"#E6E9FD\";\n          icon = \"fa fa-square\";\n          if (self.items[idx].answered && self.items[idx].correct) {\n              color = \"#74DC72\";\n              icon = 'fa fa-check-square';\n          } else if (self.items[idx].answered && !self.items[idx].correct) {\n              color = \"#FB6363\";\n              icon = \"fa fa-window-close\";\n          }\n          return \"<i style='color:\" + color + \"' class='\"+ icon +\" pl-1'></i>\";\n      }).join(\" \");\n      $(\"#\" + self.itemdata.uniqueid + \"_container .fluency_title\").html(progress);\n  },\n\n  nextPrompt: function() {\n      var self = this;\n      self.ctrlbtns.prop(\"disabled\", false);\n      self.updateProgressDots();\n      var newprompt = self.container.find(\".fluency_prompt_\" + self.game.pointer);\n      anim.do_animate(newprompt, 'zoomIn animate__faster', 'in').then(\n          function() {\n          }\n      );\n      self.nextReply();\n  },\n\n\n  nextReply: function() {\n      var self = this;\n\n      var code = \"<div class='fluency_reply fluency_reply_\" + self.game.pointer + \" text-center' style='display:none;'>\";\n\n      code += \"<div class='form-container'>\";\n      code += \"<div class='fluency_prompt fluency_prompt_\" + self.game.pointer + \"'>\";\n      code += self.items[self.game.pointer].displayprompt || self.items[self.game.pointer].prompt;\n      code += \"</div>\";\n      if (self.items[self.game.pointer].hintdisplay) {\n        code += \"<div class='fluency_prompt_hint'>\" + self.items[self.game.pointer].target + \"</div>\";\n      }\n\n      //correct or not\n      code += \" <i data-idx='\" + self.game.pointer + \"' class='fluency_feedback'></i></div>\";\n\n      //hint - image\n    if( self.items[self.game.pointer].imageurl) {\n        code += \"<div class='minilesson_sentence_image'><div class='minilesson_padded_image'><img src='\"\n            + self.items[self.game.pointer].imageurl + \"' alt='Image for gap fill' /></div></div>\";\n    }\n\n      //feedback and results containers\n      code += \"<div class='item-results-container'></div>\";\n      code += \"<div class='item-feedback-container my-4'></div>\";\n\n      $(\"#\" + self.itemdata.uniqueid + \"_container .question\").append(code);\n      var newreply = self.container.find(\".fluency_reply_\" + self.game.pointer);\n      anim.do_animate(newreply, 'zoomIn animate__faster', 'in').then(\n          function() {\n          }\n      );\n      self.ctrlbtns.prop(\"disabled\", false);\n\n      //Start timer if we have one\n      self.startTimer();\n\n      //Hide the response audio because its not ready yet\n       self.audioplayerbtn_audioself.hide();\n\n      // We autoplay the audio on item entry, if its not a mobile user.\n      // If we do not have a start page and its the first item, we play on the item show event\n      if (!self.quizhelper.mobile_user()){\n        if(self.itemdata.hidestartpage && self.game.pointer === 0){\n            self.container.on(\"showElement\", () => {\n                setTimeout(function() {\n                    self.audioplayerbtn_audiomodel.trigger('click');\n                }, 1000);\n            });\n        }else{\n            setTimeout(function() {\n                self.audioplayerbtn_audiomodel.trigger('click');\n            }, 1000);\n        }\n      }\n\n      //target is the speech we expect\n      var prompt = self.items[self.game.pointer].prompt;\n      //in some cases ttrecorder wants to know the target\n      if(self.quizhelper.use_ttrecorder()) {\n        self.ttrec.update_currentprompt(prompt);\n      }\n    },\n\n    startTimer: function(){\n        var self = this;\n        // If we have a time limit, set up the timer, otherwise return\n        if (self.itemdata.timelimit > 0) {\n            // This is a function to start the timer (we call it conditionally below)\n            var doStartTimer = function() {\n                    // This shows progress bar\n                self.progresscont.show();\n                self.progresscont.addClass('d-flex align-items-center');\n                self.progresscont.find('i').show();\n                var progresbar = self.progresscont.find('#progresstimer').progressTimer({\n                    height: '5px',\n                    timeLimit: self.itemdata.timelimit,\n                    onFinish: function() {\n                        self.skip_btn.trigger('click');\n                    }\n                });\n                progresbar.each(function() {\n                    self.items[self.game.pointer].timer.push($(this).attr('timer'));\n                });\n            };\n\n            // This adds the timer and starts it. But if we dont have a start page and its the first item\n            // we need to defer the timer start until the item is shown\n            if(self.itemdata.hidestartpage && self.game.pointer === 0){\n                self.container.on(\"showElement\", () => {\n                    doStartTimer();\n                });\n            }else{\n                doStartTimer();\n            }\n        }\n    },\n\n    stopTimer: function(timers) {\n      if (timers.length) {\n          timers.forEach(function(timer) {\n              clearInterval(timer);\n          });\n      }\n    },\n\n      // Stop audio .. usually when leaving the item or sentence\n      stop_audio: function(){\n          var self =this;\n          //pause audio if its playing\n          var theaudio = self.items[self.game.pointer].audio;\n          if(theaudio && !theaudio.paused) {\n              theaudio.pause();\n          }\n      },\n\n    do_evaluation_feedback: function (pronunciation_result, isReview) {\n        var self = this;\n        //this is part of the generated html for each sentence in the item, so we need to create a handle each time\n        var itemfeedbackcontainer = self.container.find(\".item-feedback-container\");\n\n        // Clear previous results\n        itemfeedbackcontainer.html(\"\");\n\n        var twoletterlang = self.itemdata.language.substr(0, 2);\n        if(self.itemdata.rtl){\n            var words = pronunciation_result.privPronJson.Words.reverse();\n        }else{\n            var words = pronunciation_result.privPronJson.Words;\n        }\n\n\n        // Render pronunciation feedback for each word\n        var wordresults= [];\n        words.forEach(function (wordobject) {\n\n            // We are going to skip insertions, because MS Speech in Japanese especially seems to hallucinate them\n            if(wordobject.PronunciationAssessment?.ErrorType === \"Insertion\"){\n                log.debug(\"Skipping insertion word: \", wordobject.Word);\n                return; // Skip this word\n            }\n\n            //For the bar beneath the word we need an array of phoneme scores\n            // If we have syllables we use those, oddly syllables and phoneme scores are often different\n            // so if we always used phonemes, the text markup and bar markup would be visibly different\n            var word_phoneme_score_classes = [];\n\n\n            // For the word/character markup we need to map phonemes or syllables to characters\n            // we call this adata (alignment data)\n            //MS Returns syllables, at least for English, and these have a grapheme so its the best data\n            //for some words e.g \"didn't\" sometimes the grapheme is missing. duh\n            //so we send it down the no grapheme path\n            var have_graphemes = wordobject.Syllables && wordobject.Syllables.length > 0 && wordobject.Syllables[0].Grapheme;\n            if(have_graphemes){\n                //build our phonemes bar data\n                wordobject.Syllables.forEach(function(syllable){\n                    //If errortype =omission there will be no score, we use null to flag that\n                    var thescore = syllable.PronunciationAssessment?.AccuracyScore || null;\n                    word_phoneme_score_classes.push(\n                        self.scoreToColorClass(thescore)\n                    );\n                });\n\n                //Build alignment data\n                var adata =[];\n                //If errortype =omission there will be no score, we use null to flag that\n                var thescore = wordobject.PronunciationAssessment?.AccuracyScore || null;\n                wordobject.Syllables.forEach(function(syllable){\n                    adata.push({\n                        letter: syllable.Grapheme,\n                        phoneme: syllable.Syllable,\n                        score: thescore,\n                    });\n                });\n            //If no syllable data we do our best to simulate it\n            }else{\n\n                //build our phonemes bar data\n                //No syllables so use phonemes for our phonemes bar\n                if(wordobject.Phonemes && wordobject.Phonemes.length > 0){\n                    wordobject.Phonemes.forEach(function(phoneme){\n                        //If errortype =omission there will be no score, we use null to flag that\n                        var thescore = phoneme.PronunciationAssessment?.AccuracyScore || null;\n                        word_phoneme_score_classes.push(\n                            self.scoreToColorClass(thescore)\n                        );\n                    });\n                }\n\n                //Build alignment data\n                // It turns out most msspeech langs will not have phoneme names which makes mapping hard(impossible)\n                // but if we have them we can try to map them to letters.\n                var have_phoneme_names = wordobject.Phonemes && wordobject.Phonemes.length > 0 && wordobject.Phonemes[0].Phoneme !== \"\";\n                if(have_phoneme_names) {\n                    var adata = self.markuphelper.alignPhonemesToLetters(wordobject.Word,\n                        wordobject.Phonemes,\n                        twoletterlang);\n                // if we have no phoneme names or graphemes we just show the word as is with its score. This is awful\n                // we just call the text 'phoneme' here but it means the word chunk and its score.\n                // And the word chunk is the whole word\n                }else{\n                    var adata = [];\n                    //If errortype =omission there will be no score, we use null to flag that\n                    var thescore = wordobject.PronunciationAssessment?.AccuracyScore || null;\n                    adata.push({\n                        letter: wordobject.Word,\n                        phoneme: wordobject.Word,\n                        score: thescore,\n                    });\n                }\n            }\n\n            //assign css color classes to each item in alignment data based on its score and the item's warning threshold\n            adata.forEach(function(a){\n                a.scoreclass = self.scoreToColorClass(a.score);\n            });\n\n            // Store the results for this word, excluding phoneme bars if in review mode\n            if (isReview) {\n                wordresults.push({alignmentdata: adata});\n            } else {\n            wordresults.push({alignmentdata: adata, wordphonemes: word_phoneme_score_classes});\n            }\n\n        });\n\n        //Display result of all words, with phoneme bars per word if we have them\n        templates.render('mod_minilesson/fluencylineresult', {wordresults: wordresults}).then(\n            function(html, js) {\n                // Add result html to feedback container\n                itemfeedbackcontainer.html(html);\n                //store results for later use\n                self.items[self.game.pointer].pronunciation_result = pronunciation_result;\n                self.items[self.game.pointer].answered = true;\n                self.items[self.game.pointer].correct = pronunciation_result.privPronJson.PronunciationAssessment.AccuracyScore >= self.phonemeWarningThreshold;\n                // Store audio blob url for playback later.\n                // But if savemedia is set this will already (probably) be an s3 url.\n                // If this causes issues, replace this if with: if (self.itemdata.savemedia !== 1) {\n                if(!self.items[self.game.pointer].audioself) {\n                    self.items[self.game.pointer].audioself = new Audio();\n                    self.items[self.game.pointer].audioself.src = URL.createObjectURL(self.ttrec.audio.blob);\n                }\n                self.items[self.game.pointer].lineresulthtml = html;\n\n                // Also store a review version without phoneme bars if not already in review mode\n                if (!isReview) {\n                    // Generate review version without phoneme bars\n                    var wordresults_review = [];\n                    wordresults.forEach(function(wr) {\n                        wordresults_review.push({alignmentdata: wr.alignmentdata});\n                    });\n                    templates.render('mod_minilesson/fluencylineresult', {wordresults: wordresults_review}).then(\n                        function(reviewhtml, reviewjs) {\n                            self.items[self.game.pointer].lineresulthtml_review = reviewhtml;\n                        }\n                    );\n                }\n\n                //since we now have audio, show the self audio player button\n                self.audioplayerbtn_audioself.show();\n\n                //update progress dots\n                self.updateProgressDots();\n            }\n        );\n    },\n\n    do_recolor_continue_button: function(pronunciation_result) {\n        var self = this;\n\n        var accuracyScore = pronunciation_result.accuracyScore;\n        var warningthreshold = self.phonemeWarningThreshold;\n    },\n\n    do_evaluation_stars: function(pronunciation_result) {\n        var self = this;\n        log.debug(\"Accuracy score: \", pronunciation_result.accuracyScore);\n\n        //this is part of the generated html for each sentence in the item, so we need to create a handle each time\n        var itemstarscontainer = $(\"#\" + self.itemdata.uniqueid + \"_container .item-results-container\");\n        // Clear previous results\n        itemstarscontainer.html(\"\");\n        // Create star ratings\n        var starRating = $(\"<div class='fluency_star_rating'>\");\n        var accuracyScore = pronunciation_result.accuracyScore;\n        var maxStars = 5;\n        // calculate starBandWidth // band 1 = 0-19 / band 2 = 20-39 etc.\n        var correctBandwidth = 100 - self.phonemeWarningThreshold;\n        var starBandWidth = (100 - correctBandwidth) / 4;\n\n        for (var i = 0; i < maxStars; i++) {\n            var star = $(\"<i class='fa'>\");\n            if (i <= accuracyScore / starBandWidth ) {\n                star.addClass(\"fa-star\");\n            } else {\n                star.addClass(\"fa-star-o\");\n            }\n            starRating.append(star);\n        }\n        // Append star rating to the feedback container\n        itemstarscontainer.append(starRating);\n        // Add a message based on the accuracy score\n        /*\n        var message = $(\"<div class='fluency_feedback_message'>\");\n        if (accuracyScore >= 80) {\n            message.text(\"Great job! Your pronunciation is excellent.\");\n        } else if (accuracyScore >= 50) {\n            message.text(\"Good effort! Keep practicing to improve your pronunciation.\");\n        } else {\n            message.text(\"Keep trying! Focus on the pronunciation of individual words.\");\n        }\n\n        itemstarscontainer.append(message);\n         */\n    },\n\n      //The old evaluation display with some radial charts etc. We might want to use it later\n      do_evaluation_results: function(pronunciation_result) {\n        var self = this;\n        //this is part of the generated html for each sentence in the item, so we need to create a handle each time\n        var itemresultscontainer = self.container.find(\".item-results-container\");\n\n        // Clear previous results\n        itemresultscontainer.html(\"\");\n        var itemresults = [];\n\n        itemresults.push(\"Accuracy score: \" + pronunciation_result.accuracyScore);\n        itemresults.push(\"Pronunciation score: \" + pronunciation_result.pronunciationScore);\n        itemresults.push(\"Completeness score: \" + pronunciation_result.completenessScore);\n        itemresults.push(\"Fluency score: \" + pronunciation_result.fluencyScore);\n        itemresults.push(\"Prosody score: \" +  pronunciation_result.prosodyScore);\n        itemresultscontainer.append(itemresults.join(\"<br>\"));\n\n        //make a chart for each score\n        var labels = [\"Accuracy\", \"Pronunciation\", \"Completeness\", \"Fluency\", \"Prosody\"];\n        var data = [\n            pronunciation_result.accuracyScore,\n            pronunciation_result.pronunciationScore,\n            pronunciation_result.completenessScore,\n            pronunciation_result.fluencyScore,\n            pronunciation_result.prosodyScore\n        ];\n        labels.forEach(function(label, index) {\n            var chartContainerId = self.itemdata.uniqueid + \"_chart_\" + index;\n            itemresultscontainer.append('<canvas id=\"' + chartContainerId + '\"></canvas>');\n            self.createRadialChart(chartContainerId, [label], [data[index]]);\n        });\n\n        log.debug(\"Accuracy score: \", pronunciation_result.accuracyScore);\n        log.debug(\"Pronunciation score: \", pronunciation_result.pronunciationScore);\n        log.debug(\"Completeness score : \", pronunciation_result.completenessScore);\n        log.debug(\"Fluency score: \", pronunciation_result.fluencyScore);\n        log.debug(\"Prosody score: \", pronunciation_result.prosodyScore);\n\n        log.debug(\"  Word-level details:\");\n        pronunciation_result.detailResult.Words.forEach(function (word, idx) {\n            console.log(\"    \", idx + 1, \": word: \", word.Word, \"\\taccuracy score: \", word.PronunciationAssessment.AccuracyScore, \"\\terror type: \", word.PronunciationAssessment.ErrorType, \";\");\n        });\n    },\n\n    createRadialChart: function(containerId, labels, data) {\n        var ctx = document.getElementById(containerId).getContext('2d');\n        new chartjs(ctx, {\n            type: 'doughnut',\n            data: {\n                labels: labels,\n                datasets: [{\n                    label: 'Scores',\n                    data: data,\n                    backgroundColor: 'rgba(54, 162, 235, 0.2)',\n                    borderColor: 'rgba(54, 162, 235, 1)',\n                    borderWidth: 1\n                }]\n            },\n            options: {\n                scale: {\n                    ticks: {\n                        beginAtZero: true,\n                        max: 100\n                    }\n                }\n            }\n        });\n    },\n\n    //Prepare items for display in the listitemresults template (here and letter in finished review)\n    items_for_results_display: function(includeaudioself, isReview) {\n          var self = this;\n          return self.items.map(function(target) {\n              var resulthtml = target.answered ? (isReview && target.lineresulthtml_review ? target.lineresulthtml_review : target.lineresulthtml) : target.target;\n              return {\n                  target: resulthtml,\n                  pronunciation_result: target.pronunciation_result,\n                  answered: target.answered,\n                  correct: target.correct,\n                  audio: target.audio ? {src: target.audio.src} : null,\n                  audioself: (includeaudioself && target.audioself) ? {src: target.audioself.src} : null,\n              };\n          });\n    },\n\n    scoreToColorClass: function(score)\n      {\n          if (score === null) return \"letter_missing\"; //grey\n          if (score >= this.phonemeWarningThreshold) return \"letter_good\"; //green\n          if (score >= this.phonemeErrorThreshold){\n              if(this.hidewarning) {\n                  return \"letter_wrong\"; // red\n              }else{\n                  return \"letter_fair\"; // orange\n              }\n          }\n          return \"letter_wrong\"; //red\n     },\n\n    //Marking up graphemes letters and phonemes is a dark art, we do that in this object\n    markuphelper: {\n        // Language mappings for phoneme to grapheme groups\n        languageMappings: {\n            en: {\n                graphemeGroups: [\"sh\", \"th\", \"ch\", \"ph\", \"wh\", \"ck\", \"ng\"],\n                phonemeGroups: {\n                    \"ʃ\": [\"sh\"],\n                    \"tʃ\": [\"ch\"],\n                    \"θ\": [\"th\"],\n                    \"ŋ\": [\"ng\"],\n                }\n            },\n            es: {\n                graphemeGroups: [\"ll\", \"ch\", \"rr\"],\n                phonemeGroups: {\n                    \"ʎ\": [\"ll\"],\n                    \"tʃ\": [\"ch\"],\n                    \"r\": [\"rr\"],\n                }\n            },\n            fr: {\n                graphemeGroups: [\"ch\", \"gn\", \"ou\", \"eau\", \"oi\"],\n                phonemeGroups: {\n                    \"ʃ\": [\"ch\"],\n                    \"ɲ\": [\"gn\"],\n                    \"u\": [\"ou\"],\n                    \"o\": [\"eau\"],\n                    \"wa\": [\"oi\"]\n                }\n            },\n            // This assumes no diacritics or accents in the Arabic letters\n            ar: {\n                    graphemeGroups: [\"ث\", \"ذ\", \"ش\", \"خ\", \"غ\", \"ق\", \"ع\", \"ص\", \"ض\", \"ط\", \"ظ\", \"ء\"],\n                    phonemeGroups: {\n                    // Fricatives\n                    \"θ\": [\"ث\"],     // voiceless dental fricative\n                    \"ð\": [\"ذ\"],     // voiced dental fricative\n                    \"ʃ\": [\"ش\"],     // voiceless postalveolar fricative (sh)\n                    \"x\": [\"خ\"],     // voiceless uvular fricative\n                    \"ɣ\": [\"غ\"],     // voiced uvular fricative\n                    \"ħ\": [\"ح\"],     // voiceless pharyngeal fricative\n                    \"ʕ\": [\"ع\"],     // voiced pharyngeal fricative\n                    \"h\": [\"ه\"],     // glottal fricative\n\n                    // Emphatics\n                    \"sˤ\": [\"ص\"],\n                    \"dˤ\": [\"ض\"],\n                    \"tˤ\": [\"ط\"],\n                    \"ðˤ\": [\"ظ\"],\n\n                    // Stops and other consonants\n                    \"q\": [\"ق\"],\n                    \"ʔ\": [\"ء\"],     // glottal stop (hamza)\n\n                    // Long vowels (represented as letters)\n                    \"aː\": [\"ا\"],    // alif\n                    \"uː\": [\"و\"],    // waw\n                    \"iː\": [\"ي\"]     // yaa\n                    }\n                }\n                ,\n            ru: {\n                graphemeGroups: [\"щ\", \"ч\", \"ш\", \"ж\", \"ю\", \"я\"],\n                phonemeGroups: {\n                \"ɕː\": [\"щ\"],\n                \"tɕ\": [\"ч\"],\n                \"ʂ\": [\"ш\"],\n                \"ʒ\": [\"ж\"],\n                \"ju\": [\"ю\"],\n                \"ja\": [\"я\"]\n                }\n            },\n            no: {\n                graphemeGroups: [\"kj\", \"sj\", \"ng\"],\n                phonemeGroups: {\n                \"ç\": [\"kj\"],\n                \"ʃ\": [\"sj\"],\n                \"ŋ\": [\"ng\"]\n                }\n            },\n            so: {\n                graphemeGroups: [\"kh\", \"dh\", \"sh\"],\n                phonemeGroups: {\n                \"x\": [\"kh\"],\n                \"ð\": [\"dh\"],\n                \"ʃ\": [\"sh\"]\n                }\n            },\n            de: {\n                graphemeGroups: [\"sch\", \"ch\", \"ng\", \"sp\", \"st\", \"z\"],\n                phonemeGroups: {\n                \"ʃ\": [\"sch\"],\n                \"ç\": [\"ch\"],\n                \"ŋ\": [\"ng\"],\n                \"ʃp\": [\"sp\"],\n                \"ʃt\": [\"st\"],\n                \"ts\": [\"z\"]\n                }\n            },\n            it: {\n                graphemeGroups: [\"gl\", \"gn\", \"sc\", \"ch\", \"ci\", \"ce\"],\n                phonemeGroups: {\n                \"ʎ\": [\"gl\"],\n                \"ɲ\": [\"gn\"],\n                \"ʃ\": [\"sc\"],\n                \"k\": [\"ch\"],\n                \"tʃ\": [\"ci\", \"ce\"]\n                }\n            }\n        },\n\n\n        alignPhonemesToLetters: function(word, phonemesWithScores, language = \"en\") {\n            const { graphemeGroups = [], phonemeGroups = {} } = this.languageMappings[language] || {};\n\n            // Normalize letters (strip accents, diacritics)\n            function normalizeWord(word, language) {\n                switch (language) {\n                    case \"ar\": return word.normalize(\"NFKD\").replace(/[\\u064B-\\u065F\\u0670]/g, \"\");\n                    default: return word.normalize(\"NFKD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase();\n                }\n            }\n\n            // Chunk graphemes into known groups\n            function tokenizeGraphemes(word, groups) {\n                const tokens = [];\n                let i = 0;\n                while (i < word.length) {\n                    let matched = false;\n                    for (const g of groups.sort((a, b) => b.length - a.length)) {\n                        if (word.slice(i, i + g.length) === g) {\n                            tokens.push(g);\n                            i += g.length;\n                            matched = true;\n                            break;\n                        }\n                    }\n                    if (!matched) {\n                        tokens.push(word[i]);\n                        i += 1;\n                    }\n                }\n                return tokens;\n            }\n\n            // Tokenize phonemes based on mappings\n            function normalizePhoneme(p) {\n                for (const group in phonemeGroups) {\n                    if (phonemeGroups[group].includes(p)) return group;\n                }\n                return p;\n            }\n\n            const normWord = normalizeWord(word, language);\n            const graphemes = tokenizeGraphemes(normWord, graphemeGroups);\n            const phonemes = phonemesWithScores.map(p => normalizePhoneme(p.Phoneme));\n\n            // Dynamic programming\n            const m = graphemes.length, n = phonemes.length;\n            const dp = Array(m + 1).fill().map(() => Array(n + 1).fill(0));\n            const traceback = Array(m + 1).fill().map(() => Array(n + 1).fill(null));\n\n            const matchCost = 0, mismatchCost = 1, gap = 1;\n\n            for (let i = 0; i <= m; i++) { dp[i][0] = i * gap; traceback[i][0] = \"up\"; }\n            for (let j = 0; j <= n; j++) { dp[0][j] = j * gap; traceback[0][j] = \"left\"; }\n\n            for (let i = 1; i <= m; i++) {\n                for (let j = 1; j <= n; j++) {\n                    const letter = graphemes[i - 1];\n                    const phoneme = phonemes[j - 1];\n                    const cost = letter === phoneme ? matchCost : mismatchCost;\n\n                    const diag = dp[i - 1][j - 1] + cost;\n                    const up = dp[i - 1][j] + gap;\n                    const left = dp[i][j - 1] + gap;\n\n                    dp[i][j] = Math.min(diag, up, left);\n                    traceback[i][j] = (dp[i][j] === diag) ? \"diag\" : (dp[i][j] === up ? \"up\" : \"left\");\n                }\n            }\n\n            let i = m, j = n;\n            const result = [];\n\n            while (i > 0 || j > 0) {\n                const move = traceback[i][j];\n                if (move === \"diag\") {\n                    result.unshift({\n                        letter: graphemes[i - 1],\n                        phoneme: phonemesWithScores[j - 1].Phoneme,\n                        score: phonemesWithScores[j - 1].PronunciationAssessment.AccuracyScore,\n                    });\n                    i--; j--;\n                } else if (move === \"up\") {\n                    result.unshift({ letter: graphemes[i - 1], phoneme: null, score: null });\n                    i--;\n                } else {\n                    j--;\n                }\n            }\n\n            return result;\n        },\n\n    }//end of markup helper\n\n\n    };//end of thefluencyitem\n    return thefluencyitem;\n});"],"names":["define","$","log","def","polly","ttrecorder","anim","progresstimer","templates","chartjs","str","notification","debug","thefluencyitem","phonemeWarningThreshold","phonemeErrorThreshold","hidewarning","speechConfig","referencetext","game","pointer","usevoice","items","strings","clone","extend","this","init","index","itemdata","quizhelper","init_components","init_strings","correctthreshold","Math","max","animopts","useanimatecss","register_events","setvoice","getItems","self","thebutton","container","uniqueid","wordcount","actionbox","pendingbox","resultsbox","timerdisplay","audioplayerbtn","audioplayerbtn_audiomodel","audioplayerbtn_audioself","skipbtn","startbtn","smallnextbtn","ctrlbtns","speakbtncont","questioncont","listencont","mainmenu","mainstage","controls","progresscont","description","image","maintitle","itemquestion","title","opts","callback","message","type","speechresults","results","do_evaluation_feedback","do_evaluation_stars","do_recolor_continue_button","audioself","Audio","src","mediaurl","stt_guided","ttrec","voiceoption","text_items","sentences","map","target","sentence","prompt","parsedstring","displayprompt","definition","phonetic","words","typed","timer","answered","correct","audio","audiourl","imageurl","hintdisplay","filter","e","each","item","length","appReady","hide","show","hidestartpage","start","prop","get_strings","done","s","i","nextlessonitem","confirm_desc","yes","no","next_question","stepdata","hasgrade","totalitems","correctitems","grade","round","stop_audio","results_data","includeaudioself","savemedia","items_for_results_display","resultsdata","do_next","on","some","confirm","$button","theaudioaudioself","theaudio","hasClass","paused","pause","currentTime","children","removeClass","addClass","addEventListener","load","play","stopTimer","setTimeout","find","nextPrompt","end","updateProgressDots","showitemreview","show_item_review","forEach","spoken","review_data","render","then","html","js","runTemplateJS","color","icon","progress","idx","join","newprompt","do_animate","nextReply","code","append","newreply","startTimer","mobile_user","trigger","use_ttrecorder","update_currentprompt","timelimit","doStartTimer","progressTimer","height","timeLimit","onFinish","skip_btn","push","attr","timers","clearInterval","pronunciation_result","isReview","itemfeedbackcontainer","twoletterlang","language","substr","rtl","privPronJson","Words","reverse","wordresults","wordobject","PronunciationAssessment","ErrorType","word_phoneme_score_classes","Syllables","Grapheme","syllable","thescore","AccuracyScore","scoreToColorClass","adata","letter","phoneme","Syllable","score","Phonemes","Phoneme","markuphelper","alignPhonemesToLetters","Word","a","scoreclass","alignmentdata","wordphonemes","URL","createObjectURL","blob","lineresulthtml","wordresults_review","wr","reviewhtml","reviewjs","lineresulthtml_review","accuracyScore","itemstarscontainer","starRating","starBandWidth","star","do_evaluation_results","itemresultscontainer","itemresults","pronunciationScore","completenessScore","fluencyScore","prosodyScore","data","label","chartContainerId","createRadialChart","detailResult","word","console","containerId","labels","ctx","document","getElementById","getContext","datasets","backgroundColor","borderColor","borderWidth","options","scale","ticks","beginAtZero","languageMappings","en","graphemeGroups","phonemeGroups","es","fr","ar","ru","so","de","it","phonemesWithScores","normalizeWord","normalize","replace","toLowerCase","tokenizeGraphemes","groups","tokens","matched","g","sort","b","slice","normalizePhoneme","p","group","includes","normWord","graphemes","phonemes","m","n","dp","Array","fill","traceback","matchCost","mismatchCost","gap","j","cost","diag","up","left","min","result","move","unshift"],"mappings":"AAAAA,gCAAO,CAAC,SAAU,WAAY,6BAA6B,6BACvD,4BAA6B,4BAC7B,+BAAgC,iBAAkB,eAAgB,WAAY,sBAC9E,SAASC,EAAGC,IAAKC,IAAIC,MAAOC,WAAWC,KAAMC,cAAeC,UAAWC,QAASC,IAAKC,cAOvFT,IAAIU,MAAM,wCAENC,eAAiB,CACnBC,wBAAyB,GACzBC,sBAAuB,GACvBC,aAAa,EACbC,aAAc,KAEdC,cAAe,sCACfC,KAAM,CAACC,QAAS,GAChBC,SAAU,GACVC,MAAO,KACPC,QAAS,GAGTC,MAAO,kBACMvB,EAAEwB,QAAO,EAAM,GAAIC,OAGhCC,KAAM,SAASC,MAAOC,SAAUC,iBACzBD,SAAWA,cACXC,WAAaA,gBACbF,MAAQA,WACRG,gBAAgBD,WAAYD,eAC5BG,oBAGAlB,wBAA0Be,SAASI,kBAAoBP,KAAKZ,wBAC9DY,KAAKX,uBAAyBW,KAAKZ,+BAC7BC,sBAAwBmB,KAAKC,IAAIT,KAAKZ,wBAA0B,GAAI,SAIxEE,YAAuC,IAAzBa,SAASb,gBAGxBoB,SAAW,GACfA,SAASC,cAAgBP,WAAWO,cACpC/B,KAAKqB,KAAKS,eAGLE,gBAAgBV,MAAOC,SAAUC,iBACjCS,gBACAC,YAGPT,gBAAiB,SAASD,WAAWD,cAC/BY,KAAKf,KAETe,KAAKC,UAAY,eACjBD,KAAKE,UAAY1C,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,cAClDH,KAAKI,UAAY5C,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,gCAClDH,KAAKK,UAAY7C,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,uCAClDH,KAAKM,WAAa9C,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,wCACnDH,KAAKO,WAAa/C,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,2CACnDH,KAAKQ,aAAehD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,0CACrDH,KAAKS,eAAgBjD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,kCACtDH,KAAKU,0BAA2BlD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,6CACjEH,KAAKW,yBAA0BnD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,4CAChEH,KAAKY,QAAUpD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,gCAChDH,KAAKa,SAAWrD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,iCACjDH,KAAKc,aAAetD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,qCACrDH,KAAKe,SAAYvD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,gCAClDH,KAAKgB,aAAexD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,yCACrDH,KAAKiB,aAAezD,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,wBACrDH,KAAKkB,WAAa1D,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,mCACnDH,KAAKmB,SAAW3D,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,gCACjDH,KAAKoB,UAAY5D,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,iCAClDH,KAAKqB,SAAW7D,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,gCACjDH,KAAKsB,aAAe9D,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,kCACrDH,KAAKuB,YAAc/D,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,mCACpDH,KAAKwB,MAAQhE,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,uCAC9CH,KAAKyB,UAAYjE,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,iCAClDH,KAAK0B,aAAelE,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,gCACrDH,KAAK2B,MAAQnE,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,iCA8BxCyB,KAAO,GACXA,KAAKzB,SAAWf,SAASe,SACzByB,KAAKC,SA7BgB,SAASC,gBAEtBA,QAAQC,UACT,sBAGA,4BACCC,cAAeF,QAAQG,QAC3BxE,IAAIU,MAAM6D,eACVhC,KAAKkC,uBAAuBF,eAC5BhC,KAAKmC,oBAAoBH,eACzBhC,KAAKoC,2BAA2BJ,yBAI3B,aAGDhC,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS0D,UAAY,IAAIC,MAC9CtC,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS0D,UAAUE,IAAMT,QAAQU,SACtD/E,IAAIU,MAAM,2BAA6B6B,KAAKwC,YAUpDZ,KAAKa,YAAW,EAChBb,KAAKnD,cAAcQ,KAAKR,cACxBuB,KAAK0C,MAAQ9E,WAAWmB,QACxBiB,KAAK0C,MAAMxD,KAAK0C,OAIpB9B,SAAU,WACSb,KACNL,SADMK,KACUG,SAASR,SADnBK,KAEN0D,YAFM1D,KAEWG,SAASuD,aAIvC5C,SAAU,eACJC,KAAOf,KACP2D,WAAa5C,KAAKZ,SAASyD,UAE/B7C,KAAKnB,MAAQ+D,WAAWE,KAAI,SAASC,cAC1B,CACHA,OAAQA,OAAOC,SACfC,OAAQF,OAAOE,OACfC,aAAcH,OAAOG,aACrBC,cAAeJ,OAAOI,cACtBC,WAAYL,OAAOK,WACnBC,SAAUN,OAAOM,SACjBC,MAAOP,OAAOO,MACdC,MAAO,GACPC,MAAO,GACPC,UAAU,EACVC,SAAS,EACTC,MAAO,KACPC,SAAUb,OAAOa,SAAWb,OAAOa,SAAW,GAC9CC,SAAUd,OAAOc,SACjBC,YAAaf,OAAOe,gBAEzBC,QAAO,SAASC,SACK,KAAbA,EAAEjB,UAGbvF,EAAEyG,KAAKjE,KAAKnB,OAAO,SAASM,MAAO+E,MAC/BA,KAAKP,MAAQ,IAAIrB,MACjB4B,KAAKP,MAAMpB,IAAM2B,KAAKN,SAGN,IAFZ5D,KAAKnB,MAAMkF,QAAO,SAASC,UACR,OAAZA,EAAEL,SACRQ,QACHnE,KAAKoE,eAKbA,SAAU,WAER5G,EAAE,IADSyB,KACEG,SAASe,SAAW,kCAAkCkE,OACnE7G,EAAE,IAFSyB,KAEEG,SAASe,SAAW,8BAA8BmE,OAFpDrF,KAGHG,SAASmF,cAHNtF,KAIFuF,QAELhH,EAAE,IANKyB,KAMMG,SAASe,SAAW,iCAAiCsE,KAAK,YAAY,IAI3FlF,aAAc,eACJS,KAAOf,KACXhB,IAAIyG,YAAY,CACZ,KAAS,2BAA+B,kBACxC,KAAS,yBAA6B,kBACtC,KAAS,gBAAoB,UAC7B,KAAS,eAAmB,YAC7BC,MAAK,SAAUC,OACVC,EAAI,EACR7E,KAAKlB,QAAQgG,eAAiBF,EAAEC,KAChC7E,KAAKlB,QAAQiG,aAAeH,EAAEC,KAC9B7E,KAAKlB,QAAQkG,IAAMJ,EAAEC,KACrB7E,KAAKlB,QAAQmG,GAAKL,EAAEC,SAI5BK,cAAe,eAETC,SAAW,GACfA,SAAShG,MAFEF,KAEWE,MACtBgG,SAASC,UAAW,EACpBD,SAASE,WAJEpG,KAIgBJ,MAAMsF,OACjCgB,SAASG,aALErG,KAKkBJ,MAAMkF,QAAO,SAASC,UAClCA,EAAEN,WACVS,OACTgB,SAASI,MAAQ9F,KAAK+F,MAAOL,SAASG,aAAeH,SAASE,WAAc,KARjEpG,KAWJwG,iBAGHC,aAAe,GACnBA,aAAaJ,aAfFrG,KAesBJ,MAAMkF,QAAO,SAASC,UAAWA,EAAEN,WAAWS,OAC/EuB,aAAaL,WAhBFpG,KAgBoBJ,MAAMsF,WACjCwB,iBAA+C,IAjBxC1G,KAiBiBG,SAASwG,UACrCF,aAAa7G,MAlBFI,KAkBe4G,0BAA0BF,kBACpDR,SAASW,YAAcJ,aAnBZzG,KAoBNI,WAAW0G,QAAQZ,WAG1BtF,gBAAiB,SAASV,MAAOC,SAAUC,gBAErCW,KAAOf,KAEXe,KAAKc,aAAakF,GAAG,SAAS,SAAShC,GAC7BhE,KAAKnB,MAAMoH,MAAK/B,OAASA,KAAKT,WAC9BvF,aAAagI,QAAQlG,KAAKlB,QAAQgG,eAC9B9E,KAAKlB,QAAQiG,aACb/E,KAAKlB,QAAQkG,IACbhF,KAAKlB,QAAQmG,IACb,WACIjF,KAAKkF,mBAIblF,KAAKkF,mBAKflF,KAAKa,SAASmF,GAAG,SAAS,WACtBhG,KAAKwE,WAKTxE,KAAKS,eAAeuF,GAAG,SAAS,iBACxBG,QAAU3I,EAAEyB,UACdmH,kBAAmBC,YACpBF,QAAQG,SAAS,aAClBF,kBAAoBpG,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS0D,UAElDgE,SAAWrG,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASgF,MAGvCyC,kBAAmB,KACfA,kBAAkBG,cAClBH,kBAAkBI,QAClBJ,kBAAkBK,YAAY,EAC9BN,QAAQO,SAAS,OAAOC,YAAY,gBACpCR,QAAQO,SAAS,OAAOE,SAAS,WAIrCR,kBAAkBS,iBAAiB,SAAS,WACxCV,QAAQO,SAAS,OAAOC,YAAY,WACpCR,QAAQO,SAAS,OAAOE,SAAS,cAGrCR,kBAAkBS,iBAAiB,QAAQ,WACvCV,QAAQO,SAAS,OAAOC,YAAY,WACpCR,QAAQO,SAAS,OAAOE,SAAS,cAErCR,kBAAkBU,OAClBV,kBAAkBW,WAGlBV,SAASE,cACTF,SAASG,QACTH,SAASI,YAAY,EACrBN,QAAQO,SAAS,OAAOC,YAAY,gBACpCR,QAAQO,SAAS,OAAOE,SAAS,gBAKrCP,SAASQ,iBAAiB,SAAS,WAC/BV,QAAQO,SAAS,OAAOC,YAAY,WACpCR,QAAQO,SAAS,OAAOE,SAAS,mBAGrCP,SAASQ,iBAAiB,QAAQ,WAC9BV,QAAQO,SAAS,OAAOC,YAAY,gBACpCR,QAAQO,SAAS,OAAOE,SAAS,cAErCP,SAASS,OACTT,SAASU,UAKX/G,KAAKY,QAAQoF,GAAG,SAAS,WAErBhG,KAAKgH,UAAUhH,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS6E,OAEzCxD,KAAKtB,KAAKC,QAAUqB,KAAKnB,MAAMsF,OAAS,GAExCnE,KAAKY,QAAQ6D,KAAK,YAAY,GAC9BzE,KAAKY,QAAQ8F,SAAS,OAAOC,YAAY,kBACzC3G,KAAKY,QAAQ8F,SAAS,OAAOE,SAAS,sBAItCK,YAAW,WAEPjH,KAAKY,QAAQ8F,SAAS,OAAOC,YAAY,sBACzC3G,KAAKY,QAAQ8F,SAAS,OAAOE,SAAS,kBACtC5G,KAAKY,QAAQ6D,KAAK,YAAY,GAG9BzE,KAAKE,UAAUgH,KAAK,kBAAoBlH,KAAKtB,KAAKC,SAAS0F,OAC3DrE,KAAKtB,KAAKC,UACVqB,KAAKmH,eACN,OAGHnH,KAAKoH,UAKfA,IAAK,eACCpH,KAAOf,KACXe,KAAKc,aAAa2D,KAAK,YAAY,GAGnCzE,KAAKqH,qBAELJ,YAAW,WACPjH,KAAKc,aAAa2D,KAAK,YAAW,GAC/BzE,KAAKX,WAAWiI,gBACdtH,KAAK2B,MAAM0C,OACZrE,KAAKuH,oBAELvH,KAAKkF,kBAEV,MAIPV,MAAO,WACQvF,KAEN8B,SAAS0D,KAAK,YAAY,GAFpBxF,KAGN+B,aAAasD,OAHPrF,KAKNJ,MAAM2I,SAAQ,SAAStD,MACxBA,KAAKuD,OAAS,GACdvD,KAAKT,UAAW,EAChBS,KAAKR,SAAU,KARRzE,KAWNP,KAAKC,QAAU,EAXTM,KAaNgC,aAAaqD,OAbPrF,KAcNiC,WAAWoD,OAdLrF,KAeN4B,SAASwD,OAfHpF,KAgBNkC,SAASkD,OAhBHpF,KAiBNsC,YAAY8C,OAjBNpF,KAkBNuC,MAAM6C,OAlBApF,KAmBNwC,UAAU6C,OAnBJrF,KAoBNyC,aAAa4C,OApBPrF,KAqBNoC,SAASiD,OArBHrF,KAuBNkI,cAGTI,iBAAiB,eACTvH,KAAKf,KAELyI,YAAc,GAClBA,YAAYpC,aAAetF,KAAKnB,MAAMkF,QAAO,SAASC,UAAWA,EAAEN,WAAWS,OAC9EuD,YAAYrC,WAAarF,KAAKnB,MAAMsF,OAEpCuD,YAAY7I,MAAQmB,KAAK6F,2BADF,GAC8C,GAGrE9H,UAAU4J,OAAO,iCAAiCD,aAAaE,MAC7D,SAASC,KAAKC,IACV9H,KAAKO,WAAWsH,KAAKA,MAErB7H,KAAKO,WAAW+D,OAChBtE,KAAKoB,UAAUiD,OAEftG,UAAUgK,cAAcD,QAKlCT,mBAAoB,eAEZW,MAAMC,KADNjI,KAAOf,KAEPiJ,SAAWlI,KAAKnB,MAAMiE,KAAI,SAASoB,KAAMiE,YACzCH,MAAQ,UACRC,KAAO,eACHjI,KAAKnB,MAAMsJ,KAAK1E,UAAYzD,KAAKnB,MAAMsJ,KAAKzE,SAC5CsE,MAAQ,UACRC,KAAO,sBACAjI,KAAKnB,MAAMsJ,KAAK1E,WAAazD,KAAKnB,MAAMsJ,KAAKzE,UACpDsE,MAAQ,UACRC,KAAO,sBAEJ,mBAAqBD,MAAQ,YAAaC,KAAM,iBACxDG,KAAK,KACR5K,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,6BAA6B0H,KAAKK,WAGvEf,WAAY,WACGlI,KACN8B,SAAS0D,KAAK,YAAY,GADpBxF,KAENoI,yBACDgB,UAHOpJ,KAGUiB,UAAUgH,KAAK,mBAHzBjI,KAGmDP,KAAKC,SACnEd,KAAKyK,WAAWD,UAAW,yBAA0B,MAAMT,MACvD,eALO3I,KAQNsJ,aAITA,UAAW,eACHvI,KAAOf,KAEPuJ,KAAO,2CAA6CxI,KAAKtB,KAAKC,QAAU,uCAE5E6J,MAAQ,+BACRA,MAAQ,6CAA+CxI,KAAKtB,KAAKC,QAAU,KAC3E6J,MAAQxI,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASwE,eAAiBnD,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASsE,OACrFuF,MAAQ,SACJxI,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASmF,cAChC0E,MAAQ,oCAAsCxI,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASoE,OAAS,UAIvFyF,MAAQ,iBAAmBxI,KAAKtB,KAAKC,QAAU,wCAG7CqB,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASkF,WAC9B2E,MAAQ,yFACFxI,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASkF,SAAW,6CAIjD2E,MAAQ,6CACRA,MAAQ,mDAERhL,EAAE,IAAMwC,KAAKZ,SAASe,SAAW,wBAAwBsI,OAAOD,UAC5DE,SAAW1I,KAAKE,UAAUgH,KAAK,kBAAoBlH,KAAKtB,KAAKC,SACjEd,KAAKyK,WAAWI,SAAU,yBAA0B,MAAMd,MACtD,eAGJ5H,KAAKe,SAAS0D,KAAK,YAAY,GAG/BzE,KAAK2I,aAGJ3I,KAAKW,yBAAyB0D,OAI1BrE,KAAKX,WAAWuJ,gBAChB5I,KAAKZ,SAASmF,eAAuC,IAAtBvE,KAAKtB,KAAKC,QACxCqB,KAAKE,UAAU8F,GAAG,eAAe,KAC7BiB,YAAW,WACPjH,KAAKU,0BAA0BmI,QAAQ,WACxC,QAGP5B,YAAW,WACPjH,KAAKU,0BAA0BmI,QAAQ,WACxC,UAKL5F,OAASjD,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASsE,OAExCjD,KAAKX,WAAWyJ,kBACjB9I,KAAK0C,MAAMqG,qBAAqB9F,SAIpC0F,WAAY,eACJ3I,KAAOf,QAEPe,KAAKZ,SAAS4J,UAAY,EAAG,KAEzBC,aAAe,WAEfjJ,KAAKsB,aAAagD,OAClBtE,KAAKsB,aAAasF,SAAS,6BAC3B5G,KAAKsB,aAAa4F,KAAK,KAAK5C,OACXtE,KAAKsB,aAAa4F,KAAK,kBAAkBgC,cAAc,CACpEC,OAAQ,MACRC,UAAWpJ,KAAKZ,SAAS4J,UACzBK,SAAU,WACNrJ,KAAKsJ,SAAST,QAAQ,YAGnB5E,MAAK,WACZjE,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS6E,MAAM+F,KAAK/L,EAAEyB,MAAMuK,KAAK,cAM3DxJ,KAAKZ,SAASmF,eAAuC,IAAtBvE,KAAKtB,KAAKC,QACxCqB,KAAKE,UAAU8F,GAAG,eAAe,KAC7BiD,kBAGJA,iBAKZjC,UAAW,SAASyC,QACdA,OAAOtF,QACPsF,OAAOjC,SAAQ,SAAShE,OACpBkG,cAAclG,WAMtBiC,WAAY,eAGJY,SAFMpH,KAEUJ,MAFVI,KAEqBP,KAAKC,SAASgF,MAC1C0C,WAAaA,SAASE,QACrBF,SAASG,SAInBtE,uBAAwB,SAAUyH,qBAAsBC,cAChD5J,KAAOf,KAEP4K,sBAAwB7J,KAAKE,UAAUgH,KAAK,4BAGhD2C,sBAAsBhC,KAAK,QAEvBiC,cAAgB9J,KAAKZ,SAAS2K,SAASC,OAAO,EAAG,MAClDhK,KAAKZ,SAAS6K,QACT3G,MAAQqG,qBAAqBO,aAAaC,MAAMC,eAEhD9G,MAAQqG,qBAAqBO,aAAaC,UAK9CE,YAAa,GACjB/G,MAAMkE,SAAQ,SAAU8C,yCAGiC,6CAAlDA,WAAWC,sFAAyBC,gBAQnCC,2BAA6B,MAQZH,WAAWI,WAAaJ,WAAWI,UAAUvG,OAAS,GAAKmG,WAAWI,UAAU,GAAGC,SACtF,4BAEdL,WAAWI,UAAUlD,SAAQ,SAASoD,oCAE9BC,wCAAWD,SAASL,sFAAyBO,gBAAiB,KAClEL,2BAA2BlB,KACvBvJ,KAAK+K,kBAAkBF,kBAK3BG,MAAO,GAEPH,yCAAWP,WAAWC,wFAAyBO,gBAAiB,KACpER,WAAWI,UAAUlD,SAAQ,SAASoD,UAClCI,MAAMzB,KAAK,CACP0B,OAAQL,SAASD,SACjBO,QAASN,SAASO,SAClBC,MAAOP,kBAId,IAIEP,WAAWe,UAAYf,WAAWe,SAASlH,OAAS,GACnDmG,WAAWe,SAAS7D,SAAQ,SAAS0D,mCAE7BL,wCAAWK,QAAQX,sFAAyBO,gBAAiB,KACjEL,2BAA2BlB,KACvBvJ,KAAK+K,kBAAkBF,cAQVP,WAAWe,UAAYf,WAAWe,SAASlH,OAAS,GAAwC,KAAnCmG,WAAWe,SAAS,GAAGC,QAEjGN,MAAQhL,KAAKuL,aAAaC,uBAAuBlB,WAAWmB,KAC5DnB,WAAWe,SACXvB,mBAIH,4BACGkB,MAAQ,GAERH,yCAAWP,WAAWC,wFAAyBO,gBAAiB,KACpEE,MAAMzB,KAAK,CACP0B,OAAQX,WAAWmB,KACnBP,QAASZ,WAAWmB,KACpBL,MAAOP,YAMnBG,MAAMxD,SAAQ,SAASkE,GACnBA,EAAEC,WAAa3L,KAAK+K,kBAAkBW,EAAEN,UAIxCxB,SACAS,YAAYd,KAAK,CAACqC,cAAeZ,QAErCX,YAAYd,KAAK,CAACqC,cAAeZ,MAAOa,aAAcpB,kCApFlDhN,IAAIU,MAAM,4BAA6BmM,WAAWmB,SA0F1D1N,UAAU4J,OAAO,mCAAoC,CAAC0C,YAAaA,cAAczC,MAC7E,SAASC,KAAMC,OAEX+B,sBAAsBhC,KAAKA,MAE3B7H,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASgL,qBAAuBA,qBACrD3J,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS8E,UAAW,EACzCzD,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS+E,QAAUiG,qBAAqBO,aAAaK,wBAAwBO,eAAiB9K,KAAK3B,wBAIpH2B,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS0D,YAC9BrC,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS0D,UAAY,IAAIC,MAC9CtC,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS0D,UAAUE,IAAMuJ,IAAIC,gBAAgB/L,KAAK0C,MAAMiB,MAAMqI,OAEvFhM,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAASsN,eAAiBpE,MAG1C+B,SAAU,KAEPsC,mBAAqB,GACzB7B,YAAY7C,SAAQ,SAAS2E,IACzBD,mBAAmB3C,KAAK,CAACqC,cAAeO,GAAGP,mBAE/C7N,UAAU4J,OAAO,mCAAoC,CAAC0C,YAAa6B,qBAAqBtE,MACpF,SAASwE,WAAYC,UACjBrM,KAAKnB,MAAMmB,KAAKtB,KAAKC,SAAS2N,sBAAwBF,cAMlEpM,KAAKW,yBAAyB2D,OAG9BtE,KAAKqH,yBAKjBjF,2BAA4B,SAASuH,sBAGbA,qBAAqB4C,cAF9BtN,KAGiBZ,yBAGhC8D,oBAAqB,SAASwH,sBAE1BlM,IAAIU,MAAM,mBAAoBwL,qBAAqB4C,mBAG/CC,mBAAqBhP,EAAE,IAJhByB,KAI2BG,SAASe,SAAW,sCAE1DqM,mBAAmB3E,KAAK,YAEpB4E,WAAajP,EAAE,qCACf+O,cAAgB5C,qBAAqB4C,cAIrCG,eAAiB,KADE,IAZZzN,KAYuBZ,0BACa,EAEtCwG,EAAI,EAAGA,EALD,EAKeA,IAAK,KAC3B8H,KAAOnP,EAAE,kBACTqH,GAAK0H,cAAgBG,cACrBC,KAAK/F,SAAS,WAEd+F,KAAK/F,SAAS,aAElB6F,WAAWhE,OAAOkE,MAGtBH,mBAAmB/D,OAAOgE,aAiB5BG,sBAAuB,SAASjD,0BAC1B3J,KAAOf,KAEP4N,qBAAuB7M,KAAKE,UAAUgH,KAAK,2BAG/C2F,qBAAqBhF,KAAK,QACtBiF,YAAc,GAElBA,YAAYvD,KAAK,mBAAqBI,qBAAqB4C,eAC3DO,YAAYvD,KAAK,wBAA0BI,qBAAqBoD,oBAChED,YAAYvD,KAAK,uBAAyBI,qBAAqBqD,mBAC/DF,YAAYvD,KAAK,kBAAoBI,qBAAqBsD,cAC1DH,YAAYvD,KAAK,kBAAqBI,qBAAqBuD,cAC3DL,qBAAqBpE,OAAOqE,YAAY1E,KAAK,aAIzC+E,KAAO,CACPxD,qBAAqB4C,cACrB5C,qBAAqBoD,mBACrBpD,qBAAqBqD,kBACrBrD,qBAAqBsD,aACrBtD,qBAAqBuD,cANZ,CAAC,WAAY,gBAAiB,eAAgB,UAAW,WAQ/D1F,SAAQ,SAAS4F,MAAOjO,WACvBkO,iBAAmBrN,KAAKZ,SAASe,SAAW,UAAYhB,MAC5D0N,qBAAqBpE,OAAO,eAAiB4E,iBAAmB,eAChErN,KAAKsN,kBAAkBD,iBAAkB,CAACD,OAAQ,CAACD,KAAKhO,YAG5D1B,IAAIU,MAAM,mBAAoBwL,qBAAqB4C,eACnD9O,IAAIU,MAAM,wBAAyBwL,qBAAqBoD,oBACxDtP,IAAIU,MAAM,wBAAyBwL,qBAAqBqD,mBACxDvP,IAAIU,MAAM,kBAAmBwL,qBAAqBsD,cAClDxP,IAAIU,MAAM,kBAAmBwL,qBAAqBuD,cAElDzP,IAAIU,MAAM,yBACVwL,qBAAqB4D,aAAapD,MAAM3C,SAAQ,SAAUgG,KAAMrF,KAC5DsF,QAAQhQ,IAAI,OAAQ0K,IAAM,EAAG,WAAYqF,KAAK/B,KAAM,qBAAsB+B,KAAKjD,wBAAwBO,cAAe,iBAAkB0C,KAAKjD,wBAAwBC,UAAW,SAIxL8C,kBAAmB,SAASI,YAAaC,OAAQR,UACzCS,IAAMC,SAASC,eAAeJ,aAAaK,WAAW,UACtD/P,QAAQ4P,IAAK,CACb7L,KAAM,WACNoL,KAAM,CACFQ,OAAQA,OACRK,SAAU,CAAC,CACPZ,MAAO,SACPD,KAAMA,KACNc,gBAAiB,0BACjBC,YAAa,wBACbC,YAAa,KAGrBC,QAAS,CACLC,MAAO,CACHC,MAAO,CACHC,aAAa,EACb7O,IAAK,UAQzBmG,0BAA2B,SAASF,iBAAkBiE,iBACrC3K,KACCJ,MAAMiE,KAAI,SAASC,cAEpB,CACHA,OAFaA,OAAOU,SAAYmG,UAAY7G,OAAOuJ,sBAAwBvJ,OAAOuJ,sBAAwBvJ,OAAOkJ,eAAkBlJ,OAAOA,OAG1I4G,qBAAsB5G,OAAO4G,qBAC7BlG,SAAUV,OAAOU,SACjBC,QAASX,OAAOW,QAChBC,MAAOZ,OAAOY,MAAQ,CAACpB,IAAKQ,OAAOY,MAAMpB,KAAO,KAChDF,UAAYsD,kBAAoB5C,OAAOV,UAAa,CAACE,IAAKQ,OAAOV,UAAUE,KAAO,UAKhGwI,kBAAmB,SAASK,cAER,OAAVA,MAAuB,iBACvBA,OAASnM,KAAKZ,wBAAgC,cAC9C+M,OAASnM,KAAKX,sBACXW,KAAKV,YACG,eAEA,cAGR,gBAIbgN,aAAc,CAEViD,iBAAkB,CACdC,GAAI,CACAC,eAAgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACrDC,cAAe,KACN,CAAC,WACA,CAAC,UACF,CAAC,UACD,CAAC,QAGdC,GAAI,CACAF,eAAgB,CAAC,KAAM,KAAM,MAC7BC,cAAe,KACN,CAAC,WACA,CAAC,QACF,CAAC,QAGdE,GAAI,CACAH,eAAgB,CAAC,KAAM,KAAM,KAAM,MAAO,MAC1CC,cAAe,KACN,CAAC,UACD,CAAC,QACD,CAAC,QACD,CAAC,UACA,CAAC,QAIfG,GAAI,CACIJ,eAAgB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACxEC,cAAe,KAEV,CAAC,SACD,CAAC,SACD,CAAC,OACD,CAAC,SACD,CAAC,SACD,CAAC,SACD,CAAC,OACD,CAAC,UAGA,CAAC,UACD,CAAC,UACD,CAAC,UACD,CAAC,OAGF,CAAC,SACD,CAAC,UAGA,CAAC,UACD,CAAC,UACD,CAAC,OAIfI,GAAI,CACAL,eAAgB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,KAC1CC,cAAe,MACT,CAAC,UACD,CAAC,SACF,CAAC,SACD,CAAC,QACA,CAAC,QACD,CAAC,OAGX1J,GAAI,CACAyJ,eAAgB,CAAC,KAAM,KAAM,MAC7BC,cAAe,KACV,CAAC,UACD,CAAC,UACD,CAAC,QAGVK,GAAI,CACAN,eAAgB,CAAC,KAAM,KAAM,MAC7BC,cAAe,GACV,CAAC,UACD,CAAC,UACD,CAAC,QAGVM,GAAI,CACAP,eAAgB,CAAC,MAAO,KAAM,KAAM,KAAM,KAAM,KAChDC,cAAe,KACV,CAAC,WACD,CAAC,UACD,CAAC,WACA,CAAC,WACD,CAAC,SACD,CAAC,OAGXO,GAAI,CACAR,eAAgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/CC,cAAe,KACV,CAAC,UACD,CAAC,UACD,CAAC,QACD,CAAC,WACA,CAAC,KAAM,SAMrBnD,uBAAwB,SAASgC,KAAM2B,wBAAoBpF,gEAAW,WAC5D2E,eAAEA,eAAiB,GAAnBC,cAAuBA,cAAgB,IAAO1P,KAAKuP,iBAAiBzE,WAAa,YAG9EqF,cAAc5B,KAAMzD,gBAEhB,OADDA,SACcyD,KAAK6B,UAAU,QAAQC,QAAQ,yBAA0B,IAC3D9B,KAAK6B,UAAU,QAAQC,QAAQ,mBAAoB,IAAIC,uBAKtEC,kBAAkBhC,KAAMiC,cACvBC,OAAS,OACX7K,EAAI,OACDA,EAAI2I,KAAKrJ,QAAQ,KAChBwL,SAAU,MACT,MAAMC,KAAKH,OAAOI,MAAK,CAACnE,EAAGoE,IAAMA,EAAE3L,OAASuH,EAAEvH,YAC3CqJ,KAAKuC,MAAMlL,EAAGA,EAAI+K,EAAEzL,UAAYyL,EAAG,CACnCF,OAAOnG,KAAKqG,GACZ/K,GAAK+K,EAAEzL,OACPwL,SAAU,QAIbA,UACDD,OAAOnG,KAAKiE,KAAK3I,IACjBA,GAAK,UAGN6K,gBAIFM,iBAAiBC,OACjB,MAAMC,SAASvB,iBACZA,cAAcuB,OAAOC,SAASF,GAAI,OAAOC,aAE1CD,QAGLG,SAAWhB,cAAc5B,KAAMzD,UAC/BsG,UAAYb,kBAAkBY,SAAU1B,gBACxC4B,SAAWnB,mBAAmBrM,KAAImN,GAAKD,iBAAiBC,EAAE3E,WAG1DiF,EAAIF,UAAUlM,OAAQqM,EAAIF,SAASnM,OACnCsM,GAAKC,MAAMH,EAAI,GAAGI,OAAO7N,KAAI,IAAM4N,MAAMF,EAAI,GAAGG,KAAK,KACrDC,UAAYF,MAAMH,EAAI,GAAGI,OAAO7N,KAAI,IAAM4N,MAAMF,EAAI,GAAGG,KAAK,QAE5DE,UAAY,EAAGC,aAAe,EAAGC,IAAM,MAExC,IAAIlM,EAAI,EAAGA,GAAK0L,EAAG1L,IAAO4L,GAAG5L,GAAG,GAAKA,EAAIkM,IAAKH,UAAU/L,GAAG,GAAK,SAChE,IAAImM,EAAI,EAAGA,GAAKR,EAAGQ,IAAOP,GAAG,GAAGO,GAAKA,EAAID,IAAKH,UAAU,GAAGI,GAAK,WAEhE,IAAInM,EAAI,EAAGA,GAAK0L,EAAG1L,QACf,IAAImM,EAAI,EAAGA,GAAKR,EAAGQ,IAAK,OAGnBC,KAFSZ,UAAUxL,EAAI,KACbyL,SAASU,EAAI,GACKH,UAAYC,aAExCI,KAAOT,GAAG5L,EAAI,GAAGmM,EAAI,GAAKC,KAC1BE,GAAKV,GAAG5L,EAAI,GAAGmM,GAAKD,IACpBK,KAAOX,GAAG5L,GAAGmM,EAAI,GAAKD,IAE5BN,GAAG5L,GAAGmM,GAAKvR,KAAK4R,IAAIH,KAAMC,GAAIC,MAC9BR,UAAU/L,GAAGmM,GAAMP,GAAG5L,GAAGmM,KAAOE,KAAQ,OAAUT,GAAG5L,GAAGmM,KAAOG,GAAK,KAAO,WAI/EtM,EAAI0L,EAAGS,EAAIR,QACTc,OAAS,QAERzM,EAAI,GAAKmM,EAAI,GAAG,OACbO,KAAOX,UAAU/L,GAAGmM,GACb,SAATO,MACAD,OAAOE,QAAQ,CACXvG,OAAQoF,UAAUxL,EAAI,GACtBqG,QAASiE,mBAAmB6B,EAAI,GAAG1F,QACnCF,MAAO+D,mBAAmB6B,EAAI,GAAGzG,wBAAwBO,gBAE7DjG,IAAKmM,KACW,OAATO,MACPD,OAAOE,QAAQ,CAAEvG,OAAQoF,UAAUxL,EAAI,GAAIqG,QAAS,KAAME,MAAO,OACjEvG,KAEAmM,WAIDM,iBAORlT"}