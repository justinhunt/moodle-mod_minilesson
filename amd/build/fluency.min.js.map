{"version":3,"file":"fluency.min.js","sources":["../src/fluency.js"],"sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions','mod_minilesson/cloudpoodllloader',\n    'mod_minilesson/ttrecorder', 'core/templates'],\n    function($, log, def,cloudpoodll, ttrecorder, templates) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the fluency item type\n   */\n\n  log.debug('MiniLesson Fluency: initialising');\n\n  return {\n\n    speechConfig: null,\n    referencetext: 'I met my love by the gas works wall',\n\n    //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n     },\n\n    init: function(index, itemdata, quizhelper) {\n      this.itemdata = itemdata;\n      this.register_events(index, itemdata, quizhelper);\n      this.referencetext = itemdata.referencetext;\n      this.init_components(quizhelper, itemdata);\n    },\n\n    init_components: function(quizhelper,itemdata){\n      var self=this;\n\n      self.thebutton = \"thettrbutton\"; // To Do impl. this\n      self.wordcount = $(\"#\" + self.itemdata.uniqueid + \"_container span.ml_wordcount\");\n      self.actionbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_fluency_actionbox\");\n      self.pendingbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_fluency_pendingbox\");\n      self.resultsbox = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_fluency_resultsbox\");\n      self.timerdisplay = $(\"#\" + self.itemdata.uniqueid + \"_container div.ml_fluency_timerdisplay\");\n\n      // Callback: Recorder updates.\n      var recorderCallback = function(message) {\n\n        switch (message.type) {\n          case 'recording':\n            break;\n\n          case 'pronunciation_results':\n            var speechresults= message.results;\n            self.do_evaluation(speechresults);    \n        } //end of switch message type\n      };\n\n      if(quizhelper.use_ttrecorder()) {\n          //init tt recorder\n          var opts = {};\n          opts.uniqueid = itemdata.uniqueid;\n          opts.callback = recorderCallback;\n          opts.stt_guided=false;\n          opts.referencetext=this.referencetext;\n          self.ttrec = ttrecorder.clone();\n          self.ttrec.init(opts);\n\n      }else{\n          //init cloudpoodll push recorder\n          cloudpoodll.init('minilesson-recorder-fluency-' + itemdata.id, recorderCallback);\n      }\n    }, //end of init components\n\n\n\n    next_question: function(percent) {\n      var self = this;\n      var stepdata = {};\n      stepdata.index = self.index;\n      stepdata.hasgrade = true;\n      stepdata.totalitems = 1;\n      stepdata.correctitems = percent>0?1:0;\n      stepdata.grade = percent;\n      self.quizhelper.do_next(stepdata);\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n      \n      var self = this;\n      self.index = index;\n      self.quizhelper = quizhelper;\n      var nextbutton = $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\");\n      \n      nextbutton.on('click', function(e) {\n        self.next_question(0);\n      });\n\n    },\n\n    do_evaluation: function (pronunciation_result) {\n      log.debug(\"Accuracy score: \", pronunciation_result.accuracyScore);\n      log.debug(\"Pronunciation score: \", pronunciation_result.pronunciationScore);\n      log.debug(\"Completeness score : \", pronunciation_result.completenessScore);\n      log.debug(\"Fluency score: \", pronunciation_result.fluencyScore);\n      log.debug(\"Prosody score: \", pronunciation_result.prosodyScore);\n      \n      log.debug(\"  Word-level details:\");\n      pronunciation_result.detailResult.Words.forEach(function (word, idx) {\n          console.log(\"    \", idx + 1, \": word: \", word.Word, \"\\taccuracy score: \", word.PronunciationAssessment.AccuracyScore, \"\\terror type: \", word.PronunciationAssessment.ErrorType, \";\");\n      });\n    },\n  };\n});"],"names":["define","$","log","def","cloudpoodll","ttrecorder","templates","debug","speechConfig","referencetext","clone","extend","this","init","index","itemdata","quizhelper","register_events","init_components","self","thebutton","wordcount","uniqueid","actionbox","pendingbox","resultsbox","timerdisplay","recorderCallback","message","type","speechresults","results","do_evaluation","use_ttrecorder","opts","callback","stt_guided","ttrec","id","next_question","percent","stepdata","hasgrade","totalitems","correctitems","grade","do_next","on","e","pronunciation_result","accuracyScore","pronunciationScore","completenessScore","fluencyScore","prosodyScore","detailResult","Words","forEach","word","idx","console","Word","PronunciationAssessment","AccuracyScore","ErrorType"],"mappings":"AAAAA,gCAAO,CAAC,SAAU,WAAY,6BAA6B,mCACvD,4BAA6B,mBAC7B,SAASC,EAAGC,IAAKC,IAAIC,YAAaC,WAAYC,kBAOhDJ,IAAIK,MAAM,oCAEH,CAELC,aAAc,KACdC,cAAe,sCAGbC,MAAO,kBACIT,EAAEU,QAAO,EAAM,GAAIC,OAGhCC,KAAM,SAASC,MAAOC,SAAUC,iBACzBD,SAAWA,cACXE,gBAAgBH,MAAOC,SAAUC,iBACjCP,cAAgBM,SAASN,mBACzBS,gBAAgBF,WAAYD,WAGnCG,gBAAiB,SAASF,WAAWD,cAC/BI,KAAKP,KAETO,KAAKC,UAAY,eACjBD,KAAKE,UAAYpB,EAAE,IAAMkB,KAAKJ,SAASO,SAAW,gCAClDH,KAAKI,UAAYtB,EAAE,IAAMkB,KAAKJ,SAASO,SAAW,uCAClDH,KAAKK,WAAavB,EAAE,IAAMkB,KAAKJ,SAASO,SAAW,wCACnDH,KAAKM,WAAaxB,EAAE,IAAMkB,KAAKJ,SAASO,SAAW,wCACnDH,KAAKO,aAAezB,EAAE,IAAMkB,KAAKJ,SAASO,SAAW,8CAGjDK,iBAAmB,SAASC,gBAEtBA,QAAQC,UACT,sBAGA,4BACCC,cAAeF,QAAQG,QAC3BZ,KAAKa,cAAcF,oBAItBd,WAAWiB,iBAAkB,KAExBC,KAAO,GACXA,KAAKZ,SAAWP,SAASO,SACzBY,KAAKC,SAAWR,iBAChBO,KAAKE,YAAW,EAChBF,KAAKzB,cAAcG,KAAKH,cACxBU,KAAKkB,MAAQhC,WAAWK,QACxBS,KAAKkB,MAAMxB,KAAKqB,WAIhB9B,YAAYS,KAAK,+BAAiCE,SAASuB,GAAIX,mBAMrEY,cAAe,SAASC,aAElBC,SAAW,GACfA,SAAS3B,MAFEF,KAEWE,MACtB2B,SAASC,UAAW,EACpBD,SAASE,WAAa,EACtBF,SAASG,aAAeJ,QAAQ,EAAE,EAAE,EACpCC,SAASI,MAAQL,QANN5B,KAONI,WAAW8B,QAAQL,WAG1BxB,gBAAiB,SAASH,MAAOC,SAAUC,gBAErCG,KAAOP,KACXO,KAAKL,MAAQA,MACbK,KAAKH,WAAaA,WACDf,EAAE,IAAMc,SAASO,SAAW,qCAElCyB,GAAG,SAAS,SAASC,GAC9B7B,KAAKoB,cAAc,OAKvBP,cAAe,SAAUiB,sBACvB/C,IAAIK,MAAM,mBAAoB0C,qBAAqBC,eACnDhD,IAAIK,MAAM,wBAAyB0C,qBAAqBE,oBACxDjD,IAAIK,MAAM,wBAAyB0C,qBAAqBG,mBACxDlD,IAAIK,MAAM,kBAAmB0C,qBAAqBI,cAClDnD,IAAIK,MAAM,kBAAmB0C,qBAAqBK,cAElDpD,IAAIK,MAAM,yBACV0C,qBAAqBM,aAAaC,MAAMC,SAAQ,SAAUC,KAAMC,KAC5DC,QAAQ1D,IAAI,OAAQyD,IAAM,EAAG,WAAYD,KAAKG,KAAM,qBAAsBH,KAAKI,wBAAwBC,cAAe,iBAAkBL,KAAKI,wBAAwBE,UAAW"}