{"version":3,"file":"searchlesson.min.js","sources":["../src/searchlesson.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module searchlesson\n *\n * @module     mod_minilesson/searchlesson\n * @copyright  2025 Justin Hunt (poodllsupport@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport * as Str from 'core/str';\nimport Fragment from 'core/fragment';\n\n\nconst component = 'mod_minilesson';\n\nexport const registerFilter = () => {\n    const form = document.querySelector('#lessonbank_filters');\n    const cardsContainer = document.querySelector('[data-region=\"cards-container\"]');\n    const searchFilter = form => {\n\n        const functionname = 'local_lessonbank_list_minilessons';\n        const params = new URLSearchParams();\n        if (form.elements['searchgroup[language]']) {\n            params.append('language', form.elements['searchgroup[language]'].value);\n        }\n        if (form.elements['searchgroup[keyword]']) {\n            params.append('keywords', form.elements['searchgroup[keyword]'].value);\n        }\n        if (form.elements['level[]']) {\n            const selectedOptions = form.elements['level[]'].selectedOptions;\n            Array.from(selectedOptions).forEach((option, index) => {\n                params.append(`level[${index}]`, option.value);\n            });\n        }\n        const args = {\n            function: functionname,\n            args: params.toString(),\n        };\n        Ajax.call([{\n            methodname: `${component}_lessonbank`,\n            args: args,\n        }])[0].then(items => {\n            items = JSON.parse(items.data);\n            Templates.render(`${component}/lessonbankitems`, {items})\n            .then((html, js) => {\n                return Templates.replaceNodeContents(cardsContainer, html, js);\n            }).then(() => {\n                document.querySelector('#region-main')?.scrollIntoView({\n                    behavior: \"smooth\",\n                    block: \"start\"\n                });\n            });\n            return null;\n        })\n        .catch(Notification.exception);\n    };\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const downloadbtn = e.target.closest('[data-action=\"download\"]');\n        if (downloadbtn) {\n            if (!downloadbtn.dataset.id) {\n                return;\n            }\n            const id = Number(downloadbtn.dataset.id);\n            const url = new URL(window.location.href);\n            url.searchParams.set('restore', id);\n            url.searchParams.set('sesskey', M.cfg.sesskey);\n            window.location.href = url.toString();\n        }\n        const showtextbtn = e.target.closest('[data-action=\"showtext\"]');\n        if (showtextbtn) {\n            const wrapper = showtextbtn.parentElement;\n            const titlehtml = wrapper.firstElementChild.cloneNode(true).outerHTML;\n            wrapper.innerHTML = titlehtml + wrapper.dataset.text;\n        }\n    });\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const translatebtn = e.target.closest('[data-action=\"translate\"]');\n        if (translatebtn) {\n            const callFragment = data => {\n                return Fragment.loadFragment(component, 'translatetoimport', M.cfg.contextid, {\n                    params: data\n                })\n                .then((response, js) => new Promise(resolve => {\n                    response = JSON.parse(response);\n                    return resolve(\n                        response,\n                        js\n                    );\n                }));\n            };\n            ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                large: false,\n                removeOnClose: true,\n                title: Str.get_string('translatetoimport', component),\n                body: callFragment(\n                    new URLSearchParams([...Object.entries(translatebtn.dataset)]).toString()\n                ).then((response, js) => new Promise(resolve => resolve(\n                    response.html, js\n                )))\n            }).then(function (modal) {\n                modal.hideFooter();\n                modal.getRoot().on('submit ' + ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var form = this.querySelector('form');\n                    modal.setBody(\n                        callFragment(new URLSearchParams(new FormData(form)).toString())\n                        .then((response, js) => new Promise(resolve => {\n                            if (response.redirecturl) {\n                                location.href = response.redirecturl;\n                                resolve('', js);\n                                return;\n                            }\n                            resolve(response.html, js);\n                        }))\n                    );\n                });\n                modal.show();\n            });\n        }\n    });\n    form?.addEventListener('submit', e => {\n        e.preventDefault();\n        searchFilter(form);\n    });\n    if (form) {\n        searchFilter(form);\n    }\n};"],"names":["component","form","document","querySelector","cardsContainer","searchFilter","params","URLSearchParams","elements","append","value","selectedOptions","Array","from","forEach","option","index","args","function","toString","call","methodname","then","items","JSON","parse","data","render","html","js","Templates","replaceNodeContents","scrollIntoView","behavior","block","catch","Notification","exception","addEventListener","e","target","href","preventDefault","downloadbtn","closest","dataset","id","Number","url","URL","window","location","searchParams","set","M","cfg","sesskey","showtextbtn","wrapper","parentElement","titlehtml","firstElementChild","cloneNode","outerHTML","innerHTML","text","translatebtn","callFragment","Fragment","loadFragment","contextid","response","Promise","resolve","create","type","ModalFactory","types","DEFAULT","large","removeOnClose","title","Str","get_string","body","Object","entries","modal","hideFooter","getRoot","on","ModalEvents","save","this","setBody","FormData","redirecturl","show"],"mappings":"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"}