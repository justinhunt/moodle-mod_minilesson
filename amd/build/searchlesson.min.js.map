{"version":3,"sources":["../src/searchlesson.js"],"names":["registerFilter","form","document","querySelector","cardsContainer","searchFilter","params","URLSearchParams","elements","append","value","selectedOptions","Array","from","forEach","option","index","args","function","toString","Ajax","call","methodname","then","items","JSON","parse","window","console","log","Templates","render","html","js","replaceNodeContents","scrollIntoView","behavior","block","catch","Notification","exception","addEventListener","e","target","href","preventDefault","downloadbtn","closest","dataset","id","url","URL","location","searchParams","set","M","cfg","sesskey","showtextbtn","wrapper","parentElement","titlehtml","firstElementChild","cloneNode","outerHTML","innerHTML","text"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module searchlesson\n *\n * @module     mod_minilesson/searchlesson\n * @copyright  2025 YOUR NAME <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport Templates from 'core/templates';\n// import loading from 'core/loadingicon';\n\n\nconst component = 'mod_minilesson';\n\nexport const registerFilter = () => {\n    const form = document.querySelector('#lessonbank_filters');\n    const cardsContainer = document.querySelector('[data-region=\"cards-container\"]');\n    const searchFilter = form => {\n\n        const functionname = 'local_lessonbank_list_minilessons';\n        const params = new URLSearchParams();\n        if (form.elements['searchgroup[language]']) {\n            params.append('language', form.elements['searchgroup[language]'].value);\n        }\n        if (form.elements['searchgroup[keyword]']) {\n            params.append('keywords', form.elements['searchgroup[keyword]'].value);\n        }\n        if (form.elements['level[]']) {\n            const selectedOptions = form.elements['level[]'].selectedOptions;\n            Array.from(selectedOptions).forEach((option, index) => {\n                params.append(`level[${index}]`, option.value);\n            });\n        }\n        const args = {\n            function: functionname,\n            args: params.toString(),\n        };\n        Ajax.call([{\n            methodname: `${component}_lessonbank`,\n            args: args,\n        }])[0].then(items => {\n            items = JSON.parse(items);\n            window.console.log(items);\n            Templates.render(`${component}/lessonbankitems`, {items})\n            .then((html, js) => {\n                return Templates.replaceNodeContents(cardsContainer, html, js);\n            }).then(() => {\n                document.querySelector('#region-main')?.scrollIntoView({\n                    behavior: \"smooth\",\n                    block: \"start\"\n                });\n            });\n            return null;\n        })\n        .catch(Notification.exception);\n    };\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const downloadbtn = e.target.closest('[data-action=\"download\"]');\n        if (downloadbtn) {\n            if (!downloadbtn.dataset.id) {\n                return;\n            }\n            const id = Number(downloadbtn.dataset.id);\n            const url = new URL(window.location.href);\n            url.searchParams.set('restore', id);\n            url.searchParams.set('sesskey', M.cfg.sesskey);\n            window.location.href = url.toString();\n        }\n        const showtextbtn = e.target.closest('[data-action=\"showtext\"]');\n        if (showtextbtn) {\n            const wrapper = showtextbtn.parentElement;\n            const titlehtml = wrapper.firstElementChild.cloneNode(true).outerHTML;\n            wrapper.innerHTML = titlehtml + wrapper.dataset.text;\n        }\n    });\n    form?.addEventListener('submit', e => {\n        e.preventDefault();\n        searchFilter(form);\n    });\n    if (form) {\n        searchFilter(form);\n    }\n};"],"file":"searchlesson.min.js"}