{"version":3,"sources":["../src/searchlesson.js"],"names":["registerFilter","form","document","querySelector","cardsContainer","searchFilter","params","URLSearchParams","elements","append","value","selectedOptions","Array","from","forEach","option","index","args","function","toString","Ajax","call","methodname","then","items","JSON","parse","data","Templates","render","html","js","replaceNodeContents","scrollIntoView","behavior","block","catch","Notification","exception","addEventListener","e","target","href","preventDefault","downloadbtn","closest","dataset","id","url","URL","window","location","searchParams","set","M","cfg","sesskey","showtextbtn","wrapper","parentElement","titlehtml","firstElementChild","cloneNode","outerHTML","innerHTML","text","translatebtn","callFragment","Fragment","loadFragment","contextid","response","Promise","resolve","ModalFactory","create","type","types","DEFAULT","large","removeOnClose","title","Str","get_string","body","Object","entries","modal","hideFooter","getRoot","on","ModalEvents","save","setBody","FormData","redirecturl","show"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module searchlesson\n *\n * @module     mod_minilesson/searchlesson\n * @copyright  2025 Justin Hunt (poodllsupport@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport * as Str from 'core/str';\nimport Fragment from 'core/fragment';\n\n\nconst component = 'mod_minilesson';\n\nexport const registerFilter = () => {\n    const form = document.querySelector('#lessonbank_filters');\n    const cardsContainer = document.querySelector('[data-region=\"cards-container\"]');\n    const searchFilter = form => {\n\n        const functionname = 'local_lessonbank_list_minilessons';\n        const params = new URLSearchParams();\n        if (form.elements['searchgroup[language]']) {\n            params.append('language', form.elements['searchgroup[language]'].value);\n        }\n        if (form.elements['searchgroup[keyword]']) {\n            params.append('keywords', form.elements['searchgroup[keyword]'].value);\n        }\n        if (form.elements['level[]']) {\n            const selectedOptions = form.elements['level[]'].selectedOptions;\n            Array.from(selectedOptions).forEach((option, index) => {\n                params.append(`level[${index}]`, option.value);\n            });\n        }\n        const args = {\n            function: functionname,\n            args: params.toString(),\n        };\n        Ajax.call([{\n            methodname: `${component}_lessonbank`,\n            args: args,\n        }])[0].then(items => {\n            items = JSON.parse(items.data);\n            Templates.render(`${component}/lessonbankitems`, {items})\n            .then((html, js) => {\n                return Templates.replaceNodeContents(cardsContainer, html, js);\n            }).then(() => {\n                document.querySelector('#region-main')?.scrollIntoView({\n                    behavior: \"smooth\",\n                    block: \"start\"\n                });\n            });\n            return null;\n        })\n        .catch(Notification.exception);\n    };\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const downloadbtn = e.target.closest('[data-action=\"download\"]');\n        if (downloadbtn) {\n            if (!downloadbtn.dataset.id) {\n                return;\n            }\n            const id = Number(downloadbtn.dataset.id);\n            const url = new URL(window.location.href);\n            url.searchParams.set('restore', id);\n            url.searchParams.set('sesskey', M.cfg.sesskey);\n            window.location.href = url.toString();\n        }\n        const showtextbtn = e.target.closest('[data-action=\"showtext\"]');\n        if (showtextbtn) {\n            const wrapper = showtextbtn.parentElement;\n            const titlehtml = wrapper.firstElementChild.cloneNode(true).outerHTML;\n            wrapper.innerHTML = titlehtml + wrapper.dataset.text;\n        }\n    });\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const translatebtn = e.target.closest('[data-action=\"translate\"]');\n        if (translatebtn) {\n            const callFragment = data => {\n                return Fragment.loadFragment(component, 'translatetoimport', M.cfg.contextid, {\n                    params: data\n                })\n                .then((response, js) => new Promise(resolve => {\n                    response = JSON.parse(response);\n                    return resolve(\n                        response,\n                        js\n                    );\n                }));\n            };\n            ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                large: false,\n                removeOnClose: true,\n                title: Str.get_string('translatetoimport', component),\n                body: callFragment(\n                    new URLSearchParams([...Object.entries(translatebtn.dataset)]).toString()\n                ).then((response, js) => new Promise(resolve => resolve(\n                    response.html, js\n                )))\n            }).then(function (modal) {\n                modal.hideFooter();\n                modal.getRoot().on('submit ' + ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var form = this.querySelector('form');\n                    modal.setBody(\n                        callFragment(new URLSearchParams(new FormData(form)).toString())\n                        .then((response, js) => new Promise(resolve => {\n                            if (response.redirecturl) {\n                                location.href = response.redirecturl;\n                                resolve('', js);\n                                return;\n                            }\n                            resolve(response.html, js);\n                        }))\n                    );\n                });\n                modal.show();\n            });\n        }\n    });\n    form?.addEventListener('submit', e => {\n        e.preventDefault();\n        searchFilter(form);\n    });\n    if (form) {\n        searchFilter(form);\n    }\n};"],"file":"searchlesson.min.js"}