{"version":3,"sources":["../src/searchlesson.js"],"names":["registerFilter","form","document","querySelector","cardsContainer","gridlayoutbtn","listlayoutbtn","countcontainer","pagination","addEventListener","e","preventDefault","classList","remove","add","searchFilter","params","URLSearchParams","elements","append","value","selectedOptions","Array","from","forEach","option","index","page","perpage","args","function","toString","Ajax","call","methodname","then","items","JSON","parse","data","islistlayot","contains","Str","get_string","totalitems","langstr","textContent","Templates","render","html","js","replaceNodeContents","scrollIntoView","behavior","block","catch","Notification","exception","target","href","dirbtn","closest","pageno","getAttribute","pagevalue","parseInt","dataset","action","downloadbtn","id","url","URL","window","location","searchParams","set","M","cfg","sesskey","showtextbtn","wrapper","parentElement","titlehtml","firstElementChild","cloneNode","outerHTML","innerHTML","text","translatebtn","callFragment","Fragment","loadFragment","contextid","response","Promise","resolve","ModalFactory","create","type","types","DEFAULT","large","removeOnClose","title","body","Object","entries","modal","hideFooter","getRoot","on","ModalEvents","save","setBody","FormData","redirecturl","show","perpagevalue"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module searchlesson\n *\n * @module     mod_minilesson/searchlesson\n * @copyright  2025 Justin Hunt (poodllsupport@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport * as Str from 'core/str';\nimport Fragment from 'core/fragment';\n\nconst component = 'mod_minilesson';\n\nexport const registerFilter = () => {\n    const form = document.querySelector('#lessonbank_filters');\n    const cardsContainer = document.querySelector('[data-region=\"cards-container\"]');\n    const gridlayoutbtn = document.querySelector('.gridlayoutbtn');\n    const listlayoutbtn = document.querySelector('.listlayoutbtn');\n    const countcontainer = document.querySelector('.countcontainer');\n    const pagination = document.querySelector('[name=\"perpageselection\"]');\n\n    gridlayoutbtn?.addEventListener('click', e => {\n        e.preventDefault();\n        cardsContainer.classList.remove('listlayout');\n        gridlayoutbtn.classList.add('active');\n        listlayoutbtn.classList.remove('active');\n        searchFilter(form);\n    });\n\n    listlayoutbtn?.addEventListener('click', e => {\n        e.preventDefault();\n        cardsContainer.classList.add('listlayout');\n        listlayoutbtn.classList.add('active');\n        gridlayoutbtn.classList.remove('active');\n        searchFilter(form);\n    });\n\n    const searchFilter = form => {\n\n        const functionname = 'local_lessonbank_list_minilessons';\n        const params = new URLSearchParams();\n        if (form.elements['searchgroup[language]']) {\n            params.append('language', form.elements['searchgroup[language]'].value);\n        }\n        if (form.elements['searchgroup[keyword]']) {\n            params.append('keywords', form.elements['searchgroup[keyword]'].value);\n        }\n        if (form.elements['level[]']) {\n            const selectedOptions = form.elements['level[]'].selectedOptions;\n            Array.from(selectedOptions).forEach((option, index) => {\n                params.append(`level[${index}]`, option.value);\n            });\n        }\n        if (form.elements.page) {\n            params.append('page', form.elements.page.value);\n        }\n        if (form.elements.perpage) {\n            params.append('perpage', form.elements.perpage.value);\n        }\n        const args = {\n            function: functionname,\n            args: params.toString(),\n        };\n        Ajax.call([{\n            methodname: `${component}_lessonbank`,\n            args: args,\n        }])[0].then(items => {\n            items = JSON.parse(items.data);\n            items.islistlayot = cardsContainer.classList.contains('listlayout') ? true : false;\n            if (countcontainer) {\n                Str.get_string('foundlessons', 'mod_minilesson', items.totalitems).then((langstr) => {\n                    countcontainer.textContent = langstr;\n                });\n            }\n            Templates.render(`${component}/lessonbankitems`, items)\n            .then((html, js) => {\n                return Templates.replaceNodeContents(cardsContainer, html, js);\n            }).then(() => {\n                document.querySelector('#region-main')?.scrollIntoView({\n                    behavior: \"smooth\",\n                    block: \"start\"\n                });\n            });\n            return null;\n        })\n        .catch(Notification.exception);\n    };\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n       const dirbtn = e.target.closest('[data-action=\"previousbtn\"],[data-action=\"nextbtn\"]');\n        if (dirbtn) {\n            const pageno = dirbtn.getAttribute('data-page');\n            const perpage = dirbtn.getAttribute('data-perpage');\n            const pagevalue = parseInt(pageno, 10) + (dirbtn.dataset.action === 'previousbtn' ? -1: 1);\n            if (form) {\n                form.elements.page.value = pagevalue;\n                form.elements.perpage.value = perpage;\n                searchFilter(form);\n            }\n        }\n        const downloadbtn = e.target.closest('[data-action=\"download\"]');\n        if (downloadbtn) {\n            if (!downloadbtn.dataset.id) {\n                return;\n            }\n            const id = Number(downloadbtn.dataset.id);\n            const url = new URL(window.location.href);\n            url.searchParams.set('restore', id);\n            url.searchParams.set('sesskey', M.cfg.sesskey);\n            window.location.href = url.toString();\n        }\n        const showtextbtn = e.target.closest('[data-action=\"showtext\"]');\n        if (showtextbtn) {\n            const wrapper = showtextbtn.parentElement;\n            const titlehtml = wrapper.firstElementChild.cloneNode(true).outerHTML;\n            wrapper.innerHTML = titlehtml + wrapper.dataset.text;\n        }\n    });\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const translatebtn = e.target.closest('[data-action=\"translate\"]');\n        if (translatebtn) {\n            const callFragment = data => {\n                return Fragment.loadFragment(component, 'translatetoimport', M.cfg.contextid, {\n                    params: data\n                })\n                .then((response, js) => new Promise(resolve => {\n                    response = JSON.parse(response);\n                    return resolve(\n                        response,\n                        js\n                    );\n                }));\n            };\n            ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                large: false,\n                removeOnClose: true,\n                title: Str.get_string('translatetoimport', component),\n                body: callFragment(\n                    new URLSearchParams([...Object.entries(translatebtn.dataset)]).toString()\n                ).then((response, js) => new Promise(resolve => resolve(\n                    response.html, js\n                )))\n            }).then(function (modal) {\n                modal.hideFooter();\n                modal.getRoot().on('submit ' + ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var form = this.querySelector('form');\n                    modal.setBody(\n                        callFragment(new URLSearchParams(new FormData(form)).toString())\n                        .then((response, js) => new Promise(resolve => {\n                            if (response.redirecturl) {\n                                location.href = response.redirecturl;\n                                resolve('', js);\n                                return;\n                            }\n                            resolve(response.html, js);\n                        }))\n                    );\n                });\n                modal.show();\n            });\n        }\n    });\n    if (pagination) {\n        pagination.addEventListener('change', e => {\n            const perpagevalue = e.target.value;\n            if (form) {\n                form.elements.page.value = 1;\n                form.elements.perpage.value = perpagevalue;\n                searchFilter(form);\n            }\n        });\n    }\n    form?.addEventListener('submit', e => {\n        e.preventDefault();\n        form.querySelector('[name=\"page\"]').value = 1;\n        searchFilter(form);\n    });\n    if (form) {\n        searchFilter(form);\n    }\n};"],"file":"searchlesson.min.js"}