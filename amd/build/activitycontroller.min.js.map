{"version":3,"file":"activitycontroller.min.js","sources":["../src/activitycontroller.js"],"sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log','mod_minilesson/definitions','mod_minilesson/quizhelper','mod_minilesson/pollyhelper',\n    'core/modal_factory', 'core/modal_events', 'core/str'],\n    function ($,  log, def,  quizhelper,polly, ModalFactory, ModalEvents, Str) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Activity controller: initialising');\n\n    return {\n\n        cmid: null,\n        activitydata: null,\n        sorryboxid: null,\n        controls: null,\n\n        //pass in config, the jquery video/audio object, and a function to be called when conversion has finshed\n        init: function (props) {\n            var dd = this;\n\n            //pick up opts from html\n            var theid = '#amdopts_' + props.widgetid;\n            var configcontrol = $(theid).get(0);\n            if (configcontrol) {\n                dd.activitydata = JSON.parse(configcontrol.value);\n                $(theid).remove();\n            } else {\n                //if there is no config we might as well give up\n                log.debug('MiniLesson activity Controller: No config found on page. Giving up.');\n                return;\n            }\n\n            dd.cmid = props.cmid;\n            dd.attemptid = 1;\n            dd.sorryboxid = props.widgetid + '_sorrybox';\n\n            polly.init(\n                dd.activitydata.token,\n                dd.activitydata.region,\n                dd.activitydata.owner,\n                dd.activitydata.cloudpoodllurl\n            );\n\n            dd.register_events();\n            dd.process_html();\n            //OR to show quiz and no recorder do dd.doquizlayout\n            dd.doquizlayout();\n        },\n\n        process_html: function () {\n            var opts = this.activitydata;\n            //these css classes/ids are all passed in from php in\n            //renderer.php::fetch_activity_amd\n            var controls = {\n                introbox: $('.' + 'mod_intro_box'),\n                quizcontainer: $('.' +  opts['quizcontainer']),\n                feedbackcontainer: $('.' +  opts['feedbackcontainer']),\n                errorcontainer: $('.' +  opts['errorcontainer']),\n                instructionscontainer: $('.' +  opts['instructionscontainer']),\n                wheretonextcontainer: $('.' +  opts['wheretonextcontainer']),\n                placeholder: $('.mod_minilesson_placeholder')\n            };\n            this.controls = controls;\n        },\n\n        register_events: function () {\n           //do something\n\n        },\n\n        doquizlayout: function () {\n            var dd = this;\n            dd.controls.instructionscontainer.hide();\n\n            //set up the quiz\n           // quizhelper.onSubmit = function(returndata){dd.dofinishedreadinglayout(returndata);};\n            quizhelper.init(\n                dd.controls.quizcontainer,\n                this.activitydata,\n                this.cmid,\n                this.attemptid,\n                polly\n            );\n\n            //show the quiz\n            dd.controls.placeholder.hide();\n            dd.controls.quizcontainer.show();\n\n\n        },\n\n        doerrorlayout: function () {\n            this.controls.errorcontainer.show();\n            this.controls.wheretonextcontainer.show();\n        },\n\n        continueconfirmation: function(buttonselector) {\n            const deletebtn = document.querySelector(buttonselector);\n            if (!deletebtn) {\n                return;\n            }\n            deletebtn.addEventListener('click', e => {\n                e.preventDefault();\n                const form = deletebtn.form;\n                if (!form) {\n                    return;\n                }\n\n                Str.get_strings([\n                    {key: 'confirmation', component: 'core_admin'},\n                    {key: 'confirmactionmessage', component: 'mod_minilesson'},\n                    {key: 'ok', component: 'moodle'},\n                ]).then(strings => {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: strings[0],\n                        body: strings[1],\n                        buttons: {\n                            save: strings[2]\n                        }\n                    }).then(modal => {\n                        modal.getRoot().on(ModalEvents.save, () => {\n                            const hidden = document.createElement('input');\n                            hidden.type = 'hidden';\n                            hidden.name = deletebtn.getAttribute('name');\n                            hidden.value = deletebtn.getAttribute('value');\n                            form.appendChild(hidden);\n                            form.submit();\n                        });\n                        modal.show();\n                    });\n                });\n                return;\n            });\n        }\n    };//end of returned object\n});//total end\n"],"names":["define","$","log","def","quizhelper","polly","ModalFactory","ModalEvents","Str","debug","cmid","activitydata","sorryboxid","controls","init","props","dd","this","theid","widgetid","configcontrol","get","JSON","parse","value","remove","attemptid","token","region","owner","cloudpoodllurl","register_events","process_html","doquizlayout","opts","introbox","quizcontainer","feedbackcontainer","errorcontainer","instructionscontainer","wheretonextcontainer","placeholder","hide","show","doerrorlayout","continueconfirmation","buttonselector","deletebtn","document","querySelector","addEventListener","e","preventDefault","form","get_strings","key","component","then","strings","create","type","types","SAVE_CANCEL","title","body","buttons","save","modal","getRoot","on","hidden","createElement","name","getAttribute","appendChild","submit"],"mappings":"AACAA,2CAAO,CAAC,SAAU,WAAW,6BAA6B,4BAA4B,6BAClF,qBAAsB,oBAAqB,aAC3C,SAAUC,EAAIC,IAAKC,IAAMC,WAAWC,MAAOC,aAAcC,YAAaC,YAItEN,IAAIO,MAAM,qCAEH,CAEHC,KAAM,KACNC,aAAc,KACdC,WAAY,KACZC,SAAU,KAGVC,KAAM,SAAUC,WACRC,GAAKC,KAGLC,MAAQ,YAAcH,MAAMI,SAC5BC,cAAgBnB,EAAEiB,OAAOG,IAAI,GAC7BD,eACAJ,GAAGL,aAAeW,KAAKC,MAAMH,cAAcI,OAC3CvB,EAAEiB,OAAOO,SAObT,GAAGN,KAAOK,MAAML,KAChBM,GAAGU,UAAY,EACfV,GAAGJ,WAAaG,MAAMI,SAAW,YAEjCd,MAAMS,KACFE,GAAGL,aAAagB,MAChBX,GAAGL,aAAaiB,OAChBZ,GAAGL,aAAakB,MAChBb,GAAGL,aAAamB,gBAGpBd,GAAGe,kBACHf,GAAGgB,eAEHhB,GAAGiB,gBAlBC/B,IAAIO,MAAM,wEAqBlBuB,aAAc,eACNE,KAAOjB,KAAKN,aAGZE,SAAW,CACXsB,SAAUlC,EAAE,kBACZmC,cAAenC,EAAE,IAAOiC,KAAI,eAC5BG,kBAAmBpC,EAAE,IAAOiC,KAAI,mBAChCI,eAAgBrC,EAAE,IAAOiC,KAAI,gBAC7BK,sBAAuBtC,EAAE,IAAOiC,KAAI,uBACpCM,qBAAsBvC,EAAE,IAAOiC,KAAI,sBACnCO,YAAaxC,EAAE,qCAEdY,SAAWA,UAGpBkB,gBAAiB,aAKjBE,aAAc,WACDhB,KACNJ,SAAS0B,sBAAsBG,OAIlCtC,WAAWU,KALFG,KAMFJ,SAASuB,cACZnB,KAAKN,aACLM,KAAKP,KACLO,KAAKS,UACLrB,OAVKY,KAcNJ,SAAS4B,YAAYC,OAdfzB,KAeNJ,SAASuB,cAAcO,QAK9BC,cAAe,gBACN/B,SAASyB,eAAeK,YACxB9B,SAAS2B,qBAAqBG,QAGvCE,qBAAsB,SAASC,sBACrBC,UAAYC,SAASC,cAAcH,gBACpCC,WAGLA,UAAUG,iBAAiB,SAASC,IAChCA,EAAEC,uBACIC,KAAON,UAAUM,KAClBA,MAIL7C,IAAI8C,YAAY,CACZ,CAACC,IAAK,eAAgBC,UAAW,cACjC,CAACD,IAAK,uBAAwBC,UAAW,kBACzC,CAACD,IAAK,KAAMC,UAAW,YACxBC,MAAKC,UACJpD,aAAaqD,OAAO,CAChBC,KAAMtD,aAAauD,MAAMC,YACzBC,MAAOL,QAAQ,GACfM,KAAMN,QAAQ,GACdO,QAAS,CACLC,KAAMR,QAAQ,MAEnBD,MAAKU,QACJA,MAAMC,UAAUC,GAAG9D,YAAY2D,MAAM,WAC3BI,OAAStB,SAASuB,cAAc,SACtCD,OAAOV,KAAO,SACdU,OAAOE,KAAOzB,UAAU0B,aAAa,QACrCH,OAAO9C,MAAQuB,UAAU0B,aAAa,SACtCpB,KAAKqB,YAAYJ,QACjBjB,KAAKsB,YAETR,MAAMxB"}