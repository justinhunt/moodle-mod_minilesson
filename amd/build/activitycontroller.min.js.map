{"version":3,"sources":["../src/activitycontroller.js"],"names":["define","$","log","def","quizhelper","polly","ModalFactory","ModalEvents","Str","debug","cmid","activitydata","sorryboxid","controls","init","props","dd","theid","widgetid","configcontrol","get","JSON","parse","value","remove","attemptid","token","region","owner","cloudpoodllurl","register_events","process_html","doquizlayout","opts","introbox","quizcontainer","feedbackcontainer","errorcontainer","instructionscontainer","wheretonextcontainer","placeholder","hide","show","doerrorlayout","continueconfirmation","buttonselector","deletebtn","document","querySelector","addEventListener","e","preventDefault","form","get_strings","key","component","then","strings","create","type","types","SAVE_CANCEL","title","body","buttons","save","modal","getRoot","on","hidden","createElement","name","getAttribute","appendChild","submit"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log','mod_minilesson/definitions','mod_minilesson/quizhelper','mod_minilesson/pollyhelper',\n    'core/modal_factory', 'core/modal_events', 'core/str'],\n    function ($,  log, def,  quizhelper,polly, ModalFactory, ModalEvents, Str) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Activity controller: initialising');\n\n    return {\n\n        cmid: null,\n        activitydata: null,\n        sorryboxid: null,\n        controls: null,\n\n        //pass in config, the jquery video/audio object, and a function to be called when conversion has finshed\n        init: function (props) {\n            var dd = this;\n\n            //pick up opts from html\n            var theid = '#amdopts_' + props.widgetid;\n            var configcontrol = $(theid).get(0);\n            if (configcontrol) {\n                dd.activitydata = JSON.parse(configcontrol.value);\n                $(theid).remove();\n            } else {\n                //if there is no config we might as well give up\n                log.debug('MiniLesson activity Controller: No config found on page. Giving up.');\n                return;\n            }\n\n            dd.cmid = props.cmid;\n            dd.attemptid = 1;\n            dd.sorryboxid = props.widgetid + '_sorrybox';\n\n            polly.init(\n                dd.activitydata.token,\n                dd.activitydata.region,\n                dd.activitydata.owner,\n                dd.activitydata.cloudpoodllurl\n            );\n\n            dd.register_events();\n            dd.process_html();\n            //OR to show quiz and no recorder do dd.doquizlayout\n            dd.doquizlayout();\n        },\n\n        process_html: function () {\n            var opts = this.activitydata;\n            //these css classes/ids are all passed in from php in\n            //renderer.php::fetch_activity_amd\n            var controls = {\n                introbox: $('.' + 'mod_intro_box'),\n                quizcontainer: $('.' +  opts['quizcontainer']),\n                feedbackcontainer: $('.' +  opts['feedbackcontainer']),\n                errorcontainer: $('.' +  opts['errorcontainer']),\n                instructionscontainer: $('.' +  opts['instructionscontainer']),\n                wheretonextcontainer: $('.' +  opts['wheretonextcontainer']),\n                placeholder: $('.mod_minilesson_placeholder')\n            };\n            this.controls = controls;\n        },\n\n        register_events: function () {\n           //do something\n\n        },\n\n        doquizlayout: function () {\n            var dd = this;\n            dd.controls.instructionscontainer.hide();\n\n            //set up the quiz\n           // quizhelper.onSubmit = function(returndata){dd.dofinishedreadinglayout(returndata);};\n            quizhelper.init(\n                dd.controls.quizcontainer,\n                this.activitydata,\n                this.cmid,\n                this.attemptid,\n                polly\n            );\n\n            //show the quiz\n            dd.controls.placeholder.hide();\n            dd.controls.quizcontainer.show();\n\n\n        },\n\n        doerrorlayout: function () {\n            this.controls.errorcontainer.show();\n            this.controls.wheretonextcontainer.show();\n        },\n\n        continueconfirmation: function(buttonselector) {\n            const deletebtn = document.querySelector(buttonselector);\n            if (!deletebtn) {\n                return;\n            }\n            deletebtn.addEventListener('click', e => {\n                e.preventDefault();\n                const form = deletebtn.form;\n                if (!form) {\n                    return;\n                }\n\n                Str.get_strings([\n                    {key: 'confirmation', component: 'core_admin'},\n                    {key: 'confirmactionmessage', component: 'mod_minilesson'},\n                    {key: 'ok', component: 'moodle'},\n                ]).then(strings => {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: strings[0],\n                        body: strings[1],\n                        buttons: {\n                            save: strings[2]\n                        }\n                    }).then(modal => {\n                        modal.getRoot().on(ModalEvents.save, () => {\n                            const hidden = document.createElement('input');\n                            hidden.type = 'hidden';\n                            hidden.name = deletebtn.getAttribute('name');\n                            hidden.value = deletebtn.getAttribute('value');\n                            form.appendChild(hidden);\n                            form.submit();\n                        });\n                        modal.show();\n                    });\n                });\n                return;\n            });\n        }\n    };//end of returned object\n});//total end\n"],"file":"activitycontroller.min.js"}